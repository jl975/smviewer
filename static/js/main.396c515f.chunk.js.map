{"version":3,"sources":["constants/index.js","utils/index.js","components/chart/canvas/Arrow.js","components/chart/canvas/ShockArrow.js","components/chart/canvas/StepZone.js","components/chart/canvas/Guidelines.js","utils/parseSimfile.js","utils/engineUtils.js","actions/AudioActions.js","reducers/AudioReducer.js","actions/ChartActions.js","reducers/ChartReducer.js","components/form/options.js","reducers/ModsReducer.js","reducers/SongSelectReducer.js","reducers/index.js","actions/ModsActions.js","store.js","core/AudioPlayer.js","core/GameEngine.js","components/chart/Progress.js","components/ui/HoldButton.js","components/chart/ChartArea.js","components/form/SongGrid.js","svg/audiowave.svg","components/form/SongForm.js","components/form/ModsForm.js","components/navigation/MobileNav.js","containers/main/MainContainer.js","App.js","index.js"],"names":["DIRECTIONS","SP_DIFFICULTIES","fetchDocument","path","a","fetch","mode","response","reader","body","getReader","decoder","TextDecoder","read","readResult","decode","value","getAssetPath","window","location","href","getJacketPath","capitalize","str","slice","toUpperCase","arrowImages","forEach","direction","Image","src","imageName","Arrow","attrs","key","mods","speed","noteskin","colorFreezes","this","note","measureIdx","measureN","measureD","originalBeatPosition","holdBeats","hitFrame","previousBeatPosition","beatTick","canvas","c","getContext","bottomBoundary","height","i","length","arrowImg","frameX","frameY","destX","destY","includes","freeze_head","indexOf","Math","floor","beatD","beatN","measureFraction","currentBeatPosition","drawImage","save","globalAlpha","pow","tap_explosion","ARROW_WIDTH","ARROW_HEIGHT","restore","arrowBodyImg","totalBodyHeight","repetitions","partialHeight","originalPartialHeight","partialDestY","freezeBeingHeld","bodyHeight","bodyFrameY","bodyDestY","tailHeight","tailPartialHeight","arrowHeadImg","ShockArrow","frame","flashImages","receptorImages","StepZone","isFlash","Guidelines","guidelines","finalBeat","showGuidelines","beat","lineWidth","beginPath","moveTo","lineTo","width","strokeStyle","stroke","modeRegex","difficultyRegex","difficultyMap","Beginner","Easy","Medium","Hard","Challenge","parseSimfile","sm","simfiles","bpms","test","exec","split","map","point","parseFloat","stops","chartStr","smDifficulty","difficulty","simfile","levelRegex","RegExp","level","parseInt","measures","lastIndexOf","trim","measure","ticks","filter","n","startsWith","numTicks","noteObjects","tick","tickIdx","noteObj","push","chart","applyTurnMods","turn","shuffle","turnMap","off","mirror","left","right","shuffle1","shuffle2","shuffle3","shuffle4","shuffle5","shuffle6","shuffle7","shuffle8","turnMod","row","setChartProgress","progress","dispatch","type","payload","initialState","chartAudio","status","previewAudio","changeActiveBpm","bpm","activeBpm","bpmChangeQueue","options","optionDefaultValues","combineReducers","audio","state","action","round","updatedMods","songSelect","store","createStore","reducers","compose","applyMiddleware","thunk","devToolsExtension","__REDUX_DEVTOOLS_EXTENSION__","f","sources","song","preview","currentSong","currentPreview","currentSongId","currentPreviewId","activeView","previewFadeTimeout","updateTimeline","bind","updateProgress","audioResyncFrames","hash","setLoadingAudio","title","Howl","dAudioUrl","format","html5","onload","onloaderror","id","error","blah","alert","onplay","getCurrentSong","tl","play","resync","gsap","ticker","add","startAnimationLoop","onpause","pause","remove","stopAnimationLoop","onseek","onstop","restart","onend","spriteId","sprite","sample","sampleStart","sampleLength","clearTimeout","stop","storeAudioSource","params","globalParams","updateProgressOnce","seek","getCurrentTime","currentBpm","lastBpmValue","bpmEvent","getCurrentBpm","time","deltaTime","duration","actions","updateAnimationLoopOnce","seekTime","ms","timestamp","playing","getCurrentPreview","on","fade","setTimeout","GameEngine","timeline","eventList","arrows","shockArrows","mainLoopRequestRef","drawBackground","AudioPlayer","startLoop","stopLoop","updateLoopOnce","requestAnimationFrame","mainLoop","cancelAnimationFrame","bpmPtr","stopPtr","prevEvent","currentEvent","prevTimestamp","timestampDiff","currentTimestamp","Array","isArray","newChart","j","shockArrow","arrow","stepZone","resetArrows","accumulatedBeatTick","lastArrow","lastEvent","max","to","startEvent","endEvent","delay","sectionBeatLength","sectionDuration","ease","onStart","setTimeline","setGlobalParams","reset","loop","render","fillStyle","fillRect","paused","console","log","Progress","props","progressBar","useRef","gameEngine","useEffect","current","addEventListener","e","jumpToProgress","touches","event","totalWidth","offsetWidth","progressPercent","clientX","offsetLeft","seekProgress","ref","className","style","HoldButton","button","requestRef","el","pressingDown","notPressingDown","preventDefault","onClick","handleHold","Button","children","connect","selectedDifficulty","selectedSong","loadingAudio","selectedAudio","setGameEngine","useState","setCanvas","chartArea","document","querySelector","mc","Hammer","goForward","goBack","ge","generateEventList","generateArrows","initTimeline","restartTl","Icon","name","disabled","artist","levels","SongGrid","displayedSongs","onSongSelect","selectedSongOption","songs","renderSong","selectSong","alt","_extends","Object","assign","target","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","keys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref","svgRef","viewBox","ForwardRef","forwardRef","titleSortOptions","text","concat","letter","versionSortOptions","versionName","idx","reverse","levelSortOptions","difficultySortOptions","simfileList","songGridContainer","simfileOptions","setSelectedSongOption","selectedDifficultyOption","setSelectedDifficultyOption","version","selectedFilters","setSelectedFilters","setDisplayedSongs","abcSort","scrollTop","setSelectedSong","find","data","songHash","stopSongPreview","handleDifficultySelect","selectedDiffOptionIndex","onDifficultySelect","playSongPreview","Dropdown","placeholder","search","selection","onChange","selectOnBlur","selectOnNavigation","updateMods","Radio","label","checked","Checkbox","toggle","stopPreviewAudio","isDisabled","view","icon","navItem","setActiveView","MainContainer","loadingSimfiles","setLoadingSimfiles","setSimfileList","selectedSM","setSelectedSM","setSelectedDifficulty","setSelectedAudio","fetchSimfiles","fetchData","tsv","parsedTsv","smName","replace","random","encodeURIComponent","changeActiveView","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.396c515f.chunk.js","sourcesContent":["export const ARROW_WIDTH = 64;\nexport const ARROW_HEIGHT = 64;\n\n/* Height of one repetition of the freeze body pattern */\nexport const FREEZE_BODY_HEIGHT = 128;\n\nexport const DIRECTIONS = [\"left\", \"down\", \"up\", \"right\"];\n\n/* Number of seconds that the visuals are delayed relative to the audio */\n// export const GLOBAL_OFFSET = 0.012;\nexport const GLOBAL_OFFSET = 0;\n\nexport const MARVELOUS_FLASH_FRAMES = 12;\n\n/* Number of beats played after the last note or event until the timeline ends */\nexport const END_EXTRA_BEATS = 8;\n\nexport const DDR_VERSIONS = [\n  \"DDR 1st\",\n  \"DDR 2ndMIX\",\n  \"DDR 3rdMIX\",\n  \"DDR 4thMIX\",\n  \"DDR 5thMIX\",\n  \"DDRMAX\",\n  \"DDRMAX2\",\n  \"DDR EXTREME\",\n  \"DDR SuperNOVA\",\n  \"DDR SuperNOVA 2\",\n  \"DDR X\",\n  \"DDR X2\",\n  \"DDR X3 VS 2ndMIX\",\n  \"DDR (2013)\",\n  \"DDR (2014)\",\n  \"DDR A\",\n  \"DDR A20\",\n];\n\nexport const SP_DIFFICULTIES = [\n  \"Beginner\",\n  \"Basic\",\n  \"Difficult\",\n  \"Expert\",\n  \"Challenge\",\n];\nexport const DP_DIFFICULTIES = [\"Basic\", \"Difficult\", \"Expert\", \"Challenge\"];\n\nexport const TITLE_CATEGORIES = [\n  \"あ\",\n  \"か\",\n  \"さ\",\n  \"た\",\n  \"な\",\n  \"は\",\n  \"ま\",\n  \"や\",\n  \"ら\",\n  \"わ\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \"NUM\",\n];\n\nexport const LEVELS = [\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  16,\n  17,\n  18,\n  19,\n];\n","export const fetchDocument = async (path) => {\n  const response = await fetch(path, {\n    mode: \"cors\",\n  });\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder(\"utf-8\");\n  const readResult = await reader.read();\n  return decoder.decode(readResult.value);\n};\n\nexport const getAssetPath = (path) => {\n  return window.location.href + \"assets/\" + path;\n};\n\nexport const getJacketPath = (path) => {\n  return window.location.href + \"jackets/\" + path;\n};\n\nexport const capitalize = (str) => {\n  return str.slice(0, 1).toUpperCase() + str.slice(1);\n};\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  FREEZE_BODY_HEIGHT,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`rainbow_${direction}`] = new Image();\n  arrowImages[`rainbow_${direction}`].src = getAssetPath(\n    `rainbow_${direction}.png`\n  );\n  arrowImages[`note_${direction}`] = new Image();\n  arrowImages[`note_${direction}`].src = getAssetPath(`note_${direction}.png`);\n  arrowImages[`vivid_${direction}`] = new Image();\n  arrowImages[`vivid_${direction}`].src = getAssetPath(\n    `vivid_${direction}.png`\n  );\n  arrowImages[`flat_${direction}`] = new Image();\n  arrowImages[`flat_${direction}`].src = getAssetPath(`vivid_${direction}.png`);\n\n  arrowImages[`freeze_tail_active_${direction}`] = new Image();\n  arrowImages[`freeze_tail_active_${direction}`].src = getAssetPath(\n    `freeze_tail_active_${direction}.png`\n  );\n  arrowImages[`freeze_tail_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_tail_inactive_${direction}`].src = getAssetPath(\n    `freeze_tail_inactive_${direction}.png`\n  );\n\n  arrowImages[`freeze_body_active_${direction}`] = new Image();\n  arrowImages[`freeze_body_active_${direction}`].src = getAssetPath(\n    `freeze_body_active_${direction}.png`\n  );\n  arrowImages[`freeze_body_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_body_inactive_${direction}`].src = getAssetPath(\n    `freeze_body_inactive_${direction}.png`\n  );\n\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nconst miscImages = [\"freeze_head\", \"tap_explosion\"];\nmiscImages.forEach((imageName) => {\n  arrowImages[imageName] = new Image();\n  arrowImages[imageName].src = getAssetPath(`${imageName}.png`);\n});\n\nclass Arrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin, colorFreezes } = mods;\n\n    this.key = key; // arrow index\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n    this.measureIdx = attrs.measureIdx;\n    this.measureN = attrs.measureN;\n    this.measureD = attrs.measureD;\n    this.colorFreezes = colorFreezes;\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n    this.holdBeats = attrs.holdBeats || null;\n\n    this.hitFrame = 0; // frame for showing the Marvelous flash\n\n    // can be used to detect the moment that the arrow passes a certain position\n    // even without landing precisely on it\n    this.previousBeatPosition = null;\n  }\n\n  reset() {\n    this.hitFrame = 0;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  render(canvas, beatTick) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height; // can be adjusted with SUDDEN+\n\n    for (let i = 0; i < this.note.length; i++) {\n      // nothing\n      if (this.note[i] === \"0\") continue;\n\n      let arrowImg;\n      let frameX, frameY, destX, destY;\n      const direction = DIRECTIONS[i];\n\n      // regular note\n      if (this.note[i] === \"1\" || (this.note[i] === \"2\" && this.colorFreezes)) {\n        arrowImg = arrowImages[`${this.noteskin}_${direction}`];\n\n        // color as freeze head if it is hit simultaneously with a freeze arrow\n        if (this.note.includes(\"2\") && !this.colorFreezes) {\n          arrowImg = arrowImages.freeze_head;\n          frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n          frameY = 0;\n        } else {\n          if (this.noteskin === \"rainbow\") {\n            frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n            const beatD = this.measureD / 4;\n            const beatN = this.measureN % beatD;\n            if (beatN === 0) {\n              frameY = 0;\n            } else if (0 < beatN && beatN <= beatD / 4) {\n              frameY = 1;\n            } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n              frameY = 2;\n            } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n              frameY = 3;\n            } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n              frameY = 0;\n            }\n            frameY *= ARROW_HEIGHT;\n          } else if (this.noteskin === \"note\") {\n            frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n            /* \n              NOTE: In the future, if we want to support color codes for 12ths, 24ths, etc.\n              We need to use more precise math to avoid rounding errors.\n              Planned approach: Reduce the measure fraction by dividing both numerator and denominator\n              by their greatest common factor.\n              If GCF == 1, 2, or 4, use 4th note quantization.\n              Otherwise, the resulting denominator is used for the quantization (3 and 6 may be treated as 12ths)\n            */\n            const measureFraction = this.measureN / this.measureD;\n            if ([0, 1 / 4, 2 / 4, 3 / 4].includes(measureFraction)) {\n              frameY = 0;\n            } else if ([1 / 8, 3 / 8, 5 / 8, 7 / 8].includes(measureFraction)) {\n              frameY = 1;\n            } else if (\n              [\n                1 / 16,\n                3 / 16,\n                5 / 16,\n                7 / 16,\n                9 / 16,\n                11 / 16,\n                13 / 16,\n                15 / 16,\n              ].includes(measureFraction)\n            ) {\n              frameY = 3;\n            } else {\n              frameY = 2;\n            }\n            frameY *= ARROW_HEIGHT;\n          } else if (this.noteskin === \"vivid\") {\n            frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n\n            const beatD = this.measureD / 4;\n            const beatN = this.measureN % beatD;\n            const noteOffset = Math.floor(beatTick) % 4;\n\n            if (beatN === 0) {\n              frameY = 0;\n            } else if (0 < beatN && beatN <= beatD / 4) {\n              frameY = 1;\n            } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n              frameY = 2;\n            } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n              frameY = 3;\n            } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n              frameY = 0;\n            }\n            frameY = ((frameY + noteOffset) % 4) * ARROW_HEIGHT;\n          } else if (this.noteskin === \"flat\") {\n            arrowImg = arrowImages[`vivid_${direction}`];\n\n            frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n            frameY = (Math.floor(beatTick) % 4) * ARROW_HEIGHT;\n          }\n        }\n\n        destX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n        if (destY > topBoundary && destY < bottomBoundary) {\n          c.drawImage(\n            arrowImg,\n            frameX,\n            frameY,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            destX,\n            destY,\n            ARROW_WIDTH,\n            ARROW_HEIGHT\n          );\n        }\n        if (destY <= 0) {\n          if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n            // console.log(this.currentBeatPosition(beatTick));\n            c.save();\n            c.globalAlpha =\n              1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n            c.drawImage(\n              arrowImages.tap_explosion,\n              0,\n              0,\n              ARROW_WIDTH,\n              ARROW_HEIGHT,\n              destX - 2 - this.hitFrame,\n              0 - 2 - this.hitFrame,\n              ARROW_WIDTH + 4 + this.hitFrame * 2,\n              ARROW_HEIGHT + 4 + this.hitFrame * 2\n            );\n            c.restore();\n            this.hitFrame++;\n          }\n        } else {\n          this.hitFrame = 0;\n        }\n      }\n\n      // freeze note\n      else if (this.note[i] === \"2\") {\n        arrowImg = arrowImages.freeze_head;\n        frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        frameY = 0;\n\n        destX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n        // draw freeze head\n        if (destY > topBoundary && destY < bottomBoundary) {\n          c.drawImage(\n            arrowImg,\n            frameX,\n            frameY,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            destX,\n            destY,\n            ARROW_WIDTH,\n            ARROW_HEIGHT\n          );\n        }\n\n        // target flash\n        if (destY <= 0) {\n          if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n            c.save();\n            c.globalAlpha =\n              1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n            c.drawImage(\n              arrowImages.tap_explosion,\n              0,\n              0,\n              ARROW_WIDTH,\n              ARROW_HEIGHT,\n              destX - this.hitFrame,\n              0 - this.hitFrame,\n              ARROW_WIDTH + this.hitFrame * 2,\n              ARROW_HEIGHT + this.hitFrame * 2\n            );\n            c.restore();\n            this.hitFrame++;\n          }\n        } else {\n          this.hitFrame = 0;\n        }\n      }\n\n      // freeze body and tail\n      else if (this.note[i] === \"3\") {\n        arrowImg = arrowImages[`freeze_tail_inactive_${direction}`];\n        frameX = 0;\n        frameY = 0;\n\n        destX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n        // Bottom of freeze body must be the bottom of the body image (yellow part of gradient)\n        // and line up with the top of the freeze tail.\n        // Extend the freeze body upwards using as many repetitions of the 128px height image as needed.\n        // Top of freeze body is cut off at the midpoint of the freeze head.\n        let arrowBodyImg = arrowImages[`freeze_body_inactive_${direction}`];\n        const totalBodyHeight =\n          this.holdBeats[i] * ARROW_HEIGHT * this.speed - ARROW_HEIGHT / 2;\n        const repetitions = Math.floor(totalBodyHeight / FREEZE_BODY_HEIGHT);\n        let partialHeight = totalBodyHeight % FREEZE_BODY_HEIGHT;\n        const originalPartialHeight = partialHeight;\n\n        let partialDestY = destY - (totalBodyHeight + ARROW_HEIGHT / 2);\n        let freezeBeingHeld = false;\n\n        // shrink in size once it reaches the target\n        // this is also where the freeze starts to be held down\n        if (partialDestY < 0) {\n          partialHeight += partialDestY;\n          partialDestY = 0;\n          arrowImg = arrowImages[`freeze_tail_active_${direction}`];\n          arrowBodyImg = arrowImages[`freeze_body_active_${direction}`];\n\n          if (destY > 0) {\n            freezeBeingHeld = true;\n          }\n        }\n\n        // draw partial\n        if (partialDestY > -partialHeight && partialDestY < bottomBoundary) {\n          c.drawImage(\n            arrowBodyImg,\n            0,\n            FREEZE_BODY_HEIGHT - partialHeight,\n            ARROW_WIDTH,\n            partialHeight,\n            destX,\n            partialDestY + ARROW_HEIGHT / 2,\n            ARROW_WIDTH,\n            partialHeight\n          );\n        }\n\n        // draw repetitions of freeze body\n        for (let i = 1; i <= repetitions; i++) {\n          let bodyHeight = FREEZE_BODY_HEIGHT;\n          let bodyFrameY = 0;\n          let bodyDestY =\n            destY -\n            (totalBodyHeight +\n              ARROW_HEIGHT / 2 -\n              originalPartialHeight -\n              FREEZE_BODY_HEIGHT * (i - 1));\n\n          if (bodyDestY < 0 && bodyDestY > -FREEZE_BODY_HEIGHT) {\n            bodyHeight += bodyDestY;\n            bodyFrameY -= bodyDestY;\n            bodyDestY = 0;\n          }\n\n          if (bodyDestY > -bodyHeight && bodyDestY < bottomBoundary) {\n            c.drawImage(\n              arrowBodyImg,\n              0,\n              bodyFrameY,\n              ARROW_WIDTH,\n              bodyHeight,\n              destX,\n              bodyDestY + ARROW_HEIGHT / 2,\n              ARROW_WIDTH,\n              bodyHeight\n            );\n          }\n        }\n\n        let tailHeight = ARROW_HEIGHT;\n\n        // if the freeze is shorter than the height of the tail sprite,\n        // cut off the top of the sprite such that it starts at the midpoint of the freeze head\n        if (this.holdBeats[i] * ARROW_HEIGHT * this.speed < ARROW_HEIGHT / 2) {\n          const tailPartialHeight =\n            this.holdBeats[i] * ARROW_HEIGHT * this.speed;\n          frameY += ARROW_HEIGHT / 2 - tailPartialHeight;\n          destY += ARROW_HEIGHT / 2 - tailPartialHeight;\n          tailHeight = ARROW_HEIGHT - tailPartialHeight;\n        }\n\n        // shrink in size once it reaches the target\n        if (destY < ARROW_HEIGHT / 2 && destY > topBoundary) {\n          frameY += ARROW_HEIGHT / 2 - destY;\n          destY = ARROW_HEIGHT / 2;\n        }\n\n        if (destY > topBoundary && destY < bottomBoundary) {\n          c.drawImage(\n            arrowImg,\n            frameX,\n            frameY,\n            ARROW_WIDTH,\n            tailHeight,\n            destX,\n            destY,\n            ARROW_WIDTH,\n            tailHeight\n          );\n        }\n\n        // render head of held freeze arrow on top of the arrow body\n        if (freezeBeingHeld) {\n          const arrowHeadImg = arrowImages.freeze_head;\n          if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n            c.drawImage(\n              arrowHeadImg,\n              DIRECTIONS.indexOf(direction) * ARROW_WIDTH,\n              ARROW_HEIGHT * 2,\n              ARROW_WIDTH,\n              ARROW_HEIGHT,\n              DIRECTIONS.indexOf(direction) * ARROW_WIDTH,\n              0,\n              ARROW_WIDTH,\n              ARROW_HEIGHT\n            );\n          }\n        }\n\n        // flash at the end of successfully held down freeze\n        if (destY <= 0) {\n          if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n            c.save();\n            c.globalAlpha =\n              1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n            c.drawImage(\n              arrowImages.tap_explosion,\n              0,\n              0,\n              ARROW_WIDTH,\n              ARROW_HEIGHT,\n              destX - this.hitFrame,\n              0 - this.hitFrame,\n              ARROW_WIDTH + this.hitFrame * 2,\n              ARROW_HEIGHT + this.hitFrame * 2\n            );\n            c.restore();\n            this.hitFrame++;\n          }\n        } else {\n          this.hitFrame = 0;\n        }\n      }\n\n      this.previousBeatPosition = this.currentBeatPosition(beatTick);\n    }\n  }\n}\n\nexport default Arrow;\n","import { DIRECTIONS, ARROW_WIDTH, ARROW_HEIGHT } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach(direction => {\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nclass ShockArrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin } = mods;\n\n    this.key = key;\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  render(canvas, frame, beatTick) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = -ARROW_HEIGHT; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height;\n    frame = Math.floor(frame / 3) % 8; // each sprite frame lasts 3 canvas animation frames\n\n    for (let i = 0; i < this.note.length; i++) {\n      const direction = DIRECTIONS[i];\n      const arrowImg = arrowImages[`shock_${direction}`];\n      const frameX = (frame % 4) * ARROW_WIDTH;\n      const frameY = Math.floor(frame / 4) * ARROW_HEIGHT;\n      const destX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n      const destY =\n        this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    }\n  }\n}\n\nexport default ShockArrow;\n","import { DIRECTIONS, ARROW_HEIGHT, ARROW_WIDTH } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst flashImages = {};\nDIRECTIONS.forEach(direction => {\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n});\n\nconst receptorImages = {};\nDIRECTIONS.forEach(direction => {\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n});\n\nclass StepZone {\n  render(canvas, beatTick) {\n    const c = canvas.getContext(\"2d\");\n    // flash starts at the beginning of the quarter beat and lasts for 1/16 beat\n\n    const isFlash = beatTick % 1 > 0 && beatTick % 1 < 0.25;\n\n    DIRECTIONS.forEach((direction, i) => {\n      c.drawImage(\n        isFlash ? flashImages[direction] : receptorImages[direction],\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        i * ARROW_WIDTH,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT\n      );\n    });\n  }\n}\n\nexport default StepZone;\n","import { ARROW_HEIGHT } from \"../../../constants\";\n\nclass Guidelines {\n  constructor(attrs) {\n    const { mods } = attrs;\n    const { speed, guidelines } = mods;\n\n    this.speed = speed;\n    this.finalBeat = attrs.finalBeat;\n    this.showGuidelines = guidelines;\n  }\n\n  render(canvas, beatTick) {\n    if (!this.showGuidelines) return;\n\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    for (let beat = 0; beat <= this.finalBeat; beat++) {\n      const destY =\n        (beat - beatTick) * ARROW_HEIGHT * this.speed + ARROW_HEIGHT / 2;\n\n      // Render a thick line if the beat falls on the beginning of the measure.\n      // Render a thin line otherwise\n      const lineWidth = beat % 4 === 0 ? 2 : 0.8;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.beginPath();\n        c.moveTo(0, destY);\n        c.lineTo(canvas.width, destY);\n        c.lineWidth = lineWidth;\n        c.strokeStyle = \"#fff\";\n        c.stroke();\n      }\n    }\n  }\n}\n\nexport default Guidelines;\n","const modeRegex = /dance-([a-z]+)/;\nconst difficultyRegex = /(Beginner|Easy|Medium|Hard|Challenge|Edit)/;\n\nconst difficultyMap = {\n  Beginner: \"Beginner\",\n  Easy: \"Basic\",\n  Medium: \"Difficult\",\n  Hard: \"Expert\",\n  Challenge: \"Challenge\",\n};\n\nconst parseSimfile = sm => {\n  const simfiles = {};\n\n  let bpms = \"\";\n  if (/#BPMS:/i.test(sm)) {\n    bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(sm)[1];\n    if (bpms.length) {\n      bpms = bpms.split(\",\").map(point => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    } else {\n      bpms = [];\n    }\n  }\n\n  let stops = \"\";\n  if (/#STOPS:/i.test(sm)) {\n    stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(sm)[1];\n    if (stops.length) {\n      stops = stops.split(\",\").map(point => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    } else {\n      stops = [];\n    }\n  }\n\n  const chartStrs = sm\n    .slice(sm.indexOf(\"#NOTES:\"))\n    .split(/#NOTES:\\s+/)\n    .slice(1);\n\n  chartStrs.forEach(chartStr => {\n    const mode = modeRegex.exec(chartStr)[1]; // single or double\n\n    let smDifficulty = difficultyRegex.exec(chartStr)[1];\n    const difficulty = difficultyMap[smDifficulty];\n\n    simfiles[`${mode}_${difficulty}`] = { difficulty, mode, bpms, stops };\n    const simfile = simfiles[`${mode}_${difficulty}`];\n\n    const levelRegex = new RegExp(`${smDifficulty}:\\\\s+([0-9]+):`);\n    const level = parseInt(levelRegex.exec(chartStr)[1]);\n    simfile.level = level;\n\n    const measures = chartStr\n      .slice(chartStr.lastIndexOf(\":\") + 1, chartStr.lastIndexOf(\";\"))\n      .trim()\n      .split(\",\")\n      .map((measure, measureIdx) => {\n        const ticks = measure\n          .trim()\n          .split(\"\\r\\n\")\n          .filter(n => !n.startsWith(\"//\")); // filter out comment lines\n\n        const numTicks = ticks.length;\n\n        const noteObjects = [];\n        ticks.forEach((tick, tickIdx) => {\n          // skip empty ticks and comment lines\n          if (!tick.split(\"\").filter(n => n !== \"0\").length) return;\n\n          const noteObj = {};\n          noteObj.note = tick;\n          noteObj.measureIdx = measureIdx; // index of the measure relative to the whole song (starting at 0)\n          noteObj.measureN = tickIdx; // numerator of the fraction describing where note falls in this measure\n          noteObj.measureD = numTicks; // denominator of the fraction describing where note falls in this measure\n\n          noteObjects.push(noteObj);\n        });\n\n        return noteObjects;\n      });\n    simfile.chart = measures;\n  });\n\n  return simfiles;\n};\n\nexport default parseSimfile;\n","export const applyTurnMods = (chart, mods) => {\n  const { turn, shuffle } = mods;\n\n  // shuffle patterns courtesy of https://zenius-i-vanisher.com/v5.2/viewthread.php?threadid=3823\n  const turnMap = {\n    off: \"LDUR\",\n    mirror: \"RUDL\",\n    left: \"ULRD\",\n    right: \"DRLU\",\n    shuffle1: \"LRDU\",\n    shuffle2: \"UDRL\",\n    shuffle3: \"LRUD\",\n    shuffle4: \"DURL\",\n    shuffle5: \"DLUR\",\n    shuffle6: \"DULR\",\n    shuffle7: \"RLUD\",\n    shuffle8: \"RULD\",\n  };\n\n  let turnMod = turn;\n  if (turn === \"shuffle\") turnMod += shuffle;\n\n  return chart.map((row) => {\n    const note = row.note;\n    const turnedNote = turnMap[turnMod]\n      .split(\"\")\n      .map((direction) => note[turnMap.off.indexOf(direction)]);\n\n    return { ...row, note: turnedNote };\n  });\n};\n\n/*\n  Given the bpmChangeQueue and the current beat tick, find the latest bpm\n  change event that happened before the current beat and set the current bpm\n  to that bpm value. This should be invoked every time the audio is resynced\n  (which will happen whenever progress is skipped)\n*/\nexport const getCurrentBpm = (params) => {\n  const { beatTick, bpmChangeQueue } = params;\n  let lastBpmValue = 0;\n  for (let i = 0; i < bpmChangeQueue.length; i++) {\n    const bpmEvent = bpmChangeQueue[i];\n    if (bpmEvent.beat > beatTick) {\n      return lastBpmValue;\n    }\n    lastBpmValue = bpmEvent.value;\n  }\n  return lastBpmValue;\n};\n","export const PLAY_CHART_AUDIO = \"PLAY_CHART_AUDIO\";\nexport const PAUSE_CHART_AUDIO = \"PAUSE_CHART_AUDIO\";\nexport const STOP_CHART_AUDIO = \"STOP_CHART_AUDIO\";\n\nexport const PLAY_PREVIEW_AUDIO = \"PLAY_PREVIEW_AUDIO\";\nexport const STOP_PREVIEW_AUDIO = \"STOP_PREVIEW_AUDIO\";\n\nexport const SET_CHART_PROGRESS = \"SET_CHART_PROGRESS\";\n\nexport const playChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_CHART_AUDIO,\n  });\n};\n\nexport const pauseChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PAUSE_CHART_AUDIO,\n  });\n};\n\nexport const stopChartAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_CHART_AUDIO,\n  });\n};\n\nexport const playPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_PREVIEW_AUDIO,\n  });\n};\nexport const stopPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_PREVIEW_AUDIO,\n  });\n};\n\nexport const setChartProgress = (progress) => (dispatch) => {\n  dispatch({\n    type: SET_CHART_PROGRESS,\n    payload: progress,\n  });\n};\n","import * as actions from \"../actions/AudioActions\";\n\nconst initialState = {\n  chartAudio: {\n    status: \"stopped\",\n    progress: 0,\n  },\n  previewAudio: {\n    status: \"stopped\",\n  },\n};\n\nexport const audio = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.PLAY_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"playing\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PAUSE_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"paused\" };\n      return { ...state, chartAudio };\n    }\n    case actions.STOP_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"stopped\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PLAY_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"playing\" };\n      return { ...state, previewAudio };\n    }\n    case actions.STOP_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"stopped\" };\n      return { ...state, previewAudio };\n    }\n    case actions.SET_CHART_PROGRESS: {\n      const chartAudio = { ...state.chartAudio, progress: action.payload };\n      return { ...state, chartAudio };\n    }\n    default:\n      return state;\n  }\n};\n","export const SET_BPM_CHANGE_QUEUE = \"SET_BPM_CHANGE_QUEUE\";\nexport const CHANGE_ACTIVE_BPM_DISPLAY = \"CHANGE_ACTIVE_BPM_DISPLAY\";\n\nexport const setBpmChangeQueue = (payload) => (dispatch) => {\n  dispatch({\n    type: SET_BPM_CHANGE_QUEUE,\n    payload,\n  });\n};\n\nexport const changeActiveBpm = (bpm) => (dispatch) => {\n  dispatch({\n    type: CHANGE_ACTIVE_BPM_DISPLAY,\n    payload: bpm,\n  });\n};\n","import * as actions from \"../actions/ChartActions\";\n\nconst initialState = {\n  activeBpm: null,\n  bpmChangeQueue: [],\n};\n\nexport const chart = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SET_BPM_CHANGE_QUEUE: {\n      return { ...state, bpmChangeQueue: [...action.payload] };\n    }\n    case actions.CHANGE_ACTIVE_BPM_DISPLAY: {\n      // const activeBpm = action.payload;\n      const activeBpm = Math.round(action.payload);\n      return { ...state, activeBpm };\n    }\n    default:\n      return state;\n  }\n};\n","export const options = {\n  difficulty: [\"Beginner\", \"Basic\", \"Difficult\", \"Expert\", \"Challenge\"],\n  mods: {\n    speed: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n      2.25,\n      2.5,\n      2.75,\n      3,\n      3.25,\n      3.5,\n      3.75,\n      4,\n      4.5,\n      5,\n      5.5,\n      6,\n      6.5,\n      7,\n      7.5,\n      8,\n    ],\n    turn: [\"off\", \"mirror\", \"left\", \"right\", \"shuffle\"],\n    shuffle: [1, 2, 3, 4, 5, 6, 7, 8],\n    noteskin: [\"rainbow\", \"note\", \"vivid\", \"flat\"],\n  },\n};\n\nexport const optionDefaultValues = {\n  difficulty: \"Challenge\",\n  mods: {\n    speed: 0.25,\n    turn: \"off\",\n    shuffle: 1,\n    noteskin: \"note\",\n    guidelines: true,\n    colorFreezes: false,\n  },\n};\n","import * as actions from \"../actions/ModsActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\n\nconst initialState = optionDefaultValues.mods;\n\nexport const mods = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.UPDATE_MODS: {\n      const updatedMods = action.payload;\n      return { ...state, ...updatedMods };\n    }\n    default:\n      return state;\n  }\n};\n","const initialState = {};\n\nexport const songSelect = (state = initialState, action) => {\n  switch (action.type) {\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from \"redux\";\n\nimport { audio } from \"./AudioReducer\";\nimport { chart } from \"./ChartReducer\";\nimport { mods } from \"./ModsReducer\";\nimport { songSelect } from \"./SongSelectReducer\";\n\nexport default combineReducers({ audio, chart, mods, songSelect });\n","export const UPDATE_MODS = \"UPDATE_MODS\";\n\nexport const updateMods = (mods) => (dispatch) => {\n  dispatch({\n    type: UPDATE_MODS,\n    payload: mods,\n  });\n};\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n\nimport reducers from \"./reducers\";\n\nconst store = createStore(\n  reducers,\n  compose(\n    applyMiddleware(thunk),\n    window.devToolsExtension ? window.__REDUX_DEVTOOLS_EXTENSION__() : (f) => f\n  )\n);\n\nexport default store;\n","import { Howl } from \"howler\";\nimport { gsap } from \"gsap\";\n\nimport store from \"../store\";\nimport * as actions from \"../actions/AudioActions\";\nimport { changeActiveBpm } from \"../actions/ChartActions\";\nimport { getCurrentBpm } from \"../utils/engineUtils\";\n\nclass AudioPlayer {\n  constructor() {\n    /*\n      Trying to share the same audio source for both song and preview was causing too many\n      issues. Sticking to keeping separate Howl objects for each even if means loading\n      duplicate copies of the same mp3\n    */\n    this.sources = {\n      song: {},\n      preview: {},\n    }; // map of song hash to associated Howl object\n    this.currentSong = null; // hash of current song\n    this.currentPreview = null; // hash of current preview\n\n    this.currentSongId = null; // Howler soundID of current song\n    this.currentPreviewId = null; // Howler soundId of current preview\n\n    // this.updateTimeline = this.updateTimeline.bind(this);\n\n    this.activeView = null; // gets updated whenever active view changes in React\n\n    this.previewFadeTimeout = null; // reference to preview fade setTimeout so it can be cleared\n\n    this.updateTimeline = this.updateTimeline.bind(this);\n    this.updateProgress = this.updateProgress.bind(this);\n    this.audioResyncFrames = 0;\n  }\n\n  getCurrentSong() {\n    return this.sources.song[this.currentSong];\n  }\n  getCurrentPreview() {\n    return this.sources.preview[this.currentPreview];\n  }\n\n  // when loading a song file for the first time, save it as two separate Howls:\n  // one for the full song and one for the preview sample\n  storeAudioSource(song) {\n    if (!this.sources.song[song.hash]) {\n      this.setLoadingAudio(true);\n\n      this.sources.song[song.hash] = { title: song.title };\n      this.sources.song[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        onload: () => {\n          // console.log(`AudioPlayer song loaded: ${song.title}`);\n          this.setLoadingAudio(false);\n        },\n        onloaderror: (id, error, blah) => {\n          alert(`${id};;; ${error};;; ${blah}`);\n        },\n        onplay: () => {\n          this.getCurrentSong().tl.play();\n\n          this.resync();\n          gsap.ticker.add(this.updateProgress);\n          this.startAnimationLoop();\n          store.dispatch(actions.playChartAudio());\n        },\n        onpause: () => {\n          this.getCurrentSong().tl.pause();\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.pauseChartAudio());\n        },\n        onseek: () => {},\n        onstop: () => {\n          if (this.getCurrentSong().tl) {\n            this.getCurrentSong().tl.restart().pause();\n          }\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n        onend: (spriteId) => {\n          gsap.ticker.remove(this.updateTimeline);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n      });\n\n      this.sources.preview[song.hash] = { title: song.title };\n      this.sources.preview[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        sprite: {\n          sample: [\n            parseFloat((song.sampleStart - 0.12) * 1000),\n            parseFloat(song.sampleLength * 1000),\n          ],\n        },\n        onplay: () => {\n          store.dispatch(actions.playPreviewAudio());\n        },\n        onstop: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n        onend: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n      });\n\n      // console.log(`Added ${song.title} to AudioPlayer.sources`, this.sources);\n    }\n  }\n\n  selectSong(song) {\n    if (this.currentSong) {\n      this.getCurrentSong().audio.stop(this.currentSongId);\n    }\n\n    this.storeAudioSource(song);\n    this.currentSong = song.hash;\n  }\n\n  setTimeline(tl) {\n    this.getCurrentSong().tl = tl;\n  }\n  setGlobalParams(params) {\n    this.getCurrentSong().globalParams = params;\n  }\n\n  resync() {\n    // arbitrary number of frames chosen to tell timeline to resync with the audio\n    // because audio playback takes a while to restabilize\n    this.audioResyncFrames = 10;\n    gsap.ticker.add(this.updateTimeline);\n    this.updateProgressOnce();\n  }\n\n  // when audio is played, resync timeline with audio a few times until audio playback\n  // stabilizes, then remove this method from the ticker\n  updateTimeline() {\n    const self = this;\n    this.getCurrentSong().tl.seek(self.getCurrentTime() + 0.07);\n\n    this.audioResyncFrames--;\n    if (this.audioResyncFrames <= 0) {\n      // recalculate current bpm (necessary if skipping progress)\n      const currentBpm = getCurrentBpm(self.getCurrentSong().globalParams);\n      store.dispatch(changeActiveBpm(currentBpm));\n\n      gsap.ticker.remove(this.updateTimeline);\n    }\n  }\n\n  updateProgress(time, deltaTime, frame) {\n    if (frame % 15 === 0) {\n      const audio = this.getCurrentSong().audio;\n      const progress = audio.seek() / audio.duration();\n      store.dispatch(actions.setChartProgress(progress));\n    }\n  }\n\n  updateProgressOnce() {\n    this.updateProgress(null, null, 0);\n    this.updateAnimationLoopOnce();\n  }\n\n  play() {\n    this.currentSongId = this.getCurrentSong().audio.play();\n  }\n\n  pause() {\n    this.getCurrentSong().audio.pause(this.currentSongId);\n  }\n\n  stop() {\n    this.getCurrentSong().audio.stop(this.currentSongId);\n    this.seekTime(0);\n    this.currentSongId = null;\n  }\n\n  getCurrentTime() {\n    return this.getCurrentSong().audio.seek();\n  }\n\n  goBack(ms) {\n    const self = this;\n    this.seekTime(self.getCurrentTime() - ms * 0.001);\n  }\n  goForward(ms) {\n    const self = this;\n    this.seekTime(self.getCurrentTime() + ms * 0.001);\n  }\n\n  seekTime(timestamp) {\n    this.getCurrentSong().audio.seek(timestamp);\n    this.resync();\n  }\n\n  seekProgress(value) {\n    const self = this;\n    this.seekTime(value * this.getCurrentSong().audio.duration());\n    store.dispatch(actions.setChartProgress(value));\n  }\n\n  isPlaying() {\n    return (\n      this.getCurrentSong() &&\n      this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n  isPaused() {\n    return (\n      this.getCurrentSong() &&\n      !this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n\n  playSongPreview(song) {\n    if (this.currentPreview) {\n      this.getCurrentPreview().audio.stop(this.currentPreviewId);\n    }\n\n    this.storeAudioSource(song);\n    this.currentPreview = song.hash;\n\n    const preview = this.getCurrentPreview().audio;\n\n    this.currentPreviewId = preview.play(\"sample\");\n\n    preview.on(\"play\", () => {\n      const preview = this.getCurrentPreview().audio;\n\n      const fadeinTime = 200;\n      const fadeoutTime = 2000;\n      preview.fade(0, 1, fadeinTime);\n\n      this.previewFadeTimeout = setTimeout(() => {\n        preview.fade(1, 0, fadeoutTime);\n      }, song.sampleLength * 1000 - fadeoutTime);\n    });\n  }\n\n  stopSongPreview() {\n    if (!this.currentPreview) return;\n    const preview = this.getCurrentPreview().audio;\n\n    preview.stop(this.currentPreviewId);\n\n    // clearTimeout(this.previewFadeTimeout);\n  }\n\n  isPreviewPlaying() {\n    return (\n      this.getCurrentPreview() &&\n      this.getCurrentPreview().audio.playing(this.currentPreviewId)\n    );\n  }\n}\n\nexport default new AudioPlayer();\n","import { gsap } from \"gsap\";\n\nimport Arrow from \"../components/chart/canvas/Arrow\";\nimport ShockArrow from \"../components/chart/canvas/ShockArrow\";\nimport StepZone from \"../components/chart/canvas/StepZone\";\nimport Guidelines from \"../components/chart/canvas/Guidelines\";\nimport parseSimfile from \"../utils/parseSimfile\";\nimport { applyTurnMods } from \"../utils/engineUtils\";\nimport { GLOBAL_OFFSET, END_EXTRA_BEATS } from \"../constants\";\nimport AudioPlayer from \"./AudioPlayer\";\nimport store from \"../store\";\nimport * as actions from \"../actions/ChartActions\";\n\nclass GameEngine {\n  constructor(canvas, sm) {\n    this.canvas = canvas;\n    this.c = canvas.getContext(\"2d\");\n    this.tl = gsap.timeline();\n    this.sm = sm;\n    this.simfiles = {};\n\n    this.eventList = [];\n    this.arrows = [];\n    this.shockArrows = [];\n\n    this.mainLoopRequestRef = null;\n\n    this.drawBackground();\n\n    this.globalParams = {\n      /*\n        Use this parameter to keep track of which beat the chart is on at any given point.\n        Animate this one property in the timeline, then reference its value to calculate frames\n        for step zone and arrow animations without having to create separate tweens for them.\n      */\n      beatTick: 0,\n\n      /*\n        Use this parameter for animations based on absolute frame and not a function of the beat.\n      */\n      frame: 0,\n\n      bpmChangeQueue: [],\n    };\n\n    // init logic\n    if (this.sm) {\n      this.simfiles = parseSimfile(this.sm);\n    }\n\n    AudioPlayer.startAnimationLoop = this.startLoop.bind(this);\n    AudioPlayer.stopAnimationLoop = this.stopLoop.bind(this);\n    AudioPlayer.updateAnimationLoopOnce = this.updateLoopOnce.bind(this);\n  }\n\n  startLoop() {\n    this.mainLoopRequestRef = window.requestAnimationFrame(\n      this.mainLoop.bind(this)\n    );\n  }\n  stopLoop() {\n    window.cancelAnimationFrame(this.mainLoopRequestRef);\n  }\n  updateLoopOnce() {\n    window.requestAnimationFrame(this.mainLoop.bind(this, false));\n  }\n\n  // bpm changes and stops converted to timestamps\n  generateEventList(simfile) {\n    const { bpms, stops } = simfile;\n    const eventList = [];\n    let bpmPtr = 0,\n      stopPtr = 0;\n    let currentBpm = bpms[0].value;\n\n    // console.log(\"generateEventList bpms\", bpms);\n    // console.log(\"generateEventList stops\", stops);\n\n    while (bpmPtr < bpms.length && stopPtr < stops.length) {\n      const bpm = bpms[bpmPtr];\n      const stop = stops[stopPtr];\n      // add stop event, keeping track of the bpm at this point\n      if (stop.beat <= bpm.beat) {\n        eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n        stopPtr++;\n      }\n      // add bpm event, replacing the currently tracked bpm\n      else {\n        eventList.push({ ...bpm, type: \"bpm\" });\n        currentBpm = bpm.value;\n\n        this.globalParams.bpmChangeQueue.push(bpm);\n\n        bpmPtr++;\n      }\n    }\n    while (bpmPtr < bpms.length) {\n      eventList.push({ ...bpms[bpmPtr], type: \"bpm\" });\n      this.globalParams.bpmChangeQueue.push(bpms[bpmPtr]);\n      bpmPtr++;\n    }\n    while (stopPtr < stops.length) {\n      eventList.push({ ...stops[stopPtr], bpm: currentBpm, type: \"stop\" });\n      stopPtr++;\n    }\n\n    eventList[0].timestamp = 0;\n\n    for (let i = 1; i < eventList.length; i++) {\n      const prevEvent = eventList[i - 1];\n      const currentEvent = eventList[i];\n      const prevTimestamp = eventList[i - 1].timestamp;\n\n      // Find the number of beats elapsed between the current and previous event,\n      // then convert this into seconds using the bpm at the previous event.\n      // If the previous event was a stop, add the length of the stop.\n      // The timestamp of the current event is this number of seconds after the\n      // timestamp of the previous event.\n      const beatDiff = currentEvent.beat - prevEvent.beat;\n      const prevBpm =\n        prevEvent.type === \"bpm\" ? prevEvent.value : prevEvent.bpm;\n      let timestampDiff = (beatDiff / prevBpm) * 60;\n      if (prevEvent.type === \"stop\") timestampDiff += prevEvent.value;\n      const currentTimestamp = prevTimestamp + timestampDiff;\n\n      currentEvent.timestamp = currentTimestamp;\n    }\n\n    // store.dispatch(actions.setBpmChangeQueue(this.globalParams.bpmChangeQueue));\n\n    this.eventList = eventList;\n    return eventList;\n  }\n\n  generateArrows(simfile, mods) {\n    let { chart } = simfile;\n\n    if (Array.isArray(chart[0])) {\n      const newChart = [];\n      chart.forEach((measure) => {\n        newChart.push(...measure);\n      });\n      chart = newChart;\n    }\n\n    chart = applyTurnMods(chart, mods);\n\n    chart.forEach((note, key) => {\n      // calculate starting position currentBeatPosition\n      const { measureIdx, measureN, measureD } = note;\n      note.currentBeatPosition = (measureIdx + measureN / measureD) * 4;\n\n      // save its original position for later reference\n      note.originalBeatPosition = note.currentBeatPosition;\n\n      // If the note is the tail of a freeze arrow, calculate the number of beats\n      // from the head of the freeze arrow\n      for (let i = 0; i < note.note.length; i++) {\n        if (note.note[i] !== \"3\") continue;\n\n        // Find the most recent freeze head on the same direction as the tail\n        // and retroactively fill in the length of the hold in beats\n        for (let j = key - 1; j >= 0; j--) {\n          if (chart[j].note[i] === \"2\") {\n            if (!chart[j].holdBeats) chart[j].holdBeats = [];\n            if (!note.holdBeats) note.holdBeats = [];\n            chart[j].holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            note.holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            break;\n          }\n        }\n      }\n    });\n\n    chart.forEach((note, key) => {\n      if (note.note[0] === \"M\" || note.note[4] === \"M\") {\n        const shockArrow = new ShockArrow({ key, ...note, mods });\n        this.shockArrows.push(shockArrow);\n      } else {\n        const arrow = new Arrow({ key, ...note, mods });\n        this.arrows.push(arrow);\n      }\n    });\n\n    this.stepZone = new StepZone();\n\n    // console.log(\"this.arrows\", this.arrows);\n\n    // console.log(\"this.shockArrows\", this.shockArrows);\n\n    // console.log(`chart for ${simfile.difficulty}`, chart);\n  }\n\n  // Calculate the gsap tweens before playing the chart\n  initTimeline(mods) {\n    // console.log(\"this.eventList\", this.eventList);\n\n    this.resetArrows();\n\n    /*\n      The space in between each event (i.e. a bpm change or stop) denotes a continous section of constant bpm.\n      Create a tween to animate the global beat tick for each of these sections and chain them together.\n      The position and/or frame animation of each canvas object (e.g. arrows, step zone, guidelines) can be\n      determined as a function of the beat tick value at any given point.\n    */\n    let bpm;\n\n    let accumulatedBeatTick = 0;\n\n    // Designate the \"end\" of the chart as an arbitrary number of beats (8?) after either the last arrow\n    // or the last event in the chart, whichever comes later\n    const lastArrow = this.arrows[this.arrows.length - 1];\n    const lastEvent = this.eventList[this.eventList.length - 1];\n\n    let finalBeat = 0;\n    if (lastArrow && lastEvent) {\n      finalBeat = Math.max(lastArrow.originalBeatPosition, lastEvent.beat);\n    } else if (lastArrow) {\n      finalBeat = lastArrow.originalBeatPosition;\n    } else if (lastEvent) {\n      finalBeat = lastEvent.beat;\n    }\n    finalBeat += END_EXTRA_BEATS;\n\n    // hack to implement global offset of -12 ms\n    this.tl = this.tl.to({}, { duration: 0 }, GLOBAL_OFFSET);\n\n    for (let i = 0; i < this.eventList.length; i++) {\n      let startEvent = this.eventList[i],\n        endEvent = this.eventList[i + 1];\n\n      // delay the animations by the length of the stop, if applicable\n      let delay = startEvent.type === \"stop\" ? startEvent.value : 0;\n\n      // the bpm of this section\n      if (startEvent.type === \"bpm\") bpm = startEvent.value;\n      else if (startEvent.type === \"stop\") bpm = startEvent.bpm;\n\n      // if there is a bpm change or stop event somewhere ahead of this one\n      if (endEvent) {\n        // number of beats between startEvent and endEvent, i.e. how long this constant bpm section is\n        const sectionBeatLength = endEvent.beat - startEvent.beat;\n\n        // the duration of this constant bpm section in seconds\n        const sectionDuration = (sectionBeatLength / bpm) * 60;\n\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: accumulatedBeatTick + sectionBeatLength,\n            duration: sectionDuration,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n        accumulatedBeatTick += sectionBeatLength;\n      }\n      // if this is the last bpm change/stop event, animate remaining objects to end\n      else {\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: finalBeat,\n            duration: ((finalBeat - accumulatedBeatTick) / bpm) * 60,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n      }\n    }\n\n    this.guidelines = new Guidelines({ mods, finalBeat });\n    AudioPlayer.setTimeline(this.tl);\n    AudioPlayer.setGlobalParams(this.globalParams);\n\n    this.updateLoopOnce();\n    // hack\n  }\n\n  resetArrows() {\n    this.arrows.forEach((arrow) => arrow.reset());\n  }\n\n  mainLoop(loop = true) {\n    // console.log(\"mainLoop running\");\n    this.drawBackground();\n\n    if (this.stepZone) {\n      this.stepZone.render(this.canvas, this.globalParams.beatTick);\n    }\n    if (this.guidelines) {\n      this.guidelines.render(this.canvas, this.globalParams.beatTick);\n    }\n\n    for (let i = this.shockArrows.length - 1; i >= 0; i--) {\n      const shockArrow = this.shockArrows[i];\n      shockArrow.render(\n        this.canvas,\n        this.globalParams.frame,\n        this.globalParams.beatTick\n      );\n    }\n\n    // render arrows in the opposite order so the earlier arrows are layered over the later ones\n    for (let i = this.arrows.length - 1; i >= 0; i--) {\n      const arrow = this.arrows[i];\n      arrow.render(this.canvas, this.globalParams.beatTick);\n    }\n\n    // if (this.globalParams.beatTick) {\n    //   console.log(this.globalParams.beatTick);\n    // }\n    this.globalParams.frame++;\n\n    if (loop) {\n      this.mainLoopRequestRef = window.requestAnimationFrame(\n        this.mainLoop.bind(this)\n      );\n    }\n  }\n\n  drawBackground() {\n    this.c.fillStyle = \"black\";\n    this.c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  toggleTl() {\n    if (this.tl.paused()) {\n      console.log(\"tl.play()\");\n      this.tl.play();\n    } else {\n      console.log(\"tl.pause()\");\n      this.tl.pause();\n    }\n  }\n  restartTl() {\n    // console.log(\"call restart\");\n    this.tl.restart().pause();\n    this.resetArrows();\n  }\n  pauseTl() {\n    this.tl.pause();\n  }\n}\n\nexport default GameEngine;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\n\nconst Progress = (props) => {\n  const progressBar = useRef();\n  // const [progress, setProgress] = useState(0);\n\n  const { progress, gameEngine } = props;\n\n  useEffect(() => {\n    progressBar.current.addEventListener(\"touchstart\", (e) => {\n      jumpToProgress(e.touches[0]);\n    });\n\n    progressBar.current.addEventListener(\"touchmove\", (e) => {\n      jumpToProgress(e.touches[0]);\n    });\n\n    progressBar.current.addEventListener(\"touchend\", (e) => {\n      // jumpToProgress(e.touches[0]);\n    });\n\n    // AudioPlayer.setStateProgress = setProgress;\n  }, []);\n\n  const jumpToProgress = (event) => {\n    const totalWidth = progressBar.current.offsetWidth;\n    const x = event.clientX - progressBar.current.offsetLeft;\n    const progressPercent = x / totalWidth;\n\n    if (progressPercent < 0 || progressPercent > 1) return;\n\n    // console.log(\n    //   \"jump to progress\",\n    //   progressPercent,\n    //   \"gameEngine\",\n    //   gameEngine.globalParams\n    // );\n\n    // setProgress(progressPercent);\n    AudioPlayer.seekProgress(progressPercent);\n  };\n\n  return (\n    <div id=\"progress-bar\" ref={progressBar}>\n      <div\n        className=\"progress-value\"\n        style={{ width: `${progress * 100}%` }}\n      ></div>\n    </div>\n  );\n};\n\nexport default Progress;\n","import React, { useEffect, useRef } from \"react\";\nimport { Button } from \"semantic-ui-react\";\n\nconst HoldButton = (props) => {\n  const button = useRef();\n  const requestRef = useRef();\n\n  useEffect(() => {\n    const el = button.current.ref.current;\n    el.addEventListener(\"mousedown\", pressingDown, false);\n    el.addEventListener(\"mouseup\", notPressingDown, false);\n    el.addEventListener(\"mouseleave\", notPressingDown, false);\n\n    el.addEventListener(\"touchstart\", pressingDown, false);\n    el.addEventListener(\"touchend\", notPressingDown, false);\n  }, []);\n\n  const pressingDown = (e) => {\n    e.preventDefault();\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  const notPressingDown = (e) => {\n    cancelAnimationFrame(requestRef.current);\n  };\n\n  const handleHold = () => {\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  return (\n    <Button {...props} ref={button}>\n      {props.children}\n    </Button>\n  );\n};\n\nexport default HoldButton;\n","import React, { useState, useEffect } from \"react\";\nimport { Button, Icon } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\nimport Hammer from \"hammerjs\";\nimport \"inobounce\";\n\nimport \"./ChartArea.scss\";\n\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\nimport GameEngine from \"../../core/GameEngine\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport Progress from \"./Progress\";\nimport HoldButton from \"../ui/HoldButton\";\n\nconst ChartArea = (props) => {\n  const {\n    selectedDifficulty,\n    selectedSong,\n    sm,\n    mods,\n    selectedAudio,\n    loadingAudio,\n    gameEngine,\n    setGameEngine,\n  } = props;\n\n  const [canvas, setCanvas] = useState(null);\n\n  // define canvas on mount\n  useEffect(() => {\n    if (!loadingAudio) {\n      const chartArea = document.querySelector(\"#chartArea\");\n      setCanvas(chartArea);\n\n      const mc = new Hammer(chartArea);\n\n      mc.on(\"panup\", (e) => {\n        AudioPlayer.goForward(20);\n      });\n      mc.on(\"pandown\", (e) => {\n        AudioPlayer.goBack(20);\n      });\n    }\n  }, [loadingAudio]);\n\n  // reset chart if song, difficulty, or mods change\n  useEffect(() => {\n    if (!canvas) return;\n\n    let ge = new GameEngine(canvas, sm);\n\n    if (!selectedDifficulty) return;\n\n    const simfile = ge.simfiles[`single_${selectedDifficulty}`];\n\n    if (simfile) {\n      ge.generateEventList(simfile);\n      ge.generateArrows(simfile, mods);\n      ge.initTimeline(mods);\n      ge.restartTl();\n      AudioPlayer.resync();\n    }\n    setGameEngine(ge);\n  }, [canvas, sm, selectedDifficulty, mods]);\n\n  const togglePlay = () => {\n    if (!gameEngine) return;\n    // gameEngine.toggleTl();\n\n    // if (AudioPlayer.isPlaying()) {\n    if (props.audio.status === \"playing\") {\n      AudioPlayer.pause();\n    } else {\n      AudioPlayer.play();\n    }\n  };\n  const restart = () => {\n    if (!gameEngine) return;\n    AudioPlayer.stop();\n  };\n\n  const isPlayDisabled = () => {\n    if (!gameEngine || loadingAudio) return true;\n    return false;\n  };\n\n  return (\n    <div className=\"canvas-container\">\n      {loadingAudio && <div>Loading audio...</div>}\n      {!loadingAudio && (\n        <>\n          <canvas id=\"chartArea\" width=\"256\" height=\"448\" />\n          <div className=\"progress-container\">\n            <Progress progress={props.audio.progress} gameEngine={gameEngine} />\n          </div>\n        </>\n      )}\n      {/* <canvas id=\"chartArea\" width=\"256\" height=\"18000\" /> */}\n      <div className=\"row\">\n        <div className=\"play-controls\">\n          <HoldButton\n            onClick={() => AudioPlayer.goBack(20)}\n            // disabled={props.audio.progress === 0}\n            className=\"play-control\"\n          >\n            <Icon name=\"backward\" />\n          </HoldButton>\n          <Button\n            onClick={togglePlay}\n            disabled={isPlayDisabled()}\n            className=\"play-control\"\n          >\n            <Icon name={props.audio.status === \"playing\" ? \"pause\" : \"play\"} />\n          </Button>\n          <Button onClick={restart} className=\"play-control\">\n            <Icon name=\"stop\" />\n          </Button>\n          <HoldButton\n            onClick={() => AudioPlayer.goForward(20)}\n            className=\"play-control\"\n          >\n            <Icon name=\"forward\" />\n          </HoldButton>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"song-information\">\n          {selectedSong && (\n            <>\n              <div className=\"song-title\">{selectedSong.title}</div>\n              <div className=\"song-artist\">{selectedSong.artist}</div>\n            </>\n          )}\n        </div>\n        <div className=\"bpm-information\">\n          <div className=\"bpm-header\">BPM</div>\n          <div className=\"bpm-value\">{props.chart.activeBpm}</div>\n        </div>\n        <div className=\"level-information\">\n          {selectedSong && (\n            <>\n              <div className=\"song-difficulty\">{selectedDifficulty}</div>\n              <div className=\"song-level\">\n                {\n                  selectedSong.levels[\n                    SP_DIFFICULTIES.indexOf(selectedDifficulty)\n                  ]\n                }\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, chart, mods } = state;\n  return {\n    audio: audio.chartAudio,\n    chart,\n    mods,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChartArea);\n","import React from \"react\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { getJacketPath } from \"../../utils\";\n\nconst SongGrid = (props) => {\n  const { displayedSongs, onSongSelect, selectedSongOption } = props;\n\n  // let songs = displayedSongs.slice(200, 300);\n  let songs = displayedSongs;\n\n  // console.log(\"songs\", songs);\n\n  const selectSong = (song) => {\n    onSongSelect(null, { value: song.hash });\n    // console.log(\"select song\", song);\n  };\n\n  const renderSong = (song) => {\n    return (\n      <div\n        className=\"songTile-wrapper\"\n        key={`songtile_${song.hash}`}\n        onClick={() => selectSong(song)}\n      >\n        <div\n          className={`songTile ${\n            selectedSongOption === song.hash ? \"selected\" : \"\"\n          }`}\n        >\n          <div className=\"song-jacket-wrapper\">\n            <img\n              className=\"song-jacket\"\n              src={getJacketPath(`${song.hash}.png`)}\n              title={song.title}\n              alt={song.title}\n            />\n          </div>\n          <div className=\"song-title-bar\">{song.title}</div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"songGrid\">\n      {songs.map((song) => {\n        return renderSong(song);\n      })}\n    </div>\n  );\n};\n\nexport default SongGrid;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_1\",\n  \"data-name\": \"Line 1\",\n  d: \"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_2\",\n  \"data-name\": \"Line 2\",\n  d: \"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_3\",\n  \"data-name\": \"Line 3\",\n  d: \"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z\"\n});\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_4\",\n  \"data-name\": \"Line 4\",\n  d: \"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z\"\n});\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_5\",\n  \"data-name\": \"Line 5\",\n  d: \"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z\"\n});\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_6\",\n  \"data-name\": \"Line 6\",\n  d: \"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z\"\n});\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_7\",\n  \"data-name\": \"Line 7\",\n  d: \"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z\"\n});\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_8\",\n  \"data-name\": \"Line 8\",\n  d: \"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z\"\n});\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_9\",\n  \"data-name\": \"Line 9\",\n  d: \"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z\"\n});\n\nvar SvgAudiowave = function SvgAudiowave(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"audioWave\",\n    \"data-name\": \"Layer 1\",\n    viewBox: \"0 0 50 38.05\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgAudiowave, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/audiowave.e48c060f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef } from \"react\";\nimport { Dropdown } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport SongGrid from \"./SongGrid\";\nimport { getJacketPath } from \"../../utils\";\nimport {\n  SP_DIFFICULTIES,\n  TITLE_CATEGORIES,\n  LEVELS,\n  DDR_VERSIONS,\n} from \"../../constants\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { ReactComponent as AudioWave } from \"../../svg/audiowave.svg\";\n\nconst titleSortOptions = [\n  { key: \"title_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  TITLE_CATEGORIES.map((letter) => {\n    return { key: `title_${letter}`, value: letter, text: letter };\n  })\n);\n\nconst versionSortOptions = [\n  { key: \"version_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  DDR_VERSIONS.map((versionName, idx) => {\n    return { key: `version_${idx}`, value: idx, text: versionName };\n  }).reverse()\n);\n\nconst levelSortOptions = [\n  { key: \"level_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  LEVELS.map((level) => {\n    return { key: `level_${level}`, value: level, text: level };\n  })\n);\n\nconst difficultySortOptions = [\n  { key: \"difficulty_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  SP_DIFFICULTIES.map((difficulty) => {\n    return {\n      key: `difficulty_${difficulty}`,\n      value: difficulty,\n      text: difficulty,\n    };\n  })\n);\n\nconst SongForm = (props) => {\n  const { activeView, simfileList, selectedDifficulty, previewAudio } = props;\n  const songGridContainer = useRef();\n\n  const simfileOptions = simfileList.map((song) => {\n    return { key: song.hash, value: song.hash, text: song.title };\n  });\n\n  const [selectedSongOption, setSelectedSongOption] = useState(null);\n  const [selectedDifficultyOption, setSelectedDifficultyOption] = useState(\n    selectedDifficulty\n  );\n\n  const [selectedFilters, setSelectedFilters] = useState({\n    title: \"all\",\n    version: 16,\n    level: \"all\",\n    difficulty: \"all\",\n    // level: 10,\n  });\n\n  const [displayedSongs, setDisplayedSongs] = useState([]);\n\n  // on filter change\n  useEffect(() => {\n    const { title, version, level, difficulty } = selectedFilters;\n\n    const songs = simfileList\n      .filter((song) => {\n        return (\n          (title === \"all\" || title === song.abcSort) &&\n          (version === \"all\" || version === parseInt(song.version)) &&\n          (level === \"all\" || song.levels.slice(0, 5).includes(level))\n        );\n      })\n      .filter((song) => {\n        // if a difficulty is specified:\n        if (difficulty !== \"all\") {\n          // if level is not specified, simply check if that difficulty exists\n          if (level === \"all\") {\n            return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] !== null;\n          }\n          // if level is specified, only show if the difficulty is that level\n          else {\n            return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] === level;\n          }\n        }\n        return song;\n      });\n\n    setDisplayedSongs(songs);\n    songGridContainer.current.scrollTop = 0;\n  }, [selectedFilters]);\n\n  // object corresponding to the selected song option\n  // NOT the song currently playing in the main view\n  const [selectedSong, setSelectedSong] = useState(null);\n\n  // initialize song for testing\n  useEffect(() => {\n    // onSongSelect(null, { value: \"99OQb9b0IQ98P6IQdPOiqi8q16o16iqP\" }); // ORCA\n    // onSongSelect(null, { value: \"PooiIP8qP0IPd9D1Ibi6l9bDoqdi9P8O\" }); // DEGRS\n    // onSongSelect(null, { value: \"q0QIob1PDI6IP86dlPb6I6il9d6bP606\" }); // einya\n    // onSongSelect(null, { value: \"bIlqP91O9ld1lqlq6qoq9OiPdqIDPP0l\" }); // lachryma\n    // onSongSelect(null, { value: \"06O0ObdQobq86lPDo6P18dQ1QPdilIQO\" }); // ayakashi\n    // onSongSelect(null, { value: \"9bI0dQdb01Dl1bQq1Pq998i0l096D99P\" }); // second heaven\n    // onSongSelect(null, { value: \"8o1iQPiId8P6Db9Iqo1Oo119QDoq8qQ8\" }); // chaos\n    // onSongSelect(null, { value: \"dD6PqbboDil89DPIID86Pldi6obI1b8l\" }); // pluto\n    // onSongSelect(null, { value: \"loP08P1PPi990lPD0O060d888O9o6qb8\" }); // seasons\n    // onSongSelect(null, { value: \"8QbqP80q9PI8bbi0qOoiibOQD08OPdli\" }); // felm\n    // onSongSelect(null, { value: \"6bid6d9qPQ80DOqiidQQ891o6Od8801l\" }); // otp\n    // onSongSelect(null, { value: \"9i0q91lPPiO61b9P891O1i86iOP1I08O\" }); // egoism\n    // onSongSelect(null, { value: \"lldPQPDP0qq8iqQ910l8b8PoQ6O668Q0\" }); // downer & upper\n    // onSongSelect(null, { value: \"PP1q0iii1D6Dq9QOd0qqDOQD0160QoPD\" }); // paranoia eternal\n    // onSongSelect(null, { value: \"QI06q9lPIoo80DlI18Ooi6dbPl89bqi0\" }); // our soul\n    // onSongSelect(null, { value: \"POq8OPlOO9199i11Od0P00801Qo01DQo\" }); // rtswy\n    // onSongSelect(null, { value: \"QQldo10ObPPQPlliODiDIIl0Q1oPoo61\" }); // deltamax\n    // onSongSelect(null, { value: \"06loOQ0DQb0DqbOibl6qO81qlIdoP9DI\" }); // paranoia\n    // onSongSelect(null, { value: \"0dOi10q9Q6oi0Q9960iQQDO6olqlDDqo\" }); // private eye\n    // onSongSelect(null, { value: \"9I00D9Id61iD6QP8i8Dd6698PoQ9bdi9\" }); // okome\n    // onSongSelect(null, { value: \"O9qDQOQO8dDDIiO9dPP0Pb8qQo9l89D9\" }); // triperfect\n    // onSongSelect(null, { value: \"0IldoDlDQql99DqQo0Qq9ioPIiiPoIoi\" }); // pluto relinquish\n    onSongSelect(null, { value: \"PIO8dod8P9OOP1bi0D1POIi6OdOdQDql\" }); // pluto the first\n  }, []);\n\n  useEffect(() => {\n    if (selectedSongOption) {\n      const song = simfileList.find((song) => song.hash === selectedSongOption);\n      setSelectedSong(song);\n      AudioPlayer.storeAudioSource(song);\n    }\n  }, [selectedSongOption]);\n\n  const onSongSelect = async (e, data) => {\n    const songHash = data.value;\n    setSelectedSongOption(songHash);\n\n    // console.log(\"setSelectedSongOption\", songHash);\n    AudioPlayer.stopSongPreview();\n\n    const song = simfileList.find((song) => song.hash === songHash);\n\n    // if a specific level filter has been chosen, select the difficulty that\n    // corresponds to that level\n    if (selectedFilters.difficulty !== \"all\") {\n      handleDifficultySelect(selectedFilters.difficulty);\n    } else if (selectedFilters.level !== \"all\") {\n      for (let i = 0; i < song.levels.length; i++) {\n        const level = song.levels[i];\n        if (level === selectedFilters.level) {\n          console.log(\"match\", SP_DIFFICULTIES[i], level);\n          handleDifficultySelect(SP_DIFFICULTIES[i]);\n          break;\n        }\n      }\n    } else {\n      const selectedDiffOptionIndex = SP_DIFFICULTIES.indexOf(\n        selectedDifficultyOption\n      );\n      if (song.levels[selectedDiffOptionIndex]) {\n        props.onDifficultySelect(selectedDifficultyOption);\n      } else {\n        /*\n          If the song does not have a chart corresponding to the chosen difficulty option,\n          pick whatever is *closest*\n          - If Difficult, Expert, or Challenge is the chosen option, start from Challenge and\n            work your way down until the first available difficulty is reached.\n          - If Beginner or Basic is the chosen option, start from Beginner and work up.\n          The closest available difficulty will be chosen for the song without affecting the\n          difficulty option selected for the form, like the way it works in the real game\n        */\n        if (\n          [\"Difficult\", \"Expert\", \"Challenge\"].includes(\n            selectedDifficultyOption\n          )\n        ) {\n          for (let i = 4; i >= 0; i--) {\n            if (song.levels[i]) {\n              props.onDifficultySelect(SP_DIFFICULTIES[i]);\n              break;\n            }\n          }\n        } else if ([\"Beginner\", \"Basic\"].includes(selectedDifficultyOption)) {\n          for (let i = 0; i <= 4; i++) {\n            if (song.levels[i]) {\n              props.onDifficultySelect(SP_DIFFICULTIES[i]);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    // automatically update chart\n    props.onSongSelect(song);\n  };\n\n  const handleDifficultySelect = (difficulty) => {\n    setSelectedDifficultyOption(difficulty);\n    props.onDifficultySelect(difficulty);\n  };\n\n  const renderDifficulties = () => {\n    if (!selectedSong) return null;\n\n    // temp: only single\n    return selectedSong.levels.slice(0, 5).map((level, idx) => {\n      if (!level) return null;\n      const difficulty = SP_DIFFICULTIES[idx];\n      return (\n        <div\n          className={`song-difficulty ${difficulty} ${\n            selectedDifficulty === difficulty ? \"selected\" : \"\"\n          }`}\n          key={`sp-difficulty_${difficulty}`}\n          onClick={() => handleDifficultySelect(difficulty)}\n        >\n          <div className=\"difficulty\">{difficulty}</div>\n          <div className=\"level\">{level}</div>\n        </div>\n      );\n    });\n  };\n\n  const toggleSongPreview = () => {\n    const oldSongHash = AudioPlayer.currentPreview;\n\n    // toggle start/stop of the same song\n    if (oldSongHash === selectedSong.hash) {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      } else {\n        AudioPlayer.playSongPreview(selectedSong);\n      }\n    }\n\n    // play a new song and stop the current one (if applicable)\n    else {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      }\n      AudioPlayer.playSongPreview(selectedSong);\n    }\n  };\n\n  return (\n    <div\n      className={`form-container songView ${\n        activeView === \"song\" ? \"open\" : \"closed\"\n      }`}\n    >\n      <form className=\"songForm\">\n        <div className=\"form-inner-wrapper\">\n          <div className=\"selectedSong\">\n            <div\n              className={`selectedSong-jacket-wrapper ${\n                previewAudio.status === \"playing\" ? \"playing\" : \"\"\n              }`}\n            >\n              <div className=\"selectedSong-jacket-overlay\">\n                <AudioWave />\n              </div>\n              <img\n                className={`selectedSong-jacket`}\n                src={getJacketPath(`${selectedSongOption}.png`)}\n                alt=\"Selected song\"\n                onClick={toggleSongPreview}\n              />\n            </div>\n            <div className=\"selectedSong-info\">\n              <Dropdown\n                placeholder=\"Choose a song\"\n                className=\"song-title-dropdown\"\n                search\n                selection\n                value={selectedSongOption}\n                onChange={onSongSelect}\n                options={simfileOptions}\n                selectOnBlur={false}\n                selectOnNavigation={false}\n              />\n              <div className=\"song-artist\">\n                {selectedSong && selectedSong.artist}\n              </div>\n\n              <div className=\"song-difficulties\">{renderDifficulties()}</div>\n            </div>\n          </div>\n          <div className=\"songForm-filters\">\n            <div className=\"songForm-filters-row\">\n              <div className=\"form-field\">\n                <label>By Title</label>\n                <Dropdown\n                  className=\"title-filter-dropdown\"\n                  selection\n                  value={selectedFilters.title}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      title: data.value,\n                    })\n                  }\n                  options={titleSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Version</label>\n                <Dropdown\n                  className=\"version-filter-dropdown\"\n                  selection\n                  value={selectedFilters.version}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      version: data.value,\n                    })\n                  }\n                  options={versionSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Level</label>\n                <Dropdown\n                  className=\"level-filter-dropdown\"\n                  selection\n                  value={selectedFilters.level}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      level: data.value,\n                    })\n                  }\n                  options={levelSortOptions}\n                />\n                <label>By Difficulty</label>\n                <Dropdown\n                  className=\"difficulty-filter-dropdown\"\n                  selection\n                  value={selectedFilters.difficulty}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      difficulty: data.value,\n                    })\n                  }\n                  options={difficultySortOptions}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n\n      <div className=\"songGrid-container\" ref={songGridContainer}>\n        <SongGrid\n          displayedSongs={displayedSongs}\n          onSongSelect={onSongSelect}\n          selectedSongOption={selectedSongOption}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  const { previewAudio } = audio;\n  return {\n    previewAudio,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SongForm);\n","import React, { useState } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Radio, Checkbox } from \"semantic-ui-react\";\n\nimport { options } from \"./options\";\nimport { capitalize } from \"../../utils\";\nimport { updateMods } from \"../../actions/ModsActions\";\n\nconst ModsForm = (props) => {\n  const {\n    activeView,\n    simfileList,\n    selectedDifficulty,\n    mods,\n    gameEngine,\n    updateMods,\n  } = props;\n\n  return (\n    <div\n      className={`form-container ${activeView === \"mods\" ? \"open\" : \"closed\"}`}\n    >\n      <form>\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Speed</h4>\n          {options.mods.speed.map((speed) => {\n            return (\n              <Radio\n                key={`speed_${speed}`}\n                label={`${speed}x`}\n                name=\"speed\"\n                value={speed}\n                checked={mods.speed === speed}\n                onChange={() => updateMods({ speed })}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Arrow color</h4>\n          {options.mods.noteskin.map((noteskin) => {\n            return (\n              <Radio\n                key={`noteskin_${noteskin}`}\n                label={capitalize(noteskin)}\n                name=\"noteskin\"\n                value={noteskin}\n                checked={mods.noteskin === noteskin}\n                onChange={() => updateMods({ noteskin })}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Turn</h4>\n          {options.mods.turn.map((turn) => {\n            return (\n              <Radio\n                key={`turn_${turn}`}\n                label={capitalize(turn)}\n                name=\"turn\"\n                value={turn}\n                checked={mods.turn === turn}\n                onChange={() => updateMods({ turn })}\n              />\n            );\n          })}\n        </div>\n        {mods.turn === \"shuffle\" && (\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Shuffle pattern</h4>\n            {options.mods.shuffle.map((shuffle) => {\n              return (\n                <Radio\n                  key={`shuffle_${shuffle}`}\n                  label={shuffle}\n                  name=\"shuffle\"\n                  value={shuffle}\n                  checked={mods.shuffle === shuffle}\n                  onChange={() => updateMods({ shuffle })}\n                />\n              );\n            })}\n          </div>\n        )}\n\n        <h4>Miscellaneous</h4>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Guidelines\"\n            name=\"guidelines\"\n            checked={mods.guidelines}\n            onChange={() => updateMods({ guidelines: !mods.guidelines })}\n          />\n        </div>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Color freeze heads\"\n            name=\"colorFreezes\"\n            checked={mods.colorFreezes}\n            onChange={() => updateMods({ colorFreezes: !mods.colorFreezes })}\n          />\n        </div>\n      </form>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods } = state;\n  return { mods };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    updateMods: (mods) => dispatch(updateMods(mods)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ModsForm);\n","import React from \"react\";\nimport { Icon } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { stopPreviewAudio } from \"../../actions/AudioActions\";\n\nconst MobileNav = (props) => {\n  const { activeView, chartAudio, previewAudio } = props;\n\n  const navItems = [\n    { view: \"song\", icon: \"music\" },\n    { view: \"mods\", icon: \"sidebar\" },\n    { view: \"2\", icon: \"\" },\n    { view: \"3\", icon: \"\" },\n    { view: \"chart\", icon: \"arrow up\" },\n  ];\n\n  const setActiveView = (view) => {\n    if (chartAudio.status === \"playing\") return;\n    AudioPlayer.stopSongPreview();\n    props.setActiveView(view);\n  };\n\n  const isDisabled = (view) => {\n    if (view !== \"chart\" && chartAudio.status === \"playing\") return true;\n    return false;\n  };\n\n  return (\n    <nav className=\"mobileNav\">\n      {navItems.map((navItem) => {\n        const { view, icon } = navItem;\n        if (!view) return <div className=\"mobileNav_item\" />;\n        return (\n          <div\n            key={`mobileNavItem_${view}`}\n            className={`mobileNav_item ${activeView === view ? \"active\" : \"\"} ${\n              isDisabled(view) ? \"disabled\" : \"\"\n            }`}\n            onClick={() => setActiveView(view)}\n          >\n            <Icon name={icon} />\n          </div>\n        );\n      })}\n    </nav>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  const { chartAudio, previewAudio } = audio;\n  return {\n    chartAudio,\n    previewAudio,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    stopPreviewAudio: () => dispatch(stopPreviewAudio()),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MobileNav);\n","import React, { useState, useEffect } from \"react\";\nimport { tsv } from \"d3-fetch\";\nimport { Button } from \"semantic-ui-react\";\n\nimport ChartArea from \"../../components/chart/ChartArea\";\nimport SongForm from \"../../components/form/SongForm\";\nimport ModsForm from \"../../components/form/ModsForm\";\nimport MobileNav from \"../../components/navigation/MobileNav\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { optionDefaultValues } from \"../../components/form/options\";\nimport { fetchDocument } from \"../../utils\";\n\nconst MainContainer = (props) => {\n  const [loadingSimfiles, setLoadingSimfiles] = useState(true);\n  const [simfileList, setSimfileList] = useState([]);\n  const [selectedSong, setSelectedSong] = useState(null);\n  const [selectedSM, setSelectedSM] = useState(null);\n  const [selectedDifficulty, setSelectedDifficulty] = useState(\n    optionDefaultValues.difficulty\n  );\n  const [selectedAudio, setSelectedAudio] = useState(null);\n\n  const [mods, setMods] = useState(optionDefaultValues.mods);\n  const [activeView, setActiveView] = useState(\"chart\");\n\n  const [gameEngine, setGameEngine] = useState(null);\n\n  const [loadingAudio, setLoadingAudio] = useState(false);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchSimfiles();\n      setLoadingSimfiles(false);\n    };\n    fetchData();\n\n    AudioPlayer.setLoadingAudio = setLoadingAudio;\n  }, []);\n\n  const fetchSimfiles = async () => {\n    try {\n      const parsedTsv = await tsv(window.location.href + \"/data/simfiles.tsv\");\n      parsedTsv.forEach((row) => {\n        row.levels = row.levels\n          .split(\",\")\n          .map((level) => (level ? parseInt(level) : null));\n      });\n\n      // console.log(\"simfiles\", parsedTsv);\n      setSimfileList(parsedTsv);\n    } catch (error) {\n      console.error(error);\n      return null;\n    }\n  };\n\n  const onSongSelect = async (song) => {\n    console.log(\"MainContainer selected song\", song);\n    AudioPlayer.selectSong(song);\n    setSelectedSong(song);\n\n    // retrieve audio file and simfile from song.simfilePath\n    // TEMP: SM only; ignore Ace for Aces and Chaos Terror-Tech for now\n\n    let smName = song.smName;\n\n    // special case for tohoku evolved: pick one of its types at random\n    if (song.hash === \"OddDoQ6dqi0QdQDDOO6qlO08d8bPbli1\") {\n      smName = smName.replace(\"1\", Math.floor(Math.random() * 4) + 1);\n    }\n\n    try {\n      const sm = await fetchDocument(\n        `${window.location.href}/simfiles/${encodeURIComponent(smName)}.sm`\n      );\n      setSelectedSM(sm);\n    } catch (err) {\n      alert(err);\n    }\n  };\n\n  const onDifficultySelect = (difficulty) => {\n    setSelectedDifficulty(difficulty);\n  };\n\n  const changeActiveView = (view) => {\n    setActiveView(view);\n    AudioPlayer.activeView = view;\n  };\n\n  return (\n    <div className=\"main-container\">\n      {!loadingSimfiles && (\n        <>\n          <ChartArea\n            loadingAudio={loadingAudio}\n            selectedSong={selectedSong}\n            selectedDifficulty={selectedDifficulty}\n            sm={selectedSM}\n            selectedAudio={selectedAudio}\n            gameEngine={gameEngine}\n            setGameEngine={setGameEngine}\n          />\n\n          <SongForm\n            activeView={activeView}\n            setActiveView={changeActiveView}\n            simfileList={simfileList}\n            selectedDifficulty={selectedDifficulty}\n            onSongSelect={onSongSelect}\n            onDifficultySelect={onDifficultySelect}\n            loadingAudio={loadingAudio}\n          />\n\n          <ModsForm\n            activeView={activeView}\n            simfileList={simfileList}\n            selectedSong={selectedSong}\n            onSongSelect={onSongSelect}\n            selectedDifficulty={selectedDifficulty}\n            onDifficultySelect={onDifficultySelect}\n            selectedAudio={selectedAudio}\n            setSelectedAudio={setSelectedAudio}\n            gameEngine={gameEngine}\n          />\n\n          <MobileNav activeView={activeView} setActiveView={changeActiveView} />\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default MainContainer;\n","import React from \"react\";\n\nimport MainContainer from \"./containers/main/MainContainer\";\n\nfunction App() {\n  return (\n    <div className=\"app-container\">\n      <MainContainer />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport \"semantic-ui-css/semantic.min.css\";\n\nimport \"./styles.scss\";\nimport App from \"./App\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}