{"version":3,"sources":["constants/index.js","utils/index.js","utils/debugUtils.js","utils/engineUtils.js","components/chart/canvas/Arrow.js","components/chart/canvas/ShockArrow.js","components/chart/canvas/StepZone.js","components/chart/canvas/Guidelines.js","components/chart/canvas/TargetFlash.js","components/chart/canvas/ComboDisplay.js","components/chart/canvas/BpmAndStopDisplay.js","components/chart/canvas/LaneCover.js","utils/parseSimfile.js","actions/AudioActions.js","reducers/AudioReducer.js","reducers/ChartReducer.js","actions/ModsActions.js","utils/userSettings.js","components/form/options.js","reducers/ModsReducer.js","reducers/ScreenReducer.js","actions/SongSelectActions.js","reducers/SongSelectReducer.js","reducers/index.js","actions/ChartActions.js","actions/ScreenActions.js","store.js","components/chart/canvas/Progress.js","core/AudioPlayer.js","core/GameEngine.js","components/chart/ShareModal.js","components/ui/HoldButton.js","components/chart/PlayControls.js","components/chart/SongInfo.js","components/chart/CabButtons.js","components/chart/BpmDisplay.js","components/chart/StopDisplay.js","components/chart/ChartArea.js","hooks/index.js","utils/songUtils.js","components/form/SongGrid.js","utils/loadStore.js","components/ui/ToggleSwitch.js","components/form/songFormOptions.js","svg/audiowave.svg","components/form/SongForm.js","components/form/ModsForm.js","svg/arrows.svg","svg/mods.svg","svg/music_search.svg","components/navigation/Navbar.js","containers/main/MainContainer.js","components/debug/LogView.js","App.js","index.js"],"names":["DIRECTIONS","SP_DIFFICULTIES","DP_DIFFICULTIES","getOriginPath","window","location","search","href","slice","indexOf","fetchDocument","path","a","fetch","mode","response","reader","body","getReader","decoder","TextDecoder","read","readResult","decode","value","getAssetPath","getJacketPath","capitalize","str","toUpperCase","presetParams","obj","split","forEach","param","key","error","console","log","parseUrlParams","debugLog","text","changeActiveBpm","bpmValue","globalParams","currentBpmEl","document","querySelector","bpmQueue","beatTick","length","beat","textContent","Math","round","getCurrentCombo","song","audio","allArrows","currentTime","seek","i","arrow","combo","timestamp","getReverseCoord","originalCoord","height","canvas","clearBpmAndStopDisplay","bpmReel","getElementById","innerHTML","stopReel","initializeBeatWindow","windowStart","windowEnd","arrows","freezes","shocks","chartAreaHeight","mods","speed","visibleTime","cmod","timeTick","numVisibleBeats","windowStartPtr","windowEndPtr","previousArrow","currentArrow","shock","event","events","ts","freeze","nextTopArrow","j","nextArrow","nextTopShock","currentShock","nextShock","nextTopEvent","currentEvent","nextEvent","holdEnds","nextTopFreeze","latestHoldEnd","max","filter","currentFreeze","nextFreeze","timeWindowStartPtr","timeWindowEndPtr","currentTimeWindow","beatWindowStartPtr","beatWindowEndPtr","currentBeatWindow","updateBeatWindow","Object","keys","nextBottomArrowAdj","nextBottomShockAdj","nextBottomEventAdj","nextBottomFreeze","nextBottomFreezeAdj","arrowImages","direction","Image","src","imageName","Arrow","attrs","this","note","measureIdx","measureN","measureD","beatstamp","directionIdx","arrowImg","frameX","frameY","destX","destY","c","getContext","scroll","appearance","bottomBoundary","currentTimePosition","currentBeatPosition","totalBodyHeight","arrowBodyImg","holdEndTimes","holdStartTimes","ARROW_HEIGHT","holdEndBeats","holdStartBeats","repetitions","floor","partialHeight","originalPartialHeight","partialDestY","freezeBeingHeld","drawImage","bodyHeight","bodyFrameY","bodyDestY","bodyDistance","tailHeight","actualDestY","arrowHeadImg","freeze_head","noteskin","colorFreezes","includes","beatD","beatN","measureFraction","ShockArrow","frame","flashImages","receptorImages","StepZone","isFlash","Guidelines","finalBeat","guidelines","strokeStyle","lineWidth","beginPath","moveTo","lineTo","width","stroke","image","TargetFlash","directions","push","save","globalAlpha","pow","restore","comboImages","type","num","coords","1","2","3","4","ComboDisplay","comboNum","comboFont","numDigits","toString","comboImg","numImg","comboDestX","comboDestY","comboWidth","comboHeight","digit","digitWidth","digitHeight","imageCol","imageRow","imageX","imageY","numDestX","numDestY","numWidth","numHeight","BpmAndStopDisplay","bpmElements","stopElements","eventWindow","elementMap","domKey","element","parentNode","removeChild","bpm","pxPosition","getPxPosition","style","transform","createElement","className","valueNode","appendChild","stop","reel","clientHeight","images","upper","lower","appearanceIdx","LaneCover","laneCoverHeight","img","ARROW_WIDTH","modeRegex","difficultyRegex","difficultyMap","Beginner","Easy","Medium","Hard","Challenge","parseSimfile","sm","chartStrs","simfileType","simfiles","chartMetadata","bpms","stops","offset","test","exec","map","point","parseFloat","finishedLoading","loadedSimfilesNum","chartStr","smDifficulty","difficulty","level","simfile","levelRegex","RegExp","parseInt","measures","lastIndexOf","trim","measure","ticks","n","startsWith","numTicks","noteObjects","tick","tickIdx","noteObj","chart","setChartAudioStatus","status","dispatch","payload","initialState","chartAudio","progress","previewAudio","activeBpm","updateMods","getUserSettings","settings","localStorage","getItem","JSON","parse","err","updateUserSettings","newSettings","setItem","stringify","getSavedSongProgress","saveSongProgress","options","turn","shuffle","stepZone","comboDisplay","optionDefaultValues","laneCoverVisible","globalOffset","bpmStopDisplay","params","userSettings","mod","difficulties","b","B","D","E","C","turnValue","toLowerCase","generateInitialValues","innerWidth","innerHeight","activeView","selectSong","combineReducers","state","action","updatedMods","updatedState","diff","canvasHeight","lowerBoundary","upperBoundary","screen","target","values","songSelect","hash","store","createStore","reducers","compose","applyMiddleware","thunk","devToolsExtension","__REDUX_DEVTOOLS_EXTENSION__","f","mouseDown","currentProgress","presetStart","presetMarker","drawBackground","addEventListener","e","preventDefault","jumpToProgress","touches","setPresetMarker","totalWidth","offsetWidth","presetPosition","left","presetProgress","progressPercent","domRect","getBoundingClientRect","clientX","x","setProgress","AudioPlayer","seekProgress","stopPropagation","fillStyle","fillRect","isNaN","sources","preview","assistTick","Howl","currentSong","currentPreview","currentSongId","currentPreviewId","previewFadeTimeout","updateTimeline","bind","updateProgress","audioResyncFrames","getCurrentSong","initialProgress","setLoadingAudio","thisSong","title","dAudioUrl","format","html5","onload","onloaderror","id","blah","alert","onplay","tl","play","resync","gsap","ticker","add","startAnimationLoop","onpause","pause","remove","stopAnimationLoop","onseek","onstop","restart","onend","spriteId","thisPreview","sprite","sample","sampleStart","sampleLength","volume","setTimeout","fade","clearTimeout","storeAudioSource","audioReloadFrames","isAudioStable","getCurrentTime","getState","updateProgressOnce","getChartAudioStatus","currentBpm","lastBpmValue","bpmEvent","getCurrentBpm","currentCombo","comboTemp","ms","seekTime","audioDuration","duration","time","deltaTime","t0","performance","now","Progress","render","getFullCombo","updateAnimationLoopOnce","actions","songId","kill","playing","getPreviewAudioStatus","getCurrentPreview","GameEngine","chartParams","timeline","eventList","mainLoopRequestRef","targetFlashes","lastEntity","startLoop","stopLoop","updateLoopOnce","resetChart","bpmAndStopDisplay","clearWindow","stopQueue","setGlobalParams","output","debugLogView","row","find","t","join","debugSimfileChart","generateEventList","generateArrows","generateTimestamps","initTimeline","restartTl","pauseTl","requestAnimationFrame","mainLoop","cancelAnimationFrame","bpmPtr","stopPtr","prevEvent","prevTimestamp","timestampDiff","currentTimestamp","Array","isArray","newChart","turnMap","off","mirror","right","shuffle1","shuffle2","shuffle3","shuffle4","shuffle5","shuffle6","shuffle7","shuffle8","turnMod","turnedNote","reverse","applyTurnMods","shockArrow","laneCover","lastArrow","lastEvent","lastArrowBeat","lastEventBeat","comboArrows","currentBpmPtr","currentEventPtr","pendingStopPtr","pendingStop","currentStopOffset","idx","bpmSection","bpmSectionStartBeat","arrowTimestamp","arrowsDuringFreeze","freezeHead","freezeTail","arrowDuringFreeze","set","onStart","to","ease","accumulatedBeatTick","startEvent","endEvent","delay","sectionBeatLength","sectionDuration","setTimeline","loop","killed","refreshWindow","renderBpm","renderStop","upArrows","notUpArrows","renderFreezeBody","renderArrow","targetFlash","paused","Basic","Difficult","Expert","modes","single","double","ShareModal","props","modalOpen","setModalOpen","data","shareUrl","useRef","useState","message","setMessage","useEffect","current","getProgress","replace","queryStr","generateShareUrl","Modal","size","open","onClose","Header","Content","Input","Button","onClick","copy","HoldButton","button","requestRef","pressingDownRef","notPressingDownRef","buttonProps","el","ref","removeEventListener","pressingDown","notPressingDown","handleHold","children","connect","controlsDisabled","setShareModalOpen","goBack","Icon","name","disabled","goForward","selectedSong","selectedDifficulty","selectedMode","artist","levels","updateLaneCoverHeight","laneCoverFn","adjustLaneCoverHeight","keyCode","laneCoverHeightDiff","reverseFactor","toggleLaneCover","loadingAudio","gameEngine","setGameEngine","setCanvas","shareModalOpen","chartArea","canvasContainer","chartLoadingScreen","prevState","usePrevious","initCanvas","resizeChartArea","top","position","wrapper","scaleFactor","xOffset","yOffset","currentState","thing","useSsc","ge","prev","curr","isTlPaused","updateExternalGlobalParams","shareParams","jumpToPresetStart","onTouchStart","getClosestDifficulty","SongGrid","displayedSongs","onSongSelect","selectedSongOption","selectedDifficultyOption","selectedFilters","songs","renderSong","alt","levelFilter","difficultyFilter","displayedLevels","difficultyIdx","closestDiff","closestDiffIdx","renderSongLevel","loadStore","lastRequestedSong","lastRequestedSongLoaded","ToggleSwitch","option1","option2","selectOption","option","onChange","getSwitchClassName","titleSortOptions","concat","letter","versionSortOptions","versionName","levelSortOptions","difficultySortOptions","_extends","assign","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","d","_ref4","_ref6","_ref7","_ref8","_ref9","_ref10","_ref","svgRef","viewBox","ForwardRef","forwardRef","previousSong","simfileList","songGridContainer","simfileOptions","setSelectedSongOption","setSelectedDifficultyOption","setLoadingFirstSong","filters","version","setSelectedFilters","updateSelectedFilters","newFilters","setDisplayedSongs","singleDiffs","doubleDiffs","abcSort","some","scrollTop","setSelectedSong","click","preserveShareUrl","stopSongPreview","killImmediately","selectClosestDifficulty","difficultyToSelect","selectedDiffOptionIndex","onDifficultySelect","history","pushState","Helmet","property","content","playSongPreview","Dropdown","placeholder","selection","selectOnBlur","selectOnNavigation","handleDifficultySelect","renderDifficulties","onModeSelect","displayBpm","getDisplayBpm","lowBpm","highBpm","getEffectiveScrollSpeed","Radio","label","checked","min","_","onBlur","fieldValue","Checkbox","toggle","step","fill","verticalAlign","overflow","fillRule","stopPreviewAudio","setActiveView","view","navItems","icon","svgIcon","SongIcon","ModsIcon","ChartIcon","isDisabled","navItem","SVGIcon","changeActiveView","selectDifficulty","selectMode","resizeScreen","loadingSimfiles","setLoadingSimfiles","setSimfileList","selectedSM","setSelectedSM","fetchSimfiles","fetchData","tsv","parsedTsv","smName","random","encodeURIComponent","withRouter","exact","component","MainContainer","ReactDOM","basename","process"],"mappings":"iSAWaA,G,OAAa,CAAC,OAAQ,OAAQ,KAAM,UAsCpCC,EAAkB,CAC7B,WACA,QACA,YACA,SACA,aAEWC,EAAkB,CAAC,QAAS,YAAa,SAAU,aCtDnDC,EAAgB,WAC3B,OAAIC,OAAOC,SAASC,OACXF,OAAOC,SAASE,KAAKC,MAC1B,EACAJ,OAAOC,SAASE,KAAKE,QAAQL,OAAOC,SAASC,SAE1CF,OAAOC,SAASE,MAGZG,EAAa,uCAAG,WAAOC,GAAP,qBAAAC,EAAA,sEACJC,MAAMF,EAAM,CACjCG,KAAM,SAFmB,cACrBC,EADqB,OAIrBC,EAASD,EAASE,KAAKC,YACvBC,EAAU,IAAIC,YAAY,SALL,SAMFJ,EAAOK,OANL,cAMrBC,EANqB,yBAOpBH,EAAQI,OAAOD,EAAWE,QAPN,2CAAH,sDAUbC,EAAe,SAACd,GAC3B,OAAOR,IAAkB,UAAYQ,GAG1Be,EAAgB,SAACf,GAC5B,OAAOR,IAAkB,WAAaQ,GAG3BgB,EAAa,SAACC,GACzB,OAAOA,EAAIpB,MAAM,EAAG,GAAGqB,cAAgBD,EAAIpB,MAAM,IAoBtCsB,EAjBiB,WAC5B,IAAK1B,OAAOC,SAASC,OAAQ,MAAO,GACpC,IAAMyB,EAAM,GACZ,IAQE,OAPA3B,OAAOC,SAASC,OACbE,MAAM,GACNwB,MAAM,KACNC,SAAQ,SAACC,GAAW,IAAD,EACGA,EAAMF,MAAM,KADf,mBACXG,EADW,KACNX,EADM,KAElBO,EAAII,GAAOX,KAERO,EACP,MAAOK,GAEP,OADAC,QAAQC,IAAI,2BAA4BF,GACjC,IAGiBG,G,wCChDfC,EAAW,SAACC,GAAqB,yD,ykBCCvC,IAgEMC,EAAkB,SAACC,EAAUC,GACxC,IAAMC,EAAeC,SAASC,cAAc,sBAC5C,GAAKF,EAAL,CAFyD,IAIjDG,EAAuBJ,EAAvBI,SAAuBJ,EAAbK,SAML,GACXD,EAASE,QAAU,GACE,IAArBF,EAAS,GAAGG,MACS,IAArBH,EAAS,GAAGG,KAEZN,EAAaO,YAAc,GAE3BP,EAAaO,YAAcC,KAAKC,MAAMX,KAW7BY,EAAkB,SAACC,GAAU,IAChCC,EAAwBD,EAAxBC,MACAC,EADwBF,EAAjBZ,aACPc,UACR,IAAKA,EAAUR,OAAQ,OAAO,EAiB9B,IAfA,IAAMS,EAAcF,EAAMG,OAejBC,EAAI,EAAGA,EAAIH,EAAUR,OAAQW,IAAK,CACzC,IAAMC,EAAQJ,EAAUG,GACxB,GAAIC,EAAMC,OAASD,EAAME,UAAYL,EHnGX,IGsGxB,OAFeG,EAAMC,MAAQ,EASjC,IAAK,IAAIF,EAAIH,EAAUR,OAAS,EAAGW,GAAK,EAAGA,IAAK,CAC9C,IAAMC,EAAQJ,EAAUG,GACxB,GAAIC,EAAMC,MAER,OADeD,EAAMC,MAKzB,OAAQ,GAoBGE,EAAkB,SAACC,EAAeC,EAAQC,GACrD,OAAOA,EAAOD,QAAUD,EAAgBC,IAI7BE,EAAyB,WACpC,IAAMC,EAAUxB,SAASyB,eAAe,WACpCD,IACFA,EAAQE,UAAY,IAGtB,IAAMC,EAAW3B,SAASyB,eAAe,YACrCE,IACFA,EAASD,UAAY,KASZE,EAAuB,SAAC9B,GAAkB,IAUjD+B,EAAaC,EATTC,EAAmDjC,EAAnDiC,OAAQC,EAA2ClC,EAA3CkC,QAASC,EAAkCnC,EAAlCmC,OAAQC,EAA0BpC,EAA1BoC,gBAAiBC,EAASrC,EAATqC,KAE9CjB,EAA2B,SAAfiB,EAAKC,MAAmB,YAAc,YAStD,GAAmB,SAAfD,EAAKC,MAAkB,CACzB,IAAIC,EAAcH,EH3LM,GG4LxBG,GAAeF,EAAKG,KAAO,GAC3BT,EAAc/B,EAAayC,SAAW,GAAKJ,EAAKG,KAAO,IACvDR,EAAYhC,EAAayC,SAAWF,MAC/B,CACL,IAAIG,EAAkBN,EHhME,GGiMxBM,GAAmBL,EAAKC,MAExBP,EAAc/B,EAAaK,SAAW,EAAIgC,EAAKC,MAC/CN,EAAYhC,EAAaK,SAAWqC,EAGtC,IAAMC,EAAiB,GACjBC,EAAe,GAGrB,IAAKX,EAAO3B,QAAU2B,EAAO,GAAGb,GAAaW,EAC3CY,EAAezB,MAAQ,OAGpB,GAAIe,EAAOA,EAAO3B,OAAS,GAAGc,GAAaW,EAC9CY,EAAezB,MAAQe,EAAO3B,YAK9B,IAAK,IAAIW,EAAI,EAAGA,EAAIgB,EAAO3B,OAAQW,IAAK,CACtC,IAAM4B,EAAgBZ,EAAOhB,EAAI,GAC3B6B,EAAeb,EAAOhB,GAG5B,GACE4B,EAAczB,GAAaW,GAC3Be,EAAa1B,IAAcW,EAC3B,CACAY,EAAezB,MAAQD,EACvB,OAMN,IAAKkB,EAAO7B,QAAU6B,EAAO,GAAGf,GAAaW,EAC3CY,EAAeI,MAAQ,OAClB,GAAIZ,EAAOA,EAAO7B,OAAS,GAAGc,GAAaW,EAChDY,EAAeI,MAAQZ,EAAO7B,YAE9B,IAAK,IAAIW,EAAI,EAAGA,EAAIkB,EAAO7B,OAAQW,IACjC,GACEkB,EAAOlB,EAAI,GAAGG,GAAaW,GAC3BI,EAAOlB,GAAGG,IAAcW,EACxB,CACAY,EAAeI,MAAQ9B,EACvB,MAwBN,GAlBA,CAAC,MAAO,QAAQ5B,SAAQ,SAAC2D,GACvB,IAAMC,EAASjD,EAAa,GAAD,OAAIgD,EAAJ,UACrBE,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,OACjD,IAAKW,EAAO3C,QAAU2C,EAAO,GAAGC,GAAMnB,EACpCY,EAAeK,GAAS,OACnB,GAAIC,EAAOA,EAAO3C,OAAS,GAAG4C,GAAMnB,EACzCY,EAAeK,GAASC,EAAO3C,YAE/B,IAAK,IAAIW,EAAI,EAAGA,EAAIgC,EAAO3C,OAAQW,IACjC,GAAIgC,EAAOhC,EAAI,GAAGiC,GAAMnB,GAAekB,EAAOhC,GAAGiC,IAAOnB,EAAa,CACnEY,EAAeK,GAAS/B,EACxB,WAOHiB,EAAQ5B,QAAU4B,EAAQ,GAAGd,GAAaW,EAC7CY,EAAeQ,OAAS,OACnB,GAAIjB,EAAQA,EAAQ5B,OAAS,GAAGc,GAAaW,EAClDY,EAAeQ,OAASjB,EAAQ5B,YAEhC,IAAK,IAAIW,EAAI,EAAGA,EAAIiB,EAAQ5B,OAAQW,IAClC,GACEiB,EAAQjB,EAAI,GAAGG,GAAaW,GAC5BG,EAAQjB,GAAGG,IAAcW,EACzB,CACAY,EAAeQ,OAASlC,EACxB,MAYN,IAAImC,EAAenB,EAAOU,EAAezB,OAGzC,GACEyB,EAAezB,OAASe,EAAO3B,QAC/B8C,EAAahC,GAAaY,EAE1BY,EAAa1B,MAAQyB,EAAezB,MAAQ,OAK5C,IAAK,IAAImC,EAAIV,EAAezB,MAAOmC,EAAIpB,EAAO3B,OAAQ+C,IAAK,CACzD,IAAMP,EAAeb,EAAOoB,GACtBC,EAAYrB,EAAOoB,EAAI,GAG7B,IAAKC,EAAW,CACdV,EAAa1B,MAAQmC,EACrB,MACK,GACLP,EAAa1B,IAAcY,GAC3BsB,EAAUlC,GAAaY,EACvB,CACAY,EAAa1B,MAAQmC,EACrB,OAMN,IAAIE,EAAepB,EAAOQ,EAAeI,OACzC,GACEJ,EAAeI,OAASZ,EAAO7B,QAC/BiD,EAAanC,GAAaY,EAE1BY,EAAaG,MAAQJ,EAAeI,MAAQ,OAE5C,IAAK,IAAI9B,EAAI0B,EAAeI,MAAO9B,EAAIkB,EAAO7B,OAAQW,IAAK,CACzD,IAAMuC,EAAerB,EAAOlB,GACtBwC,EAAYtB,EAAOlB,EAAI,GAC7B,IACGwC,GACAD,EAAapC,IAAcY,GAC1ByB,EAAUrC,GAAaY,EACzB,CACAY,EAAaG,MAAQ9B,EACrB,OAMN,CAAC,MAAO,QAAQ5B,SAAQ,SAAC2D,GACvB,IAAMC,EAASjD,EAAa,GAAD,OAAIgD,EAAJ,UACrBE,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,OAC7CoB,EAAeT,EAAON,EAAeK,IACzC,GACEL,EAAeK,IAAUC,EAAO3C,QAChCoD,EAAaR,GAAMlB,EAEnBY,EAAaI,GAASL,EAAeK,GAAS,OAE9C,IAAK,IAAI/B,EAAI0B,EAAeK,GAAQ/B,EAAIgC,EAAO3C,OAAQW,IAAK,CAC1D,IAAM0C,EAAeV,EAAOhC,GACtB2C,EAAYX,EAAOhC,EAAI,GAC7B,IACG2C,GACAD,EAAaT,IAAOlB,GAAa4B,EAAUV,GAAMlB,EAClD,CACAY,EAAaI,GAAS/B,EACtB,WAMR,IAAM4C,EAA0B,SAAfxB,EAAKC,MAAmB,eAAiB,eAGtDwB,EAAgB5B,EAAQS,EAAeQ,QAC3C,GAAIR,EAAeQ,QAAUjB,EAAQ5B,OACnCsC,EAAaO,OAASR,EAAeQ,OAAS,OAI3C,GAAIW,EAAc1C,GAAaY,GAMlC,GALAY,EAAaO,OAASR,EAAeQ,OAAS,EAK1CW,EAAcD,GAAW,CAC3B,IAAME,EAAgBtD,KAAKuD,IAAL,MAAAvD,KAAI,YACrBqD,EAAcD,GAAUI,QAAO,SAACjG,GAAD,OAAOA,OAG3C,IADA4E,EAAaO,OAASR,EAAeQ,OAC9BjB,EAAQU,EAAaO,QAAQ/B,GAAa2C,GAC/CnB,EAAaO,eAKjB,IAAK,IAAIlC,EAAI0B,EAAeQ,OAAQlC,EAAIiB,EAAQ5B,OAAQW,IAAK,CAC3D,IAAMiD,EAAgBhC,EAAQjB,GACxBkD,EAAajC,EAAQjB,EAAI,GAE/B,IAAKkD,EAAY,CACfvB,EAAaO,OAASlC,EACtB,MAKG,GACHiD,EAAc9C,IAAcY,GAC5BmC,EAAW/C,GAAaY,EACxB,CACA,GAAIkC,EAAcL,GAKhB,IAJA,IAAME,EAAgBtD,KAAKuD,IAAL,MAAAvD,KAAI,YACrByD,EAAcL,GAAUI,QAAO,SAACjG,GAAD,OAAOA,OAGpCkE,EAAQjB,GAAGG,GAAa2C,GAAe9C,IAEhD2B,EAAaO,OAASlC,EACtB,OAKa,SAAfoB,EAAKC,OACPtC,EAAaoE,mBAAqBzB,EAClC3C,EAAaqE,iBAAmBzB,EAChC5C,EAAasE,kBAAoB,CAACvC,EAAaC,KAE/ChC,EAAauE,mBAAqB5B,EAClC3C,EAAawE,iBAAmB5B,EAChC5C,EAAayE,kBAAoB,CAAC1C,EAAaC,KAatC0C,EAAmB,SAAC1E,GAAkB,IAG7C2C,EAAgBC,EAAcxB,EAF1Ba,EAAmDjC,EAAnDiC,OAAQC,EAA2ClC,EAA3CkC,QAASC,EAAkCnC,EAAlCmC,OAAQC,EAA0BpC,EAA1BoC,gBAAiBC,EAASrC,EAATqC,KAalD,GAVmB,SAAfA,EAAKC,OACPK,EAAiB3C,EAAaoE,mBAC9BxB,EAAe5C,EAAaqE,iBAC5BjD,EAAY,cAEZuB,EAAiB3C,EAAauE,mBAC9B3B,EAAe5C,EAAawE,iBAC5BpD,EAAY,aAIc,qBAAnBuB,GACiB,qBAAjBC,GACN+B,OAAOC,KAAKjC,GAAgBrC,QAC5BqE,OAAOC,KAAKhC,GAActC,OAJ7B,CAYA,IAAIyB,EAAaC,EACjB,GAAmB,SAAfK,EAAKC,MAAkB,CACzB,IAAIC,EAAcH,EHldM,GGmdxBG,GAAeF,EAAKG,KAAO,GAC3BT,EAAc/B,EAAayC,SAAW,GAAKJ,EAAKG,KAAO,IACvDR,EAAYhC,EAAayC,SAAWF,EACpCvC,EAAasE,kBAAoB,CAACvC,EAAaC,OAC1C,CACL,IAAIU,EAAkBN,EHxdE,GGydxBM,GAAmBL,EAAKC,MAExBP,EAAc/B,EAAaK,SAAW,EAAIgC,EAAKC,MAC/CN,EAAYhC,EAAaK,SAAWqC,EACpC1C,EAAayE,kBAAoB,CAAC1C,EAAaC,GAIjD,GAAIW,EAAezB,QAAUe,EAAO3B,OAApC,EAI4B,IAAxBsC,EAAa1B,OAEXe,EAAO,GAAGb,IAAcY,IAC1BY,EAAa1B,MAAQ,GAMvBiB,EAAO7B,SACiB,IAAxBsC,EAAaG,OACbZ,EAAO,GAAGf,IAAcY,IAExBY,EAAaG,MAAQ,GAIvB,CAAC,MAAO,QAAQ1D,SAAQ,SAAC2D,GACvB,IAAMC,EAASjD,EAAa,GAAD,OAAIgD,EAAJ,UACrBE,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,OAE/CW,EAAO3C,SACkB,IAAzBsC,EAAaI,IACbC,EAAO,GAAGC,IAAOlB,IAEjBY,EAAaI,GAAS,MAa1B,IALA,IAEII,EAFiBnB,EAAOU,EAAezB,OAKpCkC,EAAahC,GAAaW,GAAa,CAI5C,GAHAY,EAAezB,QAGXyB,EAAezB,OAASe,EAAO3B,OAAQ,OAE3C8C,EAAenB,EAAOU,EAAezB,OAKvC,IADA,IAAIqC,EAAepB,EAAOQ,EAAeI,OAClCQ,GAAgBA,EAAanC,GAAaW,GAC/CY,EAAeI,QACfQ,EAAepB,EAAOQ,EAAeI,OAIvC,CAAC,MAAO,QAAQ1D,SAAQ,SAAC2D,GAIvB,IAHA,IAAMC,EAASjD,EAAa,GAAD,OAAIgD,EAAJ,UACrBE,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,OAC7CoB,EAAeT,EAAON,EAAeK,IAClCU,GAAgBA,EAAaR,GAAMnB,GACxCY,EAAeK,KACfU,EAAeT,EAAON,EAAeK,OAMzC,IADA,IAAIc,EAAgB5B,EAAQS,EAAeQ,QACpCW,GAAiBA,EAAc1C,GAAaW,GACjDY,EAAeQ,SACfW,EAAgB5B,EAAQS,EAAeQ,QAOnBlB,EAAOW,EAAa1B,OAI1C,IAJA,IACI2D,EAAqB5C,EAAOW,EAAa1B,MAAQ,GAG9C2D,GAAsBA,EAAmBzD,IAAcY,GAC5DY,EAAa1B,QACKe,EAAOW,EAAa1B,OACtC2D,EAAqB5C,EAAOW,EAAa1B,MAAQ,GAI7BiB,EAAOS,EAAaG,OAE1C,IAFA,IACI+B,EAAqB3C,EAAOS,EAAaG,MAAQ,GAC9C+B,GAAsBA,EAAmB1D,IAAcY,GAC5DY,EAAaG,QACKZ,EAAOS,EAAaG,OACtC+B,EAAqB3C,EAAOS,EAAaG,MAAQ,GAInD,CAAC,MAAO,QAAQ1D,SAAQ,SAAC2D,GAKvB,IAJA,IAAMC,EAASjD,EAAa,GAAD,OAAIgD,EAAJ,UACrBE,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,OAE7CyC,GADkB9B,EAAOL,EAAaI,IACjBC,EAAOL,EAAaI,GAAS,IAC/C+B,GAAsBA,EAAmB7B,IAAOlB,GACrDY,EAAaI,KACKC,EAAOL,EAAaI,IACtC+B,EAAqB9B,EAAOL,EAAaI,GAAS,MAOtD,IAFA,IAAIgC,EAAmB9C,EAAQU,EAAaO,QACxC8B,EAAsB/C,EAAQU,EAAaO,OAAS,GACjD8B,GAAuBA,EAAoB7D,IAAcY,GAC9DY,EAAaO,SACb6B,EAAmB9C,EAAQU,EAAaO,QACxC8B,EAAsB/C,EAAQU,EAAaO,OAAS,GAItD,GAAI6B,EAKF,IAJA,IAAMnB,EAA0B,SAAfxB,EAAKC,MAAmB,eAAiB,eACpDyB,EAAgBtD,KAAKuD,IAAL,MAAAvD,KAAI,YACrBuE,EAAiBnB,GAAUI,QAAO,SAACjG,GAAD,OAAOA,OAEvCkE,EAAQU,EAAaO,QAAQ/B,GAAa2C,GAC/CnB,EAAaO,SAqBE,SAAfd,EAAKC,OACPtC,EAAaoE,mBAAqBzB,EAClC3C,EAAaqE,iBAAmBzB,IAEhC5C,EAAauE,mBAAqB5B,EAClC3C,EAAawE,iBAAmB5B,MCrnB9BsC,EAAc,GACpB9H,EAAWiC,SAAQ,SAAC8F,GAClBD,EAAY,WAAD,OAAYC,IAAe,IAAIC,MAC1CF,EAAY,WAAD,OAAYC,IAAaE,IAAMxG,EAAa,WAAD,OACzCsG,EADyC,SAGtDD,EAAY,QAAD,OAASC,IAAe,IAAIC,MACvCF,EAAY,QAAD,OAASC,IAAaE,IAAMxG,EAAa,QAAD,OAASsG,EAAT,SACnDD,EAAY,SAAD,OAAUC,IAAe,IAAIC,MACxCF,EAAY,SAAD,OAAUC,IAAaE,IAAMxG,EAAa,SAAD,OACzCsG,EADyC,SAGpDD,EAAY,QAAD,OAASC,IAAe,IAAIC,MACvCF,EAAY,QAAD,OAASC,IAAaE,IAAMxG,EAAa,SAAD,OAAUsG,EAAV,YAGhC,CACnB,cACA,gBACA,qBACA,uBACA,qBACA,wBAEW9F,SAAQ,SAACiG,GACpBJ,EAAYI,GAAa,IAAIF,MAC7BF,EAAYI,GAAWD,IAAMxG,EAAa,GAAD,OAAIyG,EAAJ,Y,IAsZ5BC,E,WAlZb,WAAYC,GAAQ,wBACVjG,EAAQiG,EAARjG,IAERkG,KAAKlG,IAAMA,EACXkG,KAAKC,KAAOF,EAAME,KAClBD,KAAKE,WAAaH,EAAMG,WACxBF,KAAKG,SAAWJ,EAAMI,SACtBH,KAAKI,SAAWL,EAAMK,SAEtBJ,KAAKK,UAAYN,EAAMM,U,gEAGLzF,GAClB,OAAOoF,KAAKK,UAAYzF,I,0CAENoC,GAClB,OAAOgD,KAAKrE,UAAYqB,I,uCAGTjB,E,EAAgCuE,EAAcP,GAAQ,IASjEQ,EACAC,EAAQC,EAAQC,EAAOC,EAVF/F,EAA2C,EAA3CA,SAAUoC,EAAiC,EAAjCA,SAC7B4D,EAAI7E,EAAO8E,WAAW,MAEpBjE,EAASmD,EAATnD,KACAC,EAAoCD,EAApCC,MAAOE,EAA6BH,EAA7BG,KAAM+D,EAAuBlE,EAAvBkE,OAAQC,EAAenE,EAAfmE,WAGvBC,EAAiBjF,EAAOD,OAIxB4D,EAAY/H,EAAW2I,EAAe,GAG5C,GAAgC,MAA5BN,KAAKC,KAAKK,GAAuB,CACnCC,EAAWd,EAAW,qBAEtBe,EJzEqB,II0EjBF,EAAe,GAAiB,YAAXQ,EAAuB,EAAI,IACpDL,EAAS,EAETC,EJ7EqB,GI6EbJ,EAGNK,EADY,SAAV9D,EJ9EkB,GI+EZmD,KAAKiB,oBAAoBjE,IAA4BD,EAAO,IJ/EhD,GIiFZiD,KAAKkB,oBAAoBtG,GAA2BiC,EAO9D,IAEIsE,EAFAC,EAAe3B,EAAW,qBAI5B0B,EADY,SAAVtE,EJ3FkB,II6FjBmD,KAAKqB,aAAaf,GACjBN,KAAKsB,eAAehB,KAEnBvD,EAAO,IACVwE,GJjGkB,IIoGjBvB,KAAKwB,aAAalB,GACjBN,KAAKyB,eAAenB,IAEpBzD,EACF0E,GAEJ,IAAMG,EAAc1G,KAAK2G,MAAMR,EJvGH,KIwGxBS,EAAgBT,EJxGQ,IIyGtBU,EAAwBD,EAE1BE,EAAenB,GAASQ,EAAkBI,IAC1CQ,GAAkB,EAIlBD,GAAgB,IAClBF,GAAiBE,EACjBA,EAAe,EACfvB,EAAWd,EAAW,mBACtB2B,EAAe3B,EAAW,mBAEtBkB,EAAQ,IACVoB,GAAkB,IAMpBD,GAAgBF,GAChBE,EAAed,GACA,YAAfD,GAEAH,EAAEoB,UACAZ,EACAZ,EACW,YAAXM,EAAuB,EJpIC,IIoIwBc,EJxI/B,GI0IjBA,EACAlB,EACW,YAAXI,EACIlF,EACEkG,EAAeP,GACfK,EACA7F,GAEF+F,EAAeP,GJlJF,GIoJjBK,GAKJ,IAAK,IAAIpG,EAAI,EAAGA,GAAKkG,EAAalG,IAAK,CACrC,IAAIyG,EJtJsB,IIuJtBC,EAAa,EACbC,EACFxB,GACCQ,EACCI,GACAM,EJ5JsB,KI6JArG,EAAI,IAC1B2G,EAAY,GAAKA,GJ9JK,MI+JxBF,GAAcE,EACdD,GAAcC,EACdA,EAAY,GAGZA,GAAaF,GACbE,EAAYnB,GACG,YAAfD,GAEAH,EAAEoB,UACAZ,EACAZ,EACW,YAAXM,EAAuB,EAAIoB,EJ/KZ,GIiLfD,EACAvB,EACW,YAAXI,EACIlF,EACEuG,EAAYZ,GACZU,EACAlG,GAEFoG,EAAYZ,GJzLD,GI2LfU,GAKN,IAUIG,EAVAC,EJ/LkB,GIuMlBC,EAAc3B,EAiBlB,IAbEyB,EADY,SAAVvF,EJ1MkB,II4MjBmD,KAAKqB,aAAaf,GACjBN,KAAKsB,eAAehB,KAErBvD,EAAO,IJ/MU,IIkNjBiD,KAAKwB,aAAalB,GACjBN,KAAKyB,eAAenB,IAEtBzD,GAGe0E,GAAkB,CAEnCd,GAAUc,GADgBa,EAE1BzB,GAASY,GAFiBa,EAG1BC,EAH0BD,EAGOb,GA8BnC,GA1BIZ,EAAQY,IAAoBZ,EAnKd,IAoKhBF,GAAUc,GAAmBZ,EAC7BA,EAAQY,IAIRe,EAzKgB,GA0KhBA,EAActB,GACC,YAAfD,GAEAH,EAAEoB,UACAzB,EACAC,EACW,YAAXM,EAAuB,EAAIL,EJ9OV,GIgPN,YAAXK,EJ/OkB,GI+OoBL,EAAS4B,EAC/C3B,EACW,YAAXI,EACIlF,EAAgB0G,EJlPF,GIkP6BvG,GAC3C4E,EJpPa,GIsPN,YAAXG,EJrPkB,GIqPoBL,EAAS4B,GAK/CN,EAAiB,CACnB,IAAMQ,EAAe9C,EAAY+C,YACjC5B,EAAEoB,UACAO,EJ9PiB,GI+PjB5K,EAAWS,QAAQsH,GACnB6B,IJhQiB,GACC,GADD,GImQjBjB,EACW,YAAXQ,EAAuBlF,EAAgB,EJnQrB,GImQsCG,GAAU,EJpQjD,GACC,Q,kCI2QdA,E,EAAgCuE,EAAcP,GAAQ,IAA5CnF,EAA2C,EAA3CA,SAAUoC,EAAiC,EAAjCA,SACxB4D,EAAI7E,EAAO8E,WAAW,MAEpBjE,EAASmD,EAATnD,KACAC,EAA4DD,EAA5DC,MAAOE,EAAqDH,EAArDG,KAAM0F,EAA+C7F,EAA/C6F,SAAUC,EAAqC9F,EAArC8F,aAAc5B,EAAuBlE,EAAvBkE,OAAQC,EAAenE,EAAfmE,WAG/CC,EAAiBjF,EAAOD,OAG9B,GAAgC,MAA5BkE,KAAKC,KAAKK,IAGK,YAAfS,EAAJ,CAEA,IAAIR,EACAC,EAAQC,EAAQC,EAAOC,EACrBjB,EAAY/H,EAAW2I,EAAe,GAG5C,GAC8B,MAA5BN,KAAKC,KAAKK,IACmB,MAA5BN,KAAKC,KAAKK,IAAyBoC,EACpC,CAKA,GAHAnC,EAAWd,EAAY,GAAD,OAAIgD,EAAJ,YAAgB/C,IAGlCM,KAAKC,KAAK0C,SAAS,OAASD,EAC9BnC,EAAWd,EAAY+C,YACvBhC,EJ1SmB,GI0SV7I,EAAWS,QAAQsH,GAC5Be,EAAS,OAET,GAAiB,YAAbgC,EAAwB,CAC1BjC,EAAUxF,KAAK2G,MAAiB,EAAX/G,GAAgB,EJ9SpB,GIgTjB,IAAMgI,EAAQ5C,KAAKI,SAAW,EACxByC,EAAQ7C,KAAKG,SAAWyC,EAChB,IAAVC,EACFpC,EAAS,EACA,EAAIoC,GAASA,GAASD,EAAQ,EACvCnC,EAAS,EACAmC,EAAQ,EAAIC,GAASA,GAASD,EAAQ,EAC/CnC,EAAS,EACAmC,EAAQ,EAAIC,GAASA,GAAU,EAAID,EAAS,EACrDnC,EAAS,EACC,EAAImC,EAAS,EAAIC,GAASA,EAAQD,IAC5CnC,EAAS,GAEXA,GJ5TkB,QI6Tb,GAAiB,SAAbgC,EAAqB,CAC9BjC,EAAUxF,KAAK2G,MAAiB,EAAX/G,GAAgB,EJ/TpB,GIyUjB,IAAMkI,EAAkB9C,KAAKG,SAAWH,KAAKI,SAE3CK,EADE,CAAC,EAAG,IAAO,GAAO,KAAOkC,SAASG,GAC3B,EACA,CAAC,EAAI,EAAG,EAAI,EAAG,EAAI,EAAG,EAAI,GAAGH,SAASG,GACtC,EAET,CACE,EAAI,GACJ,EAAI,GACJ,EAAI,GACJ,EAAI,GACJ,EAAI,GACJ,MACA,MACA,OACAH,SAASG,GAEF,EAEA,EAEXrC,GJ7VkB,QI8Vb,GAAiB,UAAbgC,EAAsB,CAC/BjC,EAAUxF,KAAK2G,MAAiB,EAAX/G,GAAgB,EJhWpB,GIkWjB,IAAMgI,EAAQ5C,KAAKI,SAAW,EACxByC,EAAQ7C,KAAKG,SAAWyC,EAGhB,IAAVC,EACFpC,EAAS,EACA,EAAIoC,GAASA,GAASD,EAAQ,EACvCnC,EAAS,EACAmC,EAAQ,EAAIC,GAASA,GAASD,EAAQ,EAC/CnC,EAAS,EACAmC,EAAQ,EAAIC,GAASA,GAAU,EAAID,EAAS,EACrDnC,EAAS,EACC,EAAImC,EAAS,EAAIC,GAASA,EAAQD,IAC5CnC,EAAS,GAEXA,GAAWA,EAbQzF,KAAK2G,MAAM/G,GAAY,GAaR,EJhXhB,OIiXI,SAAb6H,IACTlC,EAAWd,EAAY,SAAD,OAAUC,IAEhCc,EAAUxF,KAAK2G,MAAiB,EAAX/G,GAAgB,EJrXpB,GIsXjB6F,EAAUzF,KAAK2G,MAAM/G,GAAY,EJrXf,IIyXtB8F,EJ1XqB,GI0XbJ,GAMRK,GAJEA,EADY,SAAV9D,EJ1XkB,GI2XZmD,KAAKiB,oBAAoBjE,IAA4BD,EAAO,IJ3XhD,GI6XZiD,KAAKkB,oBAAoBtG,GAA2BiC,GAE7C,GAAO,GA9GN,GAgHS8D,EAAQK,GACjCJ,EAAEoB,UACAzB,EACAC,EACAC,EJtYiB,GACC,GIwYlBC,EACW,YAAXI,EACIlF,EAAgB+E,EJ1YF,GI0YuB5E,GACrC4E,EJ5Ya,GACC,QIoZa,MAA5BX,KAAKC,KAAKK,KACjBC,EAAWd,EAAY+C,YACvBhC,EJvZqB,GIuZZ7I,EAAWS,QAAQsH,GAC5Be,EAAS,EAETC,EJ1ZqB,GI0ZbJ,GAMRK,GAJEA,EADY,SAAV9D,EJ1ZkB,GI2ZZmD,KAAKiB,oBAAoBjE,IAA4BD,EAAO,IJ3ZhD,GI6ZZiD,KAAKkB,oBAAoBtG,GAA2BiC,GAE7C,GAAO,GA9IN,GAiJS8D,EAAQK,GACjCJ,EAAEoB,UACAzB,EACAC,EACAC,EJvaiB,GACC,GIyalBC,EACW,YAAXI,EACIlF,EAAgB+E,EJ3aF,GI2auB5E,GACrC4E,EJ7aa,GACC,U,KKCtBlB,EAAc,GACpB9H,EAAWiC,SAAQ,SAAC8F,GAClBD,EAAY,SAAD,OAAUC,IAAe,IAAIC,MACxCF,EAAY,SAAD,OAAUC,IAAaE,IAAMxG,EAAa,SAAD,OACzCsG,EADyC,Y,IAmEvCqD,E,WA7Db,WAAYhD,GAAQ,wBACVjG,EAAQiG,EAARjG,IAERkG,KAAKlG,IAAMA,EACXkG,KAAKC,KAAOF,EAAME,KAElBD,KAAKK,UAAYN,EAAMM,U,gEAGLzF,GAClB,OAAOoF,KAAKK,UAAYzF,I,0CAENoC,GAClB,OAAOgD,KAAKrE,UAAYqB,I,6BAGnBjB,EAAQiH,E,EAA+BjD,GAAQ,IAA9BnF,EAA6B,EAA7BA,SAAUoC,EAAmB,EAAnBA,SAC1B4D,EAAI7E,EAAO8E,WAAW,MAEpBjE,EAASmD,EAATnD,KACAC,EAAoCD,EAApCC,MAAOE,EAA6BH,EAA7BG,KAAM+D,EAAuBlE,EAAvBkE,OAErB,GAAmB,YAFyBlE,EAAfmE,WAE7B,CAEA,IACMC,EAAiBjF,EAAOD,OAC9BkH,EAAQhI,KAAK2G,MAAMqB,EAAQ,GAAK,EAEhC,IAAK,IAAIxH,EAAI,EAAGA,EAAIwE,KAAKC,KAAKpF,OAAQW,IACpC,GAAqB,MAAjBwE,KAAKC,KAAKzE,GAAd,CACA,IAAMkE,EAAY/H,EAAW6D,EAAI,GAC3B+E,EAAWd,EAAY,SAAD,OAAUC,IAChCc,EAAUwC,EAAQ,EL3CH,GK4CfvC,EL3CgB,GK2CPzF,KAAK2G,MAAMqB,EAAQ,GAC5BtC,EL7Ce,GK6CPlF,EACVmF,OAAK,GAEPA,EADY,SAAV9D,EL9CkB,GK+CZmD,KAAKiB,oBAAoBjE,IAA4BD,EAAO,IL/ChD,GKiDZiD,KAAKkB,oBAAoBtG,GAA2BiC,IAf5C,IAkBS8D,EAAQK,GACjCJ,EAAEoB,UACAzB,EACAC,EACAC,ELzDiB,GACC,GK2DlBC,EACW,YAAXI,EACIlF,EAAgB+E,EL7DF,GK6DuB5E,GACrC4E,EL/Da,GACC,U,KMCtBsC,EAAc,GACpBtL,EAAWiC,SAAQ,SAAC8F,GAClBuD,EAAYvD,GAAa,IAAIC,MAC7BsD,EAAYvD,GAAWE,IAAMxG,EAAa,GAAD,OAAIsG,EAAJ,mBACzCuD,EAAYvD,GAAa,IAAIC,MAC7BsD,EAAYvD,GAAWE,IAAMxG,EAAa,GAAD,OAAIsG,EAAJ,sBAG3C,IAAMwD,EAAiB,GACvBvL,EAAWiC,SAAQ,SAAC8F,GAClBwD,EAAexD,GAAa,IAAIC,MAChCuD,EAAexD,GAAWE,IAAMxG,EAAa,GAAD,OAAIsG,EAAJ,sBAC5CwD,EAAexD,GAAa,IAAIC,MAChCuD,EAAexD,GAAWE,IAAMxG,EAAa,GAAD,OAAIsG,EAAJ,yB,IA6C/ByD,E,WAzCb,WAAYpD,GAAQ,oB,mDAEbhE,E,EAAsBgE,GAAQ,IAApBnF,EAAmB,EAAnBA,SACTgG,EAAI7E,EAAO8E,WAAW,MAEpBpI,EAAesH,EAAftH,KACAqI,EADef,EAATnD,KACNkE,OAGFsC,EAAUxI,EAAW,EAAI,GAAKA,EAAW,EAAI,IAEnDjD,EAAWiC,SAAQ,SAAC8F,EAAWlE,GAC7BoF,EAAEoB,UACAoB,EAAUH,EAAYvD,GAAawD,EAAexD,GAClD,EACA,ENlCmB,GACC,GADD,GMqCnBlE,EACW,YAAXsF,EAAuBlF,EAAgB,ENrCnB,GMqCoCG,GAAU,ENtC/C,GACC,IM0CT,WAATtD,GACFmI,EAAEoB,UACAoB,EAAUH,EAAYvD,GAAawD,EAAexD,GAClD,EACA,EN/CiB,GACC,GADD,IMkDhBlE,EAAI,GACM,YAAXsF,EAAuBlF,EAAgB,ENlDrB,GMkDsCG,GAAU,ENnDjD,GACC,W,KO6CbsH,E,WA5Cb,WAAYC,GAAY,oBACtBtD,KAAKsD,UAAYA,E,mDAGZvH,E,EAAgCgE,GAAQ,IAA9BnF,EAA6B,EAA7BA,SACPgC,GADoC,EAAnBI,SACR+C,EAATnD,MACAC,EAAwBD,EAAxBC,MAAOiE,EAAiBlE,EAAjBkE,OAAiBlE,EAATG,KAGvB,GADuBH,EAAK2G,YAId,SAAV1G,EAAJ,CAEA,IAAM+D,EAAI7E,EAAO8E,WAAW,MAC5BD,EAAE4C,YAAc,OAKhB,IAHA,IACMxC,EAAiBjF,EAAOD,OAErBhB,EAAO,EAAGA,GAAQkF,KAAKsD,UAAWxI,IAAQ,CACjD,IAAI6F,EPtBkB,IOsBT7F,EAAOF,GAA2BiC,EAAQ0E,GAOjDkC,EAAY3I,EAAO,IAAM,EAAI,EAAI,GAJvC6F,EAASA,EAAQ,GAAO,GAPN,GAaSA,EAAQK,IAClB,YAAXF,IACFH,EAAQ/E,EAAgB+E,EAAO,EAAG5E,IAEpC6E,EAAE8C,YACF9C,EAAE+C,OAAO,EAAGhD,GACZC,EAAEgD,OAAO7H,EAAO8H,MAAOlD,GACvBC,EAAE6C,UAAYA,EACd7C,EAAEkD,gB,KCjCJC,EAAQ,IAAIpE,MAClBoE,EAAMnE,IAAMxG,EAAa,qB,IA4CV4K,E,WAzCb,WAAYvI,GAAQ,IAAD,2BACjBuE,KAAKgD,OAAS,EAEdhD,KAAKiE,WAAa,GAClBxI,EAAMwE,KAAKrG,SAAQ,SAACqG,EAAMK,GACX,MAATL,GAAyB,MAATA,GAAyB,MAATA,GAClC,EAAKgE,WAAWC,KAAK5D,M,mDAKpBvE,EAAQgE,GAAQ,IAAD,OACda,EAAI7E,EAAO8E,WAAW,MAGpBC,EADSf,EAATnD,KACAkE,OAERd,KAAKiE,WAAWrK,SAAQ,SAAC0G,GACvB,KAAI,EAAK0C,MAAQ,GAAK,EAAKA,ORVK,IQUhC,CACA,IAAMtC,ER9Be,GQ8BPJ,EAEdM,EAAEuD,OACFvD,EAAEwD,YAAc,EAAIpJ,KAAKqJ,IAAI,EAAKrB,MRdF,GQckC,GAClEpC,EAAEoB,UACA+B,EACA,EACA,ERrCmB,GACC,GQuCpBrD,EAAQ,EAAKsC,MACF,YAAXlC,EACIlF,EAAgB,EAAI,EAAKoH,MRzCT,GQyC8BjH,GAC9C,EAAI,EAAKiH,MR3CM,GQ4CQ,EAAb,EAAKA,MR3CC,GQ4CQ,EAAb,EAAKA,OAEtBpC,EAAE0D,kB,KC/CFC,EAAc,GAEpB,CAAC,MAAO,KAAK3K,SAAQ,SAAC4K,GACpBD,EAAYC,GAAQ,CAClBC,IAAK,IAAI9E,MACTjE,MAAO,IAAIiE,OAEb4E,EAAYC,GAAMC,IAAI7E,IAAMxG,EAAa,iBAAD,OAAkBoL,EAAlB,SACxCD,EAAYC,GAAM9I,MAAMkE,IAAMxG,EAAa,SAAD,OAAUoL,EAAV,YAG5CD,EAAW,IAAQG,OAAS,CAC1BC,EAAG,CACDjJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,CAAC,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAErD8I,EAAG,CACDlJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,CAAC,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAEzD+I,EAAG,CACDnJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,EAAE,EAAG,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAE7DgJ,EAAG,CACDpJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,EAAE,IAAK,EAAG,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,MAIpEyI,EAAW,EAAMG,OAAS,CACxBC,EAAG,CACDjJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,CAAC,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAErD8I,EAAG,CACDlJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,CAAC,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAEzD+I,EAAG,CACDnJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,EAAE,EAAG,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,KAE7DgJ,EAAG,CACDpJ,MAAO,CAAEgF,MAAO,IAAKC,MAAO,IAAKkD,MAAO,MAAO/H,OAAQ,IACvD2I,IAAK,CAAE/D,MAAO,EAAE,IAAK,EAAG,GAAI,IAAKC,MAAO,IAAKkD,MAAO,GAAI/H,OAAQ,MAIpE,IA8EeiJ,E,WA3Eb,WAAYhF,GAAQ,oB,mDAEbhE,GAA8B,IAAtBiJ,EAAqB,uDAAV,EAAGjF,EAAO,uCAC5Ba,EAAI7E,EAAO8E,WAAW,MAC5B,KAAImE,EAAW,GAAf,CAFkC,IAI1BpI,EAAemD,EAAfnD,KAAMnE,EAASsH,EAATtH,KACNwM,EAAcrI,EAAdqI,UAEJT,EAAOS,EAGLC,GADNF,EAAWA,EAASG,YACOtK,OAGrBuK,EAAWb,EAAYC,GAAM9I,MAC7B2J,EAASd,EAAYC,GAAMC,IAE3Ba,EACJf,EAAYC,GAAME,OAAOQ,GAAWxJ,MAAMgF,OAChC,WAATjI,EAvBe,IAuBqB,GACjC8M,EAAahB,EAAYC,GAAME,OAAOQ,GAAWxJ,MAAMiF,MACvD6E,EAAajB,EAAYC,GAAME,OAAOQ,GAAWxJ,MAAMmI,MACvD4B,EAAclB,EAAYC,GAAME,OAAOQ,GAAWxJ,MAAMI,OAG9D8E,EAAEoB,UACAoD,EACA,EACA,EACAA,EAASvB,MACTuB,EAAStJ,OACTwJ,EACAC,EACAC,EACAC,GAIF,IAAK,IAAIjK,EAAI,EAAGA,EAAI0J,EAAW1J,IAAK,CAClC,IAAMkK,EAAQV,EAASxJ,GAEjBmK,EAAaN,EAAOxB,MAAQ,EAC5B+B,EAAcP,EAAOvJ,OAAS,EAC9B+J,EAAWH,EAAQ,EACnBI,EAAW9K,KAAK2G,MAAM+D,EAAQ,GAC9BK,EAASF,EAAWF,EACpBK,EAASF,EAAWF,EAEpBK,EACJ1B,EAAYC,GAAME,OAAOQ,GAAWT,IAAI/D,MAAMlF,IACpC,WAAT/C,EAtDa,IAsDuB,GACjCyN,EAAW3B,EAAYC,GAAME,OAAOQ,GAAWT,IAAI9D,MACnDwF,EAAW5B,EAAYC,GAAME,OAAOQ,GAAWT,IAAIZ,MACnDuC,EAAY7B,EAAYC,GAAME,OAAOQ,GAAWT,IAAI3I,OAM1D8E,EAAEoB,UACAqD,EACAU,EACAC,EACAL,EACAC,EACAK,EACAC,EACAC,EACAC,S,KCxHFC,E,WACJ,aAAe,oBAIbrG,KAAKsG,YAAc,GACnBtG,KAAKuG,aAAe,G,0DAORC,EAAazG,GAAQ,IAAD,OAChC,GAAKyG,EAAL,CADgC,kBAECA,EAFD,GAEzBlK,EAFyB,KAEZC,EAFY,KAGxBK,EAASmD,EAATnD,KACR,CAAC,MAAO,QAAQhD,SAAQ,SAAC2D,GACvB,IAAMkJ,EAAa,EAAK,GAAD,OAAIlJ,EAAJ,aACvB,IAAK,IAAImJ,KAAUD,EAAY,CAAC,IAAD,EACJA,EAAWC,GAA5BhN,EADqB,EACrBA,IAAKiN,EADgB,EAChBA,QACPlJ,EAAoB,SAAfb,EAAKC,MAAmB,YAAc,QAC7CnD,EAAI+D,GAAMnB,GAAe5C,EAAI+D,GAAMlB,KAEjCoK,EAAQC,YACVD,EAAQC,WAAWC,YAAYF,UAE1BF,EAAWC,W,oCAWX,IAAD,OACZ,CAAC,MAAO,QAAQ9M,SAAQ,SAAC2D,GACvB,IAAMkJ,EAAa,EAAK,GAAD,OAAIlJ,EAAJ,aACvB,IAAK,IAAImJ,KAAUD,EAAY,CAAC,IAAD,EACJA,EAAWC,GAAvBC,GADgB,EACrBjN,IADqB,EAChBiN,SACTA,EAAQC,YACVD,EAAQC,WAAWC,YAAYF,UAE1BF,EAAWC,S,gCAWdzK,EAAS6K,E,KAAwC,IAAjClM,EAAgC,EAAhCA,SAAUoC,EAAsB,EAAtBA,SAAcJ,EAAQ,EAARA,KAC1C9C,EAAMgN,EAAIhM,KAEViM,EAAaC,EACjBF,EACA,CAAElM,WAAUoC,YACZJ,EACAX,GAEF,GAAK+D,KAAKsG,YAAYxM,GAUf,CACWkG,KAAKsG,YAAYxM,GAAK6M,QAC9BM,MAAMC,UAAd,qBAAwCH,EAAxC,WAZ0B,CAC1B,IAAMJ,EAAUlM,SAAS0M,cAAc,OACvCR,EAAQS,UAAY,YAEpBT,EAAQM,MAAMC,UAAd,qBAAwCH,EAAxC,OACA,IAAMM,EAAY5M,SAAS0M,cAAc,OACzCE,EAAUtM,YAAc+L,EAAI3N,MAC5BwN,EAAQW,YAAYD,GACpBpL,EAAQqL,YAAYX,GACpB3G,KAAKsG,YAAYxM,GAAO,CAAEX,MAAO2N,EAAI3N,MAAOO,IAAKoN,EAAKH,c,iCAO/CvK,EAAUmL,E,KAAyC,IAAjC3M,EAAgC,EAAhCA,SAAUoC,EAAsB,EAAtBA,SAAcJ,EAAQ,EAARA,KAC7C9C,EAAMyN,EAAKzM,KACXiM,EAAaC,EACjBO,EACA,CAAE3M,WAAUoC,YACZJ,EACAR,GAEF,GAAK4D,KAAKuG,aAAazM,GAUhB,CACWkG,KAAKuG,aAAazM,GAAK6M,QAC/BM,MAAMC,UAAd,qBAAwCH,EAAxC,WAZ2B,CAC3B,IAAMJ,EAAUlM,SAAS0M,cAAc,OACvCR,EAAQS,UAAY,aAEpBT,EAAQM,MAAMC,UAAd,qBAAwCH,EAAxC,OACA,IAAMM,EAAY5M,SAAS0M,cAAc,OACzCE,EAAUtM,YAAcwM,EAAKpO,MAC7BwN,EAAQW,YAAYD,GACpBjL,EAASkL,YAAYX,GACrB3G,KAAKuG,aAAazM,GAAO,CAAEX,MAAOoO,EAAKpO,MAAOO,IAAK6N,EAAMZ,gB,KAQzDK,EAAgB,SAACzJ,EAAD,EAAgCX,EAAM4K,GAAU,IAChET,EAD0BnM,EAAqC,EAArCA,SAAUoC,EAA2B,EAA3BA,SAErB,SAAfJ,EAAKC,MAEPkK,EV/GwB,IU8GPxJ,EAAM5B,UAAYqB,IACKJ,EAAKG,KAAO,IAGpDgK,EVlHwB,IUiHPxJ,EAAMzC,KAAOF,GACSgC,EAAKC,MAO9C,OALAkK,GAAcxF,GAEM,YAAhB3E,EAAKkE,SACPiG,EAAanL,EAAgBmL,EAAY,EAAG,CAAEjL,OAAQ0L,EAAKC,gBAEtDV,GAGMV,IC3HTqB,EAAS,GAEfA,EAAOC,MAAQ,IAAIhI,MACnB+H,EAAOC,MAAM/H,IAAMxG,EAAa,uBAChCsO,EAAOE,MAAQ,IAAIjI,MACnB+H,EAAOE,MAAMhI,IAAMxG,EAAa,uBAEhC,IAAMyO,GAAgB,CAAC,SAAU,SAAU,gBA8E5BC,G,WA3Eb,WAAY/H,GAAQ,oB,mDAEbhE,EAAQgE,GACb,IAAMa,EAAI7E,EAAO8E,WAAW,MAEpBjE,EAAemD,EAAfnD,KAAMnE,EAASsH,EAATtH,KACNsI,EAAuBnE,EAAvBmE,WAAYD,EAAWlE,EAAXkE,OACdiH,EACJnL,EAAKmL,gBAAgBF,GAAczP,QAAQ2I,IAE7C,GACGA,EAAW4B,SAAS,WAAwB,WAAX7B,GACjCC,EAAW4B,SAAS,WAAwB,YAAX7B,EAClC,CACA,IAAIkH,EAAMN,EAAOC,MACjB/G,EAAEoB,UACAgG,EACA,EACApM,EAAgBmM,EAAiB,EAAGhM,GACpCiM,EAAInE,MACJkE,EACA,EACA,EACAC,EAAInE,MACJkE,GAGW,WAATtP,GACFmI,EAAEoB,UACAgG,EACA,EACApM,EAAgBmM,EAAiB,EAAGhM,GACpCiM,EAAInE,MACJkE,EACAE,IACA,EACAD,EAAInE,MACJkE,GAIN,GACGhH,EAAW4B,SAAS,WAAwB,WAAX7B,GACjCC,EAAW4B,SAAS,WAAwB,YAAX7B,EAClC,CACA,IAAIkH,EAAMN,EAAOE,MACjBhH,EAAEoB,UACAgG,EACA,EACA,EACAA,EAAInE,MACJkE,EACA,EACAnM,EAAgBmM,EAAiB,EAAGhM,GACpCiM,EAAInE,MACJkE,GAGW,WAATtP,GACFmI,EAAEoB,UACAgG,EACA,EACA,EACAA,EAAInE,MACJkE,EACAE,IACArM,EAAgBmM,EAAiB,EAAGhM,GACpCiM,EAAInE,MACJkE,Q,KClFJG,GAAY,iBACZC,GAAkB,6CAElBC,GAAgB,CACpBC,SAAU,WACVC,KAAM,QACNC,OAAQ,YACRC,KAAM,SACNC,UAAW,aA0JEC,GAvJM,SAACC,GAA4B,IAkC5CC,EAlCoBC,EAAuB,uDAAT,KAChCC,EAAW,GAEXC,EAAgBJ,EAAGxQ,MACvB,EACAwQ,EAAGvQ,QAAwB,QAAhByQ,EAAwB,aAAe,YAGhDG,EAAO,GACPC,EAAQ,GACRC,EAAS,EAGT,UAAUC,KAAKJ,KACjBC,EAAO,wBAAwBI,KAAKL,GAAe,IAC1ClO,SACPmO,EAAOA,EAAKrP,MAAM,KAAK0P,KAAI,SAACC,GAAW,IAAD,EACdA,EAAM3P,MAAM,KADE,mBAC7BmB,EAD6B,KACvB3B,EADuB,KAEpC,MAAO,CAAE2B,KAAMyO,WAAWzO,GAAO3B,MAAOoQ,WAAWpQ,QAKrD,WAAWgQ,KAAKJ,KAClBE,EAAQ,yBAAyBG,KAAKL,GAAe,IAC3ClO,SACRoO,EAAQA,EAAMtP,MAAM,KAAK0P,KAAI,SAACC,GAAW,IAAD,EAChBA,EAAM3P,MAAM,KADI,mBAC/BmB,EAD+B,KACzB3B,EADyB,KAEtC,MAAO,CAAE2B,KAAMyO,WAAWzO,GAAO3B,MAAOoQ,WAAWpQ,QAOrD,YAAYgQ,KAAKJ,KACnBG,EAAS,0BAA0BE,KAAKL,GAAe,GACvDG,EAASK,WAAWL,IAIpBN,EADkB,QAAhBC,EACUF,EACTxQ,MAAMwQ,EAAGvQ,QAAQ,eACjBuB,MAAM,kBACNxB,MAAM,GAEGwQ,EACTxQ,MAAMwQ,EAAGvQ,QAAQ,YACjBuB,MAAM,cACNxB,MAAM,GAGX6B,QAAQC,IAAI,mBAAoB2O,EAAU/N,QAC1CiO,EAASU,iBAAkB,EAC3B,IAAIC,EAAoB,EA8FxB,OA5FAb,EAAUhP,SAAQ,SAAC8P,EAAUlO,GAC3B,IAAM/C,EAAOyP,GAAUkB,KAAKM,GAAU,GAElCC,EAAexB,GAAgBiB,KAAKM,GAAU,GAC5CE,EAAaxB,GAAcuB,GAEjCb,EAAS,GAAD,OAAIrQ,EAAJ,YAAYmR,IAAgB,CAClCA,aACAnR,OACAuQ,OACAC,QACAC,UAEF,IAEIW,EAFEC,EAAUhB,EAAS,GAAD,OAAIrQ,EAAJ,YAAYmR,IAGpC,GAAoB,QAAhBf,EACFgB,EAAQ,mBAAmBT,KAAKM,GAAU,OACrC,CACL,IAAMK,EAAa,IAAIC,OAAJ,UAAcL,EAAd,mBACnBE,EAAQI,SAASF,EAAWX,KAAKM,GAAU,IAE7CI,EAAQD,MAAQA,EAEI,QAAhBhB,IAEE,UAAUM,KAAKO,KACjBV,EAAO,wBAAwBI,KAAKM,GAAU,IACrC7O,SACPmO,EAAOA,EAAKrP,MAAM,KAAK0P,KAAI,SAACC,GAAW,IAAD,EACdA,EAAM3P,MAAM,KADE,mBAC7BmB,EAD6B,KACvB3B,EADuB,KAEpC,MAAO,CAAE2B,KAAMyO,WAAWzO,GAAO3B,MAAOoQ,WAAWpQ,OAErD2Q,EAAQd,KAAOA,GAKf,WAAWG,KAAKO,KAClBT,EAAQ,yBAAyBG,KAAKM,GAAU,IACtC7O,SACRoO,EAAQA,EAAMtP,MAAM,KAAK0P,KAAI,SAACC,GAAW,IAAD,EAChBA,EAAM3P,MAAM,KADI,mBAC/BmB,EAD+B,KACzB3B,EADyB,KAEtC,MAAO,CAAE2B,KAAMyO,WAAWzO,GAAO3B,MAAOoQ,WAAWpQ,OAErD2Q,EAAQb,MAAQA,IAKtB,IAAIiB,EAAWR,EACZvR,MAAMuR,EAASS,YAAY,KAAO,EAAGT,EAASS,YAAY,MAC1DC,OACAzQ,MAAM,KACTuQ,EAAWA,EAASb,KAAI,SAACgB,EAASnK,GAChC,IAAMoK,EAAQD,EACXD,OACAzQ,MAAM,QACN6E,QAAO,SAAC+L,GAAD,OAAQA,EAAEC,WAAW,SAEzBC,EAAWH,EAAMzP,OAEjB6P,EAAc,GAkBpB,OAjBAJ,EAAM1Q,SAAQ,SAAC+Q,EAAMC,GAEnB,GAAKD,EAAKhR,MAAM,IAAI6E,QAAO,SAAC+L,GAAD,MAAa,MAANA,KAAW1P,OAA7C,CAEA,IAAMgQ,EAAU,GAChBA,EAAQ5K,KAAO0K,EACfE,EAAQ3K,WAAaA,EACrB2K,EAAQ1K,SAAWyK,EACnBC,EAAQzK,SAAWqK,EAEnBC,EAAYxG,KAAK2G,OAEf3K,GAAcgK,EAASrP,OAAS,IAClCb,QAAQC,IAAR,2BAAgCxB,EAAhC,YAAwCmR,IACxCH,KAGKiB,KAGTZ,EAAQgB,MAAQZ,KAGdT,IAAsBb,EAAU/N,SAClCiO,EAASU,iBAAkB,GAG7BzR,OAAO+Q,SAAWA,EAEXA,G,6BCpJIiC,GAAsB,SAACC,GAAD,OAAY,SAACC,GAC9CA,EAAS,CACPzG,KAVkC,yBAWlC0G,QAASF,M,6kBCZb,IAAMG,GAAe,CACnBC,WAAY,CACVJ,OAAQ,UACRK,SAAU,GAEZC,aAAc,CACZN,OAAQ,Y,6kBCNZ,IAAMG,GAAe,CACnBI,UAAW,KACX7P,MAAO,GCDI8P,GAAa,SAAC5O,GAAD,OAAU,SAACqO,GACnCA,EAAS,CACPzG,KALuB,cAMvB0G,QAAStO,MCNA6O,GAAkB,WAC7B,IACE,IAAMC,EAAW3T,OAAO4T,aAAaC,QAAQ,gBAC7C,OAAIF,EACKG,KAAKC,MAAMJ,GAEb,GACP,MAAOK,GAEP,OADA/R,QAAQD,MAAMgS,GACP,KAIEC,GAAqB,SAACC,GACjC,IAAIP,EAAW3T,OAAO4T,aAAaC,QAAQ,gBAC3C,IAEIF,EADEA,EACSG,KAAKC,MAAMJ,GAEX,GAEb,MAAOK,GACP/R,QAAQD,MAAMgS,GAGhB7M,OAAOC,KAAK8M,GAAarS,SAAQ,SAACE,GAChC4R,EAAS5R,GAAOmS,EAAYnS,MAE9B/B,OAAO4T,aAAaO,QAAQ,eAAgBL,KAAKM,UAAUT,KAGhDU,GAAuB,WAClC,OAAOrU,OAAO4T,aAAaC,QAAQ,aAAe,GAGvCS,GAAmB,SAAChB,GAC/BtT,OAAO4T,aAAaO,QAAQ,WAAYb,IChC7BiB,GAAU,CACrB1C,WAAY,CAAC,WAAY,QAAS,YAAa,SAAU,aACzDnR,KAAM,CAAC,SAAU,UACjBmE,KAAM,CACJC,MAAO,CACL,IACA,GACA,IACA,EACA,KACA,IACA,KACA,EACA,KACA,IACA,KACA,EACA,KACA,IACA,KACA,EACA,IACA,EACA,IACA,EACA,IACA,EACA,IACA,GAEFkE,WAAY,CAAC,UAAW,SAAU,SAAU,eAAgB,WAC5DwL,KAAM,CAAC,MAAO,SAAU,OAAQ,QAAS,WACzCC,QAAS,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC/BC,SAAU,CAAC,KAAM,OACjB3L,OAAQ,CAAC,SAAU,WACnB2B,SAAU,CAAC,UAAW,OAAQ,QAAS,QACvCiK,aAAc,CAAC,SAAU,UAAW,UACpCzH,UAAW,CAAC,MAAO,OAKjB0H,GAAsB,CAC1B/C,WAAY,SACZnR,KAAM,SACNmE,KAAM,CACJC,MAAO,IACPE,KlBxBwB,IkByBxBgE,WAAY,UACZgH,gBAAiB,CAAC,EAAG,EAAG,GACxB6E,kBAAkB,EAClBL,KAAM,MACNC,QAAS,EACTC,SAAU,KACV3L,OAAQ,SACR2B,SAAU,OACVc,YAAY,EACZmJ,aAAc,SACdzH,UAAW,MACXvC,cAAc,EACdmK,alB9C0B,IkB+C1BC,gBAAgB,I,8kBAIiB,WAA4B,IAA3BC,EAA0B,uDAAjBtT,EAEvCuT,EAAevB,KAgBrB,GAfA,CAAC,OAAQ,aAAc,QAAQ7R,SAAQ,SAACE,GAClCkT,EAAalT,KACf6S,GAAoB7S,GAAOkT,EAAalT,OAIxCkT,EAAapQ,MACfsC,OAAOC,KAAKwN,GAAoB/P,MAAMhD,SAAQ,SAACqT,GACP,qBAA3BD,EAAapQ,KAAKqQ,KAC3BN,GAAoB/P,KAAKqQ,GAAOD,EAAapQ,KAAKqQ,OAMpDF,EAAOnD,WAAY,CACrB,IAAMsD,EAAe,CACnBC,EAAG,WACHC,EAAG,QACHC,EAAG,YACHC,EAAG,SACHC,EAAG,aAEDrO,OAAOC,KAAK+N,GAAcvK,SAASoK,EAAOnD,WAAW,MACvD+C,GAAoB/C,WAAasD,EAAaH,EAAOnD,WAAW,KAErC,MAAzBmD,EAAOnD,WAAW,GACpB+C,GAAoBlU,KAAO,SACO,MAAzBsU,EAAOnD,WAAW,KAC3B+C,GAAoBlU,KAAO,UAG/B,GAAIsU,EAAOlQ,MAAO,CAChB,IAAM1D,EAAQoQ,WAAW,GAAD,OAAIwD,EAAOlQ,MAAM,GAAjB,YAAuBkQ,EAAOlQ,MAAM1E,MAAM,KAC9DmU,GAAQ1P,KAAKC,MAAM8F,SAASxJ,KAC9BwT,GAAoB/P,KAAKC,MAAQ1D,GAGrC,GAAI4T,EAAOR,KAAM,CACf,IAAMiB,EAAYT,EAAOR,KAAKkB,cAC1BnB,GAAQ1P,KAAK2P,KAAK5J,SAAS6K,KAC7Bb,GAAoB/P,KAAK2P,KAAOiB,IAMtCE,CAAsBjU,GCnHtB,IAAM0R,GAAewB,GAAoB/P,K,6kBCDzC,IAAMoQ,GAAevB,KACfN,GAAe,CACnBwC,WAAY5V,OAAO4V,WACnBC,YAAa7V,OAAO6V,YACpBC,WAAYb,GAAaa,YAAc,QCH5BC,GAAa,SAAC3S,GAAD,OAAU,SAAC8P,GACnCA,EAAS,CACPzG,KANuB,cAOvB0G,QAAS/P,M,6kBCHb,IAAMgQ,GAAe,CACnBvB,WAAY+C,GAAoB/C,WAChCnR,KAAMkU,GAAoBlU,MCEbsV,gBAAgB,CAAE3S,MTIZ,WAAmC,IAAlC4S,EAAiC,uDAAzB7C,GAAc8C,EAAW,uCACrD,OAAQA,EAAOzJ,MACb,IDXkC,yBCYhC,IAAM4G,EAAU,MAAQ4C,EAAM5C,WAAd,CAA0BJ,OAAQiD,EAAO/C,UACzD,OAAO,MAAK8C,EAAZ,CAAmB5C,eAErB,IDlB4B,mBCmB1B,IAAMA,EAAU,MAAQ4C,EAAM5C,WAAd,CAA0BJ,OAAQ,YAClD,OAAO,MAAKgD,EAAZ,CAAmB5C,eAErB,IDrB6B,oBCsB3B,IAAMA,EAAU,MAAQ4C,EAAM5C,WAAd,CAA0BJ,OAAQ,WAClD,OAAO,MAAKgD,EAAZ,CAAmB5C,eAErB,IDxB4B,mBCyB1B,IAAMA,EAAU,MAAQ4C,EAAM5C,WAAd,CAA0BJ,OAAQ,YAClD,OAAO,MAAKgD,EAAZ,CAAmB5C,eAErB,IDvBoC,2BCwBlC,IAAME,EAAY,MAAQ0C,EAAM1C,aAAd,CAA4BN,OAAQiD,EAAO/C,UAC7D,OAAO,MAAK8C,EAAZ,CAAmB1C,iBAErB,ID7B8B,qBC8B5B,IAAMA,EAAY,MAAQ0C,EAAM1C,aAAd,CAA4BN,OAAQ,YACtD,OAAO,MAAKgD,EAAZ,CAAmB1C,iBAErB,IDhC8B,qBCiC5B,IAAMA,EAAY,MAAQ0C,EAAM1C,aAAd,CAA4BN,OAAQ,YACtD,OAAO,MAAKgD,EAAZ,CAAmB1C,iBAErB,IDjC8B,qBCkC5B,IAAMF,EAAU,MAAQ4C,EAAM5C,WAAd,CAA0BC,SAAU4C,EAAO/C,UAC3D,OAAO,MAAK8C,EAAZ,CAAmB5C,eAErB,QACE,OAAO4C,ISvC2BlD,MRDnB,WAAmC,IAAlCkD,EAAiC,uDAAzB7C,GAAc8C,EAAW,uCACrD,OAAQA,EAAOzJ,MACb,ISRqC,4BTUnC,IAAM+G,EAAYvQ,KAAKC,MAAMgT,EAAO/C,SACpC,OAAO,MAAK8C,EAAZ,CAAmBzC,cAErB,ISZqB,YTanB,OAAO,MAAKyC,EAAZ,CAAmBtS,MAAOuS,EAAO/C,UAEnC,QACE,OAAO8C,IQVkCpR,KJF3B,WAAmC,IAAlCoR,EAAiC,uDAAzB7C,GAAc8C,EAAW,uCACpD,OAAQA,EAAOzJ,MACb,IHRuB,cGSrB,IAAM0J,EAAcD,EAAO/C,QACrBiD,EAAY,MAAQH,EAAR,GAAkBE,GAEpC,OADAlC,GAAmB,CAAEpP,KAAMuR,IACpBA,EAET,IHboC,2BGaI,IAAD,EACNF,EAAO/C,QAA9BkD,EAD6B,EAC7BA,KAAMC,EADuB,EACvBA,aACRtG,EAAe,YAAOiG,EAAMjG,iBAG9BuG,EAAgB,EAChBC,EAAgBF,EACK,iBAArBL,EAAMjN,aAA+BwN,GAAiB,GAC1D,IAAK,IAAI/S,EAAI,EAAGA,EAAIuM,EAAgBlN,OAAQW,IAAK,CAC/CuM,EAAgBvM,IAAM4S,EAAK5S,GAC3B,IAAMM,EAASiM,EAAgBvM,GAC3BM,EAASwS,EAAevG,EAAgBvM,GAAK8S,EACxCxS,EAASyS,IAAexG,EAAgBvM,GAAK+S,GAGxD,IAAMJ,EAAY,MAAQH,EAAR,CAAejG,oBAEjC,OADAiE,GAAmB,CAAEpP,KAAMuR,IACpBA,EAET,QACE,OAAOH,II1BwCQ,OHE/B,WAAmC,IAAlCR,EAAiC,uDAAzB7C,GAAc8C,EAAW,uCACtD,OAAQA,EAAOzJ,MACb,IKZyB,gBLYI,IACnBiK,EAAWR,EAAO/C,QAAlBuD,OACAd,EAA4Bc,EAA5Bd,WAAYC,EAAgBa,EAAhBb,YAEdc,EAAS,CAAEf,aAAYC,eAE7B,OAAO,MAAKI,EAAZ,GAAsBU,GAExB,IKnB2B,kBLoBzB,IAAMb,EAAaI,EAAO/C,QAE1B,OADAc,GAAmB,CAAE6B,eACd,MAAKG,EAAZ,CAAmBH,eAErB,QACE,OAAOG,IGlBgDW,WDCnC,WAAmC,IAAlCX,EAAiC,uDAAzB7C,GAAc8C,EAAW,uCAC1D,OAAQA,EAAOzJ,MACb,IDXuB,cCYrB,IAAMrJ,EAAO8S,EAAO/C,QAEpB,OADAc,GAAmB,CAAE7Q,KAAMA,EAAKyT,OACzB,MAAKZ,EAAZ,CAAmB7S,SAErB,IDf6B,oBCgB3B,IAAMyO,EAAaqE,EAAO/C,QAE1B,OADAc,GAAmB,CAAEpC,eACd,MAAKoE,EAAZ,CAAmBpE,eAErB,IDnBuB,cCoBrB,IAAMnR,EAAOwV,EAAO/C,QAEpB,OADAc,GAAmB,CAAEvT,SACd,MAAKuV,EAAZ,CAAmBvV,SAErB,QACE,OAAOuV,MIdEa,GARDC,aACZC,GACAC,aACEC,aAAgBC,MAChBnX,OAAOoX,kBAAoBpX,OAAOqX,+BAAiC,SAACC,GAAD,OAAOA,KCsG/D,O,WA3Gb,aAAe,oBACbrP,KAAKsP,WAAY,EACjBtP,KAAKuP,gBAAkB,EAEvBvP,KAAKwP,YAAc,EACf/V,EAAa4R,WACfrL,KAAKwP,YAAc/V,EAAa4R,SAAW,IAC3CrL,KAAKuP,gBAAkBvP,KAAKwP,a,yDAIlB,IAAD,OACXxP,KAAKjE,OAAStB,SAASC,cAAc,aACrCsF,KAAKyP,aAAehV,SAASC,cAC3B,sCAGFsF,KAAK0P,iBAGL1P,KAAKjE,OAAO4T,iBAAiB,cAAc,SAACC,GAC1CA,EAAEC,iBACF,EAAKC,eAAeF,EAAEG,QAAQ,OAEhC/P,KAAKjE,OAAO4T,iBAAiB,aAAa,SAACC,GACzCA,EAAEC,iBACF,EAAKC,eAAeF,EAAEG,QAAQ,OAIhC/P,KAAKjE,OAAO4T,iBAAiB,aAAa,SAACC,GACzCA,EAAEC,iBACF,EAAKC,eAAeF,GACpB,EAAKN,WAAY,KAEnBtP,KAAKjE,OAAO4T,iBAAiB,aAAa,SAACC,GACzCA,EAAEC,iBACE,EAAKP,WACP,EAAKQ,eAAeF,MAGxB5P,KAAKjE,OAAO4T,iBAAiB,WAAW,SAACC,GACvCA,EAAEC,iBACF,EAAKP,WAAY,KAGnBtP,KAAKgQ,kBACLjY,OAAO4X,iBAAiB,UAAU,SAACC,GACjC,EAAKI,uB,wCAKP,GAAKhQ,KAAKwP,aAAgBxP,KAAKyP,aAA/B,CACA,IAAMQ,EAAajQ,KAAKjE,OAAOmU,YAC/BlQ,KAAKmQ,eAAiBF,EAAajQ,KAAKwP,YACxCxP,KAAKyP,aAAaxI,MAAMmJ,KAAxB,UAAkCpQ,KAAKmQ,eAAvC,S,kCAGU9E,GACVrL,KAAKuP,gBAAkBlE,I,oCAGvB,OAAOrL,KAAKuP,kB,qCAGChS,EAAO8S,GACpB,IAAIC,EAEJ,GAAID,EACFC,EAAkBD,MACb,CACL,IAAME,EAAUvQ,KAAKjE,OAAOyU,wBACtBP,EAAaM,EAAQ1M,MAE3ByM,GADU/S,EAAMkT,QAAUF,EAAQG,GACZT,EAGpBK,EAAkB,GAAKA,EAAkB,IAE7CtQ,KAAK2Q,YAAYL,GACjBM,GAAYC,aAAaP,M,wCAGTV,GAChB5P,KAAK8P,eAAeF,EAAG5P,KAAKwP,aAC5BI,EAAEkB,oB,uCAIF,IAAMlQ,EAAIZ,KAAKjE,OAAO8E,WAAW,MACjCD,EAAEmQ,UAAY,UACdnQ,EAAEoQ,SAAS,EAAG,EAAGhR,KAAKjE,OAAO8H,MAAO7D,KAAKjE,OAAOD,U,6BAG3CuP,GACL,IAAI4F,MAAM5F,GAAV,CAEArL,KAAK2Q,YAAYtF,GAEjBrL,KAAK0P,iBACL,IAAM9O,EAAIZ,KAAKjE,OAAO8E,WAAW,MACjCD,EAAEmQ,UAAY,UACdnQ,EAAEoQ,SAAS,EAAG,EAAGhR,KAAKjE,OAAO8H,MAAQwH,EAAUrL,KAAKjE,OAAOD,a,MC4VhD,O,WAnbb,aAAe,oBAMbkE,KAAKkR,QAAU,CACb/V,KAAM,GACNgW,QAAS,GACTC,WAAY,CACVhW,MAAO,IAAIiW,QAAK,CACdzR,IAAKxG,EAAa,8BAOxB4G,KAAKsR,YAAc,KACnBtR,KAAKuR,eAAiB,KAEtBvR,KAAKwR,cAAgB,KACrBxR,KAAKyR,iBAAmB,KAIxBzR,KAAK0R,mBAAqB,KAE1B1R,KAAK2R,eAAiB3R,KAAK2R,eAAeC,KAAK5R,MAC/CA,KAAK6R,eAAiB7R,KAAK6R,eAAeD,KAAK5R,MAC/CA,KAAK8R,kBAAoB,E,6DAKzB,OADoB9R,KAAKkR,QAAQ/V,KAAK6E,KAAKsR,e,0CAI3C,OAAOtR,KAAKkR,QAAQC,QAAQnR,KAAKuR,kB,uCAIjC,OAAOvR,KAAK+R,iBAAiB3W,MAAMG,S,uCAKpBJ,GAA4B,IAAD,OAArB6W,EAAqB,uDAAH,EACvC,IAAKhS,KAAKkR,QAAQ/V,KAAKA,EAAKyT,MAAO,CACjC5O,KAAKiS,iBAAgB,GAErB,IAAMC,EAAYlS,KAAKkR,QAAQ/V,KAAKA,EAAKyT,MAAQ,CAAEuD,MAAOhX,EAAKgX,OAE/DD,EAAS9W,MAAQ,IAAIiW,QAAK,CACxBzR,IAAI,uCAAD,OAAyCzE,EAAKiX,WACjDC,OAAQ,CAAC,OACTC,OAAO,EACPC,OAAQ,WAEN,EAAKN,iBAAgB,GACrB,EAAKpB,aAAamB,IAEpBQ,YAAa,SAACC,EAAI1Y,EAAO2Y,GACvBC,MAAM,GAAD,OAAIF,EAAJ,eAAa1Y,EAAb,eAAyB2Y,KAEhCE,OAAQ,WACNV,EAASW,GAAGC,OACZ,EAAKC,SACLC,IAAKC,OAAOC,IAAI,EAAKrB,gBACrB,EAAKsB,qBACLtE,GAAM5D,UfxEoB,SAACA,GACnCA,EAAS,CACPzG,KApB4B,yBe4FxB4O,QAAS,WACPlB,EAASW,GAAGQ,QACZL,IAAKC,OAAOK,OAAO,EAAK3B,gBACxBqB,IAAKC,OAAOK,OAAO,EAAKzB,gBACxB,EAAK0B,oBACL1E,GAAM5D,UfzEqB,SAACA,GACpCA,EAAS,CACPzG,KAzB6B,0BekGzBgP,OAAQ,aACRC,OAAQ,WACFvB,EAASW,IACXX,EAASW,GAAGa,UAAUL,QAExBL,IAAKC,OAAOK,OAAO,EAAK3B,gBACxBqB,IAAKC,OAAOK,OAAO,EAAKzB,gBACxB,EAAK0B,oBACL1E,GAAM5D,Uf7EoB,SAACA,GACnCA,EAAS,CACPzG,KA9B4B,yBe2GxBmP,MAAO,SAACC,GACF1B,EAASW,IACXX,EAASW,GAAGQ,QAEdL,IAAKC,OAAOK,OAAO,EAAK3B,gBACxBqB,IAAKC,OAAOK,OAAO,EAAKzB,gBACxB,EAAK0B,oBACL1E,GAAM5D,UftFoB,SAACA,GACnCA,EAAS,CACPzG,KA9B4B,2BesH1B,IAAMqP,EAAe7T,KAAKkR,QAAQC,QAAQhW,EAAKyT,MAAQ,CACrDuD,MAAOhX,EAAKgX,OAEd0B,EAAYzY,MAAQ,IAAIiW,QAAK,CAC3BzR,IAAI,uCAAD,OAAyCzE,EAAKiX,WACjDC,OAAQ,CAAC,OACTC,OAAO,EACPwB,OAAQ,CACNC,OAAQ,CACNxK,WAAiD,KAArCpO,EAAK6Y,Y5B/GC,M4BgHlBzK,WAAkD,KAAtCpO,EAAK8Y,a5BhHC,Q4BmHtB1B,OAAQ,aAGRK,OAAQ,WAENiB,EAAYzY,MAAM8Y,OAAO,GAMzB,EAAKxC,mBAAqByC,YAAW,WACnCN,EAAYzY,MAAMgZ,KAAK,EAAG,EAJR,OAKG,IAApBjZ,EAAK8Y,aALY,KAOpBpF,GAAM5D,Uf1GsB,SAACA,GACrCA,EAAS,CACPzG,KAvC8B,2BeiJ1BiP,OAAQ,WACNY,aAAa,EAAK3C,oBAElB,EAAKD,iBAAmB,KACxB5C,GAAM5D,Uf3GsB,SAACA,GACrCA,EAAS,CACPzG,KA3C8B,2BesJ1BmP,MAAO,WACLU,aAAa,EAAK3C,oBAElB,EAAKD,iBAAmB,KACxB5C,GAAM5D,UfjHsB,SAACA,GACrCA,EAAS,CACPzG,KA3C8B,gC,iCekKrBrJ,GAA4B,IAAtB6W,EAAqB,uDAAH,EAC7BhS,KAAKsR,aACPtR,KAAK+R,iBAAiB3W,MAAMmM,KAAKvH,KAAKwR,eAGxCxR,KAAKsU,iBAAiBnZ,EAAM6W,GAC5BhS,KAAKsR,YAAcnW,EAAKyT,O,+BAOxB5O,KAAKuU,kBAAoB,EAIzBvU,KAAK8R,kBAAoB,GAEzBkB,IAAKC,OAAOC,IAAIlT,KAAK2R,kB,uCAQrB,IAAML,EAActR,KAAK+R,iBACzB,GAAKT,EAAYuB,IAAOvB,EAAY/W,aAApC,CAEA,IAAIia,GAAgB,EAGpB,IACE,IAAMlZ,EAAc0E,KAAKyU,iBAEzB,GAA2B,kBAAhBnZ,EAA0B,CACnCkZ,GAAgB,EAUhB,IAAM3H,EAAegC,GAAM6F,WAAW9X,KAAKiQ,aAE3CyE,EAAYuB,GAAGtX,KAEbD,EAAcuR,EAAeyE,EAAY/W,aAAa2O,QAExDlJ,KAAK2U,qBAE8B,YAA/B3U,KAAK4U,uBACPtD,EAAYuB,GAAGC,OAEjB9S,KAAK8R,yBAGLR,EAAYuB,GAAGQ,QACfrT,KAAKuU,oBAEP,MAAOxI,GACP/R,QAAQC,IAAI8R,GAId,GAAIyI,GAAiBxU,KAAK8R,mBAAqB,EAAG,CAEhD,IAAM+C,EzB7LiB,SAAC9H,GAG5B,IAHwC,IAChCnS,EAAuBmS,EAAvBnS,SAAUD,EAAaoS,EAAbpS,SACdma,EAAe,EACVtZ,EAAI,EAAGA,EAAIb,EAASE,OAAQW,IAAK,CACxC,IAAMuZ,EAAWpa,EAASa,GAC1B,GAAIuZ,EAASja,KAAOF,EAClB,OAAOka,EAETA,EAAeC,EAAS5b,MAE1B,OAAO2b,EyBmLgBE,CAAc1D,EAAY/W,cAC7CF,EAAgBwa,EAAYvD,EAAY/W,cAGxC,IAAM0a,EAAe/Z,EAAgBoW,GAI/B4D,EAAYza,SAASC,cAAc,0BACrCwa,IAAWA,EAAUna,YAAcka,GAIvCjC,IAAKC,OAAOK,OAAOtT,KAAK2R,oB,+BAInBhW,GACPqE,KAAK+R,iBAAiB3W,MAAMG,KAAKI,GACjCqE,KAAK+S,W,6BAEAoC,GACLnV,KAAKoV,SAASpV,KAAKyU,iBAAwB,KAALU,K,gCAE9BA,GACRnV,KAAKoV,SAASpV,KAAKyU,iBAAwB,KAALU,K,mCAG3Bhc,GACX,IAAMkc,EAAgBrV,KAAK+R,iBAAiB3W,MAAMka,WAClDtV,KAAKoV,SAASjc,EAAQkc,K,qCAITE,EAAMC,EAAWxS,GAC9B,IAAMsO,EAActR,KAAK+R,iBACzB,GAAKT,GAAgBA,EAAYuB,GAAjC,CAKA,GAAI2C,EAAY,GAAI,CAElB,IAAMla,EAAc0E,KAAKyU,iBAQzB,GAPAza,QAAQC,IACN,aACA,aACAub,EACA,eACAla,GAEyB,kBAAhBA,EAA0B,CACnC,IAAMuR,EAAegC,GAAM6F,WAAW9X,KAAKiQ,aAE3CyE,EAAYuB,GAAGtX,KACbD,EAAcuR,EAAeyE,EAAY/W,aAAa2O,aAGxDlP,QAAQC,IAAI,8CACZ+F,KAAK+S,SAGT,GAAI/P,EAAQ,KAAO,EAAG,CACpB,IAAIyS,EAAKC,YAAYC,MACfva,EAAQkW,EAAYlW,MACpBiQ,EAAWjQ,EAAMG,OAASH,EAAMka,WAC7BI,YAAYC,MAKrBF,EAAKC,YAAYC,MACArE,EAAYuB,GAAGxH,WAC3BqK,YAAYC,MAUjBF,EAAKC,YAAYC,MACjBtJ,GAAiBhB,GACjBuK,GAASC,OAAOxK,GACXqK,YAAYC,U,2CAMnB3V,KAAK6R,eAAe,KAAM,KAAM,GAEhC,IAAMP,EAActR,KAAK+R,iBACnBkD,EAAe/Z,EAAgBoW,GAOrCnX,EAAS,OAAD,OzB3MgB,SAACgB,GAAU,IAE7BE,EADiBF,EAAjBZ,aACAc,UACR,IAAKA,EAAUR,OAAQ,OAAO,EAC9B,IAAK,IAAIW,EAAIH,EAAUR,OAAS,EAAGW,GAAK,EAAGA,IAAK,CAC9C,IAAMC,EAAQJ,EAAUG,GACxB,GAAIC,EAAMC,MACR,OAAOD,EAAMC,MAGjB,OAAO,EyBiMWoa,CAAaxE,KAE7BA,EAAY/W,aAAamB,MAAQuZ,EAEjC5Y,EAAqBiV,EAAY/W,cAEjCyF,KAAK+V,4B,kCAGKlD,GACV7S,KAAK+R,iBAAiBc,GAAKA,I,sCAEb9F,GACd/M,KAAK+R,iBAAiBxX,aAAewS,I,6BAIrC,GAAmC,YAA/B/M,KAAK4U,sBAAT,CAGA,IAAMtD,EAActR,KAAK+R,iBACzB/R,KAAKwR,cAAgBF,EAAYlW,MAAM0X,OAEvC3Y,EAAS,gBAAD,OAAiBmX,EAAYa,OAAS,GAC9CtD,GAAM5D,SAAS+K,GAA4B,e,8BAI3ChW,KAAK+R,iBAAiB3W,MAAMiY,MAAMrT,KAAKwR,eAEvC,IAAMpW,EAAQ4E,KAAK+R,iBAAiB3W,MAC9BiQ,EAAWjQ,EAAMG,OAASH,EAAMka,WACtCjJ,GAAiBhB,K,6BAGX,IAAD,OACArL,KAAK+R,mBAGV/R,KAAK+R,iBAAiB3W,MAAMmM,KAAKvH,KAAKwR,eACtCxR,KAAKuT,oBACLY,YAAW,kBAAM,EAAKiB,SAAS,MAC/BpV,KAAKwR,cAAgB,Q,sCAGPyE,GACd,IAAM3E,EAActR,KAAKkR,QAAQ/V,KAAK8a,GAClC3E,IACEA,EAAYuB,IACd7S,KAAKkR,QAAQ/V,KAAK8a,GAAQpD,GAAGqD,OAE/BlW,KAAKuH,QAEPsH,GAAM5D,SAAS+K,GAA4B,c,kCAI3C,OACEhW,KAAK+R,kBACL/R,KAAK+R,iBAAiB3W,MAAM+a,QAAQnW,KAAKwR,iB,iCAI3C,OACExR,KAAK+R,mBACJ/R,KAAK+R,iBAAiB3W,MAAM+a,QAAQnW,KAAKwR,iB,uCAK5CxR,KAAKkR,QAAQE,WAAWhW,MAAM0X,S,sCAGhB3X,GACd,GAAqC,YAAjC6E,KAAKoW,wBAAT,CAGIpW,KAAKuR,gBACPvR,KAAKqW,oBAAoBjb,MAAMmM,KAAKvH,KAAKyR,kBAG3CzR,KAAKsU,iBAAiBnZ,GACtB6E,KAAKuR,eAAiBpW,EAAKyT,KAE3B,IfrYkC5D,EeqY5BmG,EAAUnR,KAAKqW,oBAAoBjb,MAEzC4E,KAAKyR,iBAAmBN,EAAQ2B,KAAK,UACrCjE,GAAM5D,UfxY4BD,EewYW,UfxYA,SAACC,GAChDA,EAAS,CACPzG,KA/BoC,2BAgCpC0G,QAASF,U,wCeyYJhL,KAAKuR,gBACMvR,KAAKqW,oBAAoBjb,MAEjCmM,KAAKvH,KAAKyR,oB,yCAMlB,OACEzR,KAAKqW,qBACLrW,KAAKqW,oBAAoBjb,MAAM+a,QAAQnW,KAAKyR,oB,4CAK9C,OAAO5C,GAAM6F,WAAWtZ,MAAMgQ,WAAWJ,S,8CAGzC,OAAO6D,GAAM6F,WAAWtZ,MAAMkQ,aAAaN,W,ulBC0ZhCsL,G,WAh0Bb,WAAYva,EAAQ4M,GAAsC,IAAlCE,EAAiC,uDAAnB,KAAM0N,EAAa,2DACvDvW,KAAKjE,OAASA,EACdiE,KAAKY,EAAI7E,EAAO8E,WAAW,MAC3Bb,KAAK2I,GAAKA,EACV3I,KAAK8I,SAAW,GAEhB9I,KAAK6S,GAAKG,IAAKwD,WACfxW,KAAKyW,UAAY,GACjBzW,KAAKxD,OAAS,GACdwD,KAAKtD,OAAS,GACdsD,KAAKvD,QAAU,GACfuD,KAAK3E,UAAY,GAEjB2E,KAAK0W,mBAAqB,KAE1B1W,KAAK/D,QAAUxB,SAASyB,eAAe,WACvC8D,KAAK5D,SAAW3B,SAASyB,eAAe,YAEpC8D,KAAK/D,UAAS+D,KAAK/D,QAAQE,UAAY,IACvC6D,KAAK5D,WAAU4D,KAAK5D,SAASD,UAAY,IAE7C6D,KAAK0P,iBAEL1P,KAAKzF,aAAe,CAMlBK,SAAU,EAOVoC,SAAU,EAKVgG,MAAO,EAEPtH,MAAO,EACPf,SAAU,GAEVgc,cAAe,GAOfC,WAAY,KAKZtT,UAAW,EAKX3G,gBAAiBZ,EAAOD,QAG1B8U,GAAYuC,mBAAqBnT,KAAK6W,UAAUjF,KAAK5R,MACrD4Q,GAAY2C,kBAAoBvT,KAAK8W,SAASlF,KAAK5R,MACnD4Q,GAAYmF,wBAA0B/V,KAAK+W,eAAenF,KAAK5R,MAE1DA,KAAK2I,KAGV3I,KAAK8I,SAAWJ,GAAa1I,KAAK2I,GAAIE,GACtC7O,QAAQC,IAAI,gBAAiB+F,KAAK8I,UAElC9I,KAAKgX,WAAWT,I,0DAGsB,IAA3B9d,EAA0B,EAA1BA,KAAMmR,EAAoB,EAApBA,WAAYhN,EAAQ,EAARA,KACrBxB,EAAUyT,GAAM6F,WAAhBtZ,MAGJ4E,KAAK6S,IACP7S,KAAK6S,GAAGqD,OAEVlW,KAAK6S,GAAKG,IAAKwD,WAGfxW,KAAKyW,UAAU5b,OAAS,EACxBmF,KAAKxD,OAAO3B,OAAS,EACrBmF,KAAKvD,QAAQ5B,OAAS,EACtBmF,KAAKtD,OAAO7B,OAAS,EACrBmF,KAAK3E,UAAUR,OAAS,EAEpBmF,KAAKiX,mBACPjX,KAAKiX,kBAAkBC,cAGzBlX,KAAKzF,aAAaK,SAAW,EAC7BoF,KAAKzF,aAAayC,SAAW,EAC7BgD,KAAKzF,aAAayI,MAAQ,EAC1BhD,KAAKzF,aAAamB,MAAQ,EAC1BsE,KAAKzF,aAAaI,SAAW,GAC7BqF,KAAKzF,aAAa4c,UAAY,GAE9BnX,KAAKzF,aAAaiC,OAASwD,KAAKxD,OAChCwD,KAAKzF,aAAakC,QAAUuD,KAAKvD,QACjCuD,KAAKzF,aAAamC,OAASsD,KAAKtD,OAChCsD,KAAKzF,aAAac,UAAY2E,KAAK3E,UAEnC2E,KAAKzF,aAAauE,mBAAqB,GACvCkB,KAAKzF,aAAawE,iBAAmB,GACrCiB,KAAKzF,aAAaoE,mBAAqB,GACvCqB,KAAKzF,aAAaqE,iBAAmB,GAErCoB,KAAKzF,aAAaoc,cAAgB,GAClC3W,KAAKzF,aAAaqC,KAAOA,EACzBgU,GAAYwG,gBAAgBpX,KAAKzF,cAGjCxC,OAAOwC,aAAeyF,KAAKzF,aAI3B,IAAMuP,EAAU9J,KAAK8I,SAAL,UAAiBrQ,EAAjB,YAAyBmR,IACrCE,K3BzIyB,SAACA,GAEhC,IAAMgB,EAAQhB,EAAQgB,MAGlBuM,EAAM,UAAMvN,EAAQrR,KAAd,YAAsBqR,EAAQF,WAA9B,YAA4CE,EAAQD,MAApD,SAbgB,SAACzP,GAAsB,wDAkDjDkd,CADAD,GAlCmBvM,EAChBzB,KAAI,SAACkO,GACJ,IAAKA,EAAI1c,OAAQ,MAAO,WAIxB,IAHA,IAAItB,EAAM,IACJkR,EAAW8M,EAAI,GAAGnX,SAHZ,WAKH5E,GACP,IAAMmP,EAAO4M,EAAIC,MAAK,SAACC,GAAD,OAAOA,EAAEtX,UAAY3E,KACvCA,EAAI,IAAGjC,GAAO,KAiBhBA,GAhBGoR,EAgBIA,EAAK1K,KAdL,OAgBLzE,EAAIiP,EAAW,IAAGlR,GAAO,OArBtBiC,EAAI,EAAGA,EAAIiP,EAAUjP,IAAM,EAA3BA,GAyBT,OADAjC,GAAG,aAAUkR,EAAV,gBAGJiN,KAAK,MAEa,G2BgGjBC,CAAkB7N,GAElB9J,KAAKzF,aAAa2O,OAASY,EAAQZ,OAEnClJ,KAAK4X,kBAAkB9N,GACvB9J,KAAK6X,eAAe/N,EAASlN,GAC7BoD,KAAK8X,qBACL9X,KAAK+X,aAAanb,GAClBoD,KAAKgY,YAC2B,YAA5B5c,EAAMgQ,WAAWJ,QACnBhL,KAAKiY,UAEPrH,GAAYmC,Y,kCAKd/S,KAAK0W,mBAAqB3e,OAAOmgB,sBAC/BlY,KAAKmY,SAASvG,KAAK5R,S,iCAIrBjI,OAAOqgB,qBAAqBpY,KAAK0W,sB,uCAGjC3e,OAAOmgB,sBAAsBlY,KAAKmY,SAASvG,KAAK5R,MAAM,M,iDAG7B+M,GACzB,IAAK,IAAIlT,KAASkT,EAChB/M,KAAKzF,aAAaV,GAASkT,EAAOlT,GAEpCwC,EAAqB2D,KAAKzF,gB,wCAIVuP,GAUhB,IAV0B,IAClBd,EAAgBc,EAAhBd,KAAMC,EAAUa,EAAVb,MACRwN,EAAY,GACd4B,EAAS,EACXC,EAAU,EACRzD,EAAa7L,EAAK,GAAG7P,MAKlBkf,EAASrP,EAAKnO,QAAUyd,EAAUrP,EAAMpO,QAAQ,CACrD,IAAMiM,EAAMkC,EAAKqP,GACX9Q,EAAO0B,EAAMqP,GAIf/Q,EAAKzM,MAAQgM,EAAIhM,MACnB2b,EAAUvS,KAAV,MAAoBqD,EAApB,CAA0BT,IAAK+N,EAAYrQ,KAAM,UACjD8T,MAIA7B,EAAUvS,KAAV,MAAoB4C,EAApB,CAAyBtC,KAAM,SAC/BqQ,EAAa/N,EAAI3N,MACjBkf,KAGJ,KAAOA,EAASrP,EAAKnO,QACnB4b,EAAUvS,KAAV,MAAoB8E,EAAKqP,GAAzB,CAAkC7T,KAAM,SACxC6T,IAEF,KAAOC,EAAUrP,EAAMpO,QACrB4b,EAAUvS,KAAV,MAAoB+E,EAAMqP,GAA1B,CAAoCxR,IAAK+N,EAAYrQ,KAAM,UAC3D8T,IAGF7B,EAAU,GAAG9a,UAAY,EAEzBqE,KAAKzF,aAAaI,SAAW,CAAC8b,EAAU,IAExC,IAAK,IAAIjb,EAAI,EAAGA,EAAIib,EAAU5b,OAAQW,IAAK,CACzC,IAAM+c,EAAY9B,EAAUjb,EAAI,GAC1B0C,EAAeuY,EAAUjb,GACzBgd,EAAgB/B,EAAUjb,EAAI,GAAGG,UAUnC8c,GAHava,EAAapD,KAAOyd,EAAUzd,OAE1B,QAAnByd,EAAU/T,KAAiB+T,EAAUpf,MAAQof,EAAUzR,KACd,GACpB,SAAnByR,EAAU/T,OAAiBiU,GAAiBF,EAAUpf,OAC1D,IAAMuf,EAAmBF,EAAgBC,EAEzCva,EAAavC,UAAY+c,EAEC,QAAtBxa,EAAasG,KACfxE,KAAKzF,aAAaI,SAASuJ,KAAKhG,GACD,SAAtBA,EAAasG,MACtBxE,KAAKzF,aAAa4c,UAAUjT,KAAKhG,GAKrC,OADA8B,KAAKyW,UAAYA,EACVA,I,qCAGM3M,EAASlN,GAAO,IAAD,OACtBkO,EAAUhB,EAAVgB,MACArS,EAAOoW,GAAM6F,WAAW/F,WAAWlW,KAEzC,GAAIkgB,MAAMC,QAAQ9N,EAAM,IAAK,CAC3B,IAAM+N,EAAW,GACjB/N,EAAMlR,SAAQ,SAACyQ,GACbwO,EAAS3U,KAAT,MAAA2U,EAAQ,YAASxO,OAEnBS,EAAQ+N,GAGV/N,E1B/QyB,SAACA,EAAOlO,EAAMnE,GAAU,IAC3C8T,EAAkB3P,EAAlB2P,KAAMC,EAAY5P,EAAZ4P,QAGRsM,EAAU,CACdC,IAAK,OACLC,OAAQ,OACR5I,KAAM,OACN6I,MAAO,OACPC,SAAU,OACVC,SAAU,OACVC,SAAU,OACVC,SAAU,OACVC,SAAU,OACVC,SAAU,OACVC,SAAU,OACVC,SAAU,QAGRC,EAAUnN,EAGd,MAFa,YAATA,IAAoBmN,GAAWlN,GAEtB,WAAT/T,EACKqS,EAAMzB,KAAI,SAACkO,GAChB,IAAMtX,EAAOsX,EAAItX,KAKjB,OAAO,EAAP,GAAYsX,EAAZ,CAAiBtX,KAJE6Y,EAAQY,GACxB/f,MAAM,IACN0P,KAAI,SAAC3J,GAAD,OAAeO,EAAK6Y,EAAQC,IAAI3gB,QAAQsH,YAKtC,WAATjH,EACKqS,EAAMzB,KAAI,SAACkO,GAChB,IAAIoC,EAAapC,EAAItX,KAAKtG,MAAM,IAEhC,MADa,WAAT4S,IAAmBoN,EAAaA,EAAWC,WACxC,EAAP,GAAYrC,EAAZ,CAAiBtX,KAAM0Z,YAJ3B,E0B+OUE,CAAc/O,EAAOlO,EAAMnE,IAG7BmB,SAAQ,SAACqG,EAAMnG,GAAQ,IAEnBoG,EAAmCD,EAAnCC,WAAYC,EAAuBF,EAAvBE,SAAUC,EAAaH,EAAbG,SAC9BH,EAAKI,UAAiD,GAApCH,EAAaC,EAAWC,MAI5C0K,EAAMlR,SAAQ,SAACqG,EAAMnG,GACnB,GAAqB,MAAjBmG,EAAKA,KAAK,IAA+B,MAAjBA,EAAKA,KAAK,GAAY,CAChD,IAAM6Z,EAAa,IAAI/W,EAAJ,IAAiBjJ,OAAQmG,IAC5C,EAAKvD,OAAOwH,KAAK4V,GACjB,EAAKze,UAAU6I,KAAK4V,GAEtB,GACE7Z,EAAKA,KAAK0C,SAAS,MACnB1C,EAAKA,KAAK0C,SAAS,MACnB1C,EAAKA,KAAK0C,SAAS,KACnB,CACA,IAAMlH,EAAQ,IAAIqE,EAAJ,IAAYhG,OAAQmG,IAClC,EAAKzD,OAAO0H,KAAKzI,GACjB,EAAKJ,UAAU6I,KAAKzI,IAEhBwE,EAAKA,KAAK0C,SAAS,MAAQ1C,EAAKA,KAAK0C,SAAS,OAChD,EAAKlG,QAAQyH,KAAKzI,OAKxBuE,KAAKyM,SAAW,IAAItJ,EACpBnD,KAAK0M,aAAe,IAAI3H,EACxB/E,KAAK+Z,UAAY,IAAIjS,K,2CAMD,IAAD,OAGbkS,EAAYha,KAAKxD,OAAOwD,KAAKxD,OAAO3B,OAAS,GAC7Cof,EAAYja,KAAKyW,UAAUzW,KAAKyW,UAAU5b,OAAS,GAEzD,GAAImf,GAAaC,EAAW,CAC1B,IAAMC,EAAgBF,EAAU3Z,UAC1B8Z,EAAgBF,EAAUnf,KAC5Bqf,EAAgBD,GAClBla,KAAKzF,aAAa+I,UAAY6W,EAC9Bna,KAAKzF,aAAaqc,WAAaqD,IAE/Bja,KAAKzF,aAAa+I,UAAY4W,EAC9Bla,KAAKzF,aAAaqc,WAAaoD,QAExBA,GACTha,KAAKzF,aAAa+I,UAAY0W,EAAU3Z,UACxCL,KAAKzF,aAAaqc,WAAaoD,GACtBC,IACTja,KAAKzF,aAAa+I,UAAY2W,EAAUnf,KACxCkF,KAAKzF,aAAaqc,WAAaqD,GAEjCja,KAAKzF,aAAa+I,W7BxTS,E6B4T3B,IAAM3I,EAAWqF,KAAKzF,aAAaI,SAInCqF,KAAKoa,YAAc,GAEnB,IAAIC,GAAiB,EACnBC,EAAkB,EAClBC,GAAkB,EAClB1F,EAAa,KACb2F,EAAc,KACdC,EAAoB,EACpBxF,EAAe,EACjBjV,KAAK3E,UAAUzB,SAAQ,SAAC6B,EAAOif,GAE7B,KACEL,EAAgB1f,EAASE,OAAS,GAClCF,EAAS0f,EAAgB,GAAGvf,KAAOW,EAAM4E,WACzC,CAEAga,IACA,IAAMM,EAAahgB,EAAS0f,GAC5BxF,EAAa8F,EAAWxhB,MAGxBshB,EAAoB,EAIpB,IAAK,IAAIjf,EAAI8e,EAAiB9e,EAAI,EAAKib,UAAU5b,OAAQW,IAAK,CAC5D,IAAM+B,EAAQ,EAAKkZ,UAAUjb,GAC7B,GAAI+B,EAAMzC,OAAS6f,EAAW7f,MAAuB,QAAfyC,EAAMiH,KAAgB,CAC1D8V,EAAkB9e,EAClB,IAAM2C,EAAY,EAAKsY,UAAUjb,EAAI,GACjC2C,GAAgC,SAAnBA,EAAUqG,MACzB+V,EAAiB/e,EAAI,EACrBgf,EAAc,EAAK/D,UAAU8D,IAE7BC,EAAc,KAEhB,QAQN,KAAOA,GAAeA,EAAY1f,KAAOW,EAAM4E,WAAW,CACxDoa,GAAqBD,EAAYrhB,MACjC,IAAMgF,EAAY,EAAKsY,UAAU8D,EAAiB,GAC9Cpc,GAAgC,SAAnBA,EAAUqG,KACzB+V,IAEAA,GAAkB,EAEpBC,EAAc,EAAK/D,UAAU8D,GAG/B,IAAMK,EAAsBjgB,EAAS0f,GAAevf,KAK9C+f,EAJsBlgB,EAAS0f,GAAe1e,WAEnCF,EAAM4E,UAAYua,IACN,GAAK/F,GACsB4F,EACxDhf,EAAME,UAAYkf,EAIhBpf,EAAMwE,KAAK0C,SAAS,MACpBlH,EAAMwE,KAAK0C,SAAS,MACpBlH,EAAMwE,KAAK0C,SAAS,MAEpBsS,IACAxZ,EAAMC,MAAQuZ,EAEd,EAAKmF,YAAYlW,KAAKzI,IAGfA,EAAMwE,KAAK0C,SAAS,QAI/B3C,KAAK3E,UAAUzB,SAAQ,SAAC6B,GAGtB,IAHiC,IAAD,WAGvBD,GACP,GAAsB,MAAlBC,EAAMwE,KAAKzE,GAAY,iBAQ3B,IAFA,IAAMsf,EAAqB,GAElBld,EAAInC,EAAM3B,IAAM,EAAG8D,GAAK,EAAGA,IAAK,CASvC,GARK,EAAKvC,UAAUuC,GAAG6D,iBACrB,EAAKpG,UAAUuC,GAAG6D,eAAiB,GACnC,EAAKpG,UAAUuC,GAAG4D,aAAe,GACjC,EAAKnG,UAAUuC,GAAG0D,eAAiB,GACnC,EAAKjG,UAAUuC,GAAGyD,aAAe,IAEnCyZ,EAAmB5W,KAAK,EAAK7I,UAAUuC,IAEL,MAA9B,EAAKvC,UAAUuC,GAAGqC,KAAKzE,GAAY,wBACrC,IAAMuf,EAAa,EAAK1f,UAAUuC,GAC5Bod,EAAavf,EAgBnB,OAdKuf,EAAWvZ,iBACduZ,EAAWvZ,eAAiB,GAC5BuZ,EAAWxZ,aAAe,GAC1BwZ,EAAW1Z,eAAiB,GAC5B0Z,EAAW3Z,aAAe,IAE5ByZ,EAAmB5W,KAAK8W,GAExBF,EAAmBlhB,SAAQ,SAACqhB,GAC1BA,EAAkBxZ,eAAejG,GAAKuf,EAAW1a,UACjD4a,EAAkBzZ,aAAahG,GAAKwf,EAAW3a,UAC/C4a,EAAkB3Z,eAAe9F,GAAKuf,EAAWpf,UACjDsf,EAAkB5Z,aAAa7F,GAAKwf,EAAWrf,aAEjD,QAlBqC,GAkBrC,QApCGH,EAAI,EAAGA,EAAIC,EAAMwE,KAAKpF,OAAQW,IAAK,EAAnCA,Q,mCA4CAoB,GAAO,IAAD,OAGjBoD,KAAK3E,UAAUzB,SAAQ,SAAC6B,GAGpBA,EAAMwE,KAAK0C,SAAS,MACpBlH,EAAMwE,KAAK0C,SAAS,MACpBlH,EAAMwE,KAAK0C,SAAS,KAEpB,EAAKkQ,GAAGqI,IACN,EAAK3gB,aACL,CACE4gB,QAAS,WACP,EAAK5gB,aAAamB,MAAQD,EAAMC,MAE5BD,aAAiBqE,IAGnB,EAAKvF,aAAaoc,cAChBlb,EAAM4E,WACJ,IAAI2D,EAAYvI,MAI1BA,EAAME,UAAY,MAKbF,EAAMwE,KAAK0C,SAAS,MAC3B,EAAKkQ,GAAGqI,IACN,EAAK3gB,aACL,CACE4gB,QAAS,WACP,EAAK5gB,aAAaoc,cAChBlb,EAAM4E,WACJ,IAAI2D,EAAYvI,KAGxBA,EAAME,UAAY,SAQxBqE,KAAK6S,GAAK7S,KAAK6S,GAAGqI,IAAI,GAAI,GAAI,GAK9Blb,KAAK6S,GAAK7S,KAAK6S,GAAGuI,GAChBpb,KAAKzF,aACL,CACEyC,SAAUgD,KAAKzF,aAAaqc,WAAWjb,UAAY,EACnD2Z,SAAUtV,KAAKzF,aAAaqc,WAAWjb,UAAY,EACnD0f,KAAM,QAER,KAIFrb,KAAK6S,GAAK7S,KAAK6S,GAAGqI,IAAI,GAAI,GAAI,GAY9B,IAJA,IACIpU,EADAwU,EAAsB,EAxET,WA4ER9f,GACP,IAAI+f,EAAa,EAAK9E,UAAUjb,GAC9BggB,EAAW,EAAK/E,UAAUjb,EAAI,GAG5BigB,EAA4B,SAApBF,EAAW/W,KAAkB+W,EAAWpiB,MAAQ,EAO5D,GAJwB,QAApBoiB,EAAW/W,KAAgBsC,EAAMyU,EAAWpiB,MACnB,SAApBoiB,EAAW/W,OAAiBsC,EAAMyU,EAAWzU,KAGlD0U,EAAU,CAEZ,IAAME,EAAoBF,EAAS1gB,KAAOygB,EAAWzgB,KAG/C6gB,EAAmBD,EAAoB5U,EAAO,GAEpD,EAAK+L,GAAK,EAAKA,GAAGuI,GAChB,EAAK7gB,aACL,CACEK,SAAU0gB,EAAsBI,EAChCpG,SAAUqG,EACVN,KAAM,OACNF,QAAS,WACiB,QAApBI,EAAW/W,MACbnK,EAAgBkhB,EAAWpiB,MAAO,EAAKoB,gBARrC,WAYJkhB,IAENH,GAAuBI,OAIvB,EAAK7I,GAAK,EAAKA,GAAGuI,GAChB,EAAK7gB,aACL,CACEK,SAAU,EAAKL,aAAa+I,UAC5BgS,UACI,EAAK/a,aAAa+I,UAAYgY,GAAuBxU,EAAO,GAChEuU,KAAM,OACNF,QAAS,WACiB,QAApBI,EAAW/W,MACbnK,EAAgBkhB,EAAWpiB,MAAO,EAAKoB,gBATrC,WAaJkhB,KAlDDjgB,EAAI,EAAGA,EAAIwE,KAAKyW,UAAU5b,OAAQW,IAAM,EAAxCA,GAuDTwE,KAAKuD,WAAa,IAAIF,EAAWrD,KAAKzF,aAAa+I,WACnDtD,KAAKiX,kBAAoB,IAAI5Q,EAE7BuK,GAAYgL,YAAY5b,KAAK6S,IAE7B7S,KAAK+W,mB,iCAGgB,IAAD,OAAb8E,IAAa,yDAGpB,IAAI7b,KAAK8b,OAAT,CAWKpG,YAAYC,MACjB3V,KAAK0P,iBACAgG,YAAYC,MAhBG,MAmBS9G,GAAM6F,WAA3B/F,EAnBY,EAmBZA,WAAY/R,EAnBA,EAmBAA,KACZnE,EAASkW,EAATlW,MAEJmE,EAAKG,KAAO,KAAOH,EAAKG,KAAO,OACjCH,EAAKG,K7B7lBiB,K6BskBJ,IA0DhBG,EAAgBC,EA1DA,EA0BW6C,KAAKzF,aAA5BK,EA1BY,EA0BZA,SAAUoC,EA1BE,EA0BFA,SA2ClB,GAzCIgD,KAAKyM,UAA8B,QAAlB7P,EAAK6P,WACnBiJ,YAAYC,MACjB3V,KAAKyM,SAASoJ,OACZ7V,KAAKjE,OACL,CAAEnB,YACF,CACEnC,OACAmE,SAGC8Y,YAAYC,OAGf3V,KAAKuD,aACFmS,YAAYC,MACjB3V,KAAKuD,WAAWsS,OAAO7V,KAAKjE,OAAQ,CAAEnB,WAAUoC,YAAY,CAAEJ,SACzD8Y,YAAYC,OAKO,WAAtB/Y,EAAK8P,cACP1M,KAAK0M,aAAamJ,OAAO7V,KAAKjE,OAAQiE,KAAKzF,aAAamB,MAAO,CAC7DjD,OACAmE,SAIJqC,EAAiBe,KAAKzF,cAGH,SAAfqC,EAAKC,OACPK,EAAiB8C,KAAKzF,aAAaoE,mBACnCxB,EAAe6C,KAAKzF,aAAaqE,mBAEjC1B,EAAiB8C,KAAKzF,aAAauE,mBACnC3B,EAAe6C,KAAKzF,aAAawE,kBAK/BnC,EAAKkQ,eAAgB,CAClB9M,KAAK/D,UACR+D,KAAK/D,QAAUxB,SAASyB,eAAe,YAEpC8D,KAAK5D,WACR4D,KAAK5D,SAAW3B,SAASyB,eAAe,aAG1C8D,KAAKiX,kBAAkB8E,cACN,SAAfnf,EAAKC,MACDmD,KAAKzF,aAAasE,kBAClBmB,KAAKzF,aAAayE,kBACtB,CAAEpC,SAKJ,IAAK,IAAIpB,EAAI0B,EAAe4J,IAAKtL,GAAK2B,EAAa2J,IAAKtL,IAAK,CAC3D,IAAMsL,EAAM9G,KAAKzF,aAAaI,SAASa,GAEvCwE,KAAKiX,kBAAkB+E,UACrBhc,KAAK/D,QACL6K,EACA,CAAElM,WAAUoC,YACZ,CAAEJ,SAGN,IAAK,IAAIpB,EAAI0B,EAAeqK,KAAM/L,GAAK2B,EAAaoK,KAAM/L,IAAK,CAC7D,IAAM+L,EAAOvH,KAAKzF,aAAa4c,UAAU3b,GAEzCwE,KAAKiX,kBAAkBgF,WACrBjc,KAAK5D,SACLmL,EACA,CAAE3M,WAAUoC,YACZ,CAAEJ,SAGN7E,OAAOkf,kBAAoBjX,KAAKiX,kBAYlC,IANA,IAAMiF,EAAoB,WAATzjB,EAAoB,CAAC,EAAG,GAAK,CAAC,GACzC0jB,EAAuB,WAAT1jB,EAAoB,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAK,CAAC,EAAG,EAAG,GAK3D+C,EAAI2B,EAAaG,MAAO9B,GAAK0B,EAAeI,MAAO9B,IAAK,CAC/D,IAAMse,EAAa9Z,KAAKzF,aAAamC,OAAOlB,GAC5Cse,EAAWjE,OACT7V,KAAKjE,OACLiE,KAAKzF,aAAayI,MAClB,CAAEpI,WAAUoC,YACZ,CAAEJ,SAIN,IAhIoB,eAgIXpB,GACP,IAAMkC,EAAS,EAAKnD,aAAakC,QAAQjB,GACzC2gB,EAAYviB,SAAQ,SAAC0G,GACnB5C,EAAO0e,iBACL,EAAKrgB,OACL,CAAEnB,WAAUoC,YACZsD,EACA,CAAE1D,aAPCpB,EAAI2B,EAAaO,OAAQlC,GAAK0B,EAAeQ,OAAQlC,IAAM,EAA3DA,GAWT,IA3IoB,eA2IXA,GACP,IAAMkC,EAAS,EAAKnD,aAAakC,QAAQjB,GACzC0gB,EAAStiB,SAAQ,SAAC0G,GAChB5C,EAAO0e,iBACL,EAAKrgB,OACL,CAAEnB,WAAUoC,YACZsD,EACA,CAAE1D,aAPCpB,EAAI0B,EAAeQ,OAAQlC,GAAK2B,EAAaO,OAAQlC,IAAM,EAA3DA,GAYT,IAvJoB,eAuJXA,GACP,IAAMC,EAAQ,EAAKlB,aAAaiC,OAAOhB,GACvC2gB,EAAYviB,SAAQ,SAAC0G,GACnB7E,EAAM4gB,YAAY,EAAKtgB,OAAQ,CAAEnB,WAAUoC,YAAYsD,EAAc,CACnE1D,aAJGpB,EAAI2B,EAAa1B,MAAOD,GAAK0B,EAAezB,MAAOD,IAAM,EAAzDA,GAUT,IAjKoB,eAiKXA,GACP,IAAMC,EAAQ,EAAKlB,aAAaiC,OAAOhB,GACvC0gB,EAAStiB,SAAQ,SAAC0G,GAChB7E,EAAM4gB,YAAY,EAAKtgB,OAAQ,CAAEnB,WAAUoC,YAAYsD,EAAc,CACnE1D,aAJGpB,EAAI0B,EAAezB,MAAOD,GAAK2B,EAAa1B,MAAOD,IAAM,EAAzDA,GAgCT,IAAK,IAAI6E,IAjBiB,YAAtBzD,EAAK8P,cACP1M,KAAK0M,aAAamJ,OAAO7V,KAAKjE,OAAQiE,KAAKzF,aAAamB,MAAO,CAC7DjD,OACAmE,SAMF,CAAC,SAAU,SAAU,gBAAgB+F,SAAS/F,EAAKmE,aACnDnE,EAAKgQ,kBAEL5M,KAAK+Z,UAAUlE,OAAO7V,KAAKjE,OAAQ,CAAEtD,OAAMmE,SAIxC8Y,YAAYC,MACK3V,KAAKzF,aAAaoc,cAAe,CACrD,IAAM2F,EAActc,KAAKzF,aAAaoc,cAActW,GACpDic,EAAYtZ,QACRsZ,EAAYtZ,M7BhxBgB,U6BixBvBhD,KAAKzF,aAAaoc,cAActW,GAEvCic,EAAYzG,OAAO7V,KAAKjE,OAAQ,CAAEa,SAGjC8Y,YAAYC,MAwBjB3V,KAAKzF,aAAayI,QAEd6Y,IACF7b,KAAK0W,mBAAqB3e,OAAOmgB,sBAC/BlY,KAAKmY,SAASvG,KAAK5R,W,uCAMvBA,KAAKY,EAAEmQ,UAAY,QACnB/Q,KAAKY,EAAEoQ,SAAS,EAAG,EAAGhR,KAAKjE,OAAO8H,MAAO7D,KAAKjE,OAAOD,U,kCAKrDkE,KAAK6S,GAAGa,Y,gCAGR1T,KAAK6S,GAAGQ,U,mCAGR,OAAOrT,KAAK6S,GAAG0J,a,wDCl1BbrP,GAAe,CACnB7E,SAAU,IACVmU,MAAO,IACPC,UAAW,IACXC,OAAQ,IACRjU,UAAW,KAGPkU,GAAQ,CACZC,OAAQ,IACRC,OAAQ,KA0EKC,GAvEI,SAACC,GAAW,IACrBC,EAAkCD,EAAlCC,UAAWC,EAAuBF,EAAvBE,aAAcC,EAASH,EAATG,KACzB/hB,EAAiC+hB,EAAjC/hB,KAAMyO,EAA2BsT,EAA3BtT,WAAYnR,EAAeykB,EAAfzkB,KAAMmE,EAASsgB,EAATtgB,KAE1BugB,EAAWC,mBAJW,EAKEC,mBAAS,IALX,mBAKrBC,EALqB,KAKZC,EALY,KAa5B,GANAC,qBAAU,YACU,IAAdR,GACFO,EAAW,MAEZ,CAACP,KAEC7hB,EAAM,OAAO,KA2BlBgiB,EAASM,QAvBgB,WACvB,IAAMpS,EAAWuK,GAAS8H,cAEpB3Q,EAAS,CACb5R,KAAMA,EAAKyT,KACXhF,WAAYsD,GAAatD,GAAc+S,GAAMlkB,GAAQ,IACrD8T,KAAoB,QAAd3P,EAAK2P,KAAiB3P,EAAK2P,KAAO,GACxC1P,MAAOD,EAAKC,MAAMsI,WAAWwY,QAAQ,IAAK,IAC1CtS,SAAUpB,SAAoB,IAAXoB,IAGfuS,EAAW1e,OAAOC,KAAK4N,GAC1B1D,KAAI,SAACxP,GACJ,OAAsB,OAAlBkT,EAAOlT,IAA4C,qBAAlBkT,EAAOlT,GACnC,KAEH,GAAN,OAAUA,EAAV,YAAmBkT,EAAOlT,OAE3B2E,QAAO,SAAC3E,GAAD,OAAqB,OAAVA,KAClB6d,KAAK,KAER,OAAO5f,IAAkB,IAAM8lB,EAEdC,GAOnB,OACE,kBAACC,GAAA,EAAD,CACE1W,UAAU,aACV2W,KAAK,aACLC,KAAMhB,EACNiB,QAAS,kBAAMhB,GAAa,KAE5B,kBAACa,GAAA,EAAMI,OAAP,4BACA,kBAACJ,GAAA,EAAMK,QAAP,KACE,kBAACC,GAAA,EAAD,CACE5Z,KAAK,OACL4C,UAAU,kBACVjO,MAAOgkB,EAASM,QAChBxP,QAAM,GAEN,gCACA,kBAACoQ,GAAA,EAAD,CAAQC,QArBK,WACnBC,KAAKpB,EAASM,SACdF,EAAW,8BAmBL,SAEF,2BAAID,M,wOClFZ,IA8DekB,GA9DI,SAACzB,GAClB,IAAM0B,EAASrB,mBACTsB,EAAatB,mBAEbuB,EAAkBvB,mBAClBwB,EAAqBxB,mBAErByB,E,2WAAW,IAAQ9B,UAClB8B,EAAYP,QAOnBd,qBAAU,WACR,IAAMsB,EAAKL,EAAOhB,QAAQsB,IAAItB,QAC9BqB,EAAGE,oBAAoB,YAAaL,EAAgBlB,SAAS,GAC7DqB,EAAGE,oBAAoB,UAAWJ,EAAmBnB,SAAS,GAC9DqB,EAAGE,oBAAoB,aAAcJ,EAAmBnB,SAAS,GAEjEqB,EAAGE,oBAAoB,aAAcL,EAAgBlB,SAAS,GAC9DqB,EAAGE,oBAAoB,WAAYJ,EAAmBnB,SAAS,GAE/DkB,EAAgBlB,QAAUwB,EAC1BL,EAAmBnB,QAAUyB,EAE7BJ,EAAGnP,iBAAiB,YAAagP,EAAgBlB,SAAS,GAC1DqB,EAAGnP,iBAAiB,UAAWiP,EAAmBnB,SAAS,GAC3DqB,EAAGnP,iBAAiB,aAAciP,EAAmBnB,SAAS,GAE9DqB,EAAGnP,iBAAiB,aAAcgP,EAAgBlB,SAAS,GAC3DqB,EAAGnP,iBAAiB,WAAYiP,EAAmBnB,SAAS,KAC3D,CAACV,EAAMuB,UAEV,IAAMW,EAAe,SAACrP,GACpBA,EAAEC,iBACEkN,EAAMuB,SACRvB,EAAMuB,QAAQ1O,GAEhB8O,EAAWjB,QAAUvF,sBAAsBiH,EAAWvN,KAAK,KAAMhC,KAG7DsP,EAAkB,SAACtP,GACvBA,EAAEC,iBACFuI,qBAAqBsG,EAAWjB,UAG5B0B,EAAa,SAAbA,EAAcvP,GACdmN,EAAMuB,SACRvB,EAAMuB,QAAQ1O,GAEhB8O,EAAWjB,QAAUvF,sBAAsBiH,EAAWvN,KAAK,KAAMhC,KAGnE,OACE,kBAACyO,GAAA,EAAD,iBAAYQ,EAAZ,CAAyBE,IAAKN,IAC3B1B,EAAMqC,WCKEC,gBALS,SAACrR,GAEvB,MAAO,CAAE5S,MADS4S,EAAV5S,MACcgQ,cAGgB,KAAzBiU,EA1DM,SAACtC,GAAW,IACvB3hB,EAA+C2hB,EAA/C3hB,MAAOkkB,EAAwCvC,EAAxCuC,iBAAkBC,EAAsBxC,EAAtBwC,kBAgBjC,OACE,yBAAKnY,UAAU,iBACb,kBAAC,GAAD,CACEkX,QAAS,kBAAM1N,GAAY4O,OAAO,KAClCpY,UAAU,gBAEV,kBAACqY,GAAA,EAAD,CAAMC,KAAK,cAEb,kBAACrB,GAAA,EAAD,CACEC,QAvBa,WACbgB,IACuB,YAAvBvC,EAAM3hB,MAAM4P,OACd4F,GAAYyC,QAEZzC,GAAYkC,SAmBV6M,SAAUL,EACVlY,UAAU,gBAEV,kBAACqY,GAAA,EAAD,CAAMC,KAAuB,YAAjBtkB,EAAM4P,OAAuB,QAAU,UAErD,kBAACqT,GAAA,EAAD,CAAQC,QApBI,WACVgB,GACJ1O,GAAYrJ,QAkBgBH,UAAU,gBAClC,kBAACqY,GAAA,EAAD,CAAMC,KAAK,UAEb,kBAAC,GAAD,CACEpB,QAAS,kBAAM1N,GAAYgP,UAAU,KACrCxY,UAAU,gBAEV,kBAACqY,GAAA,EAAD,CAAMC,KAAK,aAGb,kBAACrB,GAAA,EAAD,CACEC,QAAS,kBAAMiB,GAAkB,IACjCnY,UAAU,yBACVuY,SAA2B,YAAjBvkB,EAAM4P,QAEhB,kBAACyU,GAAA,EAAD,CAAMC,KAAK,sBCPJL,gBATS,SAACrR,GAAW,IAC1BW,EAAeX,EAAfW,WACR,MAAO,CACLkR,aAAclR,EAAWxT,KACzB2kB,mBAAoBnR,EAAW/E,WAC/BmW,aAAcpR,EAAWlW,QAIW,KAAzB4mB,EAzCE,SAACtC,GAAW,IACnB8C,EAAmD9C,EAAnD8C,aAAcC,EAAqC/C,EAArC+C,mBAAoBC,EAAiBhD,EAAjBgD,aAC1C,OACE,yBAAK3Y,UAAU,iBACb,yBAAKA,UAAU,oBACZyY,GACC,oCACE,yBAAKzY,UAAU,cAAcyY,EAAa1N,OAC1C,yBAAK/K,UAAU,eAAeyY,EAAaG,UAIjD,yBAAK5Y,UAAU,qBACZyY,GACC,oCACE,yBAAKzY,UAAU,mBAAmB0Y,GAClC,yBAAK1Y,UAAU,cAEXyY,EAAaI,OACM,WAAjBF,EACIloB,EAAgBO,QAAQ0nB,GAAsB,EAC9CloB,EAAgBQ,QAAQ0nB,WCuG/BT,eAAQ,MAPI,SAACpU,GAC1B,MAAO,CACLO,WAAY,SAAC5O,GAAD,OAAUqO,EAASO,GAAW5O,KAC1CsjB,sBAAuB,SAAC9R,GAAD,OAAUnD,GlBpHCC,EkBoH8BkD,ElBpHlB,SAACnD,GACjDA,EAAS,CACPzG,KAXoC,2BAYpC0G,eAHiC,IAACA,MkBwHvBmU,EAzHI,SAACtC,GAAW,IACrBhhB,EAAoDghB,EAApDhhB,OAAQa,EAA4CmgB,EAA5CngB,KAAM4O,EAAsCuR,EAAtCvR,WAAY0U,EAA0BnD,EAA1BmD,sBAE5BC,EAAc/C,mBAEdgD,EAAwB,SAACxQ,GAG7B,IAAkB,KAAdA,EAAEyQ,SAAgC,KAAdzQ,EAAEyQ,WAExBzQ,EAAEC,iBAIC,CAAC,SAAU,SAAU,gBAAgBlN,SAAS/F,EAAKmE,aAAxD,CATmC,IAkB7Buf,EAAsB,CAAC,EAAG,EAAG,GAE7BC,EAA2B,YAJd3jB,EAAXkE,QAIsC,EAAI,EAGlD,GAAkB,KAAd8O,EAAEyQ,QACJ,OAAQzjB,EAAKmE,YACX,IAAK,SACHuf,EAAoB,IlC/BM,EkC+BuBC,EACjD,MACF,IAAK,SACHD,EAAoB,IlClCM,EkCkCuBC,EACjD,MACF,IAAK,eACHD,EAAoB,IlCrCM,OkC4C3B,GAAkB,KAAd1Q,EAAEyQ,QACT,OAAQzjB,EAAKmE,YACX,IAAK,SACHuf,EAAoB,IlC/CM,EkC+CuBC,EACjD,MACF,IAAK,SACHD,EAAoB,IlClDM,EkCkDuBC,EACjD,MACF,IAAK,eACHD,EAAoB,IlCrDM,EkC4DhCJ,EAAsB,CACpB9R,KAAMkS,EACNjS,aAActS,EAAOD,WAoBzB,OAJA0hB,qBAAU,WALR/iB,SAASukB,oBAAoB,UAAWmB,EAAY1C,SACpD0C,EAAY1C,QAAU2C,EACtB3lB,SAASkV,iBAAiB,UAAWwQ,EAAY1C,WAKhD,CAAC7gB,EAAKmE,WAAYnE,EAAKkE,OAAQlE,EAAKmL,gBAAiBhM,IAGtD,yBAAKqL,UAAU,yBACb,kBAAC,GAAD,CACEA,UAAU,qBACVkX,QAAS,SAAC1O,GACRA,EAAEyQ,QAAU,GACZD,EAAsBxQ,KAGxB,yBAAKhQ,IAAKxG,EAAa,6BAEzB,kBAACilB,GAAA,EAAD,CACEjX,UAAU,gBACVkX,QAAS,SAAC1O,IA7BQ,SAACA,GACvBA,EAAEC,iBAD2B,IAErBjD,EAAqBhQ,EAArBgQ,iBACRpB,EAAW,CAAEoB,kBAAmBA,IA2B1B4T,CAAgB5Q,KAGlB,yBAAKhQ,IAAKxG,EAAa,wBAEzB,kBAAC,GAAD,CACEgO,UAAU,qBACVkX,QAAS,SAAC1O,GACRA,EAAEyQ,QAAU,GACZD,EAAsBxQ,KAGxB,yBAAKhQ,IAAKxG,EAAa,iCC7FhBimB,gBALS,SAACrR,GAEvB,MAAO,CAAEpR,KADoBoR,EAArBpR,KACO+R,WADcX,EAAfW,cAIwB,KAAzB0Q,EArBI,SAACtC,GAAW,IACrBngB,EAAqBmgB,EAArBngB,KAAqBmgB,EAAfpO,WAEd,OACE,yBAAKvH,UAAS,eACXxK,EAAKkQ,gBAAkB,yBAAK2F,GAAG,YAChC,yBAAKrL,UAAS,0BACZ,yBAAKA,UAAU,uBACb,yBAAKA,UAAU,sBAAf,OACA,yBAAKA,UAAU,4BCMViY,gBALS,SAACrR,GAEvB,MAAO,CAAEpR,KADoBoR,EAArBpR,KACO+R,WADcX,EAAfW,cAIwB,KAAzB0Q,EAfK,SAACtC,GAAW,IACtBngB,EAAqBmgB,EAArBngB,KAAqBmgB,EAAfpO,WAEd,OACE,yBAAKvH,UAAS,gBACXxK,EAAKkQ,gBAAkB,yBAAK2F,GAAG,iBCiRvB4M,gBAfS,SAACrR,GAAW,IAC1BpR,EAA6BoR,EAA7BpR,KAAM+R,EAAuBX,EAAvBW,WAAYH,EAAWR,EAAXQ,OAC1B,MAAO,CACL5R,OACAijB,aAAclR,EAAWxT,KACzB2kB,mBAAoBnR,EAAW/E,WAC/BmW,aAAcpR,EAAWlW,KACzB+V,aAIuB,SAACvD,GAC1B,MAAO,KAGMoU,EAxQG,SAACtC,GAAW,IAE1B+C,EASE/C,EATF+C,mBACAC,EAQEhD,EARFgD,aACAF,EAOE9C,EAPF8C,aACAlX,EAMEoU,EANFpU,GACA/L,EAKEmgB,EALFngB,KACA4R,EAIEuO,EAJFvO,OACAiS,EAGE1D,EAHF0D,aACAC,EAEE3D,EAFF2D,WACAC,EACE5D,EADF4D,cAVyB,EAaCtD,mBAAS,MAbV,mBAapBthB,EAboB,KAaZ6kB,EAbY,OAciBvD,oBAAS,GAd1B,mBAcpBwD,EAdoB,KAcJtB,EAdI,KAerBuB,EAAY1D,mBACZ2D,EAAkB3D,mBAClB4D,EAAqB5D,mBAErB6D,EClCmB,SAAC9nB,GAC1B,IAAM4lB,EAAM3B,mBAIZ,OAHAI,qBAAU,WACRuB,EAAItB,QAAUtkB,KAET4lB,EAAItB,SAAWtkB,ED6BJ+nB,CAAY,CAC5BnlB,SACA4M,KACAmX,qBACAC,eACAnjB,SAIF4gB,qBAAU,WACRsD,EAAUrD,QAAUhjB,SAASC,cAAc,cAC3CkmB,EAAUE,EAAUrD,SAEpB7H,GAASuL,eACR,IAIH3D,qBAAU,WACHzhB,GAAWglB,EAAgBtD,SAChC2D,MACC,CAACrlB,EAAQgkB,EAAcvR,IAE1B,IAAM4S,EAAkB,WACtB,GAAqB,WAAjBrB,EACFe,EAAUrD,QAAQ5Z,MAAQ,IAC1Bid,EAAUrD,QAAQxW,MAAMC,UAAY,OACpC4Z,EAAUrD,QAAQxW,MAAMmJ,KAAO,EAC/B0Q,EAAUrD,QAAQxW,MAAMoa,IAAM,EAG9BP,EAAUrD,QAAQxW,MAAMqa,SAAW,SACnCnN,YAAW,WACT2M,EAAUrD,QAAQxW,MAAMqa,SAAW,mBAEhC,GAAqB,WAAjBvB,EAA2B,CACpCe,EAAUrD,QAAQ5Z,MAAQ,IAE1B,IAAM0d,EAAUR,EAAgBtD,QAAQjN,wBAExC,GAAI+Q,EAAQ1d,MAAQ,IAAK,CACvB,IAAM2d,EAAcD,EAAQ1d,MAAQid,EAAUrD,QAAQ5Z,MAChD4d,GAAWX,EAAUrD,QAAQ5Z,MAAQ0d,EAAQ1d,OAAS,EACtD6d,EAAUD,GAAW,EAAI,GAC/BX,EAAUrD,QAAQxW,MAAMC,UAAxB,gBAA6Csa,EAA7C,qBACAV,EAAUrD,QAAQxW,MAAMqa,SAAW,WACnCR,EAAUrD,QAAQxW,MAAMmJ,KAAxB,WAAmCqR,EAAnC,MACAX,EAAUrD,QAAQxW,MAAMoa,IAAxB,WAAkCK,EAAlC,WAEAZ,EAAUrD,QAAQxW,MAAMC,UAAY,OACpC4Z,EAAUrD,QAAQxW,MAAMmJ,KAAO,EAC/B0Q,EAAUrD,QAAQxW,MAAMoa,IAAM,EAE9BP,EAAUrD,QAAQxW,MAAMqa,SAAW,SACnCnN,YAAW,WACT2M,EAAUrD,QAAQxW,MAAMqa,SAAW,cAKrCZ,GACFA,EAAW3J,kBAKfyG,qBAAU,WACR,IAAMmE,EAAe,CAAE5lB,SAAQ4M,KAAImX,qBAAoBC,eAAcnjB,QAErE,GAAKb,EAAL,CAEA,IAAMwa,EAAc,CAClB9d,KAAMsnB,EACNnW,WAAYkW,EACZljB,QAGFsC,OAAOC,KAAKwiB,GAAc/nB,SAAQ,SAACgoB,GACjC,GAAIX,EAAUW,KAAWD,EAAaC,GAEpC,GAAc,WAAVA,QACG,GAAc,OAAVA,EAAgB,CAQzB,IAAM/Y,EAAcgX,EAAagC,OAAS,MAAQ,KAI9CnB,IACFA,EAAW5E,QAAS,GAGtB,IAAIgG,EAAK,IAAIxL,GAAWva,EAAQ4M,EAAIE,EAAa0N,GACjDuL,EAAG7J,UACH0I,EAAcmB,OACK,SAAVF,EACT1iB,OAAOC,KAAK8hB,EAAUrkB,MAAMhD,SAAQ,SAACqT,GACnC,IAAM8U,EAAOlW,KAAKM,UAAU8U,EAAUrkB,KAAKqQ,IACrC+U,EAAOnW,KAAKM,UAAUwV,EAAa/kB,KAAKqQ,IAG1CyT,GAFeqB,IAASC,IAGd,mBAAR/U,IACEyT,EAAWzJ,mBACbyJ,EAAWzJ,kBAAkBC,cAE/BwJ,EAAWzkB,QAAU0lB,EAAa/kB,KAAKqQ,GACnCxS,SAASyB,eAAe,WACxB,KACJwkB,EAAWtkB,SAAWulB,EAAa/kB,KAAKqQ,GACpCxS,SAASyB,eAAe,YACxB,MAGF,CAAC,OAAQ,WAAWyG,SAASsK,GAC/ByT,EAAW1J,WAAWT,GAGlBmK,EAAWuB,cACbvB,EAAW3J,qBAWf2J,GACFA,EAAW1J,WAAWT,MAM1BmK,GACFA,EAAWwB,2BAA2B,CAAEtlB,YAEzC,CAACb,EAAQ4M,EAAImX,EAAoBC,EAAcnjB,IAElD,IAAMulB,EAAc,CAClBhnB,KAAM0kB,EACNjW,WAAYkW,EACZrnB,KAAMsnB,EACNnjB,QAGF,OACE,yBACEwK,UAAS,iCACe,UAAtBoH,EAAOX,WAAyB,SAAW,KAG7C,yBAAKzG,UAAU,oCACb,yBACEA,UAAS,2BAAsB2Y,EAAtB,YAAsCnjB,EAAKkE,QACpDie,IAAKgC,GAEL,yBAAK3Z,UAAU,qBACZsZ,GACC,kBAAC,GAAD,CAAY/lB,SAAU+lB,EAAWnmB,aAAaI,WAEhD,yBAAKyM,UAAU,kBACb,4BAAQqL,GAAG,YAAY5O,MAAM,MAAM/H,OAAO,QAC1C,yBACEsL,UAAS,+BAA0B2Y,EAA1B,YACPU,EAAe,UAAY,GADpB,KAGT1B,IAAKiC,GAEJnB,GACC,yBACEzY,UAAU,uBACVxH,IAAKvG,EAAc,GAAD,OAAIwmB,EAAajR,KAAjB,WAGtB,yBAAKxH,UAAU,yBAAf,qBAEDyY,IACEY,GACD,CAAC,SAAU,SAAU,gBAAgB9d,SACnC/F,EAAKmE,aACF,kBAAC,GAAD,CAAYnE,KAAMA,EAAMb,OAAQA,KAExC2kB,GACC,kBAAC,GAAD,CAAavJ,UAAWuJ,EAAWnmB,aAAa4c,cAItD,yBAAK/P,UAAU,sBACb,yBAAKA,UAAU,oBACb,4BAAQqL,GAAG,aACVhZ,EAAa4R,SACZ,yBACEjE,UAAU,wBACVkX,QAAS1I,GAASwM,kBAAkBxQ,KAAKgE,IACzCyM,aAAczM,GAASwM,kBAAkBxQ,KAAKgE,KAE9C,yBAAKxO,UAAU,mBAEf,OAIR,yBAAKA,UAAU,OACb,kBAAC,GAAD,CACEkY,kBAAmBoB,GAAcD,EACjClB,kBAAmBA,KAGvB,yBAAKnY,UAAU,OACb,kBAAC,GAAD,OAEF,kBAAC,GAAD,CACE4V,UAAW6D,EACX5D,aAAcsC,EACdrC,KAAMiF,S,oBExPHG,GAAuB,SAACnnB,EAAMyO,EAAYnR,GACrD,IAAMyU,EAAwB,WAATzU,EAAoBZ,EAAkBD,EACrDqoB,EACK,WAATxnB,EAAoB0C,EAAK8kB,OAAO9nB,MAAM,EAAG,GAAKgD,EAAK8kB,OAAO9nB,MAAM,EAAG,GAErE,GAAI,CAAC,YAAa,SAAU,aAAawK,SAASiH,IAChD,IAAK,IAAIpO,EAAI0R,EAAarS,OAAS,EAAGW,GAAK,EAAGA,IAC5C,GAAIykB,EAAOzkB,GACT,OAAO0R,EAAa1R,QAGnB,GAAI,CAAC,WAAY,SAASmH,SAASiH,GACxC,IAAK,IAAIpO,EAAI,EAAGA,GAAK0R,EAAarS,OAAS,EAAGW,IAC5C,GAAIykB,EAAOzkB,GACT,OAAO0R,EAAa1R,ICwFb+mB,GA3GE,SAACxF,GAAW,IAEzByF,EAMEzF,EANFyF,eACAC,EAKE1F,EALF0F,aACAC,EAIE3F,EAJF2F,mBACA3C,EAGEhD,EAHFgD,aACA4C,EAEE5F,EAFF4F,yBACAC,EACE7F,EADF6F,gBAGEC,EAAQL,EA6DNM,EAAa,SAAC3nB,GAClB,OACE,yBACEiM,UAAU,mBACVtN,IAAG,mBAAcqB,EAAKyT,MACtB0P,QAAS,kBAhEI,SAACnjB,GAClBsnB,EAAatnB,EAAKyT,MA+DCd,CAAW3S,KAE1B,yBACEiM,UAAS,mBACPsb,IAAuBvnB,EAAKyT,KAAO,WAAa,KAGlD,yBAAKxH,UAAU,uBACb,yBACEA,UAAU,cACVxH,IAAKvG,EAAc,GAAD,OAAI8B,EAAKyT,KAAT,SAClBuD,MAAOhX,EAAKgX,MACZ4Q,IAAK5nB,EAAKgX,SAGd,yBAAK/K,UAAU,sBA3EC,SAACjM,GACvB,IAAI8kB,EAAS,GACQ,WAAjBF,EAA2BE,EAAS9kB,EAAK8kB,OAAO9nB,MAAM,EAAG,GACnC,WAAjB4nB,IACPE,EAAM,CAAI,MAAJ,mBAAa9kB,EAAK8kB,OAAO9nB,MAAM,EAAG,MAE1C,IAAM6qB,EAAcJ,EAAgB/Y,MAC9BoZ,EAAmBL,EAAgBhZ,WAGzC,GAAyB,QAArBqZ,GAA8C,QAAhBD,EAAuB,CACvD,IAAME,EAAkB,CAAC,KAAM,KAAM,KAAM,KAAM,MAC3CC,EAAgBvrB,EAAgBQ,QAAQuqB,GAC9C,GAAI1C,EAAOkD,GACTD,EAAgBC,GAAiBlD,EAAOkD,OACnC,CACL,IAAMC,EAAcd,GAClBnnB,EACAwnB,EACA5C,GAEIsD,EAAiBzrB,EAAgBQ,QAAQgrB,GAC/CF,EAAgBG,GAAkBpD,EAAOoD,GAE3CpD,EAASiD,OAETjD,EAAOrmB,SAAQ,SAACiQ,EAAOrO,GACrB,GAAKqO,EAAL,CACA,IAAMD,EAAahS,EAAgB4D,GAEV,QAArBynB,EACEpZ,IAAUmZ,IAAa/C,EAAOzkB,GAAK,MAKnCoO,IAAeqZ,IAAkBhD,EAAOzkB,GAAK,UAKvD,OAAOykB,EAAO5W,KAAI,SAACQ,EAAOrO,GACxB,IAAKqO,EAAO,OAAO,KACnB,IAAMD,EAAahS,EAAgB4D,GACnC,OACE,yBACE1B,IAAG,UAAKqB,EAAKyT,KAAV,YAAkBhF,GACrBxC,UAAS,qBAAgBwC,IAExBC,MA0BoCyZ,CAAgBnoB,IACrD,yBAAKiM,UAAU,kBAAkBjM,EAAKgX,UAM9C,OACE,yBAAK/K,UAAU,YACZyb,EAAMxZ,KAAI,SAAClO,GACV,OAAO2nB,EAAW3nB,QCvGXooB,GAJG,CAChBC,kBAAmB,KACnBC,yBAAyB,GCqDZC,GArDM,SAAC3G,GAAW,IACvB4G,EAAsC5G,EAAtC4G,QAASC,EAA6B7G,EAA7B6G,QAASzqB,EAAoB4jB,EAApB5jB,MAAOwmB,EAAa5C,EAAb4C,SAiB3BkE,EAAe,SAACC,IAChBnE,GAAamE,GAAkC,qBAAjBA,EAAO3qB,OACzC4jB,EAAMgH,SAASD,EAAO3qB,QAUxB,OACE,yBAAKiO,UAAS,+BAA0BuY,EAAW,WAAa,KAC9D,2BACEvY,UAAS,+BACPjO,IAAUwqB,EAAQxqB,MAAQ,WAAa,IAEzCmlB,QAAS,kBAAMuF,EAAaF,KAE3BA,EAAQvpB,MAEX,yBAAKgN,UAjBkB,WACzB,IAAIA,EAAY,eAGhB,OAFIjO,IAAUwqB,EAAQxqB,MAAOiO,GAAS,QAC7BjO,IAAUyqB,EAAQzqB,QAAOiO,GAAS,UACpCA,EAaW4c,GAAsB1F,QArCrB,YACfqB,GAAagE,GAAYC,IAEzBzqB,IAAUwqB,EAAQxqB,MACpB4jB,EAAMgH,SAASH,EAAQzqB,QACJyqB,EAAQzqB,MAC3B4jB,EAAMgH,SAASJ,EAAQxqB,YAgCvB,2BACEiO,UAAS,+BACPjO,IAAUyqB,EAAQzqB,MAAQ,WAAa,IAEzCmlB,QAAS,kBAAMuF,EAAaD,KAE3BA,EAAQxpB,QC1CJ6pB,GAAmB,CAC9B,CAAEnqB,IAAK,YAAaX,MAAO,MAAOiB,KAAM,QACxC8pB,O3CiD8B,CAC9B,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,SACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,O2CrFiB7a,KAAI,SAAC8a,GACpB,MAAO,CAAErqB,IAAI,SAAD,OAAWqqB,GAAUhrB,MAAOgrB,EAAQ/pB,KAAM+pB,OAI7CC,GAAqB,CAChC,CAAEtqB,IAAK,cAAeX,MAAO,MAAOiB,KAAM,QAC1C8pB,O3CY0B,CAC1B,UACA,aACA,aACA,aACA,aACA,SACA,UACA,cACA,gBACA,kBACA,QACA,SACA,mBACA,aACA,aACA,QACA,W2C5Ba7a,KAAI,SAACgb,EAAa3J,GAC7B,MAAO,CAAE5gB,IAAI,WAAD,OAAa4gB,GAAOvhB,MAAOuhB,EAAKtgB,KAAMiqB,MACjDzK,WAGQ0K,GAAmB,CAC9B,CAAExqB,IAAK,YAAaX,MAAO,MAAOiB,KAAM,QACxC8pB,O3CyEoB,CACpB,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,EACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,GACA,I2C3FO7a,KAAI,SAACQ,GACV,MAAO,CAAE/P,IAAI,SAAD,OAAW+P,GAAS1Q,MAAO0Q,EAAOzP,KAAMyP,OAI3C0a,GAAwB,CACnC,CAAEzqB,IAAK,iBAAkBX,MAAO,MAAOiB,KAAM,QAC7C8pB,OACAtsB,EAAgByR,KAAI,SAACO,GACnB,MAAO,CACL9P,IAAI,cAAD,OAAgB8P,GACnBzQ,MAAOyQ,EACPxP,KAAMwP,OCtCZ,SAAS4a,KAA2Q,OAA9PA,GAAWtlB,OAAOulB,QAAU,SAAUhW,GAAU,IAAK,IAAIjT,EAAI,EAAGA,EAAIkpB,UAAU7pB,OAAQW,IAAK,CAAE,IAAImpB,EAASD,UAAUlpB,GAAI,IAAK,IAAI1B,KAAO6qB,EAAczlB,OAAO0lB,UAAUC,eAAeC,KAAKH,EAAQ7qB,KAAQ2U,EAAO3U,GAAO6qB,EAAO7qB,IAAY,OAAO2U,IAA2BsW,MAAM/kB,KAAM0kB,WAEhT,SAASM,GAAyBL,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkE7qB,EAAK0B,EAAnEiT,EAEzF,SAAuCkW,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2D7qB,EAAK0B,EAA5DiT,EAAS,GAAQyW,EAAahmB,OAAOC,KAAKwlB,GAAqB,IAAKnpB,EAAI,EAAGA,EAAI0pB,EAAWrqB,OAAQW,IAAO1B,EAAMorB,EAAW1pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,IAAa2U,EAAO3U,GAAO6qB,EAAO7qB,IAAQ,OAAO2U,EAFxM0W,CAA8BR,EAAQM,GAAuB,GAAI/lB,OAAOkmB,sBAAuB,CAAE,IAAIC,EAAmBnmB,OAAOkmB,sBAAsBT,GAAS,IAAKnpB,EAAI,EAAGA,EAAI6pB,EAAiBxqB,OAAQW,IAAO1B,EAAMurB,EAAiB7pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,GAAkBoF,OAAO0lB,UAAUU,qBAAqBR,KAAKH,EAAQ7qB,KAAgB2U,EAAO3U,GAAO6qB,EAAO7qB,IAAU,OAAO2U,EAMne,IAAI,GAEJ,IAAMtH,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,mFAGD,GAEJ,IAAMpe,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,kFAGDC,GAEJ,IAAMre,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,oFAGD,GAEJ,IAAMpe,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,uFAGDE,GAEJ,IAAMte,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,sFAGDG,GAEJ,IAAMve,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,uFAGDI,GAEJ,IAAMxe,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,oFAGDK,GAEJ,IAAMze,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,sFAGDM,GAEJ,IAAM1e,cAAc,OAAQ,CAC1BsL,GAAI,SACJ,YAAa,SACb8S,EAAG,sFAGD,GAAe,SAAsBO,GACvC,IAAIC,EAASD,EAAKC,OACd5T,EAAQ2T,EAAK3T,MACb4K,EAAQiI,GAAyBc,EAAM,CAAC,SAAU,UAEtD,OAAO,IAAM3e,cAAc,MAAOqd,GAAS,CACzC/R,GAAI,YACJ,YAAa,UACbuT,QAAS,eACTjH,IAAKgH,GACJhJ,GAAQ5K,EAAQ,IAAMhL,cAAc,QAAS,KAAMgL,GAAS,KAAM,GAAO,GAAOqT,GAAO,GAAOC,GAAOC,GAAOC,GAAOC,GAAOC,KAG3HI,GAAa,IAAMC,YAAW,SAAUnJ,EAAOgC,GACjD,OAAO,IAAM5X,cAAc,GAAcqd,GAAS,CAChDuB,OAAQhH,GACPhC,OAEU,I,+NCtEf,IAAM/P,GAAevB,KAygBN4T,gBAlBS,SAACrR,GAAW,IAC1B5S,EAA8B4S,EAA9B5S,MAAOuT,EAAuBX,EAAvBW,WAAYH,EAAWR,EAAXQ,OAE3B,MAAO,CACLlD,aAFuBlQ,EAAjBkQ,aAGNwU,mBAAoBnR,EAAW/E,WAC/BmW,aAAcpR,EAAWlW,KACzB0tB,aAAcxX,EAAWxT,KACzB0S,WAAYW,EAAOX,eAII,SAAC5C,GAC1B,MAAO,CACL6C,WAAY,SAAC3S,GAAD,OAAU8P,EAAS+K,GAAmB7a,QAIvCkkB,EAvgBE,SAACtC,GAAW,IACnBqJ,EAAgErJ,EAAhEqJ,YAAatG,EAAmD/C,EAAnD+C,mBAAoBC,EAA+BhD,EAA/BgD,aAAczU,EAAiByR,EAAjBzR,aACjD+a,EAAoBjJ,mBAEpBkJ,EAAiBF,EAAY/c,KAAI,SAAClO,GACtC,MAAO,CAAErB,IAAKqB,EAAKyT,KAAMzV,MAAOgC,EAAKyT,KAAMxU,KAAMe,EAAKgX,UAL9B,EAQ0BkL,mBAAS,MARnC,mBAQnBqF,EARmB,KAQC6D,EARD,OASsClJ,mBAC9DyC,GAVwB,mBASnB6C,EATmB,KASO6D,EATP,OAYsBnJ,oBAAS,GAZ/B,mBAYDoJ,GAZC,aAcoBpJ,mBAC5CrQ,GAAa0Z,SAAW,CACtBvU,MAAO,MACPwU,QAAS,GACT9c,MAAO,MACPD,WAAY,QAnBU,mBAcnBgZ,EAdmB,KAcFgE,EAdE,KAuBpBC,EAAwB,SAACC,GAC7B,IAAMJ,E,2WAAO,IAAQ9D,EAAR,GAA4BkE,GACzC9a,GAAmB,CAAE0a,YACrBE,EAAmBF,IA1BK,EA6BkBrJ,mBAAS,IA7B3B,mBA6BnBmF,EA7BmB,KA6BHuE,EA7BG,KAgC1BvJ,qBAAU,WAAO,IACPrL,EAAsCyQ,EAAtCzQ,MAAOwU,EAA+B/D,EAA/B+D,QAAS9c,EAAsB+Y,EAAtB/Y,MAAOD,EAAegZ,EAAfhZ,WAEzBiZ,EAAQuD,EACX5nB,QAAO,SAACrD,GACP,IAAM6rB,EAAc7rB,EAAK8kB,OAAO9nB,MAAM,EAAG,GACnC8uB,EAAc9rB,EAAK8kB,OAAO9nB,MAAM,EAAG,GACzC,OAEa,QAAVga,GAAmBA,IAAUhX,EAAK+rB,WAEtB,QAAZP,GAAqBA,IAAY1c,SAAS9O,EAAKwrB,YAGpC,QAAV9c,GACiB,WAAjBkW,GACAiH,EAAYG,MAAK,SAACtd,GAAD,QAAaA,MACnB,QAAVA,GACkB,WAAjBkW,GACAkH,EAAYE,MAAK,SAACtd,GAAD,QAAaA,MACd,WAAjBkW,GACC5kB,EAAK8kB,OAAO9nB,MAAM,EAAG,GAAGwK,SAASkH,IACjB,WAAjBkW,GACC5kB,EAAK8kB,OAAO9nB,MAAM,EAAG,GAAGwK,SAASkH,OAGxCrL,QAAO,SAACrD,GAEP,GAAmB,QAAfyO,EAEF,GAAc,QAAVC,EAAiB,CACnB,GAAqB,WAAjBkW,EACF,OAA4D,OAArD5kB,EAAK8kB,OAAOroB,EAAgBQ,QAAQwR,IACtC,GAAqB,WAAjBmW,EACT,OAC2D,OAAzD5kB,EAAK8kB,OAAOpoB,EAAgBO,QAAQwR,GAAc,OAKnD,CACH,GAAqB,WAAjBmW,EACF,OAAO5kB,EAAK8kB,OAAOroB,EAAgBQ,QAAQwR,MAAiBC,EACvD,GAAqB,WAAjBkW,EACT,OACE5kB,EAAK8kB,OAAOpoB,EAAgBO,QAAQwR,GAAc,KAAOC,EAKjE,OAAO1O,KAGX4rB,EAAkBlE,GAClBwD,EAAkB5I,QAAQ2J,UAAY,IACrC,CAACxE,EAAiB7C,IAvFK,MA2Fc1C,mBAAS,MA3FvB,mBA2FnBwC,EA3FmB,KA2FLwH,EA3FK,KA6G1B7J,qBAAU,WAMR/iB,SAAS7B,KAAK0uB,QAIV7tB,EAAa0B,KACfsnB,EAAahpB,EAAa0B,KAAM,CAAEosB,kBAAkB,IAG7Cva,GAAa7R,KACpBsnB,EAAazV,GAAa7R,MAI1BsnB,EAAa,oCAEfgE,GAAoB,KACnB,IAEHjJ,qBAAU,WACR,GAAIkF,EAAoB,CACtB,IAAMvnB,EAAOirB,EAAY5O,MAAK,SAACrc,GAAD,OAAUA,EAAKyT,OAAS8T,KACtD2E,EAAgBlsB,GAChByV,GAAY0D,iBAAiBnZ,MAE9B,CAACunB,IAEJ,IAAMD,EAAY,uCAAG,WAAOxM,GAAP,2CAAA1d,EAAA,6DAAewU,EAAf,+BAAwB,GAC3C6D,GAAY4W,kBACR3H,IACFjP,GAAY6W,gBAAgB5H,EAAajR,MACzC5S,KAGFuqB,EAAsBtQ,GAEhB9a,EAAOirB,EAAY5O,MAAK,SAACrc,GAAD,OAAUA,EAAKyT,OAASqH,KAElDjE,EAAkB,EAGjB+K,EAAMoJ,eACTnU,EAAkB5F,MAGhB3S,EAAa0B,OAAS8a,GAAUxc,EAAa4R,SAC/C2G,EAAkBvY,EAAa4R,SAAW,IAG1C5R,EAAa4R,SAAW,EAtBP,UA0Bb0R,EAAM0F,aAAatnB,EAAM6W,GA1BZ,WA6BfuR,GAAUC,oBAAsBroB,EAAKgX,MA7BtB,sDAiCbuV,EAA0B,WAC9B,IAGIC,EAHEC,EAA0BhwB,EAAgBQ,QAC9CuqB,GAIAgF,EADExsB,EAAK8kB,OAAO2H,GACOjF,EAEAL,GACnBnnB,EACAwnB,EACA5C,GAGJhD,EAAM8K,mBAAmBF,IAQC,QAA1B/E,EAAgB/Y,OACe,QAA/B+Y,EAAgBhZ,WAxDC,iBA4DjB8d,IA5DiB,2BAiES,QAA1B9E,EAAgB/Y,OACe,QAA/B+Y,EAAgBhZ,WAlEC,sBAoEXqW,EACa,WAAjBF,EACI5kB,EAAK8kB,OAAO9nB,MAAM,EAAG,GACrBgD,EAAK8kB,OAAO9nB,MAAM,EAAG,IAGhBwK,SAASigB,EAAgB/Y,OA1EnB,iBA2ENrO,EAAI,EA3EE,aA2ECA,EAAIykB,EAAOplB,QA3EZ,oBA4EColB,EAAOzkB,KACPonB,EAAgB/Y,MA7EjB,wBA8ELqD,EACa,WAAjB6S,EAA4BloB,EAAkBD,EAChDmlB,EAAM8K,mBAAmB3a,EAAa1R,IAhF3B,6BA2EoBA,IA3EpB,gDAwFfksB,IAxFe,gCA8Fc,QAA/B9E,EAAgBhZ,YACU,QAA1BgZ,EAAgB/Y,OAEZsZ,EAAgBvrB,EAAgBQ,QAAQwqB,EAAgBhZ,YACvC,WAAjBmW,IAA2BoD,GAAiB,GAGN,kBAA/BhoB,EAAK8kB,OAAOkD,GACrBpG,EAAM8K,mBAAmBjF,EAAgBhZ,YAKzC8d,KAO6B,QAA/B9E,EAAgBhZ,YACU,QAA1BgZ,EAAgB/Y,QAEZsZ,EAAgBvrB,EAAgBQ,QAAQwqB,EAAgBhZ,YACvC,WAAjBmW,IAA2BoD,GAAiB,GAE5ChoB,EAAK8kB,OAAOkD,KAAmBP,EAAgB/Y,MACjDkT,EAAM8K,mBAAmBjF,EAAgBhZ,YAEzC8d,KA3He,QAkId3a,EAAOwa,kBACVxvB,OAAO+vB,QAAQC,UAAU,KAAM,KAAM,KAnIpB,4CAAH,sDAsNlB,OACE,yBACE3gB,UAAS,gCACc,SAArB2V,EAAMlP,WAAwB,SAAW,KAI1CgS,GACC,kBAACmI,GAAA,EAAD,KACE,+BAAQnI,EAAa1N,MAArB,eACA,0BACE8V,SAAS,WACTC,QAAO,UAAKrI,EAAa1N,MAAlB,kBAKb,yBAAK/K,UAAU,gBACb,0BAAMA,UAAU,YACd,yBAAKA,UAAU,sBACb,yBAAKA,UAAU,gBACb,yBACEA,UAAS,sCACiB,YAAxBkE,EAAaN,OAAuB,UAAY,KAGlD,yBAAK5D,UAAU,+BACb,kBAAC,GAAD,OAEF,yBACEA,UAAS,sBACTxH,IAAKvG,EAAc,GAAD,OAAIqpB,EAAJ,SAClBK,IAAI,gBACJzE,QAtDU,WACJ1N,GAAYW,iBAGZsO,EAAajR,KACH,YAAxBtD,EAAaN,OACf4F,GAAY4W,kBAEZ5W,GAAYuX,gBAAgBtI,IAMF,YAAxBvU,EAAaN,QACf4F,GAAY4W,kBAEd5W,GAAYuX,gBAAgBtI,QAwCpB,yBAAKzY,UAAU,qBACb,kBAACghB,GAAA,EAAD,CACEC,YAAY,gBACZjhB,UAAU,sBACVnP,QAAM,EACNqwB,WAAS,EACTnvB,MAAOupB,EACPqB,SAAU,SAACnU,EAAGsN,GAAJ,OAAauF,EAAavF,EAAK/jB,QACzCmT,QAASga,EACTiC,cAAc,EACdC,oBAAoB,IAEtB,yBAAKphB,UAAU,eACZyY,GAAgBA,EAAaG,QAGhC,yBAAK5Y,UAAU,qBA1HF,WACzB,OAAKyY,GAGgB,WAAjBE,EAA2BE,EAASJ,EAAaI,OAAO9nB,MAAM,EAAG,GAC3C,WAAjB4nB,IACPE,EAASJ,EAAaI,OAAO9nB,MAAM,EAAG,IAEjC8nB,EAAO5W,KAAI,SAACQ,EAAO6Q,GACxB,IAAK7Q,EAAO,OAAO,KACnB,IAAMD,EACa,WAAjBmW,EAA4BloB,EAAgB6iB,GAAO9iB,EAAgB8iB,GACrE,OACE,yBACEtT,UAAS,0BAAqBwC,EAArB,YACPkW,IAAuBlW,EAAa,WAAa,IAEnD9P,IAAG,UAAKimB,EAAL,uBAAgCnW,GACnC0U,QAAS,kBA3Bc,SAAC1U,GAC9B4c,EAA4B5c,GAC5BmT,EAAM8K,mBAAmBje,GAyBJ6e,CAAuB7e,KAEtC,yBAAKxC,UAAU,cAAcwC,GAC7B,yBAAKxC,UAAU,SAASyC,QApBJ,KAE1B,IAAIoW,EAuH4CyI,IAEpC,yBAAKthB,UAAU,aACb,kBAAC,GAAD,CACEuc,QAAS,CAAEvpB,KAAM,SAAUjB,MAAO,UAClCyqB,QAAS,CAAExpB,KAAM,SAAUjB,MAAO,UAClC4qB,SApIO,SAACtrB,GACxBskB,EAAM4L,aAAalwB,IAoIHU,MAAO4mB,EACPJ,UA3FXE,IAAiBE,GACK,aAAvBD,IACiB,WAAjBC,GACMF,EAAaI,OAAO9nB,MAAM,EAAG,GAAGqG,QAAO,SAACjG,GAAD,OAAOA,KAAGsC,OAC/B,WAAjBklB,IACDF,EAAaI,OAAO9nB,MAAM,EAAG,GAAGqG,QAAO,SAACjG,GAAD,OAAOA,KAAGsC,WA0F/C,yBAAKuM,UAAU,yBACb,yBAAKA,UAAU,qBAAf,OACA,yBAAKA,UAAU,qBA7GT,WACpB,IAAKyY,EAAc,OAAO,KAC1B,IAAI+I,EAAa/I,EAAa+I,WAC9B,GAAIA,EAAWjmB,SAAS,KAAM,CAC5B,IAAIwgB,EAAgBvrB,EAAgBQ,QAAQ0nB,GACvB,WAAjBC,IAA2BoD,GAAiB,GAChDyF,EAAaA,EAAWjvB,MAAM,KAAKwpB,GAErC,OAAOyF,EAqG2CC,OAI1C,yBAAKzhB,UAAU,oBACb,yBAAKA,UAAU,wBACb,yBAAKA,UAAU,cACb,2CACA,kBAACghB,GAAA,EAAD,CACEhhB,UAAU,wBACVkhB,WAAS,EACTnvB,MAAOypB,EAAgBzQ,MACvB4R,SAAU,SAACnU,EAAGsN,GAAJ,OACR2J,EAAsB,CACpB1U,MAAO+K,EAAK/jB,SAGhBmT,QAAS2X,MAGb,yBAAK7c,UAAU,cACb,6CACA,kBAACghB,GAAA,EAAD,CACEhhB,UAAU,0BACVkhB,WAAS,EACTnvB,MAAOypB,EAAgB+D,QACvB5C,SAAU,SAACnU,EAAGsN,GAAJ,OACR2J,EAAsB,CACpBF,QAASzJ,EAAK/jB,SAGlBmT,QAAS8X,MAGb,yBAAKhd,UAAU,cACb,2CACA,kBAACghB,GAAA,EAAD,CACEhhB,UAAU,wBACVkhB,WAAS,EACTnvB,MAAOypB,EAAgB/Y,MACvBka,SAAU,SAACnU,EAAGsN,GAAJ,OACR2J,EAAsB,CACpBhd,MAAOqT,EAAK/jB,SAGhBmT,QAASgY,KAEX,gDACA,kBAAC8D,GAAA,EAAD,CACEhhB,UAAU,6BACVkhB,WAAS,EACTnvB,MAAOypB,EAAgBhZ,WACvBma,SAAU,SAACnU,EAAGsN,GAAJ,OACR2J,EAAsB,CACpBjd,WAAYsT,EAAK/jB,SAGrBmT,QAASiY,UAQrB,yBAAKnd,UAAU,qBAAqB2X,IAAKsH,GACvC,kBAAC,GAAD,CACE7D,eAAgBA,EAChBC,aAAcA,EACdC,mBAAoBA,EACpB3C,aAAcA,EACd4C,yBAA0BA,EAC1BC,gBAAiBA,U,oBCtLdvD,gBAjBS,SAACrR,GAAW,IAC1BpR,EAA6BoR,EAA7BpR,KAAM+R,EAAuBX,EAAvBW,WAAYH,EAAWR,EAAXQ,OAC1B,MAAO,CACL5R,OACAnE,KAAMkW,EAAWlW,KACjB0C,KAAMwT,EAAWxT,KACjByO,WAAY+E,EAAW/E,WACvBiE,WAAYW,EAAOX,eAII,SAAC5C,GAC1B,MAAO,CACLO,WAAY,SAAC5O,GAAD,OAAUqO,EAASO,GAAW5O,QAI/ByiB,EA5UE,SAACtC,GAAW,IACnBngB,EAA6CmgB,EAA7CngB,KAAM4O,EAAuCuR,EAAvCvR,WAAY/S,EAA2BskB,EAA3BtkB,KAAM0C,EAAqB4hB,EAArB5hB,KAAMyO,EAAemT,EAAfnT,WAItC4T,qBAAU,WACK,WAAT/kB,GAAsB,CAAC,MAAO,UAAUkK,SAAS/F,EAAK2P,OACxDf,EAAW,CAAEe,KAAM,UAEpB,CAAC9T,IA2CJ,OACE,yBACE2O,UAAS,gCACc,SAArB2V,EAAMlP,WAAwB,SAAW,KAG3C,yBAAKzG,UAAU,gBACb,0BAAMA,UAAU,YACd,yBAAKA,UAAU,cACb,wBAAIA,UAAU,cAAd,QAEGjM,GACC,0BAAMiM,UAAU,iBAAhB,2BAC2B,IACzB,gCAvDgB,WAC9B,IAAKjM,EAAM,OAAO,KAElB,IAAIytB,EACJ,GAAmB,SAAfhsB,EAAKC,MAIP,OAFE+rB,EADEhsB,EAAKG,KAAO,KAAOH,EAAKG,KAAO,I9CEb,I8CAFH,EAAKG,KAClB,gCAAS6rB,GAIlB,IADAA,EAAaztB,EAAKytB,YACHjmB,SAAS,KAAM,CAC5B,IAAIwgB,EAAgBvrB,EAAgBQ,QAAQwR,GAC/B,WAATnR,IAAmB0qB,GAAiB,GACxCyF,EAAaA,EAAWjvB,MAAM,KAAKwpB,GAfD,MAkBVyF,EAAWjvB,MAAM,KAlBP,mBAkB7BmvB,EAlB6B,KAkBrBC,EAlBqB,KAmBpC,OAAKA,EAID,0CAAY/tB,KAAKC,MAAM6tB,EAASlsB,EAAKC,OAArC,cAAiD7B,KAAKC,MACpD8tB,EAAUnsB,EAAKC,SAJZ,gCAAS7B,KAAKC,MAAM6tB,EAASlsB,EAAKC,QAmCpBmsB,IAFX,MAMH1c,GAAQ1P,KAAKC,MAAMwM,KAAI,SAACxM,GACvB,OACE,kBAACosB,GAAA,EAAD,CACEnvB,IAAG,gBAAW+C,GACdqsB,MAAK,UAAKrsB,EAAL,KACL6iB,KAAK,QACLvmB,MAAO0D,EACPssB,QAASvsB,EAAKC,QAAUA,EACxBknB,SAAU,kBAAMvY,EAAW,CAAE3O,gBAInC,6BACE,kBAACosB,GAAA,EAAD,CACEnvB,IAAI,aACJovB,MAAM,OACNxJ,KAAK,QACLvmB,MAAM,OACNgwB,QAAwB,SAAfvsB,EAAKC,MACdknB,SAAU,kBAAMvY,EAAW,CAAE3O,MAAO,YAEtC,kBAACuhB,GAAA,EAAD,CACE5Z,KAAK,SACLmb,SAAyB,SAAf/iB,EAAKC,MACfusB,IAAK,IACL7qB,IAAK,IACLmhB,KAAK,OACLvmB,MAAOyD,EAAKG,KACZgnB,SAAU,SAACsF,EAAGnM,GAAJ,OAAa1R,EAAW,CAAEzO,KAAMmgB,EAAK/jB,SAC/CmwB,OA1Da,SAAC1Z,GAC1B,IAAM2Z,EAAa3Z,EAAEnB,OAAOtV,QAEzBowB,GACDtf,SAASsf,GAAc,KACvBtf,SAASsf,GAAc,MAEvB/d,EAAW,CAAEzO,K9C9BS,U8CoFhB,mE9CpFgB,I8CoFhB,MAGF,yBAAKqK,UAAU,cACb,wBAAIA,UAAU,cAAd,cACCkF,GAAQ1P,KAAKmE,WAAWsI,KAAI,SAACtI,EAAYvF,GACxC,OACE,kBAACytB,GAAA,EAAD,CACEnvB,IAAG,qBAAgBiH,GACnBmoB,MACE,CACE,UACA,UACA,UACA,oBACA,WACA1tB,GAEJkkB,KAAK,aACLvmB,MAAO4H,EACPooB,QAASvsB,EAAKmE,aAAeA,EAC7BgjB,SAAU,kBAAMvY,EAAW,CAAEzK,sBAMrC,yBAAKqG,UAAU,cACb,wBAAIA,UAAU,cAAd,eACCkF,GAAQ1P,KAAK6F,SAAS4G,KAAI,SAAC5G,GAC1B,OACE,kBAACwmB,GAAA,EAAD,CACEnvB,IAAG,mBAAc2I,GACjBymB,MAAO5vB,EAAWmJ,GAClBid,KAAK,WACLvmB,MAAOsJ,EACP0mB,QAASvsB,EAAK6F,WAAaA,EAC3BshB,SAAU,kBAAMvY,EAAW,CAAE/I,oBAMrC,yBAAK2E,UAAU,cACb,wBAAIA,UAAU,cAAd,QACCkF,GAAQ1P,KAAK2P,KACX/N,QAAO,SAAC+N,GACP,MAAa,WAAT9T,IACc,QAAT8T,GAA2B,WAATA,MAG5BlD,KAAI,SAACkD,GACJ,OACE,kBAAC0c,GAAA,EAAD,CACEnvB,IAAG,eAAUyS,GACb2c,MAAO5vB,EAAWiT,GAClBmT,KAAK,OACLvmB,MAAOoT,EACP4c,QAASvsB,EAAK2P,OAASA,EACvBwX,SAAU,kBAAMvY,EAAW,CAAEe,gBAKxB,YAAd3P,EAAK2P,MACJ,yBAAKnF,UAAU,cACb,wBAAIA,UAAU,cAAd,kBAEE,0BAAMA,UAAU,iBAAhB,+BAIDkF,GAAQ1P,KAAK4P,QAAQnD,KAAI,SAACmD,EAAShR,GAClC,OACE,kBAACytB,GAAA,EAAD,CACEnvB,IAAG,kBAAa0S,GAChB0c,MACE,CACE,OACA,OACA,OACA,OACA,OACA,OACA,OACA,QACA1tB,GAEJkkB,KAAK,UACLvmB,MAAOqT,EACP2c,QAASvsB,EAAK4P,UAAYA,EAC1BuX,SAAU,kBAAMvY,EAAW,CAAEgB,mBAOvC,yBAAKpF,UAAU,cACb,wBAAIA,UAAU,cAAd,aACCkF,GAAQ1P,KAAK6P,SAASpD,KAAI,SAACoD,GAC1B,OACE,kBAACwc,GAAA,EAAD,CACEnvB,IAAG,mBAAc2S,GACjByc,MAAO5vB,EAAWmT,GAClBiT,KAAK,WACLvmB,MAAOsT,EACP0c,QAASvsB,EAAK6P,WAAaA,EAC3BsX,SAAU,kBAAMvY,EAAW,CAAEiB,oBAMrC,yBAAKrF,UAAU,cACb,wBAAIA,UAAU,cAAd,UACCkF,GAAQ1P,KAAKkE,OAAOuI,KAAI,SAACvI,GACxB,OACE,kBAACmoB,GAAA,EAAD,CACEnvB,IAAG,iBAAYgH,GACfooB,MAAO5vB,EAAWwH,GAClB4e,KAAK,SACLvmB,MAAO2H,EACPqoB,QAASvsB,EAAKkE,SAAWA,EACzBijB,SAAU,kBAAMvY,EAAW,CAAE1K,kBAMrC,yBAAKsG,UAAU,cACb,wBAAIA,UAAU,cAAd,iBACCkF,GAAQ1P,KAAK8P,aAAarD,KAAI,SAACqD,EAAclR,GAC5C,OACE,kBAACytB,GAAA,EAAD,CACEnvB,IAAG,uBAAkB4S,GACrBwc,MAAO,CAAC,gBAAiB,qBAAsB,UAAU1tB,GACzDkkB,KAAK,eACLvmB,MAAOuT,EACPyc,QAASvsB,EAAK8P,eAAiBA,EAC/BqX,SAAU,kBAAMvY,EAAW,CAAEkB,wBAMrC,yBAAKtF,UAAU,cACb,wBAAIA,UAAU,cAAd,cACCkF,GAAQ1P,KAAKqI,UAAUoE,KAAI,SAACpE,GAC3B,OACE,kBAACgkB,GAAA,EAAD,CACEnvB,IAAG,oBAAemL,GAClBikB,MAAOjkB,EACPya,KAAK,YACLvmB,MAAO8L,EACPkkB,QAASvsB,EAAKqI,YAAcA,EAC5B8e,SAAU,kBAAMvY,EAAW,CAAEvG,qBAMrC,6CACA,yBAAKmC,UAAU,cACb,kBAACoiB,GAAA,EAAD,CACEC,QAAM,EACNP,MAAM,aACNxJ,KAAK,aACLyJ,QAASvsB,EAAK2G,WACdwgB,SAAU,kBAAMvY,EAAW,CAAEjI,YAAa3G,EAAK2G,iBAGnD,yBAAK6D,UAAU,cACb,kBAACoiB,GAAA,EAAD,CACEC,QAAM,EACNP,MAAM,qBACNxJ,KAAK,eACLyJ,QAASvsB,EAAK8F,aACdqhB,SAAU,kBAAMvY,EAAW,CAAE9I,cAAe9F,EAAK8F,mBAGrD,yBAAK0E,UAAU,cACb,kBAACoiB,GAAA,EAAD,CACEC,QAAM,EACNP,MAAM,4BACNxJ,KAAK,iBACLyJ,QAASvsB,EAAKkQ,eACdiX,SAAU,kBACRvY,EAAW,CAAEsB,gBAAiBlQ,EAAKkQ,qBAIzC,yBAAK1F,UAAU,cACb,wBAAIA,UAAU,cAAd,iBACA,kBAACgX,GAAA,EAAD,CACE5Z,KAAK,QACLkb,KAAK,eACL0J,IAAI,QACJ7qB,IAAI,OACJmrB,KAAK,OACLvwB,MAAOyD,EAAKiQ,aACZkX,SAAU,SAACsF,EAAGnM,GAAJ,OACR1R,EAAW,CAAEqB,aAActD,WAAW2T,EAAK/jB,YAG/C,8BAAOyD,EAAKiQ,qBC5TxB,SAAS,KAA2Q,OAA9P,GAAW3N,OAAOulB,QAAU,SAAUhW,GAAU,IAAK,IAAIjT,EAAI,EAAGA,EAAIkpB,UAAU7pB,OAAQW,IAAK,CAAE,IAAImpB,EAASD,UAAUlpB,GAAI,IAAK,IAAI1B,KAAO6qB,EAAczlB,OAAO0lB,UAAUC,eAAeC,KAAKH,EAAQ7qB,KAAQ2U,EAAO3U,GAAO6qB,EAAO7qB,IAAY,OAAO2U,IAA2BsW,MAAM/kB,KAAM0kB,WAEhT,SAAS,GAAyBC,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkE7qB,EAAK0B,EAAnEiT,EAEzF,SAAuCkW,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2D7qB,EAAK0B,EAA5DiT,EAAS,GAAQyW,EAAahmB,OAAOC,KAAKwlB,GAAqB,IAAKnpB,EAAI,EAAGA,EAAI0pB,EAAWrqB,OAAQW,IAAO1B,EAAMorB,EAAW1pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,IAAa2U,EAAO3U,GAAO6qB,EAAO7qB,IAAQ,OAAO2U,EAFxM,CAA8BkW,EAAQM,GAAuB,GAAI/lB,OAAOkmB,sBAAuB,CAAE,IAAIC,EAAmBnmB,OAAOkmB,sBAAsBT,GAAS,IAAKnpB,EAAI,EAAGA,EAAI6pB,EAAiBxqB,OAAQW,IAAO1B,EAAMurB,EAAiB7pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,GAAkBoF,OAAO0lB,UAAUU,qBAAqBR,KAAKH,EAAQ7qB,KAAgB2U,EAAO3U,GAAO6qB,EAAO7qB,IAAU,OAAO2U,EAMne,IAAI,GAEJ,IAAMtH,cAAc,QAAS,KAAM,qEAE/B,GAEJ,IAAMA,cAAc,OAAQ,CAC1BsL,GAAI,SACJrL,UAAW,OACXme,EAAG,0sDAGD,GAAY,SAAmBO,GACjC,IAAIC,EAASD,EAAKC,OACd5T,EAAQ2T,EAAK3T,MACb4K,EAAQ,GAAyB+I,EAAM,CAAC,SAAU,UAEtD,OAAO,IAAM3e,cAAc,MAAO,GAAS,CACzC6e,QAAS,aACTniB,MAAO,IACP/H,OAAQ,GACRijB,IAAKgH,GACJhJ,GAAQ5K,EAAQ,IAAMhL,cAAc,QAAS,KAAMgL,GAAS,KAAM,GAAO,KAG1E,GAAa,IAAM+T,YAAW,SAAUnJ,EAAOgC,GACjD,OAAO,IAAM5X,cAAc,GAAW,GAAS,CAC7C4e,OAAQhH,GACPhC,OAEU,ICtCf,SAAS,KAA2Q,OAA9P,GAAW7d,OAAOulB,QAAU,SAAUhW,GAAU,IAAK,IAAIjT,EAAI,EAAGA,EAAIkpB,UAAU7pB,OAAQW,IAAK,CAAE,IAAImpB,EAASD,UAAUlpB,GAAI,IAAK,IAAI1B,KAAO6qB,EAAczlB,OAAO0lB,UAAUC,eAAeC,KAAKH,EAAQ7qB,KAAQ2U,EAAO3U,GAAO6qB,EAAO7qB,IAAY,OAAO2U,IAA2BsW,MAAM/kB,KAAM0kB,WAEhT,SAAS,GAAyBC,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkE7qB,EAAK0B,EAAnEiT,EAEzF,SAAuCkW,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2D7qB,EAAK0B,EAA5DiT,EAAS,GAAQyW,EAAahmB,OAAOC,KAAKwlB,GAAqB,IAAKnpB,EAAI,EAAGA,EAAI0pB,EAAWrqB,OAAQW,IAAO1B,EAAMorB,EAAW1pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,IAAa2U,EAAO3U,GAAO6qB,EAAO7qB,IAAQ,OAAO2U,EAFxM,CAA8BkW,EAAQM,GAAuB,GAAI/lB,OAAOkmB,sBAAuB,CAAE,IAAIC,EAAmBnmB,OAAOkmB,sBAAsBT,GAAS,IAAKnpB,EAAI,EAAGA,EAAI6pB,EAAiBxqB,OAAQW,IAAO1B,EAAMurB,EAAiB7pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,GAAkBoF,OAAO0lB,UAAUU,qBAAqBR,KAAKH,EAAQ7qB,KAAgB2U,EAAO3U,GAAO6qB,EAAO7qB,IAAU,OAAO2U,EAMne,IAAI,GAEJ,IAAMtH,cAAc,OAAQ,CAC1Boe,EAAG,47DACHoE,KAAM,KAGJ,GAAU,SAAiB7D,GAC7B,IAAIC,EAASD,EAAKC,OACd5T,EAAQ2T,EAAK3T,MACb4K,EAAQ,GAAyB+I,EAAM,CAAC,SAAU,UAEtD,OAAO,IAAM3e,cAAc,MAAO,GAAS,CACzCC,UAAW,OACXH,MAAO,CACLpD,MAAO,MACP/H,OAAQ,MACR8tB,cAAe,SACfD,KAAM,eACNE,SAAU,UAEZ7D,QAAS,gBACTjH,IAAKgH,GACJhJ,GAAQ5K,EAAQ,IAAMhL,cAAc,QAAS,KAAMgL,GAAS,KAAM,KAGnE,GAAa,IAAM+T,YAAW,SAAUnJ,EAAOgC,GACjD,OAAO,IAAM5X,cAAc,GAAS,GAAS,CAC3C4e,OAAQhH,GACPhC,OAEU,ICvCf,SAAS,KAA2Q,OAA9P,GAAW7d,OAAOulB,QAAU,SAAUhW,GAAU,IAAK,IAAIjT,EAAI,EAAGA,EAAIkpB,UAAU7pB,OAAQW,IAAK,CAAE,IAAImpB,EAASD,UAAUlpB,GAAI,IAAK,IAAI1B,KAAO6qB,EAAczlB,OAAO0lB,UAAUC,eAAeC,KAAKH,EAAQ7qB,KAAQ2U,EAAO3U,GAAO6qB,EAAO7qB,IAAY,OAAO2U,IAA2BsW,MAAM/kB,KAAM0kB,WAEhT,SAAS,GAAyBC,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAAkE7qB,EAAK0B,EAAnEiT,EAEzF,SAAuCkW,EAAQM,GAAY,GAAc,MAAVN,EAAgB,MAAO,GAAI,IAA2D7qB,EAAK0B,EAA5DiT,EAAS,GAAQyW,EAAahmB,OAAOC,KAAKwlB,GAAqB,IAAKnpB,EAAI,EAAGA,EAAI0pB,EAAWrqB,OAAQW,IAAO1B,EAAMorB,EAAW1pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,IAAa2U,EAAO3U,GAAO6qB,EAAO7qB,IAAQ,OAAO2U,EAFxM,CAA8BkW,EAAQM,GAAuB,GAAI/lB,OAAOkmB,sBAAuB,CAAE,IAAIC,EAAmBnmB,OAAOkmB,sBAAsBT,GAAS,IAAKnpB,EAAI,EAAGA,EAAI6pB,EAAiBxqB,OAAQW,IAAO1B,EAAMurB,EAAiB7pB,GAAQypB,EAAS7sB,QAAQ0B,IAAQ,GAAkBoF,OAAO0lB,UAAUU,qBAAqBR,KAAKH,EAAQ7qB,KAAgB2U,EAAO3U,GAAO6qB,EAAO7qB,IAAU,OAAO2U,EAMne,IAAI,GAEJ,IAAMtH,cAAc,QAAS,KAAM,qEAE/B,GAEJ,IAAMA,cAAc,IAAK,CACvBsL,GAAI,SACH,IAAMtL,cAAc,OAAQ,CAC7BsL,GAAI,QACJqX,SAAU,UACV1iB,UAAW,OACXme,EAAG,2YACD,IAAMpe,cAAc,OAAQ,CAC9BsL,GAAI,QACJqX,SAAU,UACV1iB,UAAW,OACXme,EAAG,4RACD,IAAMpe,cAAc,OAAQ,CAC9BsL,GAAI,QACJqX,SAAU,UACV1iB,UAAW,OACXme,EAAG,23BAGD,GAAiB,SAAwBO,GAC3C,IAAIC,EAASD,EAAKC,OACd5T,EAAQ2T,EAAK3T,MACb4K,EAAQ,GAAyB+I,EAAM,CAAC,SAAU,UAEtD,OAAO,IAAM3e,cAAc,MAAO,GAAS,CACzC6e,QAAS,YACTniB,MAAO,GACP/H,OAAQ,GACRijB,IAAKgH,GACJhJ,GAAQ5K,EAAQ,IAAMhL,cAAc,QAAS,KAAMgL,GAAS,KAAM,GAAO,KAG1E,GAAa,IAAM+T,YAAW,SAAUnJ,EAAOgC,GACjD,OAAO,IAAM5X,cAAc,GAAgB,GAAS,CAClD4e,OAAQhH,GACPhC,OC6BUsC,ID3BA,IC2BAA,aAhBS,SAACrR,GAAW,IAC1B5S,EAAkB4S,EAAlB5S,MAAOoT,EAAWR,EAAXQ,OAEf,MAAO,CACLpD,WAFqBhQ,EAAfgQ,WAGNyC,WAAYW,EAAOX,eAII,SAAC5C,GAC1B,MAAO,CACL8e,iBAAkB,kBAAM9e,GrC1BU,SAACA,GACrCA,EAAS,CACPzG,KA3C8B,2BqCoE9BwlB,cAAe,SAACC,GAAD,OAAUhf,EzBhEA,SAACgf,GAAD,OAAU,SAAChf,GACtCA,EAAS,CACPzG,KAX2B,kBAY3B0G,QAAS+e,KyB6DyBD,CAAcC,QAIrC5K,EAlEA,SAACtC,GAAW,IACjBlP,EAA2BkP,EAA3BlP,WAAYzC,EAAe2R,EAAf3R,WAEd8e,EAAW,CACf,CAAED,KAAM,OAAQE,KAAM,QAASC,QAASC,GAAUjwB,KAAM,QACxD,CAAE6vB,KAAM,OAAQE,KAAM,UAAWC,QAASE,GAAUlwB,KAAM,QAC1D,CAAE6vB,KAAM,QAASG,QAASG,GAAWnwB,KAAM,SAC3C,CAAE6vB,KAAgC,GAAIE,KAAM,GAAI/vB,KAAM,IACtD,CAAE6vB,KAAM,IAAKE,KAAM,GAAI/vB,KAAM,KASzBowB,EAAa,SAACP,GAClB,MAAa,UAATA,GAA0C,YAAtB7e,EAAWJ,QAIrC,OACE,yBAAK5D,UAAU,UACZ8iB,EAAS7gB,KAAI,SAACohB,EAASjvB,GAAO,IACrByuB,EAAqBQ,EAArBR,KAAME,EAAeM,EAAfN,KAAM/vB,EAASqwB,EAATrwB,KACdswB,EAAUD,EAAQL,QACxB,OAAKH,EAGH,yBACEnwB,IAAG,qBAAgB0B,GACnB4L,UAAS,sBAAiByG,IAAeoc,EAAO,SAAW,GAAlD,YACPO,EAAWP,GAAQ,WAAa,IAElC3L,QAAS,kBAxBM,SAAC2L,GACE,YAAtB7e,EAAWJ,SACf4F,GAAY4W,kBACZzK,EAAMiN,cAAcC,IAqBGU,CAAiBV,KAE/BS,EACC,kBAACA,EAAD,CAAStjB,UAAS,mBAAc6iB,KAEhC,kBAACxK,GAAA,EAAD,CAAMC,KAAMyK,IAEd,0BAAM/iB,UAAU,eAAehN,IAd1B,yBAAKN,IAAG,qBAAgB0B,GAAK4L,UAAU,wBCkHzCiY,ICnIAA,aAPS,SAACrR,GAEvB,MAAO,CACLH,WAFiBG,EAAXQ,OAEaX,cAIiB,KAAzBwR,EApBC,SAACtC,GACf,OACE,yBACE3V,UAAS,qCACY,aAArB2V,EAAMlP,WAA4B,SAAW,KAE7C,yBAAKzG,UAAU,gBACb,yBAAKqL,GAAG,YAAR,uBDgJO4M,aAbS,SAACrR,GACvB,MAAO,MAGkB,SAAC/C,GAC1B,MAAO,CACL6C,WAAY,SAAC3S,GAAD,OAAU8P,EAAS6C,GAAW3S,KAC1CyvB,iBAAkB,SAACzvB,GAAD,OAAU8P,G9BzICrB,E8ByIyBzO,E9BzIV,SAAC8P,GAC/CA,EAAS,CACPzG,KAZ6B,oBAa7B0G,QAAStB,OAHmB,IAACA,G8B0I7BihB,WAAY,SAAC1vB,GAAD,OAAU8P,G9BnICxS,E8BmImB0C,E9BnIV,SAAC8P,GACnCA,EAAS,CACPzG,KAlBuB,cAmBvB0G,QAASzS,OAHa,IAACA,G8BoIvBqyB,aAAc,SAAClb,GAAD,OAAO3E,E1BnJG,SAAC2E,GAAD,OAAO,SAAC3E,GAClCA,EAAS,CACPzG,KALyB,gBAMzB0G,QAAS0E,K0BgJqBkb,CAAalb,QAIhCyP,EAtIO,SAACtC,GAAW,IAAD,EACeM,oBAAS,GADxB,mBACxB0N,EADwB,KACPC,EADO,OAEO3N,mBAAS,IAFhB,mBAExB+I,EAFwB,KAEX6E,EAFW,OAGK5N,mBAAS,MAHd,mBAGxB6N,EAHwB,KAGZC,EAHY,OAKK9N,mBAAS,MALd,mBAKxBqD,EALwB,KAKZC,EALY,OAOStD,oBAAS,GAPlB,mBAOxBoD,EAPwB,KAOVxO,EAPU,KAS/BuL,qBAAU,YACO,uCAAG,sBAAAjlB,EAAA,sEACV6yB,IADU,OAEhBJ,GAAmB,GAFH,2CAAH,qDAIfK,GAEAza,GAAYqB,gBAAkBA,EAE9Bla,OAAO4X,iBAAiB,SAAUoN,EAAM+N,gBACvC,IAEH,IAAMM,EAAa,uCAAG,4BAAA7yB,EAAA,+EAEM+yB,YAAIxzB,IAAkB,qBAF5B,QAEZyzB,EAFY,QAGR3xB,SAAQ,SAAC2d,GACjBA,EAAI0I,OAAS1I,EAAI0I,OACdtmB,MAAM,KACN0P,KAAI,SAACQ,GAAD,OAAYA,EAAQI,SAASJ,GAAS,WAI/CohB,EAAeM,GAVG,uDAYlBvxB,QAAQD,MAAR,MAZkB,kBAaX,MAbW,yDAAH,qDAiBb0oB,EAAY,uCAAG,WAAOtnB,GAAP,+BAAA5C,EAAA,6DAAayZ,EAAb,+BAA+B,EAElDpB,GAAY9C,WAAW3S,EAAM6W,GAG7B+K,EAAMjP,WAAW3S,GAEjBV,SAAS0X,MAAT,UAAoBhX,EAAKgX,MAAzB,eAIIqZ,EAASrwB,EAAKqwB,OAGA,qCAAdrwB,EAAKyT,OACP4c,EAASA,EAAO7N,QAAQ,IAAK3iB,KAAK2G,MAAsB,EAAhB3G,KAAKywB,UAAgB,IAf5C,SAqBjBlI,GAAUC,kBAAoBroB,EAAKgX,MArBlB,UAsBA9Z,EAAc,GAAD,OACzBP,IADyB,oBACE4zB,mBAAmBF,GADrB,YAE1BrwB,EAAK0mB,OAAS,MAAQ,OAxBT,QAsBXlZ,EAtBW,OA8Bb4a,GAAUC,oBAAsBroB,EAAKgX,OACvCgZ,EAAcxiB,GA/BC,kDAkCjBgK,MAAM,QAAD,OAASxX,EAAKgX,MAAd,yBAlCY,0DAAH,sDA8ClB,OACE,yBAAK/K,UAAU,mBACX2jB,GACA,oCACE,kBAAC,GAAD,MACA,yBAAK3jB,UAAU,kBACb,kBAAC,GAAD,CACEqZ,aAAcA,EACd9X,GAAIuiB,EACJxK,WAAYA,EACZC,cAAeA,IAEjB,kBAAC,GAAD,MACA,kBAAC,GAAD,CACEyF,YAAaA,EACb3D,aAAcA,EACdoF,mBAxBe,SAACje,GAE1BmT,EAAM6N,iBAAiBhhB,IAuBb+e,aArBS,SAAClwB,GACpBskB,EAAM8N,WAAWpyB,IAqBPgoB,aAAcA,EACdzoB,SAAU+kB,EAAM/kB,YnD3HJ,YqDeX2zB,oBAVf,WACE,OACE,yBAAKvkB,UAAU,iBACb,kBAAC,IAAD,KACE,kBAAC,IAAD,CAAOwkB,OAAK,EAACtzB,KAAK,IAAIuzB,UAAWC,UCCzCC,IAASlW,OACP,kBAAC,IAAD,CAAUhH,MAAOA,IACf,kBAAC,IAAD,CAAemd,SAAUC,aACvB,kBAAC,GAAD,QAGJxxB,SAASyB,eAAe,W","file":"static/js/main.20e726ae.chunk.js","sourcesContent":["export const DEBUG_MODE = false;\n\nexport const ARROW_WIDTH = 64;\nexport const ARROW_HEIGHT = 64;\n\n/* Height of one repetition of the freeze body pattern */\nexport const FREEZE_BODY_HEIGHT = 128;\n\n/* Amount of pixels the Hidden+ and Sudden+ lane covers are moved with one nudge */\nexport const LANE_COVER_INCREMENT = 4;\n\nexport const DIRECTIONS = [\"left\", \"down\", \"up\", \"right\"];\n\n/* \n  Offset of the visuals (i.e. chart, gsap timeline) relative to the audio.\n  Positive value represents notes being earlier (have to hit earlier than the music)\n  Negative value represents notes being later (have to hit later than the music)\n*/\nexport const DEFAULT_OFFSET = 0.07;\n// export const DEFAULT_OFFSET = -0.1;  // oneplus\n\nexport const MARVELOUS_FLASH_FRAMES = 12;\n\n/* Number of beats played after the last note or event until the timeline ends */\nexport const END_EXTRA_BEATS = 8;\n\n/* Default cmod value; also serves as fallback speed if cmod form field value is invalid */\nexport const DEFAULT_CMOD = 550;\n\nexport const DDR_VERSIONS = [\n  \"DDR 1st\",\n  \"DDR 2ndMIX\",\n  \"DDR 3rdMIX\",\n  \"DDR 4thMIX\",\n  \"DDR 5thMIX\",\n  \"DDRMAX\",\n  \"DDRMAX2\",\n  \"DDR EXTREME\",\n  \"DDR SuperNOVA\",\n  \"DDR SuperNOVA 2\",\n  \"DDR X\",\n  \"DDR X2\",\n  \"DDR X3 VS 2ndMIX\",\n  \"DDR (2013)\",\n  \"DDR (2014)\",\n  \"DDR A\",\n  \"DDR A20\",\n];\n\nexport const SP_DIFFICULTIES = [\n  \"Beginner\",\n  \"Basic\",\n  \"Difficult\",\n  \"Expert\",\n  \"Challenge\",\n];\nexport const DP_DIFFICULTIES = [\"Basic\", \"Difficult\", \"Expert\", \"Challenge\"];\n\nexport const TITLE_CATEGORIES = [\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \"NUM\",\n];\n\nexport const LEVELS = [\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  16,\n  17,\n  18,\n  19,\n];\n","import { DEBUG_MODE } from \"../constants\";\n\nexport const getOriginPath = () => {\n  if (window.location.search)\n    return window.location.href.slice(\n      0,\n      window.location.href.indexOf(window.location.search)\n    );\n  return window.location.href;\n};\n\nexport const fetchDocument = async (path) => {\n  const response = await fetch(path, {\n    mode: \"cors\",\n  });\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder(\"utf-8\");\n  const readResult = await reader.read();\n  return decoder.decode(readResult.value);\n};\n\nexport const getAssetPath = (path) => {\n  return getOriginPath() + \"assets/\" + path;\n};\n\nexport const getJacketPath = (path) => {\n  return getOriginPath() + \"jackets/\" + path;\n};\n\nexport const capitalize = (str) => {\n  return str.slice(0, 1).toUpperCase() + str.slice(1);\n};\n\nexport const parseUrlParams = () => {\n  if (!window.location.search) return {};\n  const obj = {};\n  try {\n    window.location.search\n      .slice(1)\n      .split(\"&\")\n      .forEach((param) => {\n        const [key, value] = param.split(\"=\");\n        obj[key] = value;\n      });\n    return obj;\n  } catch (error) {\n    console.log(\"error parsing url params\", error);\n    return {};\n  }\n};\nexport const presetParams = parseUrlParams();\n\nexport const debugLog = (text, divNum = 1) => {\n  if (!DEBUG_MODE) return;\n  const debugDiv = document.querySelector(`#debugLog .debug-text${divNum}`);\n  if (debugDiv) {\n    debugDiv.textContent = text;\n  }\n};\n\nexport const debugLogView = (text, viewNum = 1) => {\n  if (!DEBUG_MODE) return;\n  const debugDiv = document.querySelector(`#logView${viewNum}`);\n  if (debugDiv) {\n    debugDiv.textContent = text;\n  }\n};\n","import { DEBUG_MODE } from \"../constants\";\n\nexport const debugLog = (text, divNum = 1) => {\n  if (!DEBUG_MODE) return;\n  const debugDiv = document.querySelector(`#debugLog .debug-text${divNum}`);\n  if (debugDiv) {\n    debugDiv.textContent = text;\n  }\n};\n\nexport const debugLogView = (text, viewNum = 1) => {\n  if (!DEBUG_MODE) return;\n  const debugDiv = document.querySelector(`#logView${viewNum}`);\n  if (debugDiv) {\n    debugDiv.textContent = text;\n  }\n};\n\nexport const debugSimfileChart = (simfile) => {\n  // console.log(\"DSC\", simfile);\n  const chart = simfile.chart;\n  // console.log(chart);\n\n  let output = `${simfile.mode} ${simfile.difficulty} ${simfile.level}\\n\\n`;\n\n  const printChart = chart\n    .map((row) => {\n      if (!row.length) return \"[    ]\\n\";\n      let str = \"[\";\n      const numTicks = row[0].measureD;\n\n      for (let i = 0; i < numTicks; i++) {\n        const tick = row.find((t) => t.measureN == i);\n        if (i > 0) str += \" \";\n        if (!tick) {\n          // str += \"    \";\n          str += \"0000\";\n        } else {\n          // let lineOutput = \"\";\n          // tick.note.split(\"\").forEach((note, i) => {\n          //   if (note == 0) lineOutput += \" \";\n          //   else if (note == 1) {\n          //     if (i === 0) lineOutput += \"L\";\n          //     else if (i === 1) lineOutput += \"D\";\n          //     else if (i === 2) lineOutput += \"U\";\n          //     else if (i === 3) lineOutput += \"R\";\n          //   }\n          // });\n          // str += lineOutput;\n\n          str += tick.note;\n        }\n        if (i < numTicks - 1) str += \"\\n\";\n      }\n\n      str += `] (${numTicks} ticks)\\n`;\n      return str;\n    })\n    .join(\"\\n\");\n  output += printChart;\n  debugLogView(output, 1);\n};\n","import { DEFAULT_OFFSET, ARROW_HEIGHT } from \"../constants\";\nimport { debugLog } from \"./debugUtils\";\n\nexport const applyTurnMods = (chart, mods, mode) => {\n  const { turn, shuffle } = mods;\n\n  // shuffle patterns courtesy of https://zenius-i-vanisher.com/v5.2/viewthread.php?threadid=3823\n  const turnMap = {\n    off: \"LDUR\",\n    mirror: \"RUDL\",\n    left: \"ULRD\",\n    right: \"DRLU\",\n    shuffle1: \"LRDU\",\n    shuffle2: \"UDRL\",\n    shuffle3: \"LRUD\",\n    shuffle4: \"DURL\",\n    shuffle5: \"DLUR\",\n    shuffle6: \"DULR\",\n    shuffle7: \"RLUD\",\n    shuffle8: \"RULD\",\n  };\n\n  let turnMod = turn;\n  if (turn === \"shuffle\") turnMod += shuffle;\n\n  if (mode === \"single\") {\n    return chart.map((row) => {\n      const note = row.note;\n      const turnedNote = turnMap[turnMod]\n        .split(\"\")\n        .map((direction) => note[turnMap.off.indexOf(direction)]);\n\n      return { ...row, note: turnedNote };\n    });\n  }\n  if (mode === \"double\") {\n    return chart.map((row) => {\n      let turnedNote = row.note.split(\"\");\n      if (turn === \"mirror\") turnedNote = turnedNote.reverse();\n      return { ...row, note: turnedNote };\n    });\n  }\n};\n\n/*\n  Given the bpmQueue and the current beat tick, find the latest bpm\n  change event that happened before the current beat and set the current bpm\n  to that bpm value. This should be invoked every time the audio is resynced\n  (which will happen whenever progress is skipped)\n*/\nexport const getCurrentBpm = (params) => {\n  const { beatTick, bpmQueue } = params;\n  let lastBpmValue = 0;\n  for (let i = 0; i < bpmQueue.length; i++) {\n    const bpmEvent = bpmQueue[i];\n    if (bpmEvent.beat > beatTick) {\n      return lastBpmValue;\n    }\n    lastBpmValue = bpmEvent.value;\n  }\n  return lastBpmValue;\n};\n\n/*\n  Change current displayed bpm. Going with direct DOM text manipulation\n  rather than dispatching an action\n*/\nexport const changeActiveBpm = (bpmValue, globalParams) => {\n  const currentBpmEl = document.querySelector(\".current-bpm-value\");\n  if (!currentBpmEl) return;\n\n  const { bpmQueue, beatTick } = globalParams;\n\n  // Several charts start with an \"offset\" bpm on the first measure and are corrected\n  // to the \"real\" bpm on the second measure. If the chart follows this pattern,\n  // don't show the offset bpm as it can be very different and misleading\n  if (\n    beatTick < 4 &&\n    bpmQueue.length >= 2 &&\n    bpmQueue[0].beat === 0 &&\n    bpmQueue[1].beat === 4\n  ) {\n    currentBpmEl.textContent = \"\";\n  } else {\n    currentBpmEl.textContent = Math.round(bpmValue);\n  }\n\n  // console.log(\"globalParams\", globalParams);\n};\n\n/*\n  Find the current combo given the song timestamp. This should be invoked\n  every time the audio is resynced.\n*/\n\nexport const getCurrentCombo = (song) => {\n  const { audio, globalParams } = song;\n  const { allArrows } = globalParams;\n  if (!allArrows.length) return 0;\n\n  const currentTime = audio.seek();\n\n  // if audio is not properly loaded by the time this runs, currentTime will\n  // return the Howl object, causing this method to return the full combo.\n  // Return 0 instead in this case; seeing no combo is better than seeing\n  // an incorrect full combo number\n\n  // if (typeof currentTime !== \"number\") {\n  //   return 0;\n  // }\n\n  let currentCombo;\n\n  // Go through the chart until the arrow following the current timestamp is reached,\n  // then set the combo to one less than that arrow's combo\n  for (let i = 0; i < allArrows.length; i++) {\n    const arrow = allArrows[i];\n    if (arrow.combo && arrow.timestamp > currentTime + DEFAULT_OFFSET) {\n      currentCombo = arrow.combo - 1;\n      // console.log(currentCombo);\n      return currentCombo;\n    }\n  }\n\n  // If end of chart is reached, use the combo of the last arrow.\n  // Need to go back if the last \"note\" is the end of a freeze, which is common\n  // Expected to short circuit out of loop after ~1-2 iterations\n  for (let i = allArrows.length - 1; i >= 0; i--) {\n    const arrow = allArrows[i];\n    if (arrow.combo) {\n      currentCombo = arrow.combo;\n      return currentCombo;\n    }\n  }\n\n  return -1; // should never reach this. return -1 to make debugging easier\n};\n\nexport const getFullCombo = (song) => {\n  const { globalParams } = song;\n  const { allArrows } = globalParams;\n  if (!allArrows.length) return 0;\n  for (let i = allArrows.length - 1; i >= 0; i--) {\n    const arrow = allArrows[i];\n    if (arrow.combo) {\n      return arrow.combo;\n    }\n  }\n  return 0;\n};\n\n/*\n  Method for finding the coordinate of a sprite on Reverse scroll\n  given the corresponding coordinate on Normal scroll and its height\n*/\nexport const getReverseCoord = (originalCoord, height, canvas) => {\n  return canvas.height - (originalCoord + height);\n};\n\n/* Remove all bpm/stop display elements from the DOM */\nexport const clearBpmAndStopDisplay = () => {\n  const bpmReel = document.getElementById(\"bpmReel\");\n  if (bpmReel) {\n    bpmReel.innerHTML = \"\";\n    // console.log(\"cleared bpm reel\", bpmReel);\n  }\n  const stopReel = document.getElementById(\"stopReel\");\n  if (stopReel) {\n    stopReel.innerHTML = \"\";\n    // console.log(\"cleared stop reel\", stopReel);\n  }\n};\n\n/*\n  Based on the current beat tick, calculates the index of the first\n  arrow to fall within the visible beat window\n*/\nexport const initializeBeatWindow = (globalParams) => {\n  const { arrows, freezes, shocks, chartAreaHeight, mods } = globalParams;\n\n  let timestamp = mods.speed === \"cmod\" ? \"timestamp\" : \"beatstamp\";\n\n  // calculate number of beats (on 1x scroll) covered by the visible chart area\n  // = number of arrow heights that can fit on screen + 1 extra arrow height on top and bottom\n  // then divided by the scroll speed mod\n  // let numVisibleBeats = (chartAreaHeight + ARROW_HEIGHT) / ARROW_HEIGHT;\n\n  let windowStart, windowEnd;\n\n  if (mods.speed === \"cmod\") {\n    let visibleTime = chartAreaHeight / ARROW_HEIGHT;\n    visibleTime /= mods.cmod / 60;\n    windowStart = globalParams.timeTick - 1 / (mods.cmod / 60);\n    windowEnd = globalParams.timeTick + visibleTime;\n  } else {\n    let numVisibleBeats = chartAreaHeight / ARROW_HEIGHT;\n    numVisibleBeats /= mods.speed;\n\n    windowStart = globalParams.beatTick - 1 / mods.speed;\n    windowEnd = globalParams.beatTick + numVisibleBeats;\n  }\n\n  const windowStartPtr = {};\n  const windowEndPtr = {};\n\n  // if no arrows have passed yet (or none exist), set pointer to beginning\n  if (!arrows.length || arrows[0][timestamp] > windowStart) {\n    windowStartPtr.arrow = 0;\n  }\n  // if no more arrows left\n  else if (arrows[arrows.length - 1][timestamp] < windowStart) {\n    windowStartPtr.arrow = arrows.length;\n  }\n  // if at least one arrow has passed, find the topmost arrow that has yet to pass\n  // binary search would be ideal. for now, just use an ordinary O(n) search\n  else {\n    for (let i = 1; i < arrows.length; i++) {\n      const previousArrow = arrows[i - 1];\n      const currentArrow = arrows[i];\n\n      // return the index of the first arrow that lies on or after the current beat tick\n      if (\n        previousArrow[timestamp] < windowStart &&\n        currentArrow[timestamp] >= windowStart\n      ) {\n        windowStartPtr.arrow = i;\n        break;\n      }\n    }\n  }\n\n  // start pointer for shock arrows\n  if (!shocks.length || shocks[0][timestamp] > windowStart) {\n    windowStartPtr.shock = 0;\n  } else if (shocks[shocks.length - 1][timestamp] < windowStart) {\n    windowStartPtr.shock = shocks.length;\n  } else {\n    for (let i = 1; i < shocks.length; i++) {\n      if (\n        shocks[i - 1][timestamp] < windowStart &&\n        shocks[i][timestamp] >= windowStart\n      ) {\n        windowStartPtr.shock = i;\n        break;\n      }\n    }\n  }\n\n  // start pointer for bpm/stop values\n  [\"bpm\", \"stop\"].forEach((event) => {\n    const events = globalParams[`${event}Queue`];\n    const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n    if (!events.length || events[0][ts] > windowStart) {\n      windowStartPtr[event] = 0;\n    } else if (events[events.length - 1][ts] < windowStart) {\n      windowStartPtr[event] = events.length;\n    } else {\n      for (let i = 1; i < events.length; i++) {\n        if (events[i - 1][ts] < windowStart && events[i][ts] >= windowStart) {\n          windowStartPtr[event] = i;\n          break;\n        }\n      }\n    }\n  });\n\n  // find start pointer for freeze bodies. copy of above logic for regular arrows\n  if (!freezes.length || freezes[0][timestamp] > windowStart) {\n    windowStartPtr.freeze = 0;\n  } else if (freezes[freezes.length - 1][timestamp] < windowStart) {\n    windowStartPtr.freeze = freezes.length;\n  } else {\n    for (let i = 1; i < freezes.length; i++) {\n      if (\n        freezes[i - 1][timestamp] < windowStart &&\n        freezes[i][timestamp] >= windowStart\n      ) {\n        windowStartPtr.freeze = i;\n        break;\n      }\n    }\n  }\n\n  // repeat for end pointer\n\n  // if there are no arrows on screen and the next \"top arrow\" is pointing to an arrow\n  // that has yet to appear, point the next \"bottom arrow\" to the arrow BEFORE the top arrow.\n  // This replicates the way the pointers naturally update when the screen reaches a section\n  // with no visible arrows, essentially meaning there are no arrows to iterate over and render\n\n  let nextTopArrow = arrows[windowStartPtr.arrow];\n\n  // short-circuit if chart is over or if no arrows are on screen\n  if (\n    windowStartPtr.arrow >= arrows.length ||\n    nextTopArrow[timestamp] > windowEnd\n  ) {\n    windowEndPtr.arrow = windowStartPtr.arrow - 1;\n  }\n\n  // if at least one arrow is on screen\n  else {\n    for (let j = windowStartPtr.arrow; j < arrows.length; j++) {\n      const currentArrow = arrows[j];\n      const nextArrow = arrows[j + 1];\n\n      // if there is no next arrow, the end has been reached\n      if (!nextArrow) {\n        windowEndPtr.arrow = j;\n        break;\n      } else if (\n        currentArrow[timestamp] <= windowEnd &&\n        nextArrow[timestamp] > windowEnd\n      ) {\n        windowEndPtr.arrow = j;\n        break;\n      }\n    }\n  }\n\n  // end pointer for shock arrows\n  let nextTopShock = shocks[windowStartPtr.shock];\n  if (\n    windowStartPtr.shock >= shocks.length ||\n    nextTopShock[timestamp] > windowEnd\n  ) {\n    windowEndPtr.shock = windowStartPtr.shock - 1;\n  } else {\n    for (let i = windowStartPtr.shock; i < shocks.length; i++) {\n      const currentShock = shocks[i];\n      const nextShock = shocks[i + 1];\n      if (\n        !nextShock ||\n        (currentShock[timestamp] <= windowEnd &&\n          nextShock[timestamp] > windowEnd)\n      ) {\n        windowEndPtr.shock = i;\n        break;\n      }\n    }\n  }\n\n  // end pointer for bpm/stop values\n  [\"bpm\", \"stop\"].forEach((event) => {\n    const events = globalParams[`${event}Queue`];\n    const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n    let nextTopEvent = events[windowStartPtr[event]];\n    if (\n      windowStartPtr[event] >= events.length ||\n      nextTopEvent[ts] > windowEnd\n    ) {\n      windowEndPtr[event] = windowStartPtr[event] - 1;\n    } else {\n      for (let i = windowStartPtr[event]; i < events.length; i++) {\n        const currentEvent = events[i];\n        const nextEvent = events[i + 1];\n        if (\n          !nextEvent ||\n          (currentEvent[ts] <= windowEnd && nextEvent[ts] > windowEnd)\n        ) {\n          windowEndPtr[event] = i;\n          break;\n        }\n      }\n    }\n  });\n\n  const holdEnds = mods.speed === \"cmod\" ? \"holdEndTimes\" : \"holdEndBeats\";\n\n  // find end pointer for freeze bodies\n  let nextTopFreeze = freezes[windowStartPtr.freeze];\n  if (windowStartPtr.freeze >= freezes.length) {\n    windowEndPtr.freeze = windowStartPtr.freeze - 1;\n  }\n\n  // if the next top arrow is off screen\n  else if (nextTopFreeze[timestamp] > windowEnd) {\n    windowEndPtr.freeze = windowStartPtr.freeze - 1;\n\n    // if the off-screen arrow is in the middle of (or part of) a freeze,\n    // increment the end pointer until it matches the latest hold end (which could either\n    // be part of itself or part of an adjacent freeze arrow)\n    if (nextTopFreeze[holdEnds]) {\n      const latestHoldEnd = Math.max(\n        ...nextTopFreeze[holdEnds].filter((a) => a)\n      );\n      windowEndPtr.freeze = windowStartPtr.freeze;\n      while (freezes[windowEndPtr.freeze][timestamp] < latestHoldEnd)\n        windowEndPtr.freeze++;\n    }\n  }\n  // if at least one arrow is on screen\n  else {\n    for (let i = windowStartPtr.freeze; i < freezes.length; i++) {\n      const currentFreeze = freezes[i];\n      const nextFreeze = freezes[i + 1];\n\n      if (!nextFreeze) {\n        windowEndPtr.freeze = i;\n        break;\n      }\n      // if the last visible arrow is in the middle of (or part of) a freeze,\n      // increment the end pointer until it matches the latest holdEndBeat (which could either\n      // be part of itself or part of an adjacent freeze arrow)\n      else if (\n        currentFreeze[timestamp] <= windowEnd &&\n        nextFreeze[timestamp] > windowEnd\n      ) {\n        if (currentFreeze[holdEnds]) {\n          const latestHoldEnd = Math.max(\n            ...currentFreeze[holdEnds].filter((a) => a)\n          );\n\n          while (freezes[i][timestamp] < latestHoldEnd) i++;\n        }\n        windowEndPtr.freeze = i;\n        break;\n      }\n    }\n  }\n\n  if (mods.speed === \"cmod\") {\n    globalParams.timeWindowStartPtr = windowStartPtr;\n    globalParams.timeWindowEndPtr = windowEndPtr;\n    globalParams.currentTimeWindow = [windowStart, windowEnd];\n  } else {\n    globalParams.beatWindowStartPtr = windowStartPtr;\n    globalParams.beatWindowEndPtr = windowEndPtr;\n    globalParams.currentBeatWindow = [windowStart, windowEnd];\n  }\n\n  // globalParams.currentBeatWindow = currentBeatWindow;\n\n  // console.log(\"initialize beat window\", currentBeatWindow);\n};\n\n/*\n  Assuming the beat pointer is already defined, invoke this method on every subsequent\n  frame to incrementally update the window values and determine if the pointer needs\n  to be shifted\n*/\nexport const updateBeatWindow = (globalParams) => {\n  const { arrows, freezes, shocks, chartAreaHeight, mods } = globalParams;\n\n  let windowStartPtr, windowEndPtr, timestamp;\n  if (mods.speed === \"cmod\") {\n    windowStartPtr = globalParams.timeWindowStartPtr;\n    windowEndPtr = globalParams.timeWindowEndPtr;\n    timestamp = \"timestamp\";\n  } else {\n    windowStartPtr = globalParams.beatWindowStartPtr;\n    windowEndPtr = globalParams.beatWindowEndPtr;\n    timestamp = \"beatstamp\";\n  }\n\n  if (\n    typeof windowStartPtr === \"undefined\" ||\n    typeof windowEndPtr === \"undefined\" ||\n    !Object.keys(windowStartPtr).length ||\n    !Object.keys(windowEndPtr).length\n  )\n    return;\n\n  // calculate number of beats (on 1x scroll) covered by the visible chart area\n  // = number of arrow heights that can fit on screen + 1 extra arrow height on top and bottom\n  // then divided by the scroll speed mod\n  // let numVisibleBeats = (chartAreaHeight + ARROW_HEIGHT) / ARROW_HEIGHT;\n  let windowStart, windowEnd;\n  if (mods.speed === \"cmod\") {\n    let visibleTime = chartAreaHeight / ARROW_HEIGHT;\n    visibleTime /= mods.cmod / 60;\n    windowStart = globalParams.timeTick - 1 / (mods.cmod / 60);\n    windowEnd = globalParams.timeTick + visibleTime;\n    globalParams.currentTimeWindow = [windowStart, windowEnd];\n  } else {\n    let numVisibleBeats = chartAreaHeight / ARROW_HEIGHT;\n    numVisibleBeats /= mods.speed;\n\n    windowStart = globalParams.beatTick - 1 / mods.speed;\n    windowEnd = globalParams.beatTick + numVisibleBeats;\n    globalParams.currentBeatWindow = [windowStart, windowEnd];\n  }\n\n  // short-circuit if chart is over\n  if (windowStartPtr.arrow === arrows.length) return;\n\n  // if chart is just beginning, watch for the first arrow (unless it is a freeze)\n  // short-circuit if it has not begun\n  if (windowEndPtr.arrow === -1) {\n    // if the first arrow has finally appeared, set the end ptr\n    if (arrows[0][timestamp] <= windowEnd) {\n      windowEndPtr.arrow = 0;\n    }\n  }\n\n  // watch for first shock if applicable\n  if (\n    shocks.length &&\n    windowEndPtr.shock === -1 &&\n    shocks[0][timestamp] <= windowEnd\n  ) {\n    windowEndPtr.shock = 0;\n  }\n\n  // watch for first bpm change/stop\n  [\"bpm\", \"stop\"].forEach((event) => {\n    const events = globalParams[`${event}Queue`];\n    const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n    if (\n      events.length &&\n      windowEndPtr[event] === -1 &&\n      events[0][ts] <= windowEnd\n    ) {\n      windowEndPtr[event] = 0;\n    }\n  });\n\n  // Watching top arrow\n  //\n  // if there are arrows on the screen, and the topmost arrow from the previous frame is\n  // now behind the updated windowStart\n  const topmostArrow = arrows[windowStartPtr.arrow];\n\n  let nextTopArrow = topmostArrow;\n\n  // topmost arrow is no longer the topmost arrow when it is behind windowStart\n  while (nextTopArrow[timestamp] < windowStart) {\n    windowStartPtr.arrow++;\n\n    // no more arrows left\n    if (windowStartPtr.arrow >= arrows.length) return;\n\n    nextTopArrow = arrows[windowStartPtr.arrow];\n  }\n\n  // watching top shock arrow\n  let nextTopShock = shocks[windowStartPtr.shock];\n  while (nextTopShock && nextTopShock[timestamp] < windowStart) {\n    windowStartPtr.shock++;\n    nextTopShock = shocks[windowStartPtr.shock];\n  }\n\n  // watch for first bpm change/stop\n  [\"bpm\", \"stop\"].forEach((event) => {\n    const events = globalParams[`${event}Queue`];\n    const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n    let nextTopEvent = events[windowStartPtr[event]];\n    while (nextTopEvent && nextTopEvent[ts] < windowStart) {\n      windowStartPtr[event]++;\n      nextTopEvent = events[windowStartPtr[event]];\n    }\n  });\n\n  // watching top freeze arrow\n  let nextTopFreeze = freezes[windowStartPtr.freeze];\n  while (nextTopFreeze && nextTopFreeze[timestamp] < windowStart) {\n    windowStartPtr.freeze++;\n    nextTopFreeze = freezes[windowStartPtr.freeze];\n  }\n\n  // Watching bottom arrow\n  //\n  // if there are arrows on the screen, and the arrow AFTER the bottommost arrow from the previous\n  // frame is now behind the updated windowEnd\n  let nextBottomArrow = arrows[windowEndPtr.arrow];\n  let nextBottomArrowAdj = arrows[windowEndPtr.arrow + 1];\n\n  // bottommost arrow is no longer bottommost arrow when the next arrow is behind windowEnd\n  while (nextBottomArrowAdj && nextBottomArrowAdj[timestamp] <= windowEnd) {\n    windowEndPtr.arrow++;\n    nextBottomArrow = arrows[windowEndPtr.arrow];\n    nextBottomArrowAdj = arrows[windowEndPtr.arrow + 1];\n  }\n\n  // watching bottom shock arrow\n  let nextBottomShock = shocks[windowEndPtr.shock];\n  let nextBottomShockAdj = shocks[windowEndPtr.shock + 1];\n  while (nextBottomShockAdj && nextBottomShockAdj[timestamp] <= windowEnd) {\n    windowEndPtr.shock++;\n    nextBottomShock = shocks[windowEndPtr.shock];\n    nextBottomShockAdj = shocks[windowEndPtr.shock + 1];\n  }\n\n  // watch for first bpm change/stop\n  [\"bpm\", \"stop\"].forEach((event) => {\n    const events = globalParams[`${event}Queue`];\n    const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n    let nextBottomEvent = events[windowEndPtr[event]];\n    let nextBottomEventAdj = events[windowEndPtr[event] + 1];\n    while (nextBottomEventAdj && nextBottomEventAdj[ts] <= windowEnd) {\n      windowEndPtr[event]++;\n      nextBottomEvent = events[windowEndPtr[event]];\n      nextBottomEventAdj = events[windowEndPtr[event] + 1];\n    }\n  });\n\n  // watching bottom freeze arrow\n  let nextBottomFreeze = freezes[windowEndPtr.freeze];\n  let nextBottomFreezeAdj = freezes[windowEndPtr.freeze + 1];\n  while (nextBottomFreezeAdj && nextBottomFreezeAdj[timestamp] <= windowEnd) {\n    windowEndPtr.freeze++;\n    nextBottomFreeze = freezes[windowEndPtr.freeze];\n    nextBottomFreezeAdj = freezes[windowEndPtr.freeze + 1];\n  }\n\n  // extend the freeze window to reach the latest hold end\n  if (nextBottomFreeze) {\n    const holdEnds = mods.speed === \"cmod\" ? \"holdEndTimes\" : \"holdEndBeats\";\n    const latestHoldEnd = Math.max(\n      ...nextBottomFreeze[holdEnds].filter((a) => a)\n    );\n    while (freezes[windowEndPtr.freeze][timestamp] < latestHoldEnd) {\n      windowEndPtr.freeze++;\n    }\n  }\n\n  // ^ because a freeze tail happening simultaneously as the head of a different freeze\n  // are counted as the same note, if the end pointer falls on such a note, the above code cannot\n  // tell whether it is referring to the former's tail or the latter's head.\n  // therefore, it will result in the beat window being extended all the way down to the end of\n  // any \"freeze chain\", including any freezes that are not yet visible on the screen in any form.\n  // this makes the engine loop over slightly more arrows than necessary, but this is fine for now\n\n  // const allArrowsInWindow = [];\n  // for (\n  //   let i = globalParams.windowStartPtr.freeze;\n  //   i <= globalParams.windowEndPtr.freeze;\n  //   i++\n  // ) {\n  //   allArrowsInWindow.push(i);\n  // }\n  // console.log(allArrowsInWindow);\n\n  if (mods.speed === \"cmod\") {\n    globalParams.timeWindowStartPtr = windowStartPtr;\n    globalParams.timeWindowEndPtr = windowEndPtr;\n  } else {\n    globalParams.beatWindowStartPtr = windowStartPtr;\n    globalParams.beatWindowEndPtr = windowEndPtr;\n  }\n};\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  FREEZE_BODY_HEIGHT,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`rainbow_${direction}`] = new Image();\n  arrowImages[`rainbow_${direction}`].src = getAssetPath(\n    `rainbow_${direction}.png`\n  );\n  arrowImages[`note_${direction}`] = new Image();\n  arrowImages[`note_${direction}`].src = getAssetPath(`note_${direction}.png`);\n  arrowImages[`vivid_${direction}`] = new Image();\n  arrowImages[`vivid_${direction}`].src = getAssetPath(\n    `vivid_${direction}.png`\n  );\n  arrowImages[`flat_${direction}`] = new Image();\n  arrowImages[`flat_${direction}`].src = getAssetPath(`vivid_${direction}.png`);\n});\n\nconst freezeImages = [\n  \"freeze_head\",\n  \"tap_explosion\",\n  \"freeze_tail_active\",\n  \"freeze_tail_inactive\",\n  \"freeze_body_active\",\n  \"freeze_body_inactive\",\n];\nfreezeImages.forEach((imageName) => {\n  arrowImages[imageName] = new Image();\n  arrowImages[imageName].src = getAssetPath(`${imageName}.png`);\n});\n\nclass Arrow {\n  constructor(attrs) {\n    const { key } = attrs;\n\n    this.key = key; // arrow index\n    this.note = attrs.note;\n    this.measureIdx = attrs.measureIdx;\n    this.measureN = attrs.measureN;\n    this.measureD = attrs.measureD;\n\n    this.beatstamp = attrs.beatstamp;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.beatstamp - beatTick;\n  }\n  currentTimePosition(timeTick) {\n    return this.timestamp - timeTick;\n  }\n\n  renderFreezeBody(canvas, { beatTick, timeTick }, directionIdx, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mods } = attrs;\n    const { speed, cmod, scroll, appearance } = mods;\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // freeze body and tail\n    if (this.note[directionIdx] === \"3\") {\n      arrowImg = arrowImages[`freeze_tail_inactive`];\n\n      frameX =\n        ((directionIdx % 4) + (scroll === \"reverse\" ? 4 : 0)) * ARROW_WIDTH;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n\n      if (speed === \"cmod\") {\n        destY = this.currentTimePosition(timeTick) * ARROW_HEIGHT * (cmod / 60);\n      } else {\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * speed;\n      }\n\n      // Bottom of freeze body must be the bottom of the body image (yellow part of gradient)\n      // and line up with the top of the freeze tail.\n      // Extend the freeze body upwards using as many repetitions of the 128px height image as needed.\n      // Top of freeze body is cut off at the midpoint of the freeze head.\n      let arrowBodyImg = arrowImages[`freeze_body_inactive`];\n\n      let totalBodyHeight;\n      if (speed === \"cmod\") {\n        totalBodyHeight =\n          (this.holdEndTimes[directionIdx] -\n            this.holdStartTimes[directionIdx]) *\n            ARROW_HEIGHT *\n            (cmod / 60) -\n          ARROW_HEIGHT / 2;\n      } else {\n        totalBodyHeight =\n          (this.holdEndBeats[directionIdx] -\n            this.holdStartBeats[directionIdx]) *\n            ARROW_HEIGHT *\n            speed -\n          ARROW_HEIGHT / 2;\n      }\n      const repetitions = Math.floor(totalBodyHeight / FREEZE_BODY_HEIGHT);\n      let partialHeight = totalBodyHeight % FREEZE_BODY_HEIGHT;\n      const originalPartialHeight = partialHeight;\n\n      let partialDestY = destY - (totalBodyHeight + ARROW_HEIGHT / 2);\n      let freezeBeingHeld = false;\n\n      // shrink in size once it reaches the target\n      // this is also where the freeze starts to be held down\n      if (partialDestY <= 0) {\n        partialHeight += partialDestY;\n        partialDestY = 0;\n        arrowImg = arrowImages[`freeze_tail_active`];\n        arrowBodyImg = arrowImages[`freeze_body_active`];\n\n        if (destY > 0) {\n          freezeBeingHeld = true;\n        }\n      }\n\n      // draw partial\n      if (\n        partialDestY > -partialHeight &&\n        partialDestY < bottomBoundary &&\n        appearance !== \"stealth\"\n      ) {\n        c.drawImage(\n          arrowBodyImg,\n          frameX,\n          scroll === \"reverse\" ? 0 : FREEZE_BODY_HEIGHT - partialHeight,\n          ARROW_WIDTH,\n          partialHeight,\n          destX,\n          scroll === \"reverse\"\n            ? getReverseCoord(\n                partialDestY + ARROW_HEIGHT / 2,\n                partialHeight,\n                canvas\n              )\n            : partialDestY + ARROW_HEIGHT / 2,\n          ARROW_WIDTH,\n          partialHeight\n        );\n      }\n\n      // draw repetitions of freeze body\n      for (let i = 1; i <= repetitions; i++) {\n        let bodyHeight = FREEZE_BODY_HEIGHT;\n        let bodyFrameY = 0;\n        let bodyDestY =\n          destY -\n          (totalBodyHeight +\n            ARROW_HEIGHT / 2 -\n            originalPartialHeight -\n            FREEZE_BODY_HEIGHT * (i - 1));\n        if (bodyDestY < 0 && bodyDestY > -FREEZE_BODY_HEIGHT) {\n          bodyHeight += bodyDestY;\n          bodyFrameY -= bodyDestY;\n          bodyDestY = 0;\n        }\n        if (\n          bodyDestY > -bodyHeight &&\n          bodyDestY < bottomBoundary &&\n          appearance !== \"stealth\"\n        ) {\n          c.drawImage(\n            arrowBodyImg,\n            frameX,\n            scroll === \"reverse\" ? 0 : bodyFrameY,\n            ARROW_WIDTH,\n            bodyHeight,\n            destX,\n            scroll === \"reverse\"\n              ? getReverseCoord(\n                  bodyDestY + ARROW_HEIGHT / 2,\n                  bodyHeight,\n                  canvas\n                )\n              : bodyDestY + ARROW_HEIGHT / 2,\n            ARROW_WIDTH,\n            bodyHeight\n          );\n        }\n      }\n\n      let tailHeight = ARROW_HEIGHT;\n\n      // if the freeze is shorter than the height of the tail sprite,\n      // cut off the top of the sprite such that it starts at the midpoint of the freeze head\n\n      // Because we need to overwrite destY for proper sprite placement in the event that the\n      // top of the sprite needs to be cut off, store the actual Y position of the arrow\n      // in a separate variable\n      let actualDestY = destY;\n\n      let bodyDistance;\n      if (speed === \"cmod\") {\n        bodyDistance =\n          (this.holdEndTimes[directionIdx] -\n            this.holdStartTimes[directionIdx]) *\n          ARROW_HEIGHT *\n          (cmod / 60);\n      } else {\n        bodyDistance =\n          (this.holdEndBeats[directionIdx] -\n            this.holdStartBeats[directionIdx]) *\n          ARROW_HEIGHT *\n          speed;\n      }\n\n      if (bodyDistance < ARROW_HEIGHT / 2) {\n        const tailPartialHeight = bodyDistance; // distance between head note and tail note, less than half arrow height\n        frameY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        destY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        tailHeight = tailPartialHeight + ARROW_HEIGHT / 2;\n      }\n\n      // shrink in size once it reaches the target\n      if (destY < ARROW_HEIGHT / 2 && destY > topBoundary) {\n        frameY += ARROW_HEIGHT / 2 - destY;\n        destY = ARROW_HEIGHT / 2;\n      }\n\n      if (\n        actualDestY > topBoundary &&\n        actualDestY < bottomBoundary &&\n        appearance !== \"stealth\"\n      ) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          scroll === \"reverse\" ? 0 : frameY,\n          ARROW_WIDTH,\n          scroll === \"reverse\" ? ARROW_HEIGHT - frameY : tailHeight,\n          destX,\n          scroll === \"reverse\"\n            ? getReverseCoord(actualDestY, ARROW_HEIGHT, canvas)\n            : destY,\n          ARROW_WIDTH,\n          scroll === \"reverse\" ? ARROW_HEIGHT - frameY : tailHeight\n        );\n      }\n\n      // render head of held freeze arrow on top of the arrow body\n      if (freezeBeingHeld) {\n        const arrowHeadImg = arrowImages.freeze_head;\n        c.drawImage(\n          arrowHeadImg,\n          DIRECTIONS.indexOf(direction) * ARROW_WIDTH,\n          ARROW_HEIGHT * 2,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          directionIdx * ARROW_WIDTH,\n          scroll === \"reverse\" ? getReverseCoord(0, ARROW_HEIGHT, canvas) : 0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    }\n  }\n\n  renderArrow(canvas, { beatTick, timeTick }, directionIdx, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mods } = attrs;\n    const { speed, cmod, noteskin, colorFreezes, scroll, appearance } = mods;\n\n    const topBoundary = 0; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height; // can be adjusted with SUDDEN+\n\n    // nothing\n    if (this.note[directionIdx] === \"0\") return;\n\n    // stealth\n    if (appearance === \"stealth\") return;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // regular note\n    if (\n      this.note[directionIdx] === \"1\" ||\n      (this.note[directionIdx] === \"2\" && colorFreezes)\n    ) {\n      // console.log(\"arrow\", directionIdx);\n      arrowImg = arrowImages[`${noteskin}_${direction}`];\n\n      // color as freeze head if it is hit simultaneously with a freeze arrow\n      if (this.note.includes(\"2\") && !colorFreezes) {\n        arrowImg = arrowImages.freeze_head;\n        frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        frameY = 0;\n      } else {\n        if (noteskin === \"rainbow\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (noteskin === \"note\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          /* \n              NOTE: In the future, if we want to support color codes for 12ths, 24ths, etc.\n              We need to use more precise math to avoid rounding errors.\n              Planned approach: Reduce the measure fraction by dividing both numerator and denominator\n              by their greatest common factor.\n              If GCF == 1, 2, or 4, use 4th note quantization.\n              Otherwise, the resulting denominator is used for the quantization (3 and 6 may be treated as 12ths)\n            */\n          const measureFraction = this.measureN / this.measureD;\n          if ([0, 1 / 4, 2 / 4, 3 / 4].includes(measureFraction)) {\n            frameY = 0;\n          } else if ([1 / 8, 3 / 8, 5 / 8, 7 / 8].includes(measureFraction)) {\n            frameY = 1;\n          } else if (\n            [\n              1 / 16,\n              3 / 16,\n              5 / 16,\n              7 / 16,\n              9 / 16,\n              11 / 16,\n              13 / 16,\n              15 / 16,\n            ].includes(measureFraction)\n          ) {\n            frameY = 3;\n          } else {\n            frameY = 2;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (noteskin === \"vivid\") {\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          const noteOffset = Math.floor(beatTick) % 4;\n\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY = ((frameY + noteOffset) % 4) * ARROW_HEIGHT;\n        } else if (noteskin === \"flat\") {\n          arrowImg = arrowImages[`vivid_${direction}`];\n\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n          frameY = (Math.floor(beatTick) % 4) * ARROW_HEIGHT;\n        }\n      }\n\n      destX = directionIdx * ARROW_WIDTH;\n      if (speed === \"cmod\") {\n        destY = this.currentTimePosition(timeTick) * ARROW_HEIGHT * (cmod / 60);\n      } else {\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * speed;\n      }\n      destY = (destY + 0.5) | 0;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          scroll === \"reverse\"\n            ? getReverseCoord(destY, ARROW_HEIGHT, canvas)\n            : destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n        // console.log(destY);\n      }\n    }\n\n    // freeze note\n    else if (this.note[directionIdx] === \"2\") {\n      arrowImg = arrowImages.freeze_head;\n      frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n      if (speed === \"cmod\") {\n        destY = this.currentTimePosition(timeTick) * ARROW_HEIGHT * (cmod / 60);\n      } else {\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * speed;\n      }\n      destY = (destY + 0.5) | 0;\n\n      // draw freeze head\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          scroll === \"reverse\"\n            ? getReverseCoord(destY, ARROW_HEIGHT, canvas)\n            : destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n        // console.log(destY);\n      }\n    }\n  }\n}\n\nexport default Arrow;\n","import { DIRECTIONS, ARROW_WIDTH, ARROW_HEIGHT } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nclass ShockArrow {\n  constructor(attrs) {\n    const { key } = attrs;\n\n    this.key = key;\n    this.note = attrs.note;\n\n    this.beatstamp = attrs.beatstamp;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.beatstamp - beatTick;\n  }\n  currentTimePosition(timeTick) {\n    return this.timestamp - timeTick;\n  }\n\n  render(canvas, frame, { beatTick, timeTick }, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mods } = attrs;\n    const { speed, cmod, scroll, appearance } = mods;\n\n    if (appearance === \"stealth\") return;\n\n    const topBoundary = -ARROW_HEIGHT; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height;\n    frame = Math.floor(frame / 3) % 8; // each sprite frame lasts 3 canvas animation frames\n\n    for (let i = 0; i < this.note.length; i++) {\n      if (this.note[i] !== \"M\") continue;\n      const direction = DIRECTIONS[i % 4];\n      const arrowImg = arrowImages[`shock_${direction}`];\n      const frameX = (frame % 4) * ARROW_WIDTH;\n      const frameY = Math.floor(frame / 4) * ARROW_HEIGHT;\n      const destX = i * ARROW_WIDTH;\n      let destY;\n      if (speed === \"cmod\") {\n        destY = this.currentTimePosition(timeTick) * ARROW_HEIGHT * (cmod / 60);\n      } else {\n        destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * speed;\n      }\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          scroll === \"reverse\"\n            ? getReverseCoord(destY, ARROW_HEIGHT, canvas)\n            : destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    }\n  }\n}\n\nexport default ShockArrow;\n","import { DIRECTIONS, ARROW_HEIGHT, ARROW_WIDTH } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nconst flashImages = {};\nDIRECTIONS.forEach((direction) => {\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n});\n\nconst receptorImages = {};\nDIRECTIONS.forEach((direction) => {\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n});\n\nclass StepZone {\n  constructor(attrs) {}\n\n  render(canvas, { beatTick }, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mode, mods } = attrs;\n    const { scroll } = mods;\n\n    // flash starts at the beginning of the quarter beat and lasts for 1/16 beat\n    const isFlash = beatTick % 1 > 0 && beatTick % 1 < 0.25;\n\n    DIRECTIONS.forEach((direction, i) => {\n      c.drawImage(\n        isFlash ? flashImages[direction] : receptorImages[direction],\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        i * ARROW_WIDTH,\n        scroll === \"reverse\" ? getReverseCoord(0, ARROW_HEIGHT, canvas) : 0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT\n      );\n\n      if (mode === \"double\") {\n        c.drawImage(\n          isFlash ? flashImages[direction] : receptorImages[direction],\n          0,\n          0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          (i + 4) * ARROW_WIDTH,\n          scroll === \"reverse\" ? getReverseCoord(0, ARROW_HEIGHT, canvas) : 0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    });\n  }\n}\n\nexport default StepZone;\n","import { ARROW_HEIGHT } from \"../../../constants\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nclass Guidelines {\n  constructor(finalBeat) {\n    this.finalBeat = finalBeat;\n  }\n\n  render(canvas, { beatTick, timeTick }, attrs) {\n    const { mods } = attrs;\n    const { speed, scroll, cmod } = mods;\n\n    const showGuidelines = mods.guidelines;\n    if (!showGuidelines) return;\n\n    // FIXME: do an actual spacing calculation for cmod\n    if (speed === \"cmod\") return;\n\n    const c = canvas.getContext(\"2d\");\n    c.strokeStyle = \"#fff\";\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    for (let beat = 0; beat <= this.finalBeat; beat++) {\n      let destY = (beat - beatTick) * ARROW_HEIGHT * speed + ARROW_HEIGHT / 2;\n      // let destY = (beat - beatTick) * ARROW_HEIGHT * speed;\n\n      destY = (destY + 0.5) | 0;\n\n      // Render a thick line if the beat falls on the beginning of the measure.\n      // Render a thin line otherwise\n      const lineWidth = beat % 4 === 0 ? 2 : 1;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        if (scroll === \"reverse\") {\n          destY = getReverseCoord(destY, 0, canvas);\n        }\n        c.beginPath();\n        c.moveTo(0, destY);\n        c.lineTo(canvas.width, destY);\n        c.lineWidth = lineWidth;\n        c.stroke();\n      }\n    }\n  }\n}\n\nexport default Guidelines;\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nconst image = new Image();\nimage.src = getAssetPath(\"tap_explosion.png\");\n\nclass TargetFlash {\n  constructor(arrow) {\n    this.frame = -1;\n\n    this.directions = [];\n    arrow.note.forEach((note, directionIdx) => {\n      if (note === \"1\" || note === \"2\" || note === \"3\") {\n        this.directions.push(directionIdx);\n      }\n    });\n  }\n\n  render(canvas, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mods } = attrs;\n    const { scroll } = mods;\n\n    this.directions.forEach((directionIdx) => {\n      if (this.frame < 0 || this.frame >= MARVELOUS_FLASH_FRAMES) return;\n      const destX = directionIdx * ARROW_WIDTH;\n\n      c.save();\n      c.globalAlpha = 1 - Math.pow(this.frame / MARVELOUS_FLASH_FRAMES, 3);\n      c.drawImage(\n        image,\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        destX - this.frame,\n        scroll === \"reverse\"\n          ? getReverseCoord(0 + this.frame, ARROW_HEIGHT, canvas)\n          : 0 - this.frame,\n        ARROW_WIDTH + this.frame * 2,\n        ARROW_HEIGHT + this.frame * 2\n      );\n      c.restore();\n    });\n  }\n}\n\nexport default TargetFlash;\n","import { getAssetPath } from \"../../../utils\";\n\nconst comboImages = {};\n\n[\"A20\", \"A\"].forEach((type) => {\n  comboImages[type] = {\n    num: new Image(),\n    combo: new Image(),\n  };\n  comboImages[type].num.src = getAssetPath(`combo_numbers_${type}.png`);\n  comboImages[type].combo.src = getAssetPath(`combo_${type}.png`);\n});\n\ncomboImages[\"A20\"].coords = {\n  1: {\n    combo: { destX: 104, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [51], destY: 170, width: 63, height: 70 },\n  },\n  2: {\n    combo: { destX: 114, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [17, 61], destY: 170, width: 63, height: 70 },\n  },\n  3: {\n    combo: { destX: 134, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [-7, 37, 81], destY: 170, width: 63, height: 70 },\n  },\n  4: {\n    combo: { destX: 134, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [-51, -7, 37, 81], destY: 170, width: 63, height: 70 },\n  },\n};\n\ncomboImages[\"A\"].coords = {\n  1: {\n    combo: { destX: 104, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [51], destY: 170, width: 63, height: 70 },\n  },\n  2: {\n    combo: { destX: 114, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [17, 61], destY: 170, width: 63, height: 70 },\n  },\n  3: {\n    combo: { destX: 134, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [-7, 37, 81], destY: 170, width: 63, height: 70 },\n  },\n  4: {\n    combo: { destX: 134, destY: 195, width: 124.5, height: 41 },\n    num: { destX: [-51, -7, 37, 81], destY: 170, width: 63, height: 70 },\n  },\n};\n\nconst doubleXOffset = 128;\n\nclass ComboDisplay {\n  constructor(attrs) {}\n\n  render(canvas, comboNum = 0, attrs) {\n    const c = canvas.getContext(\"2d\");\n    if (comboNum < 4) return;\n\n    const { mods, mode } = attrs;\n    const { comboFont } = mods;\n\n    let type = comboFont;\n\n    comboNum = comboNum.toString();\n    const numDigits = comboNum.length;\n    // console.log(\"comboNum\", comboNum, \"numDigits\", numDigits);\n\n    const comboImg = comboImages[type].combo;\n    const numImg = comboImages[type].num;\n\n    const comboDestX =\n      comboImages[type].coords[numDigits].combo.destX +\n      (mode === \"double\" ? doubleXOffset : 0);\n    const comboDestY = comboImages[type].coords[numDigits].combo.destY;\n    const comboWidth = comboImages[type].coords[numDigits].combo.width;\n    const comboHeight = comboImages[type].coords[numDigits].combo.height;\n\n    // draw combo word\n    c.drawImage(\n      comboImg,\n      0,\n      0,\n      comboImg.width,\n      comboImg.height,\n      comboDestX,\n      comboDestY,\n      comboWidth,\n      comboHeight\n    );\n\n    // draw combo number\n    for (let i = 0; i < numDigits; i++) {\n      const digit = comboNum[i];\n\n      const digitWidth = numImg.width / 4;\n      const digitHeight = numImg.height / 4;\n      const imageCol = digit % 4;\n      const imageRow = Math.floor(digit / 4);\n      const imageX = imageCol * digitWidth;\n      const imageY = imageRow * digitHeight;\n\n      const numDestX =\n        comboImages[type].coords[numDigits].num.destX[i] +\n        (mode === \"double\" ? doubleXOffset : 0);\n      const numDestY = comboImages[type].coords[numDigits].num.destY;\n      const numWidth = comboImages[type].coords[numDigits].num.width;\n      const numHeight = comboImages[type].coords[numDigits].num.height;\n\n      // console.log(\n      //   `digit ${digit}, i ${i}, imageX ${imageX}, imageY ${imageY}, numDestX ${numDestX}, numDestY ${numDestY}, numWidth ${numWidth}, numHeight ${numHeight}`\n      // );\n\n      c.drawImage(\n        numImg,\n        imageX,\n        imageY,\n        digitWidth,\n        digitHeight,\n        numDestX,\n        numDestY,\n        numWidth,\n        numHeight\n      );\n    }\n  }\n}\n\nexport default ComboDisplay;\n","import { ARROW_HEIGHT } from \"../../../constants\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nclass BpmAndStopDisplay {\n  constructor() {\n    // store key-value pairs for the bpm and stop values\n    // key: the index of the bpm/stop in its queue\n    // value: reference to the DOM element displaying the value\n    this.bpmElements = {};\n    this.stopElements = {};\n  }\n\n  /*\n    Go through the DOM element maps and delete any elements that no longer\n    fall within the window, both from the maps and from the actual DOM.\n  */\n  refreshWindow(eventWindow, attrs) {\n    if (!eventWindow) return;\n    const [windowStart, windowEnd] = eventWindow;\n    const { mods } = attrs;\n    [\"bpm\", \"stop\"].forEach((event) => {\n      const elementMap = this[`${event}Elements`];\n      for (let domKey in elementMap) {\n        const { obj, element } = elementMap[domKey];\n        const ts = mods.speed === \"cmod\" ? \"timestamp\" : \"beat\";\n        if (obj[ts] < windowStart || obj[ts] > windowEnd) {\n          // remove from DOM (if it is still on the DOM) and from map\n          if (element.parentNode) {\n            element.parentNode.removeChild(element);\n          }\n          delete elementMap[domKey];\n        }\n      }\n    });\n\n    // console.log(\"bpmElements after refreshWindow\", this.bpmElements);\n  }\n\n  /*\n    Delete all elements from the DOM, usually when changing the song or difficulty\n  */\n  clearWindow() {\n    [\"bpm\", \"stop\"].forEach((event) => {\n      const elementMap = this[`${event}Elements`];\n      for (let domKey in elementMap) {\n        const { obj, element } = elementMap[domKey];\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        }\n        delete elementMap[domKey];\n      }\n    });\n  }\n\n  /*\n    Check if the event is in its corresponding map by its key.\n    If it exists, update the properties on the existing DOM element.\n    If not, create the DOM element, append it to the reel and store it in the map.\n    Elements in the map that are no longer within the window are deleted\n  */\n  renderBpm(bpmReel, bpm, { beatTick, timeTick }, { mods }) {\n    const key = bpm.beat;\n\n    const pxPosition = getPxPosition(\n      bpm,\n      { beatTick, timeTick },\n      mods,\n      bpmReel\n    );\n    if (!this.bpmElements[key]) {\n      const element = document.createElement(\"div\");\n      element.className = \"bpm-value\";\n      // element.dataset[\"val\"] = bpm.value;\n      element.style.transform = `translateY(${pxPosition}px)`;\n      const valueNode = document.createElement(\"div\");\n      valueNode.textContent = bpm.value;\n      element.appendChild(valueNode);\n      bpmReel.appendChild(element);\n      this.bpmElements[key] = { value: bpm.value, obj: bpm, element };\n    } else {\n      const element = this.bpmElements[key].element;\n      element.style.transform = `translateY(${pxPosition}px)`;\n    }\n  }\n\n  renderStop(stopReel, stop, { beatTick, timeTick }, { mods }) {\n    const key = stop.beat;\n    const pxPosition = getPxPosition(\n      stop,\n      { beatTick, timeTick },\n      mods,\n      stopReel\n    );\n    if (!this.stopElements[key]) {\n      const element = document.createElement(\"div\");\n      element.className = \"stop-value\";\n      // element.dataset[\"val\"] = stop.value;\n      element.style.transform = `translateY(${pxPosition}px)`;\n      const valueNode = document.createElement(\"div\");\n      valueNode.textContent = stop.value;\n      element.appendChild(valueNode);\n      stopReel.appendChild(element);\n      this.stopElements[key] = { value: stop.value, obj: stop, element };\n    } else {\n      const element = this.stopElements[key].element;\n      element.style.transform = `translateY(${pxPosition}px)`;\n    }\n  }\n}\n\nconst getPxPosition = (event, { beatTick, timeTick }, mods, reel) => {\n  let pxPosition;\n  if (mods.speed === \"cmod\") {\n    const timeDiff = event.timestamp - timeTick;\n    pxPosition = timeDiff * ARROW_HEIGHT * (mods.cmod / 60);\n  } else {\n    const beatDiff = event.beat - beatTick;\n    pxPosition = beatDiff * ARROW_HEIGHT * mods.speed;\n  }\n  pxPosition += ARROW_HEIGHT / 2;\n\n  if (mods.scroll === \"reverse\") {\n    pxPosition = getReverseCoord(pxPosition, 0, { height: reel.clientHeight });\n  }\n  return pxPosition;\n};\n\nexport default BpmAndStopDisplay;\n","import { ARROW_WIDTH } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\nimport { getReverseCoord } from \"../../../utils/engineUtils\";\n\nconst images = {};\n\nimages.upper = new Image();\nimages.upper.src = getAssetPath(\"upper_lanecover.png\");\nimages.lower = new Image();\nimages.lower.src = getAssetPath(\"lower_lanecover.png\");\n\nconst appearanceIdx = [\"hidden\", \"sudden\", \"hiddensudden\"];\n\nclass LaneCover {\n  constructor(attrs) {}\n\n  render(canvas, attrs) {\n    const c = canvas.getContext(\"2d\");\n\n    const { mods, mode } = attrs;\n    const { appearance, scroll } = mods;\n    const laneCoverHeight =\n      mods.laneCoverHeight[appearanceIdx.indexOf(appearance)];\n\n    if (\n      (appearance.includes(\"hidden\") && scroll === \"normal\") ||\n      (appearance.includes(\"sudden\") && scroll === \"reverse\")\n    ) {\n      let img = images.upper;\n      c.drawImage(\n        img,\n        0,\n        getReverseCoord(laneCoverHeight, 0, canvas),\n        img.width,\n        laneCoverHeight,\n        0,\n        0,\n        img.width,\n        laneCoverHeight\n      );\n\n      if (mode === \"double\") {\n        c.drawImage(\n          img,\n          0,\n          getReverseCoord(laneCoverHeight, 0, canvas),\n          img.width,\n          laneCoverHeight,\n          ARROW_WIDTH * 4,\n          0,\n          img.width,\n          laneCoverHeight\n        );\n      }\n    }\n    if (\n      (appearance.includes(\"sudden\") && scroll === \"normal\") ||\n      (appearance.includes(\"hidden\") && scroll === \"reverse\")\n    ) {\n      let img = images.lower;\n      c.drawImage(\n        img,\n        0,\n        0,\n        img.width,\n        laneCoverHeight,\n        0,\n        getReverseCoord(laneCoverHeight, 0, canvas),\n        img.width,\n        laneCoverHeight\n      );\n\n      if (mode === \"double\") {\n        c.drawImage(\n          img,\n          0,\n          0,\n          img.width,\n          laneCoverHeight,\n          ARROW_WIDTH * 4,\n          getReverseCoord(laneCoverHeight, 0, canvas),\n          img.width,\n          laneCoverHeight\n        );\n      }\n    }\n  }\n}\n\nexport default LaneCover;\n","const modeRegex = /dance-([a-z]+)/;\nconst difficultyRegex = /(Beginner|Easy|Medium|Hard|Challenge|Edit)/;\n\nconst difficultyMap = {\n  Beginner: \"Beginner\",\n  Easy: \"Basic\",\n  Medium: \"Difficult\",\n  Hard: \"Expert\",\n  Challenge: \"Challenge\",\n};\n\nconst parseSimfile = (sm, simfileType = \"sm\") => {\n  const simfiles = {};\n\n  const chartMetadata = sm.slice(\n    0,\n    sm.indexOf(simfileType === \"ssc\" ? \"#NOTEDATA:\" : \"#NOTES:\")\n  );\n\n  let bpms = [];\n  let stops = [];\n  let offset = 0;\n\n  // default bpms\n  if (/#BPMS:/i.test(chartMetadata)) {\n    bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (bpms.length) {\n      bpms = bpms.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n  // default stops\n  if (/#STOPS:/i.test(chartMetadata)) {\n    stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (stops.length) {\n      stops = stops.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n  // offset\n\n  let chartStrs;\n  if (/#OFFSET:/i.test(chartMetadata)) {\n    offset = /#OFFSET:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    offset = parseFloat(offset);\n  }\n\n  if (simfileType === \"ssc\") {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTEDATA:\"))\n      .split(/#NOTEDATA:\\s*;/)\n      .slice(1);\n  } else {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTES:\"))\n      .split(/#NOTES:\\s+/)\n      .slice(1);\n  }\n\n  console.log(\"chartStrs.length\", chartStrs.length);\n  simfiles.finishedLoading = false;\n  let loadedSimfilesNum = 0;\n\n  chartStrs.forEach((chartStr, i) => {\n    const mode = modeRegex.exec(chartStr)[1]; // single or double\n\n    let smDifficulty = difficultyRegex.exec(chartStr)[1];\n    const difficulty = difficultyMap[smDifficulty];\n\n    simfiles[`${mode}_${difficulty}`] = {\n      difficulty,\n      mode,\n      bpms,\n      stops,\n      offset,\n    };\n    const simfile = simfiles[`${mode}_${difficulty}`];\n\n    let level;\n    if (simfileType === \"ssc\") {\n      level = /#METER:([0-9]+);/.exec(chartStr)[1];\n    } else {\n      const levelRegex = new RegExp(`${smDifficulty}:\\\\s+([0-9]+):`);\n      level = parseInt(levelRegex.exec(chartStr)[1]);\n    }\n    simfile.level = level;\n\n    if (simfileType === \"ssc\") {\n      // check for different bpms\n      if (/#BPMS:/i.test(chartStr)) {\n        bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (bpms.length) {\n          bpms = bpms.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.bpms = bpms;\n        }\n      }\n\n      // check for different stops\n      if (/#STOPS:/i.test(chartStr)) {\n        stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (stops.length) {\n          stops = stops.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.stops = stops;\n        }\n      }\n    }\n\n    let measures = chartStr\n      .slice(chartStr.lastIndexOf(\":\") + 1, chartStr.lastIndexOf(\";\"))\n      .trim()\n      .split(\",\");\n    measures = measures.map((measure, measureIdx) => {\n      const ticks = measure\n        .trim()\n        .split(\"\\r\\n\")\n        .filter((n) => !n.startsWith(\"//\")); // filter out comment lines\n\n      const numTicks = ticks.length;\n\n      const noteObjects = [];\n      ticks.forEach((tick, tickIdx) => {\n        // skip empty ticks and comment lines\n        if (!tick.split(\"\").filter((n) => n !== \"0\").length) return;\n\n        const noteObj = {};\n        noteObj.note = tick;\n        noteObj.measureIdx = measureIdx; // index of the measure relative to the whole song (starting at 0)\n        noteObj.measureN = tickIdx; // numerator of the fraction describing where note falls in this measure\n        noteObj.measureD = numTicks; // denominator of the fraction describing where note falls in this measure\n\n        noteObjects.push(noteObj);\n      });\n      if (measureIdx >= measures.length - 1) {\n        console.log(`finished loading ${mode}_${difficulty}`);\n        loadedSimfilesNum++;\n      }\n\n      return noteObjects;\n    });\n\n    simfile.chart = measures;\n  });\n\n  if (loadedSimfilesNum === chartStrs.length) {\n    simfiles.finishedLoading = true;\n  }\n\n  window.simfiles = simfiles;\n\n  return simfiles;\n};\n\nexport default parseSimfile;\n","export const PLAY_CHART_AUDIO = \"PLAY_CHART_AUDIO\";\nexport const PAUSE_CHART_AUDIO = \"PAUSE_CHART_AUDIO\";\nexport const STOP_CHART_AUDIO = \"STOP_CHART_AUDIO\";\nexport const SET_CHART_AUDIO_STATUS = \"SET_CHART_AUDIO_STATUS\";\n\nexport const PLAY_PREVIEW_AUDIO = \"PLAY_PREVIEW_AUDIO\";\nexport const STOP_PREVIEW_AUDIO = \"STOP_PREVIEW_AUDIO\";\nexport const SET_PREVIEW_AUDIO_STATUS = \"SET_PREVIEW_AUDIO_STATUS\";\n\nexport const SET_CHART_PROGRESS = \"SET_CHART_PROGRESS\";\n\nexport const setChartAudioStatus = (status) => (dispatch) => {\n  dispatch({\n    type: SET_CHART_AUDIO_STATUS,\n    payload: status,\n  });\n};\n\nexport const playChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_CHART_AUDIO,\n  });\n};\n\nexport const pauseChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PAUSE_CHART_AUDIO,\n  });\n};\n\nexport const stopChartAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_CHART_AUDIO,\n  });\n};\n\nexport const setPreviewAudioStatus = (status) => (dispatch) => {\n  dispatch({\n    type: SET_PREVIEW_AUDIO_STATUS,\n    payload: status,\n  });\n};\nexport const playPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_PREVIEW_AUDIO,\n  });\n};\nexport const stopPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_PREVIEW_AUDIO,\n  });\n};\n\nexport const setChartProgress = (progress) => (dispatch) => {\n  dispatch({\n    type: SET_CHART_PROGRESS,\n    payload: progress,\n  });\n};\n","import * as actions from \"../actions/AudioActions\";\n\nconst initialState = {\n  chartAudio: {\n    status: \"stopped\",\n    progress: 0,\n  },\n  previewAudio: {\n    status: \"stopped\",\n  },\n};\n\nexport const audio = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SET_CHART_AUDIO_STATUS: {\n      const chartAudio = { ...state.chartAudio, status: action.payload };\n      return { ...state, chartAudio };\n    }\n    case actions.PLAY_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"playing\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PAUSE_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"paused\" };\n      return { ...state, chartAudio };\n    }\n    case actions.STOP_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"stopped\" };\n      return { ...state, chartAudio };\n    }\n    case actions.SET_PREVIEW_AUDIO_STATUS: {\n      const previewAudio = { ...state.previewAudio, status: action.payload };\n      return { ...state, previewAudio };\n    }\n    case actions.PLAY_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"playing\" };\n      return { ...state, previewAudio };\n    }\n    case actions.STOP_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"stopped\" };\n      return { ...state, previewAudio };\n    }\n    case actions.SET_CHART_PROGRESS: {\n      const chartAudio = { ...state.chartAudio, progress: action.payload };\n      return { ...state, chartAudio };\n    }\n    default:\n      return state;\n  }\n};\n","import * as actions from \"../actions/ChartActions\";\n\nconst initialState = {\n  activeBpm: null,\n  combo: 0,\n};\n\nexport const chart = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.CHANGE_ACTIVE_BPM_DISPLAY: {\n      // const activeBpm = action.payload;\n      const activeBpm = Math.round(action.payload);\n      return { ...state, activeBpm };\n    }\n    case actions.SET_COMBO: {\n      return { ...state, combo: action.payload };\n    }\n    default:\n      return state;\n  }\n};\n","export const UPDATE_MODS = \"UPDATE_MODS\";\nexport const UPDATE_LANE_COVER_HEIGHT = \"UPDATE_LANE_COVER_HEIGHT\";\n\nexport const updateMods = (mods) => (dispatch) => {\n  dispatch({\n    type: UPDATE_MODS,\n    payload: mods,\n  });\n};\n\nexport const updateLaneCoverHeight = (payload) => (dispatch) => {\n  dispatch({\n    type: UPDATE_LANE_COVER_HEIGHT,\n    payload,\n  });\n};\n","export const getUserSettings = () => {\n  try {\n    const settings = window.localStorage.getItem(\"userSettings\");\n    if (settings) {\n      return JSON.parse(settings);\n    }\n    return {};\n  } catch (err) {\n    console.error(err);\n    return {};\n  }\n};\n\nexport const updateUserSettings = (newSettings) => {\n  let settings = window.localStorage.getItem(\"userSettings\");\n  try {\n    if (settings) {\n      settings = JSON.parse(settings);\n    } else {\n      settings = {};\n    }\n  } catch (err) {\n    console.error(err);\n  }\n\n  Object.keys(newSettings).forEach((key) => {\n    settings[key] = newSettings[key];\n  });\n  window.localStorage.setItem(\"userSettings\", JSON.stringify(settings));\n};\n\nexport const getSavedSongProgress = () => {\n  return window.localStorage.getItem(\"progress\") || 0;\n};\n\nexport const saveSongProgress = (progress) => {\n  window.localStorage.setItem(\"progress\", progress);\n};\n","import { presetParams } from \"../../utils\";\nimport { DEFAULT_CMOD, DEFAULT_OFFSET } from \"../../constants\";\nimport { getUserSettings } from \"../../utils/userSettings\";\n\nexport const options = {\n  difficulty: [\"Beginner\", \"Basic\", \"Difficult\", \"Expert\", \"Challenge\"],\n  mode: [\"single\", \"double\"],\n  mods: {\n    speed: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n      2.25,\n      2.5,\n      2.75,\n      3,\n      3.25,\n      3.5,\n      3.75,\n      4,\n      4.5,\n      5,\n      5.5,\n      6,\n      6.5,\n      7,\n      7.5,\n      8,\n    ],\n    appearance: [\"visible\", \"hidden\", \"sudden\", \"hiddensudden\", \"stealth\"],\n    turn: [\"off\", \"mirror\", \"left\", \"right\", \"shuffle\"],\n    shuffle: [1, 2, 3, 4, 5, 6, 7, 8],\n    stepZone: [\"on\", \"off\"],\n    scroll: [\"normal\", \"reverse\"],\n    noteskin: [\"rainbow\", \"note\", \"vivid\", \"flat\"],\n    comboDisplay: [\"behind\", \"inFront\", \"hidden\"],\n    comboFont: [\"A20\", \"A\"],\n  },\n};\n\n// Default values when user opens app for the first time\nconst optionDefaultValues = {\n  difficulty: \"Expert\",\n  mode: \"single\",\n  mods: {\n    speed: 2.5,\n    cmod: DEFAULT_CMOD,\n    appearance: \"visible\",\n    laneCoverHeight: [8, 8, 8],\n    laneCoverVisible: true,\n    turn: \"off\",\n    shuffle: 1,\n    stepZone: \"on\",\n    scroll: \"normal\",\n    noteskin: \"note\",\n    guidelines: true,\n    comboDisplay: \"behind\",\n    comboFont: \"A20\",\n    colorFreezes: false,\n    globalOffset: DEFAULT_OFFSET,\n    bpmStopDisplay: false,\n  },\n};\n\nexport const generateInitialValues = (params = presetParams) => {\n  // Values stored in localStorage user settings override default values\n  const userSettings = getUserSettings();\n  [\"song\", \"difficulty\", \"mode\"].forEach((key) => {\n    if (userSettings[key]) {\n      optionDefaultValues[key] = userSettings[key];\n    }\n  });\n\n  if (userSettings.mods) {\n    Object.keys(optionDefaultValues.mods).forEach((mod) => {\n      if (typeof userSettings.mods[mod] !== \"undefined\") {\n        optionDefaultValues.mods[mod] = userSettings.mods[mod];\n      }\n    });\n  }\n\n  // Preset params in the url override default values AND user settings\n  if (params.difficulty) {\n    const difficulties = {\n      b: \"Beginner\",\n      B: \"Basic\",\n      D: \"Difficult\",\n      E: \"Expert\",\n      C: \"Challenge\",\n    };\n    if (Object.keys(difficulties).includes(params.difficulty[0])) {\n      optionDefaultValues.difficulty = difficulties[params.difficulty[0]];\n    }\n    if (params.difficulty[1] === \"S\") {\n      optionDefaultValues.mode = \"single\";\n    } else if (params.difficulty[1] === \"D\") {\n      optionDefaultValues.mode = \"double\";\n    }\n  }\n  if (params.speed) {\n    const value = parseFloat(`${params.speed[0]}.${params.speed.slice(1)}`);\n    if (options.mods.speed.includes(value)) {\n      optionDefaultValues.mods.speed = value;\n    }\n  }\n  if (params.turn) {\n    const turnValue = params.turn.toLowerCase();\n    if (options.mods.turn.includes(turnValue)) {\n      optionDefaultValues.mods.turn = turnValue;\n    }\n  }\n\n  return optionDefaultValues;\n};\ngenerateInitialValues(presetParams);\n\nexport { optionDefaultValues };\n","import * as actions from \"../actions/ModsActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\nimport { updateUserSettings } from \"../utils/userSettings\";\n\nconst initialState = optionDefaultValues.mods;\n\nexport const mods = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.UPDATE_MODS: {\n      const updatedMods = action.payload;\n      const updatedState = { ...state, ...updatedMods };\n      updateUserSettings({ mods: updatedState });\n      return updatedState;\n    }\n    case actions.UPDATE_LANE_COVER_HEIGHT: {\n      const { diff, canvasHeight } = action.payload;\n      const laneCoverHeight = [...state.laneCoverHeight];\n\n      // don't let lane covers go beyond the chart area boundary\n      let lowerBoundary = 0;\n      let upperBoundary = canvasHeight;\n      if (state.appearance === \"hiddensudden\") upperBoundary /= 2;\n      for (let i = 0; i < laneCoverHeight.length; i++) {\n        laneCoverHeight[i] += diff[i];\n        const height = laneCoverHeight[i];\n        if (height < lowerBoundary) laneCoverHeight[i] = lowerBoundary;\n        else if (height > upperBoundary) laneCoverHeight[i] = upperBoundary;\n      }\n\n      const updatedState = { ...state, laneCoverHeight };\n      updateUserSettings({ mods: updatedState });\n      return updatedState;\n    }\n    default:\n      return state;\n  }\n};\n","import * as actions from \"../actions/ScreenActions\";\nimport { getUserSettings, updateUserSettings } from \"../utils/userSettings\";\n\nconst userSettings = getUserSettings();\nconst initialState = {\n  innerWidth: window.innerWidth,\n  innerHeight: window.innerHeight,\n  activeView: userSettings.activeView || \"song\",\n};\n\nexport const screen = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.RESIZE_SCREEN: {\n      const { target } = action.payload;\n      const { innerWidth, innerHeight } = target;\n\n      const values = { innerWidth, innerHeight };\n\n      return { ...state, ...values };\n    }\n    case actions.SET_ACTIVE_VIEW: {\n      const activeView = action.payload;\n      updateUserSettings({ activeView });\n      return { ...state, activeView };\n    }\n    default:\n      return state;\n  }\n};\n","export const SELECT_SONG = \"SELECT_SONG\";\nexport const SELECT_DIFFICULTY = \"SELECT_DIFFICULTY\";\nexport const SELECT_MODE = \"SELECT_MODE\";\n\nexport const selectSong = (song) => (dispatch) => {\n  dispatch({\n    type: SELECT_SONG,\n    payload: song,\n  });\n};\n\nexport const selectDifficulty = (difficulty) => (dispatch) => {\n  dispatch({\n    type: SELECT_DIFFICULTY,\n    payload: difficulty,\n  });\n};\n\nexport const selectMode = (mode) => (dispatch) => {\n  dispatch({\n    type: SELECT_MODE,\n    payload: mode,\n  });\n};\n","import * as actions from \"../actions/SongSelectActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\nimport { updateUserSettings } from \"../utils/userSettings\";\n\nconst initialState = {\n  difficulty: optionDefaultValues.difficulty,\n  mode: optionDefaultValues.mode,\n};\n\nexport const songSelect = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SELECT_SONG: {\n      const song = action.payload;\n      updateUserSettings({ song: song.hash });\n      return { ...state, song };\n    }\n    case actions.SELECT_DIFFICULTY: {\n      const difficulty = action.payload;\n      updateUserSettings({ difficulty });\n      return { ...state, difficulty };\n    }\n    case actions.SELECT_MODE: {\n      const mode = action.payload;\n      updateUserSettings({ mode });\n      return { ...state, mode };\n    }\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from \"redux\";\n\nimport { audio } from \"./AudioReducer\";\nimport { chart } from \"./ChartReducer\";\nimport { mods } from \"./ModsReducer\";\nimport { screen } from \"./ScreenReducer\";\nimport { songSelect } from \"./SongSelectReducer\";\n\nexport default combineReducers({ audio, chart, mods, screen, songSelect });\n","export const SET_BPM_CHANGE_QUEUE = \"SET_BPM_CHANGE_QUEUE\";\nexport const CHANGE_ACTIVE_BPM_DISPLAY = \"CHANGE_ACTIVE_BPM_DISPLAY\";\nexport const SET_COMBO = \"SET_COMBO\";\n\nexport const changeActiveBpm = (bpm) => (dispatch) => {\n  dispatch({\n    type: CHANGE_ACTIVE_BPM_DISPLAY,\n    payload: bpm,\n  });\n};\n\nexport const setCombo = (combo) => (dispatch) => {\n  dispatch({\n    type: SET_COMBO,\n    payload: combo,\n  });\n};\n","export const RESIZE_SCREEN = \"RESIZE_SCREEN\";\nexport const SET_ACTIVE_VIEW = \"SET_ACTIVE_VIEW\";\n\nexport const resizeScreen = (e) => (dispatch) => {\n  dispatch({\n    type: RESIZE_SCREEN,\n    payload: e,\n  });\n};\n\nexport const setActiveView = (view) => (dispatch) => {\n  dispatch({\n    type: SET_ACTIVE_VIEW,\n    payload: view,\n  });\n};\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n\nimport reducers from \"./reducers\";\n\nconst store = createStore(\n  reducers,\n  compose(\n    applyMiddleware(thunk),\n    window.devToolsExtension ? window.__REDUX_DEVTOOLS_EXTENSION__() : (f) => f\n  )\n);\n\nexport default store;\n","import { presetParams } from \"../../../utils\";\nimport AudioPlayer from \"../../../core/AudioPlayer\";\n\nclass Progress {\n  constructor() {\n    this.mouseDown = false;\n    this.currentProgress = 0;\n\n    this.presetStart = 0;\n    if (presetParams.progress) {\n      this.presetStart = presetParams.progress / 100000;\n      this.currentProgress = this.presetStart;\n    }\n  }\n\n  initCanvas() {\n    this.canvas = document.querySelector(\"#progress\");\n    this.presetMarker = document.querySelector(\n      \"#progress + .preset-marker-wrapper\"\n    );\n\n    this.drawBackground();\n\n    // mobile scrub behavior\n    this.canvas.addEventListener(\"touchstart\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e.touches[0]);\n    });\n    this.canvas.addEventListener(\"touchmove\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e.touches[0]);\n    });\n\n    // desktop scrub behavior\n    this.canvas.addEventListener(\"mousedown\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e);\n      this.mouseDown = true;\n    });\n    this.canvas.addEventListener(\"mousemove\", (e) => {\n      e.preventDefault();\n      if (this.mouseDown) {\n        this.jumpToProgress(e);\n      }\n    });\n    this.canvas.addEventListener(\"mouseup\", (e) => {\n      e.preventDefault();\n      this.mouseDown = false;\n    });\n\n    this.setPresetMarker();\n    window.addEventListener(\"resize\", (e) => {\n      this.setPresetMarker();\n    });\n  }\n\n  setPresetMarker() {\n    if (!this.presetStart || !this.presetMarker) return;\n    const totalWidth = this.canvas.offsetWidth;\n    this.presetPosition = totalWidth * this.presetStart;\n    this.presetMarker.style.left = `${this.presetPosition}px`;\n  }\n\n  setProgress(progress) {\n    this.currentProgress = progress;\n  }\n  getProgress() {\n    return this.currentProgress;\n  }\n\n  jumpToProgress(event, presetProgress) {\n    let progressPercent;\n\n    if (presetProgress) {\n      progressPercent = presetProgress;\n    } else {\n      const domRect = this.canvas.getBoundingClientRect();\n      const totalWidth = domRect.width;\n      const x = event.clientX - domRect.x;\n      progressPercent = x / totalWidth;\n    }\n\n    if (progressPercent < 0 || progressPercent > 1) return;\n\n    this.setProgress(progressPercent);\n    AudioPlayer.seekProgress(progressPercent);\n  }\n\n  jumpToPresetStart(e) {\n    this.jumpToProgress(e, this.presetStart);\n    e.stopPropagation();\n  }\n\n  drawBackground() {\n    const c = this.canvas.getContext(\"2d\");\n    c.fillStyle = \"#d7e2ed\";\n    c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  render(progress) {\n    if (isNaN(progress)) return;\n\n    this.setProgress(progress);\n\n    this.drawBackground();\n    const c = this.canvas.getContext(\"2d\");\n    c.fillStyle = \"#627c92\";\n    c.fillRect(0, 0, this.canvas.width * progress, this.canvas.height);\n  }\n}\n\nexport default new Progress();\n","import { Howl } from \"howler\";\nimport { gsap } from \"gsap\";\n\nimport store from \"../store\";\nimport * as actions from \"../actions/AudioActions\";\nimport Progress from \"../components/chart/canvas/Progress\";\n// import { changeActiveBpm, setCombo } from \"../actions/ChartActions\";\nimport { getAssetPath } from \"../utils\";\nimport { saveSongProgress } from \"../utils/userSettings\";\nimport {\n  getCurrentBpm,\n  changeActiveBpm,\n  getCurrentCombo,\n  getFullCombo,\n  initializeBeatWindow,\n} from \"../utils/engineUtils\";\nimport { DEFAULT_OFFSET } from \"../constants\";\nimport { debugLog } from \"../utils/debugUtils\";\n\nclass AudioPlayer {\n  constructor() {\n    /*\n      Trying to share the same audio source for both song and preview was causing too many\n      issues. Sticking to keeping separate Howl objects for each even if means loading\n      duplicate copies of the same mp3\n    */\n    this.sources = {\n      song: {},\n      preview: {},\n      assistTick: {\n        audio: new Howl({\n          src: getAssetPath(\"sounds/assist_tick.wav\"),\n          // format: [\"wav\"],\n          // html5: true,\n        }),\n      },\n    }; // map of song hash to associated Howl object\n\n    this.currentSong = null; // hash of current song\n    this.currentPreview = null; // hash of current preview\n\n    this.currentSongId = null; // Howler soundID of current song\n    this.currentPreviewId = null; // Howler soundId of current preview\n\n    // this.updateTimeline = this.updateTimeline.bind(this);\n\n    this.previewFadeTimeout = null; // reference to preview fade setTimeout so it can be cleared\n\n    this.updateTimeline = this.updateTimeline.bind(this);\n    this.updateProgress = this.updateProgress.bind(this);\n    this.audioResyncFrames = 0;\n  }\n\n  getCurrentSong() {\n    const currentSong = this.sources.song[this.currentSong];\n    return currentSong;\n  }\n  getCurrentPreview() {\n    return this.sources.preview[this.currentPreview];\n  }\n\n  getCurrentTime() {\n    return this.getCurrentSong().audio.seek();\n  }\n\n  // when loading a song file for the first time, save it as two separate Howls:\n  // one for the full song and one for the preview sample\n  storeAudioSource(song, initialProgress = 0) {\n    if (!this.sources.song[song.hash]) {\n      this.setLoadingAudio(true);\n\n      const thisSong = (this.sources.song[song.hash] = { title: song.title });\n\n      thisSong.audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        onload: () => {\n          // console.log(`AudioPlayer song loaded: ${song.title}`);\n          this.setLoadingAudio(false);\n          this.seekProgress(initialProgress);\n        },\n        onloaderror: (id, error, blah) => {\n          alert(`${id};;; ${error};;; ${blah}`);\n        },\n        onplay: () => {\n          thisSong.tl.play();\n          this.resync();\n          gsap.ticker.add(this.updateProgress);\n          this.startAnimationLoop();\n          store.dispatch(actions.playChartAudio());\n        },\n        onpause: () => {\n          thisSong.tl.pause();\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.pauseChartAudio());\n        },\n        onseek: () => {},\n        onstop: () => {\n          if (thisSong.tl) {\n            thisSong.tl.restart().pause();\n          }\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n        onend: (spriteId) => {\n          if (thisSong.tl) {\n            thisSong.tl.pause();\n          }\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n      });\n\n      const thisPreview = (this.sources.preview[song.hash] = {\n        title: song.title,\n      });\n      thisPreview.audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        sprite: {\n          sample: [\n            parseFloat((song.sampleStart - DEFAULT_OFFSET) * 1000),\n            parseFloat((song.sampleLength - DEFAULT_OFFSET) * 1000),\n          ],\n        },\n        onload: () => {\n          // thisPreview.audio.volume(0);\n        },\n        onplay: () => {\n          // const preview = this.getCurrentPreview().audio;\n          thisPreview.audio.volume(1);\n\n          const fadeinTime = 0;\n          const fadeoutTime = 2000;\n          // thisPreview.audio.fade(0, 1, fadeinTime);\n\n          this.previewFadeTimeout = setTimeout(() => {\n            thisPreview.audio.fade(1, 0, fadeoutTime);\n          }, song.sampleLength * 1000 - fadeoutTime);\n\n          store.dispatch(actions.playPreviewAudio());\n        },\n        onstop: () => {\n          clearTimeout(this.previewFadeTimeout);\n          // thisPreview.audio.volume(0);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n        onend: () => {\n          clearTimeout(this.previewFadeTimeout);\n          // thisPreview.audio.volume(0);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n      });\n\n      // console.log(`Added ${song.title} to AudioPlayer.sources`, this.sources);\n    }\n  }\n\n  selectSong(song, initialProgress = 0) {\n    if (this.currentSong) {\n      this.getCurrentSong().audio.stop(this.currentSongId);\n    }\n\n    this.storeAudioSource(song, initialProgress);\n    this.currentSong = song.hash;\n  }\n\n  resync() {\n    // number of frames it takes for audio to reload/restabilize\n    // this.getCurrentTime() (i.e. Howler .seek()) will return an object instead of a number\n    // if audio is not loaded yet\n    this.audioReloadFrames = 0;\n\n    // arbitrary number of frames chosen to tell timeline to resync with the audio\n    // this needs to be done after (/in addition to) the audio restabilizing\n    this.audioResyncFrames = 10;\n\n    gsap.ticker.add(this.updateTimeline);\n    // this.updateProgressOnce();\n  }\n\n  // when audio is played, resync timeline with audio a few times until audio playback\n  // stabilizes, then remove this method from the ticker\n  updateTimeline() {\n    // // for reducing debugging headaches; don't remove\n    const currentSong = this.getCurrentSong();\n    if (!currentSong.tl || !currentSong.globalParams) return;\n\n    let isAudioStable = false;\n\n    // NOTE: the following block will run 10 times on every resync\n    try {\n      const currentTime = this.getCurrentTime();\n      // console.log(\"currentTime\", currentTime);\n      if (typeof currentTime === \"number\") {\n        isAudioStable = true;\n        // console.log(\n        //   \"seek timeline to\",\n        //   currentTime,\n        //   \"after\",\n        //   this.audioReloadFrames,\n        //   \"frames\"\n        // );\n        // console.log(\"stabilized to\", currentTime);\n\n        const globalOffset = store.getState().mods.globalOffset;\n\n        currentSong.tl.seek(\n          // currentTime + DEFAULT_OFFSET + currentSong.globalParams.offset\n          currentTime + globalOffset + currentSong.globalParams.offset\n        );\n        this.updateProgressOnce();\n\n        if (this.getChartAudioStatus() === \"playing\") {\n          currentSong.tl.play();\n        }\n        this.audioResyncFrames--;\n      } else {\n        // console.log(\"audio restabilizing\");\n        currentSong.tl.pause();\n        this.audioReloadFrames++;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n\n    // This block will only run once on every resync\n    if (isAudioStable && this.audioResyncFrames <= 0) {\n      // recalculate current bpm (necessary if skipping progress)\n      const currentBpm = getCurrentBpm(currentSong.globalParams);\n      changeActiveBpm(currentBpm, currentSong.globalParams);\n      // document.querySelector(\".bpm-value\").textContent = Math.round(currentBpm);\n\n      const currentCombo = getCurrentCombo(currentSong);\n      // currentSong.globalParams.combo = currentCombo;\n\n      // store.dispatch(setCombo(currentCombo));\n      const comboTemp = document.querySelector(\"#combo-temp .combo-num\");\n      if (comboTemp) comboTemp.textContent = currentCombo;\n\n      // console.log(\"doOnce\");\n\n      gsap.ticker.remove(this.updateTimeline);\n    }\n  }\n\n  seekTime(timestamp) {\n    this.getCurrentSong().audio.seek(timestamp);\n    this.resync();\n  }\n  goBack(ms) {\n    this.seekTime(this.getCurrentTime() - ms * 0.001);\n  }\n  goForward(ms) {\n    this.seekTime(this.getCurrentTime() + ms * 0.001);\n  }\n\n  seekProgress(value) {\n    const audioDuration = this.getCurrentSong().audio.duration();\n    this.seekTime(value * audioDuration);\n  }\n\n  // gsap ticker method for regularly updating progress bar, not called manually\n  updateProgress(time, deltaTime, frame) {\n    const currentSong = this.getCurrentSong();\n    if (!currentSong || !currentSong.tl) return;\n\n    // console.log(currentSong.tl);\n\n    // detect significant frame skips and resync when it happens\n    if (deltaTime > 60) {\n      // console.log(deltaTime);\n      const currentTime = this.getCurrentTime();\n      console.log(\n        \"frame skip\",\n        \"deltaTime:\",\n        deltaTime,\n        \"currentTime:\",\n        currentTime\n      );\n      if (typeof currentTime === \"number\") {\n        const globalOffset = store.getState().mods.globalOffset;\n\n        currentSong.tl.seek(\n          currentTime + globalOffset + currentSong.globalParams.offset\n        );\n      } else {\n        console.log(\"audio unstable after frame skip, resyncing\");\n        this.resync();\n      }\n    }\n    if (frame % 15 === 0) {\n      let t0 = performance.now();\n      const audio = currentSong.audio;\n      const progress = audio.seek() / audio.duration();\n      let t1 = performance.now();\n      const audioSeekPerf = t1 - t0;\n      // console.log(`audio seek/duration progress: ${(t1 - t0).toFixed(3)} ms`);\n      // store.dispatch(actions.setChartProgress(progress));\n\n      t0 = performance.now();\n      let tlProgress = currentSong.tl.progress();\n      t1 = performance.now();\n      const tlSeekPerf = t1 - t0;\n\n      // console.log(\n      //   `audioSeekPerf - tlSeekPerf = ${(audioSeekPerf - tlSeekPerf).toFixed(\n      //     3\n      //   )} ms`\n      // );\n      // console.log(`tl progress: ${(t1 - t0).toFixed(3)} ms`);\n\n      t0 = performance.now();\n      saveSongProgress(progress);\n      Progress.render(progress);\n      t1 = performance.now();\n      // console.log(`renderProgress ${(t1 - t0).toFixed(3)} ms`);\n    }\n  }\n\n  updateProgressOnce() {\n    this.updateProgress(null, null, 0);\n\n    const currentSong = this.getCurrentSong();\n    const currentCombo = getCurrentCombo(currentSong);\n\n    // const comboDebug = document.querySelector(\"#combo-debug .combo-debug-num\");\n    // if (comboDebug) {\n    //   comboDebug.textContent = currentCombo;\n    // }\n\n    debugLog(`FC: ${getFullCombo(currentSong)}`);\n\n    currentSong.globalParams.combo = currentCombo;\n\n    initializeBeatWindow(currentSong.globalParams);\n\n    this.updateAnimationLoopOnce();\n  }\n\n  setTimeline(tl) {\n    this.getCurrentSong().tl = tl;\n  }\n  setGlobalParams(params) {\n    this.getCurrentSong().globalParams = params;\n  }\n\n  play() {\n    if (this.getChartAudioStatus() === \"pending\") {\n      return;\n    }\n    const currentSong = this.getCurrentSong();\n    this.currentSongId = currentSong.audio.play();\n\n    debugLog(`last played: ${currentSong.title}`, 2);\n    store.dispatch(actions.setChartAudioStatus(\"pending\"));\n  }\n\n  pause() {\n    this.getCurrentSong().audio.pause(this.currentSongId);\n\n    const audio = this.getCurrentSong().audio;\n    const progress = audio.seek() / audio.duration();\n    saveSongProgress(progress);\n  }\n\n  stop() {\n    if (!this.getCurrentSong()) {\n      return;\n    }\n    this.getCurrentSong().audio.stop(this.currentSongId);\n    this.stopAnimationLoop();\n    setTimeout(() => this.seekTime(0));\n    this.currentSongId = null;\n  }\n\n  killImmediately(songId) {\n    const currentSong = this.sources.song[songId];\n    if (currentSong) {\n      if (currentSong.tl) {\n        this.sources.song[songId].tl.kill();\n      }\n      this.stop();\n    }\n    store.dispatch(actions.setChartAudioStatus(\"stopped\"));\n  }\n\n  isPlaying() {\n    return (\n      this.getCurrentSong() &&\n      this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n  isPaused() {\n    return (\n      this.getCurrentSong() &&\n      !this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n\n  playAssistTick() {\n    this.sources.assistTick.audio.play();\n  }\n\n  playSongPreview(song) {\n    if (this.getPreviewAudioStatus() === \"pending\") {\n      return;\n    }\n    if (this.currentPreview) {\n      this.getCurrentPreview().audio.stop(this.currentPreviewId);\n    }\n\n    this.storeAudioSource(song);\n    this.currentPreview = song.hash;\n\n    const preview = this.getCurrentPreview().audio;\n\n    this.currentPreviewId = preview.play(\"sample\");\n    store.dispatch(actions.setPreviewAudioStatus(\"pending\"));\n  }\n\n  stopSongPreview() {\n    if (!this.currentPreview) return;\n    const preview = this.getCurrentPreview().audio;\n\n    preview.stop(this.currentPreviewId);\n\n    // clearTimeout(this.previewFadeTimeout);\n  }\n\n  isPreviewPlaying() {\n    return (\n      this.getCurrentPreview() &&\n      this.getCurrentPreview().audio.playing(this.currentPreviewId)\n    );\n  }\n\n  getChartAudioStatus() {\n    return store.getState().audio.chartAudio.status;\n  }\n  getPreviewAudioStatus() {\n    return store.getState().audio.previewAudio.status;\n  }\n}\n\nexport default new AudioPlayer();\n","import { gsap } from \"gsap\";\n\nimport Arrow from \"../components/chart/canvas/Arrow\";\nimport ShockArrow from \"../components/chart/canvas/ShockArrow\";\nimport StepZone from \"../components/chart/canvas/StepZone\";\nimport Guidelines from \"../components/chart/canvas/Guidelines\";\nimport TargetFlash from \"../components/chart/canvas/TargetFlash\";\nimport ComboDisplay from \"../components/chart/canvas/ComboDisplay\";\nimport BpmAndStopDisplay from \"../components/chart/canvas/BpmAndStopDisplay\";\nimport LaneCover from \"../components/chart/canvas/LaneCover\";\nimport parseSimfile from \"../utils/parseSimfile\";\nimport {\n  applyTurnMods,\n  initializeBeatWindow,\n  updateBeatWindow,\n  changeActiveBpm,\n} from \"../utils/engineUtils\";\nimport {\n  END_EXTRA_BEATS,\n  MARVELOUS_FLASH_FRAMES,\n  DEFAULT_CMOD,\n  ARROW_HEIGHT,\n} from \"../constants\";\nimport AudioPlayer from \"./AudioPlayer\";\nimport store from \"../store\";\nimport * as actions from \"../actions/ChartActions\";\nimport { debugLogView, debugSimfileChart } from \"../utils/debugUtils\";\n\nclass GameEngine {\n  constructor(canvas, sm, simfileType = \"sm\", chartParams) {\n    this.canvas = canvas;\n    this.c = canvas.getContext(\"2d\");\n    this.sm = sm;\n    this.simfiles = {};\n\n    this.tl = gsap.timeline();\n    this.eventList = [];\n    this.arrows = [];\n    this.shocks = [];\n    this.freezes = [];\n    this.allArrows = [];\n\n    this.mainLoopRequestRef = null;\n\n    this.bpmReel = document.getElementById(\"bpmReel\");\n    this.stopReel = document.getElementById(\"stopReel\");\n\n    if (this.bpmReel) this.bpmReel.innerHTML = \"\";\n    if (this.stopReel) this.stopReel.innerHTML = \"\";\n\n    this.drawBackground();\n\n    this.globalParams = {\n      /*\n        Use this parameter to keep track of which beat the chart is on at any given point.\n        Animate this one property in the timeline, then reference its value to calculate frames\n        for step zone and arrow animations without having to create separate tweens for them.\n      */\n      beatTick: 0,\n\n      /*\n        Use this parameter to animate values that can be tracked as a continuous function of time,\n        e.g. position of arrows/guidelines on a cmod.\n        Not intended to be used for events that happen at discrete timestamps, such as combo updates and target flashes\n      */\n      timeTick: 0,\n\n      /*\n        Use this parameter for animations based on absolute frame and not a function of the beat.\n      */\n      frame: 0,\n\n      combo: 0,\n      bpmQueue: [], // this is the one that is used\n\n      targetFlashes: {},\n\n      // \"global\" variables for creating the timeline\n      /*\n        lol for lack of a better word. Refers to the last arrow or last bpm change/stop event,\n        whichever comes later\n      */\n      lastEntity: null,\n\n      /*\n        The beat that the timeline ends on. Will be defined as the beat of the lastEntity\n      */\n      finalBeat: 0,\n\n      /*\n        Miscellaneous constant parameters for ease of access\n      */\n      chartAreaHeight: canvas.height,\n    };\n\n    AudioPlayer.startAnimationLoop = this.startLoop.bind(this);\n    AudioPlayer.stopAnimationLoop = this.stopLoop.bind(this);\n    AudioPlayer.updateAnimationLoopOnce = this.updateLoopOnce.bind(this);\n\n    if (!this.sm) return;\n\n    // init logic\n    this.simfiles = parseSimfile(this.sm, simfileType);\n    console.log(\"this.simfiles\", this.simfiles);\n\n    this.resetChart(chartParams);\n  }\n\n  resetChart({ mode, difficulty, mods }) {\n    const { audio } = store.getState();\n\n    // kill the previous gsap timeline before creating a new one\n    if (this.tl) {\n      this.tl.kill();\n    }\n    this.tl = gsap.timeline();\n\n    // reinitialize all chart-specific values\n    this.eventList.length = 0;\n    this.arrows.length = 0;\n    this.freezes.length = 0;\n    this.shocks.length = 0;\n    this.allArrows.length = 0;\n\n    if (this.bpmAndStopDisplay) {\n      this.bpmAndStopDisplay.clearWindow();\n    }\n\n    this.globalParams.beatTick = 0;\n    this.globalParams.timeTick = 0;\n    this.globalParams.frame = 0;\n    this.globalParams.combo = 0;\n    this.globalParams.bpmQueue = [];\n    this.globalParams.stopQueue = [];\n    // this.globalParams.arrows = self.allArrows;\n    this.globalParams.arrows = this.arrows;\n    this.globalParams.freezes = this.freezes;\n    this.globalParams.shocks = this.shocks;\n    this.globalParams.allArrows = this.allArrows;\n\n    this.globalParams.beatWindowStartPtr = {};\n    this.globalParams.beatWindowEndPtr = {};\n    this.globalParams.timeWindowStartPtr = {};\n    this.globalParams.timeWindowEndPtr = {};\n\n    this.globalParams.targetFlashes = {};\n    this.globalParams.mods = mods;\n    AudioPlayer.setGlobalParams(this.globalParams);\n\n    // debugging\n    window.globalParams = this.globalParams;\n\n    // recreate the chart with the new given parameters\n    // then immediately seek to where the chart's progress was before it was recreated\n    const simfile = this.simfiles[`${mode}_${difficulty}`];\n    if (simfile) {\n      debugSimfileChart(simfile);\n\n      this.globalParams.offset = simfile.offset;\n\n      this.generateEventList(simfile);\n      this.generateArrows(simfile, mods);\n      this.generateTimestamps();\n      this.initTimeline(mods);\n      this.restartTl();\n      if (audio.chartAudio.status !== \"playing\") {\n        this.pauseTl();\n      }\n      AudioPlayer.resync();\n    }\n  }\n\n  startLoop() {\n    this.mainLoopRequestRef = window.requestAnimationFrame(\n      this.mainLoop.bind(this)\n    );\n  }\n  stopLoop() {\n    window.cancelAnimationFrame(this.mainLoopRequestRef);\n  }\n  updateLoopOnce() {\n    window.requestAnimationFrame(this.mainLoop.bind(this, false));\n  }\n\n  updateExternalGlobalParams(params) {\n    for (let param in params) {\n      this.globalParams[param] = params[param];\n    }\n    initializeBeatWindow(this.globalParams);\n  }\n\n  // bpm changes and stops converted to timestamps\n  generateEventList(simfile) {\n    const { bpms, stops } = simfile;\n    const eventList = [];\n    let bpmPtr = 0,\n      stopPtr = 0;\n    let currentBpm = bpms[0].value;\n\n    // console.log(\"generateEventList bpms\", bpms);\n    // console.log(\"generateEventList stops\", stops);\n\n    while (bpmPtr < bpms.length && stopPtr < stops.length) {\n      const bpm = bpms[bpmPtr];\n      const stop = stops[stopPtr];\n\n      // stops before bpm changes when they fall on the same beat\n      // add stop event, keeping track of the bpm at this point\n      if (stop.beat <= bpm.beat) {\n        eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n        stopPtr++;\n      }\n      // add bpm event, replacing the currently tracked bpm\n      else {\n        eventList.push({ ...bpm, type: \"bpm\" });\n        currentBpm = bpm.value;\n        bpmPtr++;\n      }\n    }\n    while (bpmPtr < bpms.length) {\n      eventList.push({ ...bpms[bpmPtr], type: \"bpm\" });\n      bpmPtr++;\n    }\n    while (stopPtr < stops.length) {\n      eventList.push({ ...stops[stopPtr], bpm: currentBpm, type: \"stop\" });\n      stopPtr++;\n    }\n\n    eventList[0].timestamp = 0;\n\n    this.globalParams.bpmQueue = [eventList[0]];\n\n    for (let i = 1; i < eventList.length; i++) {\n      const prevEvent = eventList[i - 1];\n      const currentEvent = eventList[i];\n      const prevTimestamp = eventList[i - 1].timestamp;\n\n      // Find the number of beats elapsed between the current and previous event,\n      // then convert this into seconds using the bpm at the previous event.\n      // If the previous event was a stop, add the length of the stop.\n      // The timestamp of the current event is this number of seconds after the\n      // timestamp of the previous event.\n      const beatDiff = currentEvent.beat - prevEvent.beat;\n      const prevBpm =\n        prevEvent.type === \"bpm\" ? prevEvent.value : prevEvent.bpm;\n      let timestampDiff = (beatDiff / prevBpm) * 60;\n      if (prevEvent.type === \"stop\") timestampDiff += prevEvent.value;\n      const currentTimestamp = prevTimestamp + timestampDiff;\n\n      currentEvent.timestamp = currentTimestamp;\n\n      if (currentEvent.type === \"bpm\") {\n        this.globalParams.bpmQueue.push(currentEvent);\n      } else if (currentEvent.type === \"stop\") {\n        this.globalParams.stopQueue.push(currentEvent);\n      }\n    }\n\n    this.eventList = eventList;\n    return eventList;\n  }\n\n  generateArrows(simfile, mods) {\n    let { chart } = simfile;\n    const mode = store.getState().songSelect.mode;\n\n    if (Array.isArray(chart[0])) {\n      const newChart = [];\n      chart.forEach((measure) => {\n        newChart.push(...measure);\n      });\n      chart = newChart;\n    }\n\n    chart = applyTurnMods(chart, mods, mode);\n\n    // calculate beat positions for each arrow\n    chart.forEach((note, key) => {\n      // calculate starting position currentBeatPosition\n      const { measureIdx, measureN, measureD } = note;\n      note.beatstamp = (measureIdx + measureN / measureD) * 4;\n    });\n\n    // generate arrays of arrows by category\n    chart.forEach((note, key) => {\n      if (note.note[0] === \"M\" || note.note[4] === \"M\") {\n        const shockArrow = new ShockArrow({ key, ...note });\n        this.shocks.push(shockArrow);\n        this.allArrows.push(shockArrow);\n      }\n      if (\n        note.note.includes(\"1\") ||\n        note.note.includes(\"2\") ||\n        note.note.includes(\"3\")\n      ) {\n        const arrow = new Arrow({ key, ...note });\n        this.arrows.push(arrow);\n        this.allArrows.push(arrow);\n\n        if (note.note.includes(\"2\") || note.note.includes(\"3\")) {\n          this.freezes.push(arrow);\n        }\n      }\n    });\n\n    this.stepZone = new StepZone();\n    this.comboDisplay = new ComboDisplay();\n    this.laneCover = new LaneCover();\n\n    // console.log(\"all arrows\", this.allArrows);\n    // console.log(`chart for ${simfile.difficulty}`, chart);\n  }\n\n  generateTimestamps() {\n    // Designate the \"end\" of the chart as an arbitrary number of beats (8?) after either the last arrow\n    // or the last event in the chart, whichever comes later\n    const lastArrow = this.arrows[this.arrows.length - 1];\n    const lastEvent = this.eventList[this.eventList.length - 1];\n\n    if (lastArrow && lastEvent) {\n      const lastArrowBeat = lastArrow.beatstamp;\n      const lastEventBeat = lastEvent.beat;\n      if (lastEventBeat > lastArrowBeat) {\n        this.globalParams.finalBeat = lastEventBeat;\n        this.globalParams.lastEntity = lastEvent;\n      } else {\n        this.globalParams.finalBeat = lastArrowBeat;\n        this.globalParams.lastEntity = lastArrow;\n      }\n    } else if (lastArrow) {\n      this.globalParams.finalBeat = lastArrow.beatstamp;\n      this.globalParams.lastEntity = lastArrow;\n    } else if (lastEvent) {\n      this.globalParams.finalBeat = lastEvent.beat;\n      this.globalParams.lastEntity = lastEvent;\n    }\n    this.globalParams.finalBeat += END_EXTRA_BEATS;\n\n    // note events (combo, assist tick, target flash)\n    // console.log(\"eventList\", this.eventList);\n    const bpmQueue = this.globalParams.bpmQueue;\n    // console.log(\"bpmQueue\", bpmQueue);\n\n    // subset of arrows that specifically count for combo (e.g. excluding ends of freeze arrows)\n    this.comboArrows = [];\n\n    let currentBpmPtr = -1,\n      currentEventPtr = 0,\n      pendingStopPtr = -1,\n      currentBpm = null,\n      pendingStop = null,\n      currentStopOffset = 0,\n      currentCombo = 0;\n    this.allArrows.forEach((arrow, idx) => {\n      // Find the latest bpm section that starts before this note\n      while (\n        currentBpmPtr < bpmQueue.length - 1 &&\n        bpmQueue[currentBpmPtr + 1].beat < arrow.beatstamp\n      ) {\n        // if this block was entered, a new bpm section was entered\n        currentBpmPtr++;\n        const bpmSection = bpmQueue[currentBpmPtr];\n        currentBpm = bpmSection.value;\n\n        // reset the accumulated stop time\n        currentStopOffset = 0;\n\n        // find the index of this bpm section in the eventList and use it as a starting point\n        // for keeping track of stops\n        for (let i = currentEventPtr; i < this.eventList.length; i++) {\n          const event = this.eventList[i];\n          if (event.beat === bpmSection.beat && event.type === \"bpm\") {\n            currentEventPtr = i;\n            const nextEvent = this.eventList[i + 1];\n            if (nextEvent && nextEvent.type === \"stop\") {\n              pendingStopPtr = i + 1;\n              pendingStop = this.eventList[pendingStopPtr];\n            } else {\n              pendingStop = null;\n            }\n            break;\n          }\n        }\n      }\n\n      // Accumulate total time of any stops that exist in this bpm section before this note.\n      // Keep track of the next pending stop so it can be added to the total stop time as soon as\n      // the first arrow following it is reached\n      while (pendingStop && pendingStop.beat < arrow.beatstamp) {\n        currentStopOffset += pendingStop.value;\n        const nextEvent = this.eventList[pendingStopPtr + 1];\n        if (nextEvent && nextEvent.type === \"stop\") {\n          pendingStopPtr++;\n        } else {\n          pendingStopPtr = -1;\n        }\n        pendingStop = this.eventList[pendingStopPtr];\n      }\n\n      const bpmSectionStartBeat = bpmQueue[currentBpmPtr].beat;\n      const bpmSectionStartTime = bpmQueue[currentBpmPtr].timestamp;\n\n      const beatDiff = arrow.beatstamp - bpmSectionStartBeat;\n      const timeDiff = beatDiff * (60 / currentBpm);\n      const arrowTimestamp = bpmSectionStartTime + timeDiff + currentStopOffset;\n      arrow.timestamp = arrowTimestamp;\n\n      // combo arrows (includes regular notes and freeze heads)\n      if (\n        arrow.note.includes(\"1\") ||\n        arrow.note.includes(\"2\") ||\n        arrow.note.includes(\"M\")\n      ) {\n        currentCombo++;\n        arrow.combo = currentCombo;\n\n        this.comboArrows.push(arrow);\n      }\n      // freeze ends that are not simultaneous with combo arrows\n      else if (arrow.note.includes(\"3\")) {\n      }\n    });\n\n    this.allArrows.forEach((arrow) => {\n      // If the note is the tail of a freeze arrow, calculate the number of beats\n      // from the head of the freeze arrow\n      for (let i = 0; i < arrow.note.length; i++) {\n        if (arrow.note[i] !== \"3\") continue;\n\n        // Find the most recent freeze head on the same direction as the tail\n        // and retroactively fill in the beats of the head and tail\n        // Also apply this to every regular note that occurs during the freeze\n\n        const arrowsDuringFreeze = [];\n\n        for (let j = arrow.key - 1; j >= 0; j--) {\n          if (!this.allArrows[j].holdStartBeats) {\n            this.allArrows[j].holdStartBeats = [];\n            this.allArrows[j].holdEndBeats = [];\n            this.allArrows[j].holdStartTimes = [];\n            this.allArrows[j].holdEndTimes = [];\n          }\n          arrowsDuringFreeze.push(this.allArrows[j]);\n\n          if (this.allArrows[j].note[i] === \"2\") {\n            const freezeHead = this.allArrows[j];\n            const freezeTail = arrow;\n\n            if (!freezeTail.holdStartBeats) {\n              freezeTail.holdStartBeats = [];\n              freezeTail.holdEndBeats = [];\n              freezeTail.holdStartTimes = [];\n              freezeTail.holdEndTimes = [];\n            }\n            arrowsDuringFreeze.push(freezeTail);\n\n            arrowsDuringFreeze.forEach((arrowDuringFreeze) => {\n              arrowDuringFreeze.holdStartBeats[i] = freezeHead.beatstamp;\n              arrowDuringFreeze.holdEndBeats[i] = freezeTail.beatstamp;\n              arrowDuringFreeze.holdStartTimes[i] = freezeHead.timestamp;\n              arrowDuringFreeze.holdEndTimes[i] = freezeTail.timestamp;\n            });\n            break;\n          }\n        }\n      }\n    });\n  }\n\n  // Calculate the gsap tweens before playing the chart\n  initTimeline(mods) {\n    /* Timestamp-based arrow events timeline */\n\n    this.allArrows.forEach((arrow) => {\n      // combo arrows (includes regular notes and freeze heads)\n      if (\n        arrow.note.includes(\"1\") ||\n        arrow.note.includes(\"2\") ||\n        arrow.note.includes(\"M\")\n      ) {\n        this.tl.set(\n          this.globalParams,\n          {\n            onStart: () => {\n              this.globalParams.combo = arrow.combo;\n\n              if (arrow instanceof Arrow) {\n                // AudioPlayer.playAssistTick();\n                // console.log(arrow);\n                this.globalParams.targetFlashes[\n                  arrow.beatstamp\n                ] = new TargetFlash(arrow);\n              }\n            },\n          },\n          arrow.timestamp - 0.008\n        );\n      }\n\n      // freeze ends that are not simultaneous with combo arrows\n      else if (arrow.note.includes(\"3\")) {\n        this.tl.set(\n          this.globalParams,\n          {\n            onStart: () => {\n              this.globalParams.targetFlashes[\n                arrow.beatstamp\n              ] = new TargetFlash(arrow);\n            },\n          },\n          arrow.timestamp - 0.008\n        );\n      }\n    });\n\n    /* Arrows timeline */\n\n    // set tween starting point back to 0\n    this.tl = this.tl.set({}, {}, 0);\n\n    // time tick timeline for cmod\n    // extend duration by an arbitrarily long buffer so rounding error does not cause the\n    // last arrow to stop a tiny decimal before reaching 0\n    this.tl = this.tl.to(\n      this.globalParams,\n      {\n        timeTick: this.globalParams.lastEntity.timestamp + 1,\n        duration: this.globalParams.lastEntity.timestamp + 1,\n        ease: \"none\",\n      },\n      \">\"\n    );\n\n    // set tween starting point back to 0\n    this.tl = this.tl.set({}, {}, 0);\n\n    /*\n      The space in between each event (i.e. a bpm change or stop) denotes a continous section of constant bpm.\n      Create a tween to animate the global beat tick for each of these sections and chain them together.\n      The position and/or frame animation of each canvas object (e.g. arrows, step zone, guidelines) can be\n      determined as a function of the beat tick value at any given point.\n    */\n    let accumulatedBeatTick = 0;\n    let bpm;\n\n    // beat tick timeline for normal speed mods\n    for (let i = 0; i < this.eventList.length; i++) {\n      let startEvent = this.eventList[i],\n        endEvent = this.eventList[i + 1];\n\n      // delay the animations by the length of the stop, if applicable\n      let delay = startEvent.type === \"stop\" ? startEvent.value : 0;\n\n      // the bpm of this section\n      if (startEvent.type === \"bpm\") bpm = startEvent.value;\n      else if (startEvent.type === \"stop\") bpm = startEvent.bpm;\n\n      // if there is a bpm change or stop event somewhere ahead of this one\n      if (endEvent) {\n        // number of beats between startEvent and endEvent, i.e. how long this constant bpm section is\n        const sectionBeatLength = endEvent.beat - startEvent.beat;\n\n        // the duration of this constant bpm section in seconds\n        const sectionDuration = (sectionBeatLength / bpm) * 60;\n\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: accumulatedBeatTick + sectionBeatLength,\n            duration: sectionDuration,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                changeActiveBpm(startEvent.value, this.globalParams);\n              }\n            },\n          },\n          `>${delay}`\n        );\n        accumulatedBeatTick += sectionBeatLength;\n      }\n      // if this is the last bpm change/stop event, animate remaining objects to end\n      else {\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: this.globalParams.finalBeat,\n            duration:\n              ((this.globalParams.finalBeat - accumulatedBeatTick) / bpm) * 60,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                changeActiveBpm(startEvent.value, this.globalParams);\n              }\n            },\n          },\n          `>${delay}`\n        );\n      }\n    }\n\n    this.guidelines = new Guidelines(this.globalParams.finalBeat);\n    this.bpmAndStopDisplay = new BpmAndStopDisplay();\n\n    AudioPlayer.setTimeline(this.tl);\n\n    this.updateLoopOnce();\n  }\n\n  mainLoop(loop = true) {\n    // if this gameEngine is replaced and flagged for garbage deletion, squash any residual\n    // attempts to invoke its mainLoop\n    if (this.killed) {\n      // console.log(\"old mainLoop squashed\");\n      return;\n    }\n\n    // console.log(\"mainLoop running\");\n    // console.log(\"\\n\\n\\n\");\n    let t0, t1;\n\n    // console.log(this.globalParams.timeTick);\n\n    t0 = performance.now();\n    this.drawBackground();\n    t1 = performance.now();\n    // console.log(`drawBackground: ${(t1 - t0).toFixed(3)} ms`);\n\n    const { songSelect, mods } = store.getState();\n    const { mode } = songSelect;\n\n    if (mods.cmod < 100 || mods.cmod > 1000) {\n      mods.cmod = DEFAULT_CMOD;\n    }\n\n    const { beatTick, timeTick } = this.globalParams;\n\n    if (this.stepZone && mods.stepZone !== \"off\") {\n      t0 = performance.now();\n      this.stepZone.render(\n        this.canvas,\n        { beatTick },\n        {\n          mode,\n          mods,\n        }\n      );\n      t1 = performance.now();\n      // console.log(`stepZone.render: ${(t1 - t0).toFixed(3)} ms`);\n    }\n    if (this.guidelines) {\n      t0 = performance.now();\n      this.guidelines.render(this.canvas, { beatTick, timeTick }, { mods });\n      t1 = performance.now();\n      // console.log(`guidelines.render: ${(t1 - t0).toFixed(3)} ms`);\n    }\n\n    /* Combo display, if behind arrows */\n    if (mods.comboDisplay === \"behind\") {\n      this.comboDisplay.render(this.canvas, this.globalParams.combo, {\n        mode,\n        mods,\n      });\n    }\n\n    updateBeatWindow(this.globalParams);\n\n    let windowStartPtr, windowEndPtr;\n    if (mods.speed === \"cmod\") {\n      windowStartPtr = this.globalParams.timeWindowStartPtr;\n      windowEndPtr = this.globalParams.timeWindowEndPtr;\n    } else {\n      windowStartPtr = this.globalParams.beatWindowStartPtr;\n      windowEndPtr = this.globalParams.beatWindowEndPtr;\n    }\n\n    /* Bpm and stop display */\n\n    if (mods.bpmStopDisplay) {\n      if (!this.bpmReel) {\n        this.bpmReel = document.getElementById(\"bpmReel\");\n      }\n      if (!this.stopReel) {\n        this.stopReel = document.getElementById(\"stopReel\");\n      }\n\n      this.bpmAndStopDisplay.refreshWindow(\n        mods.speed === \"cmod\"\n          ? this.globalParams.currentTimeWindow\n          : this.globalParams.currentBeatWindow,\n        { mods }\n      );\n\n      // console.log(\"mainLoop for\", songSelect.song.title, this.sm.slice(0, 30));\n\n      for (let i = windowStartPtr.bpm; i <= windowEndPtr.bpm; i++) {\n        const bpm = this.globalParams.bpmQueue[i];\n        // visibleBpmChanges.push(bpm.value);\n        this.bpmAndStopDisplay.renderBpm(\n          this.bpmReel,\n          bpm,\n          { beatTick, timeTick },\n          { mods }\n        );\n      }\n      for (let i = windowStartPtr.stop; i <= windowEndPtr.stop; i++) {\n        const stop = this.globalParams.stopQueue[i];\n        // visibleBpmChanges.push(stop.value);\n        this.bpmAndStopDisplay.renderStop(\n          this.stopReel,\n          stop,\n          { beatTick, timeTick },\n          { mods }\n        );\n      }\n      window.bpmAndStopDisplay = this.bpmAndStopDisplay;\n      // console.log(visibleBpmChanges);\n    }\n\n    /* Arrows */\n\n    const upArrows = mode === \"double\" ? [2, 6] : [2];\n    const notUpArrows = mode === \"double\" ? [0, 1, 3, 4, 5, 7] : [0, 1, 3];\n    // console.log(`GameEngine`, [\n    //   windowStartPtr.arrow,\n    //   windowEndPtr.arrow,\n    // ]);\n    for (let i = windowEndPtr.shock; i >= windowStartPtr.shock; i--) {\n      const shockArrow = this.globalParams.shocks[i];\n      shockArrow.render(\n        this.canvas,\n        this.globalParams.frame,\n        { beatTick, timeTick },\n        { mods }\n      );\n    }\n\n    for (let i = windowEndPtr.freeze; i >= windowStartPtr.freeze; i--) {\n      const freeze = this.globalParams.freezes[i];\n      notUpArrows.forEach((directionIdx) => {\n        freeze.renderFreezeBody(\n          this.canvas,\n          { beatTick, timeTick },\n          directionIdx,\n          { mods }\n        );\n      });\n    }\n    for (let i = windowStartPtr.freeze; i <= windowEndPtr.freeze; i++) {\n      const freeze = this.globalParams.freezes[i];\n      upArrows.forEach((directionIdx) => {\n        freeze.renderFreezeBody(\n          this.canvas,\n          { beatTick, timeTick },\n          directionIdx,\n          { mods }\n        );\n      });\n    }\n\n    for (let i = windowEndPtr.arrow; i >= windowStartPtr.arrow; i--) {\n      const arrow = this.globalParams.arrows[i];\n      notUpArrows.forEach((directionIdx) => {\n        arrow.renderArrow(this.canvas, { beatTick, timeTick }, directionIdx, {\n          mods,\n        });\n      });\n    }\n\n    // t0 = performance.now();\n    for (let i = windowStartPtr.arrow; i <= windowEndPtr.arrow; i++) {\n      const arrow = this.globalParams.arrows[i];\n      upArrows.forEach((directionIdx) => {\n        arrow.renderArrow(this.canvas, { beatTick, timeTick }, directionIdx, {\n          mods,\n        });\n      });\n    }\n    // t1 = performance.now();\n\n    // console.log(`arrows renderArrow: ${(t1 - t0).toFixed(3)} ms`);\n\n    // /* End arrows */\n\n    /* Combo display, if in front of arrows */\n    if (mods.comboDisplay === \"inFront\") {\n      this.comboDisplay.render(this.canvas, this.globalParams.combo, {\n        mode,\n        mods,\n      });\n    }\n\n    /* Hidden+ and/or Sudden+ lane cover */\n    if (\n      [\"hidden\", \"sudden\", \"hiddensudden\"].includes(mods.appearance) &&\n      mods.laneCoverVisible\n    ) {\n      this.laneCover.render(this.canvas, { mode, mods });\n    }\n\n    /* Target flashes */\n    t0 = performance.now();\n    for (let beatstamp in this.globalParams.targetFlashes) {\n      const targetFlash = this.globalParams.targetFlashes[beatstamp];\n      targetFlash.frame++;\n      if (targetFlash.frame > MARVELOUS_FLASH_FRAMES) {\n        delete this.globalParams.targetFlashes[beatstamp];\n      } else {\n        targetFlash.render(this.canvas, { mods });\n      }\n    }\n    t1 = performance.now();\n    // console.log(`targetFlash render: ${(t1 - t0).toFixed(3)} ms`);\n\n    /* Manual css property updates for DOM-based components */\n\n    // if (!this.bpmReel) {\n    //   this.bpmReel = document.getElementById(\"bpmReel\");\n    // }\n    // if (!this.stopReel) {\n    //   this.stopReel = document.getElementById(\"stopReel\");\n    // }\n    // if (mods.speed !== \"cmod\" && mods.bpmStopDisplay) {\n    //   [this.bpmReel, this.stopReel].forEach((reel) => {\n    //     reel.style.height =\n    //       this.globalParams.finalBeat * ARROW_HEIGHT * mods.speed;\n    //     reel.style.transform = `translateY(-${\n    //       this.globalParams.beatTick * ARROW_HEIGHT * mods.speed\n    //     }px)`;\n    //   });\n    // }\n\n    // if (this.globalParams.beatTick) {\n    //   console.log(this.globalParams.beatTick);\n    // }\n    this.globalParams.frame++;\n\n    if (loop) {\n      this.mainLoopRequestRef = window.requestAnimationFrame(\n        this.mainLoop.bind(this)\n      );\n    }\n  }\n\n  drawBackground() {\n    this.c.fillStyle = \"black\";\n    this.c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  restartTl() {\n    // console.log(\"call restart\");\n    this.tl.restart();\n  }\n  pauseTl() {\n    this.tl.pause();\n  }\n  isTlPaused() {\n    return this.tl.paused();\n  }\n}\n\nexport default GameEngine;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Modal, Button, Input } from \"semantic-ui-react\";\nimport copy from \"copy-to-clipboard\";\n\nimport { getOriginPath } from \"../../utils\";\nimport Progress from \"./canvas/Progress\";\n\nconst difficulties = {\n  Beginner: \"b\",\n  Basic: \"B\",\n  Difficult: \"D\",\n  Expert: \"E\",\n  Challenge: \"C\",\n};\n\nconst modes = {\n  single: \"S\",\n  double: \"D\",\n};\n\nconst ShareModal = (props) => {\n  const { modalOpen, setModalOpen, data } = props;\n  const { song, difficulty, mode, mods } = data;\n\n  const shareUrl = useRef();\n  const [message, setMessage] = useState(\"\");\n\n  useEffect(() => {\n    if (modalOpen === false) {\n      setMessage(\"\");\n    }\n  }, [modalOpen]);\n\n  if (!song) return null;\n\n  // console.log(\"ShareModal data\", data);\n\n  const generateShareUrl = () => {\n    const progress = Progress.getProgress();\n\n    const params = {\n      song: song.hash,\n      difficulty: difficulties[difficulty] + modes[mode] + \"P\",\n      turn: mods.turn !== \"off\" ? mods.turn : \"\",\n      speed: mods.speed.toString().replace(\".\", \"\"),\n      progress: parseInt(progress * 100000),\n    };\n\n    const queryStr = Object.keys(params)\n      .map((param) => {\n        if (params[param] === null || typeof params[param] === \"undefined\") {\n          return null;\n        }\n        return `${param}=${params[param]}`;\n      })\n      .filter((param) => param !== null)\n      .join(\"&\");\n\n    return getOriginPath() + \"?\" + queryStr;\n  };\n  shareUrl.current = generateShareUrl();\n\n  const copyShareUrl = () => {\n    copy(shareUrl.current);\n    setMessage(\"Copied link to clipboard\");\n  };\n\n  return (\n    <Modal\n      className=\"shareModal\"\n      size=\"fullscreen\"\n      open={modalOpen}\n      onClose={() => setModalOpen(false)}\n    >\n      <Modal.Header>Share link to chart</Modal.Header>\n      <Modal.Content>\n        <Input\n          type=\"text\"\n          className=\"share-url-input\"\n          value={shareUrl.current}\n          action\n        >\n          <input />\n          <Button onClick={copyShareUrl}>Copy</Button>\n        </Input>\n        <p>{message}</p>\n      </Modal.Content>\n    </Modal>\n  );\n};\n\nexport default ShareModal;\n","import React, { useEffect, useRef } from \"react\";\nimport { Button } from \"semantic-ui-react\";\n\nconst HoldButton = (props) => {\n  const button = useRef();\n  const requestRef = useRef();\n\n  const pressingDownRef = useRef();\n  const notPressingDownRef = useRef();\n\n  const buttonProps = { ...props };\n  delete buttonProps.onClick; // to avoid having the button invoke onClick an extra time\n\n  // Component needs to constantly refresh its event listeners to use the\n  // most up-to-date version of props.onClick.\n  // Unfortunately, this current implementation is not able to update state in between\n  // consecutive onClick invocations while held.\n  // Try to limit logic to those that do not depend on changing state while being held\n  useEffect(() => {\n    const el = button.current.ref.current;\n    el.removeEventListener(\"mousedown\", pressingDownRef.current, false);\n    el.removeEventListener(\"mouseup\", notPressingDownRef.current, false);\n    el.removeEventListener(\"mouseleave\", notPressingDownRef.current, false);\n\n    el.removeEventListener(\"touchstart\", pressingDownRef.current, false);\n    el.removeEventListener(\"touchend\", notPressingDownRef.current, false);\n\n    pressingDownRef.current = pressingDown;\n    notPressingDownRef.current = notPressingDown;\n\n    el.addEventListener(\"mousedown\", pressingDownRef.current, false);\n    el.addEventListener(\"mouseup\", notPressingDownRef.current, false);\n    el.addEventListener(\"mouseleave\", notPressingDownRef.current, false);\n\n    el.addEventListener(\"touchstart\", pressingDownRef.current, false);\n    el.addEventListener(\"touchend\", notPressingDownRef.current, false);\n  }, [props.onClick]);\n\n  const pressingDown = (e) => {\n    e.preventDefault();\n    if (props.onClick) {\n      props.onClick(e);\n    }\n    requestRef.current = requestAnimationFrame(handleHold.bind(null, e));\n  };\n\n  const notPressingDown = (e) => {\n    e.preventDefault();\n    cancelAnimationFrame(requestRef.current);\n  };\n\n  const handleHold = (e) => {\n    if (props.onClick) {\n      props.onClick(e);\n    }\n    requestRef.current = requestAnimationFrame(handleHold.bind(null, e));\n  };\n\n  return (\n    <Button {...buttonProps} ref={button}>\n      {props.children}\n    </Button>\n  );\n};\n\nexport default HoldButton;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Button, Icon } from \"semantic-ui-react\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport HoldButton from \"../ui/HoldButton\";\n\nconst PlayControls = (props) => {\n  const { audio, controlsDisabled, setShareModalOpen } = props;\n\n  const togglePlay = () => {\n    if (controlsDisabled) return;\n    if (props.audio.status === \"playing\") {\n      AudioPlayer.pause();\n    } else {\n      AudioPlayer.play();\n    }\n  };\n\n  const restart = () => {\n    if (controlsDisabled) return;\n    AudioPlayer.stop();\n  };\n\n  return (\n    <div className=\"play-controls\">\n      <HoldButton\n        onClick={() => AudioPlayer.goBack(20)}\n        className=\"play-control\"\n      >\n        <Icon name=\"backward\" />\n      </HoldButton>\n      <Button\n        onClick={togglePlay}\n        disabled={controlsDisabled}\n        className=\"play-control\"\n      >\n        <Icon name={audio.status === \"playing\" ? \"pause\" : \"play\"} />\n      </Button>\n      <Button onClick={restart} className=\"play-control\">\n        <Icon name=\"stop\" />\n      </Button>\n      <HoldButton\n        onClick={() => AudioPlayer.goForward(20)}\n        className=\"play-control\"\n      >\n        <Icon name=\"forward\" />\n      </HoldButton>\n\n      <Button\n        onClick={() => setShareModalOpen(true)}\n        className=\"play-control share-btn\"\n        disabled={audio.status === \"playing\"}\n      >\n        <Icon name=\"share square\" />\n      </Button>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  return { audio: audio.chartAudio };\n};\n\nexport default connect(mapStateToProps, null)(PlayControls);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\n\n// displays song information on the chart view\nconst SongInfo = (props) => {\n  const { selectedSong, selectedDifficulty, selectedMode } = props;\n  return (\n    <div className=\"song-info-row\">\n      <div className=\"song-information\">\n        {selectedSong && (\n          <>\n            <div className=\"song-title\">{selectedSong.title}</div>\n            <div className=\"song-artist\">{selectedSong.artist}</div>\n          </>\n        )}\n      </div>\n      <div className=\"level-information\">\n        {selectedSong && (\n          <>\n            <div className=\"song-difficulty\">{selectedDifficulty}</div>\n            <div className=\"song-level\">\n              {\n                selectedSong.levels[\n                  selectedMode === \"double\"\n                    ? DP_DIFFICULTIES.indexOf(selectedDifficulty) + 5\n                    : SP_DIFFICULTIES.indexOf(selectedDifficulty)\n                ]\n              }\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { songSelect } = state;\n  return {\n    selectedSong: songSelect.song,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n  };\n};\n\nexport default connect(mapStateToProps, null)(SongInfo);\n","import React, { useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Button } from \"semantic-ui-react\";\n\nimport { LANE_COVER_INCREMENT } from \"../../constants\";\nimport HoldButton from \"../ui/HoldButton\";\nimport { updateMods, updateLaneCoverHeight } from \"../../actions/ModsActions\";\nimport { getAssetPath } from \"../../utils\";\n\nconst CabButtons = (props) => {\n  const { canvas, mods, updateMods, updateLaneCoverHeight } = props;\n\n  const laneCoverFn = useRef();\n\n  const adjustLaneCoverHeight = (e) => {\n    // if key pressed is up or down, prevent default behavior\n    // ignore if key pressed is not up or down\n    if (e.keyCode !== 38 && e.keyCode !== 40) return;\n    else {\n      e.preventDefault();\n    }\n\n    // after preventing default behavior, ignore if no lane cover mod is being used\n    if (![\"hidden\", \"sudden\", \"hiddensudden\"].includes(mods.appearance)) {\n      return;\n    }\n\n    // the following code will only run if a lane cover mod is being used\n    // and if the key pressed was either up or down\n\n    const { scroll } = mods;\n\n    const laneCoverHeightDiff = [0, 0, 0];\n\n    const reverseFactor = scroll === \"reverse\" ? -1 : 1;\n\n    // up key\n    if (e.keyCode === 38) {\n      switch (mods.appearance) {\n        case \"hidden\":\n          laneCoverHeightDiff[0] -= LANE_COVER_INCREMENT * reverseFactor;\n          break;\n        case \"sudden\":\n          laneCoverHeightDiff[1] += LANE_COVER_INCREMENT * reverseFactor;\n          break;\n        case \"hiddensudden\":\n          laneCoverHeightDiff[2] += LANE_COVER_INCREMENT;\n          break;\n        default:\n          break;\n      }\n    }\n    // down key\n    else if (e.keyCode === 40) {\n      switch (mods.appearance) {\n        case \"hidden\":\n          laneCoverHeightDiff[0] += LANE_COVER_INCREMENT * reverseFactor;\n          break;\n        case \"sudden\":\n          laneCoverHeightDiff[1] -= LANE_COVER_INCREMENT * reverseFactor;\n          break;\n        case \"hiddensudden\":\n          laneCoverHeightDiff[2] -= LANE_COVER_INCREMENT;\n          break;\n        default:\n          break;\n      }\n    }\n\n    updateLaneCoverHeight({\n      diff: laneCoverHeightDiff,\n      canvasHeight: canvas.height,\n    });\n  };\n\n  const toggleLaneCover = (e) => {\n    e.preventDefault();\n    const { laneCoverVisible } = mods;\n    updateMods({ laneCoverVisible: !laneCoverVisible });\n  };\n\n  const updateLaneCoverFn = () => {\n    document.removeEventListener(\"keydown\", laneCoverFn.current);\n    laneCoverFn.current = adjustLaneCoverHeight;\n    document.addEventListener(\"keydown\", laneCoverFn.current);\n  };\n\n  useEffect(() => {\n    updateLaneCoverFn();\n  }, [mods.appearance, mods.scroll, mods.laneCoverHeight, canvas]);\n\n  return (\n    <div className=\"cab-buttons-container\">\n      <HoldButton\n        className=\"directional-button\"\n        onClick={(e) => {\n          e.keyCode = 38;\n          adjustLaneCoverHeight(e);\n        }}\n      >\n        <img src={getAssetPath(`directional_button.png`)} />\n      </HoldButton>\n      <Button\n        className=\"center-button\"\n        onClick={(e) => {\n          toggleLaneCover(e);\n        }}\n      >\n        <img src={getAssetPath(`center_button.png`)} />\n      </Button>\n      <HoldButton\n        className=\"directional-button\"\n        onClick={(e) => {\n          e.keyCode = 40;\n          adjustLaneCoverHeight(e);\n        }}\n      >\n        <img src={getAssetPath(`directional_button.png`)} />\n      </HoldButton>\n    </div>\n  );\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    updateMods: (mods) => dispatch(updateMods(mods)),\n    updateLaneCoverHeight: (diff) => dispatch(updateLaneCoverHeight(diff)),\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(CabButtons);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nconst BpmDisplay = (props) => {\n  const { mods, songSelect } = props;\n\n  return (\n    <div className={`bpm-display`}>\n      {mods.bpmStopDisplay && <div id=\"bpmReel\"></div>}\n      <div className={`current-bpm-container `}>\n        <div className=\"current-bpm-wrapper\">\n          <div className=\"current-bpm-header\">BPM</div>\n          <div className=\"current-bpm-value\"></div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect } = state;\n  return { mods, songSelect };\n};\n\nexport default connect(mapStateToProps, null)(BpmDisplay);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nconst StopDisplay = (props) => {\n  const { mods, songSelect } = props;\n\n  return (\n    <div className={`stop-display`}>\n      {mods.bpmStopDisplay && <div id=\"stopReel\"></div>}\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect } = state;\n  return { mods, songSelect };\n};\n\nexport default connect(mapStateToProps, null)(StopDisplay);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\nimport \"inobounce\";\n\nimport { presetParams, getJacketPath } from \"../../utils\";\nimport { usePrevious } from \"../../hooks\";\nimport GameEngine from \"../../core/GameEngine\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport ShareModal from \"./ShareModal\";\nimport Progress from \"./canvas/Progress\";\nimport PlayControls from \"./PlayControls\";\nimport SongInfo from \"./SongInfo\";\n\nimport CabButtons from \"./CabButtons\";\nimport BpmDisplay from \"./BpmDisplay\";\nimport StopDisplay from \"./StopDisplay\";\n\nconst ChartArea = (props) => {\n  const {\n    selectedDifficulty,\n    selectedMode,\n    selectedSong,\n    sm,\n    mods,\n    screen,\n    loadingAudio,\n    gameEngine,\n    setGameEngine,\n  } = props;\n\n  const [canvas, setCanvas] = useState(null);\n  const [shareModalOpen, setShareModalOpen] = useState(false);\n  const chartArea = useRef();\n  const canvasContainer = useRef();\n  const chartLoadingScreen = useRef();\n\n  const prevState = usePrevious({\n    canvas,\n    sm,\n    selectedDifficulty,\n    selectedMode,\n    mods,\n  });\n\n  // define canvas and resize listener on mount\n  useEffect(() => {\n    chartArea.current = document.querySelector(\"#chartArea\");\n    setCanvas(chartArea.current);\n\n    Progress.initCanvas();\n  }, []);\n\n  // change chart dimensions depending on single or double\n  // Hardcoded heights for now. Variable heights may be possible in the future\n  useEffect(() => {\n    if (!canvas || !canvasContainer.current) return;\n    resizeChartArea();\n  }, [canvas, selectedMode, screen]);\n\n  const resizeChartArea = () => {\n    if (selectedMode === \"single\") {\n      chartArea.current.width = 256;\n      chartArea.current.style.transform = \"none\";\n      chartArea.current.style.left = 0;\n      chartArea.current.style.top = 0;\n\n      // hack to resolve positioning issues\n      chartArea.current.style.position = \"static\";\n      setTimeout(() => {\n        chartArea.current.style.position = \"relative\";\n      });\n    } else if (selectedMode === \"double\") {\n      chartArea.current.width = 512;\n\n      const wrapper = canvasContainer.current.getBoundingClientRect();\n\n      if (wrapper.width < 512) {\n        const scaleFactor = wrapper.width / chartArea.current.width;\n        const xOffset = (chartArea.current.width - wrapper.width) / 2;\n        const yOffset = xOffset * (7 / 8);\n        chartArea.current.style.transform = `scale(${scaleFactor}) translate(-50%)`;\n        chartArea.current.style.position = \"absolute\";\n        chartArea.current.style.left = `-${xOffset}px`;\n        chartArea.current.style.top = `-${yOffset}px`;\n      } else {\n        chartArea.current.style.transform = \"none\";\n        chartArea.current.style.left = 0;\n        chartArea.current.style.top = 0;\n\n        chartArea.current.style.position = \"static\";\n        setTimeout(() => {\n          chartArea.current.style.position = \"relative\";\n        });\n      }\n    }\n\n    if (gameEngine) {\n      gameEngine.updateLoopOnce();\n    }\n  };\n\n  // reset chart if mode, difficulty, or mods change\n  useEffect(() => {\n    const currentState = { canvas, sm, selectedDifficulty, selectedMode, mods };\n\n    if (!canvas) return;\n\n    const chartParams = {\n      mode: selectedMode,\n      difficulty: selectedDifficulty,\n      mods,\n    };\n\n    Object.keys(currentState).forEach((thing) => {\n      if (prevState[thing] !== currentState[thing]) {\n        // initial setup of game engine when canvas is mounted\n        if (thing === \"canvas\") {\n        } else if (thing === \"sm\") {\n          // console.log(\n          //   `${thing} changed from ${\n          //     prevState[thing]\n          //       ? prevState[thing].slice(0, 30)\n          //       : prevState[thing]\n          //   } \\n\\nto ${currentState[thing].slice(0, 30)}`\n          // );\n          const simfileType = selectedSong.useSsc ? \"ssc\" : \"sm\";\n\n          // flag the old game engine as killed, so any residual invocations\n          // of its mainLoop can be squashed until it is garbage collected\n          if (gameEngine) {\n            gameEngine.killed = true;\n          }\n\n          let ge = new GameEngine(canvas, sm, simfileType, chartParams);\n          ge.pauseTl();\n          setGameEngine(ge);\n        } else if (thing === \"mods\") {\n          Object.keys(prevState.mods).forEach((mod) => {\n            const prev = JSON.stringify(prevState.mods[mod]);\n            const curr = JSON.stringify(currentState.mods[mod]);\n            const modChanged = prev !== curr;\n\n            if (gameEngine && modChanged) {\n              if (mod === \"bpmStopDisplay\") {\n                if (gameEngine.bpmAndStopDisplay) {\n                  gameEngine.bpmAndStopDisplay.clearWindow();\n                }\n                gameEngine.bpmReel = currentState.mods[mod]\n                  ? document.getElementById(\"bpmReel\")\n                  : null;\n                gameEngine.stopReel = currentState.mods[mod]\n                  ? document.getElementById(\"stopReel\")\n                  : null;\n              }\n\n              if ([\"turn\", \"shuffle\"].includes(mod)) {\n                gameEngine.resetChart(chartParams);\n              } else {\n                // console.log(prev, curr);\n                if (gameEngine.isTlPaused()) {\n                  gameEngine.updateLoopOnce();\n                }\n              }\n            }\n          });\n        }\n        // mode or difficulty\n        else {\n          // console.log(\n          //   `${thing} changed from ${prevState[thing]} to ${currentState[thing]}`\n          // );\n          if (gameEngine) {\n            gameEngine.resetChart(chartParams);\n          }\n        }\n      }\n    });\n\n    if (gameEngine) {\n      gameEngine.updateExternalGlobalParams({ mods });\n    }\n  }, [canvas, sm, selectedDifficulty, selectedMode, mods]);\n\n  const shareParams = {\n    song: selectedSong,\n    difficulty: selectedDifficulty,\n    mode: selectedMode,\n    mods,\n  };\n\n  return (\n    <div\n      className={`view-section chartView ${\n        screen.activeView === \"chart\" ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"view-wrapper chartArea-container\">\n        <div\n          className={`canvas-container ${selectedMode} ${mods.scroll}`}\n          ref={canvasContainer}\n        >\n          <div className=\"chartArea-wrapper\">\n            {gameEngine && (\n              <BpmDisplay bpmQueue={gameEngine.globalParams.bpmQueue} />\n            )}\n            <div className=\"canvas-wrapper\">\n              <canvas id=\"chartArea\" width=\"256\" height=\"448\" />\n              <div\n                className={`chart-loading-screen ${selectedMode} ${\n                  loadingAudio ? \"loading\" : \"\"\n                } `}\n                ref={chartLoadingScreen}\n              >\n                {selectedSong && (\n                  <img\n                    className=\"chart-loading-jacket\"\n                    src={getJacketPath(`${selectedSong.hash}.png`)}\n                  />\n                )}\n                <div className=\"chart-loading-message\">Loading chart...</div>\n              </div>\n              {selectedSong &&\n                !loadingAudio &&\n                [\"hidden\", \"sudden\", \"hiddensudden\"].includes(\n                  mods.appearance\n                ) && <CabButtons mods={mods} canvas={canvas} />}\n            </div>\n            {gameEngine && (\n              <StopDisplay stopQueue={gameEngine.globalParams.stopQueue} />\n            )}\n          </div>\n        </div>\n        <div className=\"progress-container\">\n          <div className=\"progress-wrapper\">\n            <canvas id=\"progress\" />\n            {presetParams.progress ? (\n              <div\n                className=\"preset-marker-wrapper\"\n                onClick={Progress.jumpToPresetStart.bind(Progress)}\n                onTouchStart={Progress.jumpToPresetStart.bind(Progress)}\n              >\n                <div className=\"preset-marker\" />\n              </div>\n            ) : null}\n          </div>\n        </div>\n        {/* <canvas id=\"chartArea\" width=\"256\" height=\"18000\" /> */}\n        <div className=\"row\">\n          <PlayControls\n            controlsDisabled={!gameEngine || loadingAudio}\n            setShareModalOpen={setShareModalOpen}\n          />\n        </div>\n        <div className=\"row\">\n          <SongInfo />\n        </div>\n        <ShareModal\n          modalOpen={shareModalOpen}\n          setModalOpen={setShareModalOpen}\n          data={shareParams}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect, screen } = state;\n  return {\n    mods,\n    selectedSong: songSelect.song,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n    screen,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChartArea);\n","import { useEffect, useRef } from \"react\";\n\nexport const usePrevious = (value) => {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current || value;\n};\n","import { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../constants\";\n\n/*\n  If the song does not have a chart corresponding to the chosen difficulty option,\n  pick whatever is *closest*\n  - If Difficult, Expert, or Challenge is the chosen option, start from Challenge and\n    work your way down until the first available difficulty is reached.\n  - If Beginner or Basic is the chosen option, start from Beginner and work up.\n  The closest available difficulty will be chosen for the song without affecting the\n  difficulty option selected for the form, like the way it works in the real game\n*/\nexport const getClosestDifficulty = (song, difficulty, mode) => {\n  const difficulties = mode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n  const levels =\n    mode === \"double\" ? song.levels.slice(5, 9) : song.levels.slice(0, 5);\n\n  if ([\"Difficult\", \"Expert\", \"Challenge\"].includes(difficulty)) {\n    for (let i = difficulties.length - 1; i >= 0; i--) {\n      if (levels[i]) {\n        return difficulties[i];\n      }\n    }\n  } else if ([\"Beginner\", \"Basic\"].includes(difficulty)) {\n    for (let i = 0; i <= difficulties.length - 1; i++) {\n      if (levels[i]) {\n        return difficulties[i];\n      }\n    }\n  }\n};\n","import React from \"react\";\n\nimport { getJacketPath } from \"../../utils\";\nimport { SP_DIFFICULTIES } from \"../../constants\";\nimport { getClosestDifficulty } from \"../../utils/songUtils\";\n\nconst SongGrid = (props) => {\n  const {\n    displayedSongs,\n    onSongSelect,\n    selectedSongOption,\n    selectedMode,\n    selectedDifficultyOption,\n    selectedFilters,\n  } = props;\n\n  let songs = displayedSongs;\n\n  const selectSong = (song) => {\n    onSongSelect(song.hash);\n  };\n\n  const renderSongLevel = (song) => {\n    let levels = [];\n    if (selectedMode === \"single\") levels = song.levels.slice(0, 5);\n    else if (selectedMode === \"double\")\n      levels = [null, ...song.levels.slice(5, 9)];\n\n    const levelFilter = selectedFilters.level;\n    const difficultyFilter = selectedFilters.difficulty;\n\n    // If neither level nor difficulty are being filtered, show the chosen difficulty option or whatever is closest\n    if (difficultyFilter === \"all\" && levelFilter === \"all\") {\n      const displayedLevels = [null, null, null, null, null];\n      const difficultyIdx = SP_DIFFICULTIES.indexOf(selectedDifficultyOption);\n      if (levels[difficultyIdx]) {\n        displayedLevels[difficultyIdx] = levels[difficultyIdx];\n      } else {\n        const closestDiff = getClosestDifficulty(\n          song,\n          selectedDifficultyOption,\n          selectedMode\n        );\n        const closestDiffIdx = SP_DIFFICULTIES.indexOf(closestDiff);\n        displayedLevels[closestDiffIdx] = levels[closestDiffIdx];\n      }\n      levels = displayedLevels;\n    } else {\n      levels.forEach((level, i) => {\n        if (!level) return;\n        const difficulty = SP_DIFFICULTIES[i];\n        // If level is chosen but difficulty is not, show all difficulties that match the level\n        if (difficultyFilter === \"all\") {\n          if (level !== levelFilter) levels[i] = null;\n        }\n        // If level is not chosen but difficulty is, show the filtered difficulty only\n        // If both level and difficulty are chosen, show the filtered difficulty only\n        else {\n          if (difficulty !== difficultyFilter) levels[i] = null;\n        }\n      });\n    }\n\n    return levels.map((level, i) => {\n      if (!level) return null;\n      const difficulty = SP_DIFFICULTIES[i];\n      return (\n        <div\n          key={`${song.hash}_${difficulty}`}\n          className={`song-level ${difficulty}`}\n        >\n          {level}\n        </div>\n      );\n    });\n  };\n\n  const renderSong = (song) => {\n    return (\n      <div\n        className=\"songTile-wrapper\"\n        key={`songtile_${song.hash}`}\n        onClick={() => selectSong(song)}\n      >\n        <div\n          className={`songTile ${\n            selectedSongOption === song.hash ? \"selected\" : \"\"\n          }`}\n        >\n          <div className=\"song-jacket-wrapper\">\n            <img\n              className=\"song-jacket\"\n              src={getJacketPath(`${song.hash}.png`)}\n              title={song.title}\n              alt={song.title}\n            />\n          </div>\n          <div className=\"song-level-wrapper\">{renderSongLevel(song)}</div>\n          <div className=\"song-title-bar\">{song.title}</div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"songGrid\">\n      {songs.map((song) => {\n        return renderSong(song);\n      })}\n    </div>\n  );\n};\n\nexport default SongGrid;\n","const loadStore = {\n  lastRequestedSong: null, // storing song title rn for easier debugging, change to hash\n  lastRequestedSongLoaded: false,\n};\nexport default loadStore;\n","import React from \"react\";\n\nconst ToggleSwitch = (props) => {\n  const { option1, option2, value, disabled } = props;\n\n  const toggleChange = () => {\n    if (disabled || !option1 || !option2) return;\n\n    if (value === option1.value) {\n      props.onChange(option2.value);\n    } else if (value === option2.value) {\n      props.onChange(option1.value);\n    }\n\n    // default to option 1 if uninitialized\n    else {\n      props.onChange(option1.value);\n    }\n  };\n\n  const selectOption = (option) => {\n    if (disabled || !option || typeof option.value === \"undefined\") return;\n    props.onChange(option.value);\n  };\n\n  const getSwitchClassName = () => {\n    let className = \"toggleSwitch\";\n    if (value === option1.value) className += ` left`;\n    else if (value === option2.value) className += ` right`;\n    return className;\n  };\n\n  return (\n    <div className={`toggleSwitch-wrapper ${disabled ? \"disabled\" : \"\"}`}>\n      <label\n        className={`toggleSwitch-option1 ${\n          value === option1.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option1)}\n      >\n        {option1.text}\n      </label>\n      <div className={getSwitchClassName()} onClick={toggleChange}></div>\n      <label\n        className={`toggleSwitch-option2 ${\n          value === option2.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option2)}\n      >\n        {option2.text}\n      </label>\n    </div>\n  );\n};\n\nexport default ToggleSwitch;\n","import {\n  SP_DIFFICULTIES,\n  TITLE_CATEGORIES,\n  LEVELS,\n  DDR_VERSIONS,\n} from \"../../constants\";\n\nexport const titleSortOptions = [\n  { key: \"title_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  TITLE_CATEGORIES.map((letter) => {\n    return { key: `title_${letter}`, value: letter, text: letter };\n  })\n);\n\nexport const versionSortOptions = [\n  { key: \"version_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  DDR_VERSIONS.map((versionName, idx) => {\n    return { key: `version_${idx}`, value: idx, text: versionName };\n  }).reverse()\n);\n\nexport const levelSortOptions = [\n  { key: \"level_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  LEVELS.map((level) => {\n    return { key: `level_${level}`, value: level, text: level };\n  })\n);\n\nexport const difficultySortOptions = [\n  { key: \"difficulty_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  SP_DIFFICULTIES.map((difficulty) => {\n    return {\n      key: `difficulty_${difficulty}`,\n      value: difficulty,\n      text: difficulty,\n    };\n  })\n);\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_1\",\n  \"data-name\": \"Line 1\",\n  d: \"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_2\",\n  \"data-name\": \"Line 2\",\n  d: \"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_3\",\n  \"data-name\": \"Line 3\",\n  d: \"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z\"\n});\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_4\",\n  \"data-name\": \"Line 4\",\n  d: \"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z\"\n});\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_5\",\n  \"data-name\": \"Line 5\",\n  d: \"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z\"\n});\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_6\",\n  \"data-name\": \"Line 6\",\n  d: \"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z\"\n});\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_7\",\n  \"data-name\": \"Line 7\",\n  d: \"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z\"\n});\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_8\",\n  \"data-name\": \"Line 8\",\n  d: \"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z\"\n});\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_9\",\n  \"data-name\": \"Line 9\",\n  d: \"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z\"\n});\n\nvar SvgAudiowave = function SvgAudiowave(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"audioWave\",\n    \"data-name\": \"Layer 1\",\n    viewBox: \"0 0 50 38.05\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgAudiowave, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/audiowave.e48c060f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef } from \"react\";\nimport { Dropdown } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\nimport { Helmet } from \"react-helmet\";\n\nimport * as actions from \"../../actions/SongSelectActions\";\nimport SongGrid from \"./SongGrid\";\nimport { getJacketPath, presetParams, parseUrlParams } from \"../../utils\";\nimport { getClosestDifficulty } from \"../../utils/songUtils\";\nimport { clearBpmAndStopDisplay } from \"../../utils/engineUtils\";\nimport {\n  getUserSettings,\n  updateUserSettings,\n  getSavedSongProgress,\n} from \"../../utils/userSettings\";\nimport loadStore from \"../../utils/loadStore\";\nimport ToggleSwitch from \"../ui/ToggleSwitch\";\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\nimport {\n  titleSortOptions,\n  versionSortOptions,\n  levelSortOptions,\n  difficultySortOptions,\n} from \"./songFormOptions\";\nimport { generateInitialValues } from \"./options\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { ReactComponent as AudioWave } from \"../../svg/audiowave.svg\";\n\nconst userSettings = getUserSettings();\n\nconst SongForm = (props) => {\n  const { simfileList, selectedDifficulty, selectedMode, previewAudio } = props;\n  const songGridContainer = useRef();\n\n  const simfileOptions = simfileList.map((song) => {\n    return { key: song.hash, value: song.hash, text: song.title };\n  });\n\n  const [selectedSongOption, setSelectedSongOption] = useState(null);\n  const [selectedDifficultyOption, setSelectedDifficultyOption] = useState(\n    selectedDifficulty\n  );\n  const [loadingFirstSong, setLoadingFirstSong] = useState(true);\n\n  const [selectedFilters, setSelectedFilters] = useState(\n    userSettings.filters || {\n      title: \"all\",\n      version: 16,\n      level: \"all\",\n      difficulty: \"all\",\n    }\n  );\n\n  const updateSelectedFilters = (newFilters) => {\n    const filters = { ...selectedFilters, ...newFilters };\n    updateUserSettings({ filters });\n    setSelectedFilters(filters);\n  };\n\n  const [displayedSongs, setDisplayedSongs] = useState([]);\n\n  // on filter or mode change\n  useEffect(() => {\n    const { title, version, level, difficulty } = selectedFilters;\n\n    const songs = simfileList\n      .filter((song) => {\n        const singleDiffs = song.levels.slice(0, 5);\n        const doubleDiffs = song.levels.slice(5, 9);\n        return (\n          // song matches title filter\n          (title === \"all\" || title === song.abcSort) &&\n          // song matches version filter\n          (version === \"all\" || version === parseInt(song.version)) &&\n          // if a level filter is selected, song matches level filter\n          // if level is not being filtered, song has at least one chart on the chosen mode\n          ((level === \"all\" &&\n            selectedMode === \"single\" &&\n            singleDiffs.some((level) => !!level)) ||\n            (level === \"all\" &&\n              selectedMode === \"double\" &&\n              doubleDiffs.some((level) => !!level)) ||\n            (selectedMode === \"single\" &&\n              song.levels.slice(0, 5).includes(level)) ||\n            (selectedMode === \"double\" &&\n              song.levels.slice(5, 9).includes(level)))\n        );\n      })\n      .filter((song) => {\n        // if a difficulty is specified:\n        if (difficulty !== \"all\") {\n          // if level is not specified, simply check if that difficulty exists\n          if (level === \"all\") {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] !== null;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] !== null\n              );\n            }\n          }\n          // if level is specified, only show if the difficulty is that level\n          else {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] === level;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] === level\n              );\n            }\n          }\n        }\n        return song;\n      });\n\n    setDisplayedSongs(songs);\n    songGridContainer.current.scrollTop = 0;\n  }, [selectedFilters, selectedMode]);\n\n  // object corresponding to the selected song option\n  // NOT the song currently playing in the main view\n  const [selectedSong, setSelectedSong] = useState(null);\n\n  // // respond to changes in share link url params\n  // useEffect(() => {\n  //   if (loadingFirstSong) return;\n  //   try {\n  //     console.log(\"share link params:\", props.location.search);\n  //     const parsedParams = parseUrlParams();\n  //     console.log(\"parsedParams\", parsedParams);\n  //     const initialValues = generateInitialValues(parsedParams);\n  //     console.log(\"initialValues\", initialValues);\n  //     onSongSelect(parsedParams.song, { preserveShareUrl: true });\n  //   } catch (error) {\n  //     console.log(\"error while trying to respond to url param change\");\n  //   }\n  // }, [props.location]);\n\n  // initialize song for testing\n  useEffect(() => {\n    /*\n      For some reason, the very first interaction with the dom will reset the Howler\n      audio seek time to 0 (a bug?). Force an interaction in the beginning to get this\n      out of the way and prevent overwriting of the preset time\n    */\n    document.body.click();\n\n    // Select a pre-selected song\n    // Highest priority: song contained in share url\n    if (presetParams.song) {\n      onSongSelect(presetParams.song, { preserveShareUrl: true });\n    }\n    // Second highest priority: song saved from user's previous session\n    else if (userSettings.song) {\n      onSongSelect(userSettings.song);\n    }\n    // Lowest priority: arbitrary song chosen to be the default\n    else {\n      onSongSelect(\"99OQb9b0IQ98P6IQdPOiqi8q16o16iqP\"); // ORCA\n    }\n    setLoadingFirstSong(false);\n  }, []);\n\n  useEffect(() => {\n    if (selectedSongOption) {\n      const song = simfileList.find((song) => song.hash === selectedSongOption);\n      setSelectedSong(song);\n      AudioPlayer.storeAudioSource(song);\n    }\n  }, [selectedSongOption]);\n\n  const onSongSelect = async (songId, params = {}) => {\n    AudioPlayer.stopSongPreview();\n    if (selectedSong) {\n      AudioPlayer.killImmediately(selectedSong.hash);\n      clearBpmAndStopDisplay();\n    }\n\n    setSelectedSongOption(songId);\n\n    const song = simfileList.find((song) => song.hash === songId);\n\n    let initialProgress = 0;\n\n    // initialize progress only if this is the song being initialized on page load\n    if (!props.previousSong) {\n      initialProgress = getSavedSongProgress();\n    }\n\n    if (presetParams.song === songId && presetParams.progress) {\n      initialProgress = presetParams.progress / 100000;\n    } else {\n      // remove preset progress marker if it is no longer relevant to the new song\n      presetParams.progress = 0;\n    }\n\n    // automatically fetch simfile and update chart\n    await props.onSongSelect(song, initialProgress);\n\n    // short-circuit if this is not the last song that was selected\n    if (loadStore.lastRequestedSong !== song.title) {\n      return;\n    }\n\n    const selectClosestDifficulty = () => {\n      const selectedDiffOptionIndex = SP_DIFFICULTIES.indexOf(\n        selectedDifficultyOption\n      );\n      let difficultyToSelect;\n      if (song.levels[selectedDiffOptionIndex]) {\n        difficultyToSelect = selectedDifficultyOption;\n      } else {\n        difficultyToSelect = getClosestDifficulty(\n          song,\n          selectedDifficultyOption,\n          selectedMode\n        );\n      }\n      props.onDifficultySelect(difficultyToSelect);\n    };\n\n    // Auto-select the selected song's chart based on the applied level/difficulty filters.\n    // 4 possible cases\n\n    // Neither level nor difficulty filter applied\n    if (\n      selectedFilters.level === \"all\" &&\n      selectedFilters.difficulty === \"all\"\n    ) {\n      // select the chart corresponding to the selected difficulty option.\n      // if the song does not have a chart for that difficulty, choose the closest difficulty.\n      selectClosestDifficulty();\n    }\n\n    // Level filter applied but not difficulty\n    else if (\n      selectedFilters.level !== \"all\" &&\n      selectedFilters.difficulty === \"all\"\n    ) {\n      const levels =\n        selectedMode === \"double\"\n          ? song.levels.slice(5, 9)\n          : song.levels.slice(0, 5);\n\n      // if the song has a chart that matches the level filter, choose that chart\n      if (levels.includes(selectedFilters.level)) {\n        for (let i = 0; i < levels.length; i++) {\n          const level = levels[i];\n          if (level === selectedFilters.level) {\n            const difficulties =\n              selectedMode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n            props.onDifficultySelect(difficulties[i]);\n            break;\n          }\n        }\n      }\n\n      // if the song does not have a chart that matches the level filter, go with the closest difficulty\n      else {\n        selectClosestDifficulty();\n      }\n    }\n\n    // Difficulty filter applied but not level\n    else if (\n      selectedFilters.difficulty !== \"all\" &&\n      selectedFilters.level === \"all\"\n    ) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(selectedFilters.difficulty);\n      if (selectedMode === \"double\") difficultyIdx += 4;\n\n      // if the song has a chart that matches the difficulty filter, choose that chart\n      if (typeof song.levels[difficultyIdx] === \"number\") {\n        props.onDifficultySelect(selectedFilters.difficulty);\n      }\n\n      // if the song does not have a chart that matches the difficulty filter, go with the closest difficulty\n      else {\n        selectClosestDifficulty();\n      }\n    }\n\n    // Both level and difficulty filters applied\n    // equivalent to a regular else block but condition listed explicitly for clarity\n    else if (\n      selectedFilters.difficulty !== \"all\" &&\n      selectedFilters.level !== \"all\"\n    ) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(selectedFilters.difficulty);\n      if (selectedMode === \"double\") difficultyIdx += 4;\n\n      if (song.levels[difficultyIdx] === selectedFilters.level) {\n        props.onDifficultySelect(selectedFilters.difficulty);\n      } else {\n        selectClosestDifficulty();\n      }\n    }\n\n    /* Miscellaneous side effects of selecting a song */\n\n    // if the user got here via a share url and changes the song/difficulty, remove the share params\n    if (!params.preserveShareUrl) {\n      window.history.pushState(null, null, \".\");\n    }\n  };\n\n  const handleDifficultySelect = (difficulty) => {\n    setSelectedDifficultyOption(difficulty);\n    props.onDifficultySelect(difficulty);\n  };\n\n  const handleModeSelect = (mode) => {\n    props.onModeSelect(mode);\n  };\n\n  const renderDifficulties = () => {\n    if (!selectedSong) return null;\n\n    let levels;\n    if (selectedMode === \"single\") levels = selectedSong.levels.slice(0, 5);\n    else if (selectedMode === \"double\")\n      levels = selectedSong.levels.slice(5, 9);\n\n    return levels.map((level, idx) => {\n      if (!level) return null;\n      const difficulty =\n        selectedMode === \"double\" ? DP_DIFFICULTIES[idx] : SP_DIFFICULTIES[idx];\n      return (\n        <div\n          className={`song-difficulty ${difficulty} ${\n            selectedDifficulty === difficulty ? \"selected\" : \"\"\n          }`}\n          key={`${selectedMode}-difficulty_${difficulty}`}\n          onClick={() => handleDifficultySelect(difficulty)}\n        >\n          <div className=\"difficulty\">{difficulty}</div>\n          <div className=\"level\">{level}</div>\n        </div>\n      );\n    });\n  };\n\n  const getDisplayBpm = () => {\n    if (!selectedSong) return null;\n    let displayBpm = selectedSong.displayBpm;\n    if (displayBpm.includes(\",\")) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(selectedDifficulty);\n      if (selectedMode === \"double\") difficultyIdx += 4;\n      displayBpm = displayBpm.split(\",\")[difficultyIdx];\n    }\n    return displayBpm;\n  };\n\n  const isModeToggleDisabled = () => {\n    if (!selectedSong || !selectedMode) return true;\n    if (selectedDifficulty === \"Beginner\") return true;\n    if (selectedMode === \"single\") {\n      return !selectedSong.levels.slice(5, 9).filter((a) => a).length;\n    } else if (selectedMode === \"double\") {\n      return !selectedSong.levels.slice(0, 5).filter((a) => a).length;\n    }\n    return true;\n  };\n\n  const toggleSongPreview = () => {\n    const oldSongHash = AudioPlayer.currentPreview;\n\n    // toggle start/stop of the same song\n    if (oldSongHash === selectedSong.hash) {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      } else {\n        AudioPlayer.playSongPreview(selectedSong);\n      }\n    }\n\n    // play a new song and stop the current one (if applicable)\n    else {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      }\n      AudioPlayer.playSongPreview(selectedSong);\n    }\n  };\n\n  return (\n    <div\n      className={`view-section songView ${\n        props.activeView === \"song\" ? \"active\" : \"\"\n      }`}\n    >\n      {/* meta tags defined here */}\n      {selectedSong && (\n        <Helmet>\n          <title>{selectedSong.title} - SMViewer</title>\n          <meta\n            property=\"og:title\"\n            content={`${selectedSong.title} - SMViewer`}\n          />\n        </Helmet>\n      )}\n      {/* end meta tags */}\n      <div className=\"view-wrapper\">\n        <form className=\"songForm\">\n          <div className=\"form-inner-wrapper\">\n            <div className=\"selectedSong\">\n              <div\n                className={`selectedSong-jacket-wrapper ${\n                  previewAudio.status === \"playing\" ? \"playing\" : \"\"\n                }`}\n              >\n                <div className=\"selectedSong-jacket-overlay\">\n                  <AudioWave />\n                </div>\n                <img\n                  className={`selectedSong-jacket`}\n                  src={getJacketPath(`${selectedSongOption}.png`)}\n                  alt=\"Selected song\"\n                  onClick={toggleSongPreview}\n                />\n              </div>\n              <div className=\"selectedSong-info\">\n                <Dropdown\n                  placeholder=\"Choose a song\"\n                  className=\"song-title-dropdown\"\n                  search\n                  selection\n                  value={selectedSongOption}\n                  onChange={(e, data) => onSongSelect(data.value)}\n                  options={simfileOptions}\n                  selectOnBlur={false}\n                  selectOnNavigation={false}\n                />\n                <div className=\"song-artist\">\n                  {selectedSong && selectedSong.artist}\n                </div>\n\n                <div className=\"song-difficulties\">{renderDifficulties()}</div>\n\n                <div className=\"song-mode\">\n                  <ToggleSwitch\n                    option1={{ text: \"Single\", value: \"single\" }}\n                    option2={{ text: \"Double\", value: \"double\" }}\n                    onChange={handleModeSelect}\n                    value={selectedMode}\n                    disabled={isModeToggleDisabled()}\n                  />\n                </div>\n\n                <div className=\"bpm-display-container\">\n                  <div className=\"bpm-display-label\">BPM</div>\n                  <div className=\"bpm-display-value\">{getDisplayBpm()}</div>\n                </div>\n              </div>\n            </div>\n            <div className=\"songForm-filters\">\n              <div className=\"songForm-filters-row\">\n                <div className=\"form-field\">\n                  <label>By Title</label>\n                  <Dropdown\n                    className=\"title-filter-dropdown\"\n                    selection\n                    value={selectedFilters.title}\n                    onChange={(e, data) =>\n                      updateSelectedFilters({\n                        title: data.value,\n                      })\n                    }\n                    options={titleSortOptions}\n                  />\n                </div>\n                <div className=\"form-field\">\n                  <label>By Version</label>\n                  <Dropdown\n                    className=\"version-filter-dropdown\"\n                    selection\n                    value={selectedFilters.version}\n                    onChange={(e, data) =>\n                      updateSelectedFilters({\n                        version: data.value,\n                      })\n                    }\n                    options={versionSortOptions}\n                  />\n                </div>\n                <div className=\"form-field\">\n                  <label>By Level</label>\n                  <Dropdown\n                    className=\"level-filter-dropdown\"\n                    selection\n                    value={selectedFilters.level}\n                    onChange={(e, data) =>\n                      updateSelectedFilters({\n                        level: data.value,\n                      })\n                    }\n                    options={levelSortOptions}\n                  />\n                  <label>By Difficulty</label>\n                  <Dropdown\n                    className=\"difficulty-filter-dropdown\"\n                    selection\n                    value={selectedFilters.difficulty}\n                    onChange={(e, data) =>\n                      updateSelectedFilters({\n                        difficulty: data.value,\n                      })\n                    }\n                    options={difficultySortOptions}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        </form>\n\n        <div className=\"songGrid-container\" ref={songGridContainer}>\n          <SongGrid\n            displayedSongs={displayedSongs}\n            onSongSelect={onSongSelect}\n            selectedSongOption={selectedSongOption}\n            selectedMode={selectedMode}\n            selectedDifficultyOption={selectedDifficultyOption}\n            selectedFilters={selectedFilters}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, songSelect, screen } = state;\n  const { previewAudio } = audio;\n  return {\n    previewAudio,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n    previousSong: songSelect.song,\n    activeView: screen.activeView,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(actions.selectSong(song)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SongForm);\n","import React, { useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Radio, Checkbox, Input } from \"semantic-ui-react\";\n\nimport { options } from \"./options\";\nimport { SP_DIFFICULTIES, DEFAULT_CMOD } from \"../../constants\";\nimport { capitalize } from \"../../utils\";\nimport { updateMods } from \"../../actions/ModsActions\";\n\nconst ModsForm = (props) => {\n  const { mods, updateMods, mode, song, difficulty } = props;\n\n  // when switching between single and double, any mod set to a value incompatible\n  // with the new mode will be reset to its default value\n  useEffect(() => {\n    if (mode === \"double\" && ![\"off\", \"mirror\"].includes(mods.turn)) {\n      updateMods({ turn: \"off\" });\n    }\n  }, [mode]);\n\n  const getEffectiveScrollSpeed = () => {\n    if (!song) return null;\n\n    let displayBpm;\n    if (mods.speed === \"cmod\") {\n      if (mods.cmod < 100 || mods.cmod > 1000) {\n        displayBpm = DEFAULT_CMOD;\n      } else displayBpm = mods.cmod;\n      return <strong>{displayBpm}</strong>;\n    }\n\n    displayBpm = song.displayBpm;\n    if (displayBpm.includes(\",\")) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(difficulty);\n      if (mode === \"double\") difficultyIdx += 4;\n      displayBpm = displayBpm.split(\",\")[difficultyIdx];\n    }\n\n    const [lowBpm, highBpm] = displayBpm.split(\"-\");\n    if (!highBpm) {\n      return <strong>{Math.round(lowBpm * mods.speed)}</strong>;\n    } else {\n      return (\n        <strong>{`${Math.round(lowBpm * mods.speed)} - ${Math.round(\n          highBpm * mods.speed\n        )}`}</strong>\n      );\n    }\n  };\n\n  const resetCmodIfInvalid = (e) => {\n    const fieldValue = e.target.value;\n    if (\n      !fieldValue ||\n      parseInt(fieldValue) < 100 ||\n      parseInt(fieldValue) > 1000\n    ) {\n      updateMods({ cmod: DEFAULT_CMOD });\n    }\n  };\n\n  return (\n    <div\n      className={`view-section modsView ${\n        props.activeView === \"mods\" ? \"active\" : \"\"\n      }`}\n    >\n      <div className=\"view-wrapper\">\n        <form className=\"modsForm\">\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">\n              Speed\n              {song && (\n                <span className=\"form-sublabel\">\n                  (Effective scroll speed:{\" \"}\n                  <strong>{getEffectiveScrollSpeed()}</strong>)\n                </span>\n              )}\n            </h4>\n            {options.mods.speed.map((speed) => {\n              return (\n                <Radio\n                  key={`speed_${speed}`}\n                  label={`${speed}x`}\n                  name=\"speed\"\n                  value={speed}\n                  checked={mods.speed === speed}\n                  onChange={() => updateMods({ speed })}\n                />\n              );\n            })}\n            <div>\n              <Radio\n                key=\"speed_cmod\"\n                label=\"Cmod\"\n                name=\"speed\"\n                value=\"cmod\"\n                checked={mods.speed === \"cmod\"}\n                onChange={() => updateMods({ speed: \"cmod\" })}\n              />\n              <Input\n                type=\"number\"\n                disabled={mods.speed !== \"cmod\"}\n                min={100}\n                max={1000}\n                name=\"cmod\"\n                value={mods.cmod}\n                onChange={(_, data) => updateMods({ cmod: data.value })}\n                onBlur={resetCmodIfInvalid}\n              />\n            </div>\n            <small>(Valid range: 100-1000; default: {DEFAULT_CMOD})</small>\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Appearance</h4>\n            {options.mods.appearance.map((appearance, i) => {\n              return (\n                <Radio\n                  key={`appearance_${appearance}`}\n                  label={\n                    [\n                      \"Visible\",\n                      \"Hidden+\",\n                      \"Sudden+\",\n                      \"Hidden+ / Sudden+\",\n                      \"Stealth\",\n                    ][i]\n                  }\n                  name=\"appearance\"\n                  value={appearance}\n                  checked={mods.appearance === appearance}\n                  onChange={() => updateMods({ appearance })}\n                />\n              );\n            })}\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Arrow color</h4>\n            {options.mods.noteskin.map((noteskin) => {\n              return (\n                <Radio\n                  key={`noteskin_${noteskin}`}\n                  label={capitalize(noteskin)}\n                  name=\"noteskin\"\n                  value={noteskin}\n                  checked={mods.noteskin === noteskin}\n                  onChange={() => updateMods({ noteskin })}\n                />\n              );\n            })}\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Turn</h4>\n            {options.mods.turn\n              .filter((turn) => {\n                if (mode === \"double\")\n                  return turn === \"off\" || turn === \"mirror\";\n                return true;\n              })\n              .map((turn) => {\n                return (\n                  <Radio\n                    key={`turn_${turn}`}\n                    label={capitalize(turn)}\n                    name=\"turn\"\n                    value={turn}\n                    checked={mods.turn === turn}\n                    onChange={() => updateMods({ turn })}\n                  />\n                );\n              })}\n          </div>\n          {mods.turn === \"shuffle\" && (\n            <div className=\"form-field\">\n              <h4 className=\"form-label\">\n                Shuffle pattern\n                <span className=\"form-sublabel\">\n                  (compare to original LDUR)\n                </span>\n              </h4>\n              {options.mods.shuffle.map((shuffle, i) => {\n                return (\n                  <Radio\n                    key={`shuffle_${shuffle}`}\n                    label={\n                      [\n                        \"LRDU\",\n                        \"UDRL\",\n                        \"LRUD\",\n                        \"DURL\",\n                        \"DLUR\",\n                        \"DULR\",\n                        \"RLUD\",\n                        \"RULD\",\n                      ][i]\n                    }\n                    name=\"shuffle\"\n                    value={shuffle}\n                    checked={mods.shuffle === shuffle}\n                    onChange={() => updateMods({ shuffle })}\n                  />\n                );\n              })}\n            </div>\n          )}\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Step zone</h4>\n            {options.mods.stepZone.map((stepZone) => {\n              return (\n                <Radio\n                  key={`stepZone_${stepZone}`}\n                  label={capitalize(stepZone)}\n                  name=\"stepZone\"\n                  value={stepZone}\n                  checked={mods.stepZone === stepZone}\n                  onChange={() => updateMods({ stepZone })}\n                />\n              );\n            })}\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Scroll</h4>\n            {options.mods.scroll.map((scroll) => {\n              return (\n                <Radio\n                  key={`scroll_${scroll}`}\n                  label={capitalize(scroll)}\n                  name=\"scroll\"\n                  value={scroll}\n                  checked={mods.scroll === scroll}\n                  onChange={() => updateMods({ scroll })}\n                />\n              );\n            })}\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Combo display</h4>\n            {options.mods.comboDisplay.map((comboDisplay, i) => {\n              return (\n                <Radio\n                  key={`comboDisplay_${comboDisplay}`}\n                  label={[\"Behind arrows\", \"In front of arrows\", \"Hidden\"][i]}\n                  name=\"comboDisplay\"\n                  value={comboDisplay}\n                  checked={mods.comboDisplay === comboDisplay}\n                  onChange={() => updateMods({ comboDisplay })}\n                />\n              );\n            })}\n          </div>\n\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Combo font</h4>\n            {options.mods.comboFont.map((comboFont) => {\n              return (\n                <Radio\n                  key={`comboFont_${comboFont}`}\n                  label={comboFont}\n                  name=\"comboFont\"\n                  value={comboFont}\n                  checked={mods.comboFont === comboFont}\n                  onChange={() => updateMods({ comboFont })}\n                />\n              );\n            })}\n          </div>\n\n          <h4>Miscellaneous</h4>\n          <div className=\"form-field\">\n            <Checkbox\n              toggle\n              label=\"Guidelines\"\n              name=\"guidelines\"\n              checked={mods.guidelines}\n              onChange={() => updateMods({ guidelines: !mods.guidelines })}\n            />\n          </div>\n          <div className=\"form-field\">\n            <Checkbox\n              toggle\n              label=\"Color freeze heads\"\n              name=\"colorFreezes\"\n              checked={mods.colorFreezes}\n              onChange={() => updateMods({ colorFreezes: !mods.colorFreezes })}\n            />\n          </div>\n          <div className=\"form-field\">\n            <Checkbox\n              toggle\n              label=\"Scrolling BPM/stop values\"\n              name=\"bpmStopDisplay\"\n              checked={mods.bpmStopDisplay}\n              onChange={() =>\n                updateMods({ bpmStopDisplay: !mods.bpmStopDisplay })\n              }\n            />\n          </div>\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Global offset</h4>\n            <Input\n              type=\"range\"\n              name=\"globalOffset\"\n              min=\"-0.20\"\n              max=\"0.20\"\n              step=\"0.01\"\n              value={mods.globalOffset}\n              onChange={(_, data) =>\n                updateMods({ globalOffset: parseFloat(data.value) })\n              }\n            />\n            <span>{mods.globalOffset}</span>\n          </div>\n        </form>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect, screen } = state;\n  return {\n    mods,\n    mode: songSelect.mode,\n    song: songSelect.song,\n    difficulty: songSelect.difficulty,\n    activeView: screen.activeView,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    updateMods: (mods) => dispatch(updateMods(mods)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ModsForm);\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"style\", null, \"\\n\\t\\ttspan { white-space:pre }\\n\\t\\t.shp0 { fill: #020202 } \\n\\t\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Path 0\",\n  className: \"shp0\",\n  d: \"M16.49 17L1.5 32C30.16 60.67 31.81 62.01 35 61.99C37.45 61.97 39.33 61.14 41.27 59.23C43.27 57.26 44.03 55.53 44.01 53C43.98 50.32 43.09 48.61 40.24 45.73L36.5 41.97L54.5 42.03C60.51 35.97 61.98 33.52 62 32C62.02 30.41 60.66 28.14 58.27 25.76L54.5 22.03L36.5 22.03C43.09 15.39 43.98 13.68 44.01 11C44.03 8.47 43.27 6.74 41.27 4.77C39.32 2.85 37.45 2.03 34.99 2.02C31.78 2 30.15 3.32 16.49 17ZM89.49 5.79L85.58 9.58L86.03 27.5C79.22 20.74 77.75 20.03 74.61 20.01C71.58 20 70.19 20.61 68.37 22.75C66.91 24.47 66.03 26.81 66.01 29C65.99 32.19 67.33 33.84 81 47.5L96 62.5C124.67 33.84 126.01 32.19 125.99 29C125.97 26.55 125.14 24.67 123.23 22.73C121.43 20.9 119.47 19.96 117.49 19.98C115.46 19.99 113.1 21.22 110.23 23.75L105.97 27.5L106.03 9.5C99.91 3.43 97.54 2.02 95.95 2.01C94.34 2.01 91.96 3.4 89.49 5.79ZM144.5 16.76C130.41 30.65 129.54 31.73 129.78 35.01C129.94 37.22 131.03 39.51 132.77 41.27C134.74 43.27 136.47 44.03 139 44.01C141.68 43.98 143.39 43.09 146.27 40.24L150.03 36.5L149.97 54.5C156.03 60.51 158.48 61.98 160 62C161.59 62.02 163.86 60.66 166.24 58.27L169.97 54.5L169.97 36.5C176.61 43.09 178.32 43.98 181 44.01C183.53 44.03 185.26 43.27 187.23 41.27C189.14 39.33 189.97 37.45 189.99 35C190.01 31.81 188.68 30.18 175.25 16.75C167.14 8.64 160.27 2.01 159.99 2C159.71 2 152.74 8.64 144.5 16.76ZM214.48 4.8C212.27 6.96 211.65 8.41 211.81 11.05C211.97 13.52 213.09 15.57 215.76 18.27L219.5 22.03L200.89 22C195.51 27.88 194.02 30.58 194 32C193.98 33.59 195.34 35.86 197.73 38.24L201.5 41.97L219.5 41.97C212.91 48.61 212.02 50.32 211.99 53C211.97 55.53 212.73 57.26 214.73 59.23C216.67 61.14 218.55 61.97 221 61.99C224.19 62.01 225.84 60.67 239.5 47L254.5 32C225.76 3.26 224.2 1.99 220.93 2C218.38 2 216.55 2.8 214.48 4.8Z\"\n});\n\nvar SvgArrows = function SvgArrows(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 256 80\",\n    width: 256,\n    height: 80,\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgArrows, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/arrows.48a2d361.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M544.033302 516.000776V96.000564c0-17.672051-14.478655-31.998984-32.150706-31.998984s-32.150706 14.326933-32.150707 31.998984v420.061624c-54.909072 14.251072-95.809105 64.333925-95.809105 123.935554 0 59.691941 40.82056 109.836206 96.090876 124.000579a32.298816 32.298816 0 0 0-0.281771 4.006195v159.99492c0 17.672051 14.478655 31.998984 32.150707 31.998984s32.150706-14.326933 32.150706-31.998984V768.004516a32.280754 32.280754 0 0 0-0.317894-3.941171c55.389526-14.088512 96.397933-64.301413 96.397932-124.058378 0.010837-59.691941-40.809723-109.832593-96.080038-124.004191z m13.221527 169.249989a64.00158 64.00158 0 1 1 18.744945-45.256635 63.578925 63.578925 0 0 1-18.744945 45.260247zM223.678606 196.003711a32.287979 32.287979 0 0 0 0.292607-4.002582V96.000564a31.970084 31.970084 0 1 0-63.940169 0V192.001129a32.371065 32.371065 0 0 0 0.180622 4.060381c-55.270316 14.160761-96.173962 64.301413-96.173961 124.000579s40.910871 109.818143 96.181186 123.996966a32.360228 32.360228 0 0 0-0.184234 3.937558V927.999436a31.970084 31.970084 0 1 0 63.940169 0V448.000226a32.287979 32.287979 0 0 0-0.278158-3.883372c55.385914-14.088512 96.350971-64.301413 96.350971-124.054765S279.071744 210.084998 223.678606 196.003711z m13.575545 169.315013A64.00158 64.00158 0 1 1 255.999097 320.062089a63.578925 63.578925 0 0 1-18.744946 45.256635zM959.99842 320.062089c0-59.775027-41.048144-109.977091-96.45212-124.058378a32.360228 32.360228 0 0 0 0.173397-4.002582V96.000564a31.970084 31.970084 0 1 0-63.940169 0V192.001129a32.291592 32.291592 0 0 0 0.299833 4.060381c-55.270316 14.160761-96.116162 64.301413-96.116163 124.000579s40.82056 109.836206 96.090876 124.000578a32.298816 32.298816 0 0 0-0.281771 3.99897V927.999436a31.970084 31.970084 0 1 0 63.940169 0V448.061637a32.381903 32.381903 0 0 0-0.166172-3.941171c55.407588-14.084899 96.452119-64.286963 96.45212-124.058377z m-82.746526 45.253022a63.997968 63.997968 0 1 1 18.748558-45.253022 63.578925 63.578925 0 0 1-18.748558 45.253022z\",\n  fill: \"\"\n});\n\nvar SvgMods = function SvgMods(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    className: \"icon\",\n    style: {\n      width: \"1em\",\n      height: \"1em\",\n      verticalAlign: \"middle\",\n      fill: \"currentColor\",\n      overflow: \"hidden\"\n    },\n    viewBox: \"0 0 1024 1024\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgMods, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/mods.d3d6577c.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"style\", null, \"\\n\\t\\ttspan { white-space:pre }\\n\\t\\t.shp0 { fill: #323638 } \\n\\t\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  id: \"Layer\"\n}, React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M92.28 85.53L84 93.71C83.8 93.9 83.55 94 83.29 94C83.04 94 82.78 93.9 82.59 93.71L65.27 76.56C64.03 75.31 64.05 73.3 65.29 72.07L70.7 66.74C71.9 65.55 73.99 65.56 75.18 66.77L92.29 84.12C92.68 84.51 92.67 85.14 92.28 85.53ZM90.16 84.81L73.76 68.17C73.53 67.95 73.24 67.82 72.92 67.82C72.61 67.82 72.32 67.94 72.1 68.16L66.7 73.49C66.24 73.95 66.23 74.69 66.69 75.15L83.29 91.59L90.16 84.81Z\"\n}), React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M39.31 77.77C18.42 77.77 1.42 60.77 1.42 39.88C1.42 18.99 18.42 2 39.3 2C60.19 2 77.19 18.99 77.19 39.88C77.19 60.77 60.19 77.77 39.31 77.77ZM75.19 39.88C75.19 20.1 59.09 4 39.3 4C19.52 4 3.42 20.1 3.42 39.88C3.42 59.67 19.52 75.77 39.3 75.77C59.09 75.77 75.19 59.67 75.19 39.88Z\"\n}), React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M57.7 25.39L57.7 54.31C57.7 58.64 54.17 62.17 49.83 62.17C45.5 62.17 41.97 58.64 41.97 54.31C41.97 49.97 45.5 46.44 49.83 46.44C52.17 46.44 54.26 47.47 55.7 49.08L55.7 25.39C55.7 25.01 55.46 24.67 55.09 24.55L34.1 17.21C33.85 17.13 33.57 17.17 33.34 17.34C33.11 17.51 32.98 17.77 32.98 18.05L32.98 48.81C32.98 53.15 29.46 56.68 25.12 56.68C20.78 56.68 17.25 53.15 17.25 48.81C17.25 44.47 20.78 40.95 25.12 40.95C27.45 40.95 29.54 41.97 30.98 43.59L30.98 18.05C30.98 17.12 31.41 16.27 32.17 15.72C32.92 15.18 33.85 15.03 34.74 15.31L55.73 22.66C56.9 23.03 57.7 24.13 57.7 25.39ZM30.98 48.81C30.98 45.58 28.35 42.95 25.12 42.95C21.88 42.95 19.25 45.58 19.25 48.81C19.25 52.05 21.88 54.68 25.12 54.68C28.35 54.68 30.98 52.05 30.98 48.81ZM55.7 54.31C55.7 51.07 53.07 48.44 49.83 48.44C46.6 48.44 43.97 51.07 43.97 54.31C43.97 57.54 46.6 60.17 49.83 60.17C53.07 60.17 55.7 57.54 55.7 54.31Z\"\n}));\n\nvar SvgMusicSearch = function SvgMusicSearch(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 94 96\",\n    width: 94,\n    height: 96,\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgMusicSearch, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/music_search.ab83855e.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\nimport { Icon } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { stopPreviewAudio } from \"../../actions/AudioActions\";\nimport { setActiveView } from \"../../actions/ScreenActions\";\nimport { ReactComponent as ChartIcon } from \"../../svg/arrows.svg\";\nimport { ReactComponent as ModsIcon } from \"../../svg/mods.svg\";\nimport { ReactComponent as SongIcon } from \"../../svg/music_search.svg\";\nimport { DEBUG_MODE } from \"../../constants\";\n\nconst Navbar = (props) => {\n  const { activeView, chartAudio } = props;\n\n  const navItems = [\n    { view: \"song\", icon: \"music\", svgIcon: SongIcon, text: \"Song\" },\n    { view: \"mods\", icon: \"sidebar\", svgIcon: ModsIcon, text: \"Mods\" },\n    { view: \"chart\", svgIcon: ChartIcon, text: \"Chart\" },\n    { view: DEBUG_MODE ? \"logView1\" : \"\", icon: \"\", text: \"\" },\n    { view: \"3\", icon: \"\", text: \"\" },\n  ];\n\n  const changeActiveView = (view) => {\n    if (chartAudio.status === \"playing\") return;\n    AudioPlayer.stopSongPreview();\n    props.setActiveView(view);\n  };\n\n  const isDisabled = (view) => {\n    if (view !== \"chart\" && chartAudio.status === \"playing\") return true;\n    return false;\n  };\n\n  return (\n    <nav className=\"navbar\">\n      {navItems.map((navItem, i) => {\n        const { view, icon, text } = navItem;\n        const SVGIcon = navItem.svgIcon;\n        if (!view)\n          return <div key={`navbarItem_${i}`} className=\"navbar_item\" />;\n        return (\n          <div\n            key={`navbarItem_${i}`}\n            className={`navbar_item ${activeView === view ? \"active\" : \"\"} ${\n              isDisabled(view) ? \"disabled\" : \"\"\n            }`}\n            onClick={() => changeActiveView(view)}\n          >\n            {SVGIcon ? (\n              <SVGIcon className={`svg-icon ${view}`} />\n            ) : (\n              <Icon name={icon} />\n            )}\n            <span className=\"description\">{text}</span>\n          </div>\n        );\n      })}\n    </nav>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, screen } = state;\n  const { chartAudio } = audio;\n  return {\n    chartAudio,\n    activeView: screen.activeView,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    stopPreviewAudio: () => dispatch(stopPreviewAudio()),\n    setActiveView: (view) => dispatch(setActiveView(view)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Navbar);\n","import React, { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { tsv } from \"d3-fetch\";\n\nimport ChartArea from \"../../components/chart/ChartArea\";\nimport SongForm from \"../../components/form/SongForm\";\nimport ModsForm from \"../../components/form/ModsForm\";\nimport Navbar from \"../../components/navigation/Navbar\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { getOriginPath, fetchDocument } from \"../../utils\";\nimport {\n  selectSong,\n  selectDifficulty,\n  selectMode,\n} from \"../../actions/SongSelectActions\";\nimport { resizeScreen } from \"../../actions/ScreenActions\";\nimport loadStore from \"../../utils/loadStore\";\nimport { DEBUG_MODE } from \"../../constants\";\nimport LogView from \"../../components/debug/LogView\";\n\nconst MainContainer = (props) => {\n  const [loadingSimfiles, setLoadingSimfiles] = useState(true);\n  const [simfileList, setSimfileList] = useState([]);\n  const [selectedSM, setSelectedSM] = useState(null);\n\n  const [gameEngine, setGameEngine] = useState(null);\n\n  const [loadingAudio, setLoadingAudio] = useState(false);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchSimfiles();\n      setLoadingSimfiles(false);\n    };\n    fetchData();\n\n    AudioPlayer.setLoadingAudio = setLoadingAudio;\n\n    window.addEventListener(\"resize\", props.resizeScreen);\n  }, []);\n\n  const fetchSimfiles = async () => {\n    try {\n      const parsedTsv = await tsv(getOriginPath() + \"data/simfiles.tsv\");\n      parsedTsv.forEach((row) => {\n        row.levels = row.levels\n          .split(\",\")\n          .map((level) => (level ? parseInt(level) : null));\n      });\n\n      // console.log(\"simfiles\", parsedTsv);\n      setSimfileList(parsedTsv);\n    } catch (error) {\n      console.error(error);\n      return null;\n    }\n  };\n\n  const onSongSelect = async (song, initialProgress = 0) => {\n    // console.log(\"MainContainer selected song\", song);\n    AudioPlayer.selectSong(song, initialProgress);\n    // setSelectedSong(song);\n\n    props.selectSong(song);\n\n    document.title = `${song.title} - SMViewer`;\n\n    // retrieve audio file and simfile from song.simfilePath\n\n    let smName = song.smName;\n\n    // special case for tohoku evolved: pick one of its types at random\n    if (song.hash === \"OddDoQ6dqi0QdQDDOO6qlO08d8bPbli1\") {\n      smName = smName.replace(\"1\", Math.floor(Math.random() * 4) + 1);\n    }\n\n    try {\n      // Immediately update the value of \"last requested song\"\n      // Any pending requests that finish before the last song is loaded will be ignored\n      loadStore.lastRequestedSong = song.title;\n      const sm = await fetchDocument(\n        `${getOriginPath()}simfiles/${encodeURIComponent(smName)}.${\n          song.useSsc ? \"ssc\" : \"sm\"\n        }`\n      );\n\n      // User might try to select a new song before the simfile is fetched.\n      // Only process simfile if this is the last song that was selected\n      if (loadStore.lastRequestedSong === song.title) {\n        setSelectedSM(sm);\n      }\n    } catch (err) {\n      alert(`Song ${song.title} failed to load`, err);\n    }\n  };\n\n  const onDifficultySelect = (difficulty) => {\n    // setSelectedDifficulty(difficulty);\n    props.selectDifficulty(difficulty);\n  };\n  const onModeSelect = (mode) => {\n    props.selectMode(mode);\n  };\n\n  return (\n    <div className=\"main-container\">\n      {!loadingSimfiles && (\n        <>\n          <Navbar />\n          <div className=\"view-container\">\n            <ChartArea\n              loadingAudio={loadingAudio}\n              sm={selectedSM}\n              gameEngine={gameEngine}\n              setGameEngine={setGameEngine}\n            />\n            <ModsForm />\n            <SongForm\n              simfileList={simfileList}\n              onSongSelect={onSongSelect}\n              onDifficultySelect={onDifficultySelect}\n              onModeSelect={onModeSelect}\n              loadingAudio={loadingAudio}\n              location={props.location}\n            />\n            {DEBUG_MODE && <LogView />}\n          </div>\n        </>\n      )}\n      {DEBUG_MODE && (\n        <div id=\"debugLog\">\n          <div className=\"debug-text1\" />\n          <div className=\"debug-text2\" />\n          <div className=\"debug-text3\" />\n          <div className=\"debug-text4\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {};\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(selectSong(song)),\n    selectDifficulty: (song) => dispatch(selectDifficulty(song)),\n    selectMode: (song) => dispatch(selectMode(song)),\n    resizeScreen: (e) => dispatch(resizeScreen(e)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MainContainer);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nconst LogView = (props) => {\n  return (\n    <div\n      className={`view-section logView1\n    ${props.activeView === \"logView1\" ? \"active\" : \"\"}`}\n    >\n      <div className=\"view-wrapper\">\n        <pre id=\"logView1\">test debug log</pre>\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { screen } = state;\n  return {\n    activeView: screen.activeView,\n  };\n};\n\nexport default connect(mapStateToProps, null)(LogView);\n","import React from \"react\";\nimport { Route, Switch, withRouter } from \"react-router-dom\";\n\nimport MainContainer from \"./containers/main/MainContainer\";\n\nfunction App() {\n  return (\n    <div className=\"app-container\">\n      <Switch>\n        <Route exact path=\"/\" component={MainContainer} />\n      </Switch>\n    </div>\n  );\n}\n\nexport default withRouter(App);\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport { Provider } from \"react-redux\";\nimport \"semantic-ui-css/semantic.min.css\";\n\nimport \"./styles.scss\";\nimport App from \"./App\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <BrowserRouter basename={process.env.PUBLIC_URL}>\n      <App />\n    </BrowserRouter>\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}