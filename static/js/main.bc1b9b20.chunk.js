(this.webpackJsonpsmviewer=this.webpackJsonpsmviewer||[]).push([[0],{236:function(e,t,n){e.exports=n(411)},247:function(e,t,n){},250:function(e,t,n){},411:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(36),o=n.n(i),s=n(27),c=(n(246),n(247),n(25)),l=n.n(c),u=n(47),f=n(16),d=n(225),h=n(54),p=n(413),m=(n(249),n(250),function(){return window.location.search?window.location.href.slice(0,window.location.href.indexOf(window.location.search)):window.location.href}),v=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:return n=e.sent,r=n.body.getReader(),a=new TextDecoder("utf-8"),e.next=7,r.read();case 7:return i=e.sent,e.abrupt("return",a.decode(i.value));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(e){return m()+"assets/"+e},b=function(e){return m()+"jackets/"+e},y=function(e){return e.slice(0,1).toUpperCase()+e.slice(1)},O=function(){if(!window.location.search)return{};var e={};try{return window.location.search.slice(1).split("&").forEach((function(t){var n=t.split("="),r=Object(f.a)(n,2),a=r[0],i=r[1];e[a]=i})),e}catch(t){return console.log("error parsing url params",t),{}}}(),w=["left","down","up","right"],E=["Beginner","Basic","Difficult","Expert","Challenge"],P=["Basic","Difficult","Expert","Challenge"],k=n(64),S=n(20),j=n(23),_=n(24),D=n(32),A={};w.forEach((function(e){A["rainbow_".concat(e)]=new Image,A["rainbow_".concat(e)].src=g("rainbow_".concat(e,".png")),A["note_".concat(e)]=new Image,A["note_".concat(e)].src=g("note_".concat(e,".png")),A["vivid_".concat(e)]=new Image,A["vivid_".concat(e)].src=g("vivid_".concat(e,".png")),A["flat_".concat(e)]=new Image,A["flat_".concat(e)].src=g("vivid_".concat(e,".png")),A["freeze_tail_active_".concat(e)]=new Image,A["freeze_tail_active_".concat(e)].src=g("freeze_tail_active_".concat(e,".png")),A["freeze_tail_inactive_".concat(e)]=new Image,A["freeze_tail_inactive_".concat(e)].src=g("freeze_tail_inactive_".concat(e,".png")),A["freeze_body_active_".concat(e)]=new Image,A["freeze_body_active_".concat(e)].src=g("freeze_body_active_".concat(e,".png")),A["freeze_body_inactive_".concat(e)]=new Image,A["freeze_body_inactive_".concat(e)].src=g("freeze_body_inactive_".concat(e,".png")),A["shock_".concat(e)]=new Image,A["shock_".concat(e)].src=g("shock_".concat(e,".png"))}));["freeze_head","tap_explosion"].forEach((function(e){A[e]=new Image,A[e].src=g("".concat(e,".png"))}));var C=function(){function e(t){Object(j.a)(this,e);var n=t.key,r=t.mods,a=r.speed,i=r.noteskin,o=r.colorFreezes;this.key=n,this.speed=a,this.note=t.note,this.noteskin=i,this.measureIdx=t.measureIdx,this.measureN=t.measureN,this.measureD=t.measureD,this.colorFreezes=o,this.originalBeatPosition=t.originalBeatPosition,this.holdBeats=t.holdBeats||null,this.hitFrame=0,this.previousBeatPosition=null}return Object(_.a)(e,[{key:"reset",value:function(){this.hitFrame=0}},{key:"currentBeatPosition",value:function(e){return this.originalBeatPosition-e}},{key:"renderFreezeBody",value:function(e,t,n){var r,a,i,o,s=e.getContext("2d"),c=e.height,l=w[n%4];if("3"===this.note[n]){r=A["freeze_tail_inactive_".concat(l)],0,a=0,i=64*n,o=64*this.currentBeatPosition(t)*this.speed;var u=A["freeze_body_inactive_".concat(l)],f=64*this.holdBeats[n]*this.speed-32,d=Math.floor(f/128),h=f%128,p=h,m=o-(f+32),v=!1;m<=0&&(h+=m,m=0,r=A["freeze_tail_active_".concat(l)],u=A["freeze_body_active_".concat(l)],o>=0&&(v=!0)),m>-h&&m<c&&s.drawImage(u,0,128-h,64,h,i,m+32,64,h);for(var g=1;g<=d;g++){var b=128,y=0,O=o-(f+32-p-128*(g-1));O<0&&O>-128&&(b+=O,y-=O,O=0),O>-b&&O<c&&s.drawImage(u,0,y,64,b,i,O+32,64,b)}var E=64,P=o;if(64*this.holdBeats[n]*this.speed<32){var k=64*this.holdBeats[n]*this.speed;a+=32-k,o+=32-k,E=k+32}if(o<32&&o>0&&(a+=32-o,o=32),P>0&&P<c&&s.drawImage(r,0,a,64,E,i,o,64,E),v){var S=A.freeze_head;this.hitFrame<=12&&s.drawImage(S,64*w.indexOf(l),128,64,64,64*n,0,64,64)}P<=0?this.hitFrame<=12&&(s.save(),s.globalAlpha=1-Math.pow(this.hitFrame/12,3),s.drawImage(A.tap_explosion,0,0,64,64,i-this.hitFrame,0-this.hitFrame,64+2*this.hitFrame,64+2*this.hitFrame),s.restore(),this.hitFrame++):this.hitFrame=0}this.previousBeatPosition=this.currentBeatPosition(t)}},{key:"renderArrow",value:function(e,t,n){var r=e.getContext("2d"),a=e.height;if("0"!==this.note[n]){var i,o,s,c,l,u=w[n%4];if("1"===this.note[n]||"2"===this.note[n]&&this.colorFreezes){if(i=A["".concat(this.noteskin,"_").concat(u)],this.note.includes("2")&&!this.colorFreezes)i=A.freeze_head,o=64*w.indexOf(u),s=0;else if("rainbow"===this.noteskin){o=Math.floor(4*t)%8*64;var f=this.measureD/4,d=this.measureN%f;0===d?s=0:0<d&&d<=f/4?s=1:f/4<d&&d<=f/2?s=2:f/2<d&&d<=3*f/4?s=3:3*f/4<d&&d<f&&(s=0),s*=64}else if("note"===this.noteskin){o=Math.floor(4*t)%8*64;var h=this.measureN/this.measureD;s=[0,.25,.5,.75].includes(h)?0:[1/8,3/8,5/8,7/8].includes(h)?1:[1/16,3/16,5/16,7/16,9/16,.6875,.8125,.9375].includes(h)?3:2,s*=64}else if("vivid"===this.noteskin){o=Math.floor(4*t)%4*64;var p=this.measureD/4,m=this.measureN%p;0===m?s=0:0<m&&m<=p/4?s=1:p/4<m&&m<=p/2?s=2:p/2<m&&m<=3*p/4?s=3:3*p/4<m&&m<p&&(s=0),s=(s+Math.floor(t)%4)%4*64}else"flat"===this.noteskin&&(i=A["vivid_".concat(u)],o=Math.floor(4*t)%4*64,s=Math.floor(t)%4*64);c=64*n,(l=64*this.currentBeatPosition(t)*this.speed)>0&&l<a&&r.drawImage(i,o,s,64,64,c,l,64,64),l<=0?this.hitFrame<=12&&(r.save(),r.globalAlpha=1-Math.pow(this.hitFrame/12,3),r.drawImage(A.tap_explosion,0,0,64,64,c-2-this.hitFrame,-2-this.hitFrame,68+2*this.hitFrame,68+2*this.hitFrame),r.restore(),this.hitFrame++):this.hitFrame=0}else"2"===this.note[n]&&(i=A.freeze_head,o=64*w.indexOf(u),s=0,c=64*n,(l=64*this.currentBeatPosition(t)*this.speed)>0&&l<a&&r.drawImage(i,o,s,64,64,c,l,64,64),l<=0?this.hitFrame<=12&&(r.save(),r.globalAlpha=1-Math.pow(this.hitFrame/12,3),r.drawImage(A.tap_explosion,0,0,64,64,c-this.hitFrame,0-this.hitFrame,64+2*this.hitFrame,64+2*this.hitFrame),r.restore(),this.hitFrame++):this.hitFrame=0);this.previousBeatPosition=this.currentBeatPosition(t)}}}]),e}(),L={};w.forEach((function(e){L["shock_".concat(e)]=new Image,L["shock_".concat(e)].src=g("shock_".concat(e,".png"))}));var N=function(){function e(t){Object(j.a)(this,e);var n=t.key,r=t.mods,a=r.speed,i=r.noteskin;this.key=n,this.speed=a,this.note=t.note,this.noteskin=i,this.originalBeatPosition=t.originalBeatPosition}return Object(_.a)(e,[{key:"currentBeatPosition",value:function(e){return this.originalBeatPosition-e}},{key:"render",value:function(e,t,n){var r=e.getContext("2d"),a=e.height;t=Math.floor(t/3)%8;for(var i=0;i<this.note.length;i++)if("M"===this.note[i]){var o=w[i%4],s=L["shock_".concat(o)],c=t%4*64,l=64*Math.floor(t/4),u=64*i,f=64*this.currentBeatPosition(n)*this.speed;f>-64&&f<a&&r.drawImage(s,c,l,64,64,u,f,64,64)}}}]),e}(),T={};w.forEach((function(e){T[e]=new Image,T[e].src=g("".concat(e,"_tap_flash.png")),T[e]=new Image,T[e].src=g("".concat(e,"_tap_flash.png"))}));var x={};w.forEach((function(e){x[e]=new Image,x[e].src=g("".concat(e,"_tap_receptor.png")),x[e]=new Image,x[e].src=g("".concat(e,"_tap_receptor.png"))}));var B=function(){function e(){Object(j.a)(this,e)}return Object(_.a)(e,[{key:"render",value:function(e,t,n){var r=e.getContext("2d"),a=t%1>0&&t%1<.25;w.forEach((function(e,t){r.drawImage(a?T[e]:x[e],0,0,64,64,64*t,0,64,64),"double"===n&&r.drawImage(a?T[e]:x[e],0,0,64,64,64*(t+4),0,64,64)}))}}]),e}(),I=function(){function e(t){Object(j.a)(this,e);var n=t.mods,r=n.speed,a=n.guidelines;this.speed=r,this.finalBeat=t.finalBeat,this.showGuidelines=a}return Object(_.a)(e,[{key:"render",value:function(e,t){if(this.showGuidelines)for(var n=e.getContext("2d"),r=e.height,a=0;a<=this.finalBeat;a++){var i=64*(a-t)*this.speed+32,o=a%4===0?2:.8;i>0&&i<r&&(n.beginPath(),n.moveTo(0,i),n.lineTo(e.width,i),n.lineWidth=o,n.strokeStyle="#fff",n.stroke())}}}]),e}(),R=/dance-([a-z]+)/,F=/(Beginner|Easy|Medium|Hard|Challenge|Edit)/,M={Beginner:"Beginner",Easy:"Basic",Medium:"Difficult",Hard:"Expert",Challenge:"Challenge"},V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sm",n={},r=e.slice(0,e.indexOf("ssc"===t?"#NOTEDATA:":"#NOTES:")),a=[],i=[];return/#BPMS:/i.test(r)&&(a=/#BPMS:([\s\S]*?)\s*;/i.exec(r)[1]).length&&(a=a.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),r=n[0],a=n[1];return{beat:parseFloat(r),value:parseFloat(a)}}))),/#STOPS:/i.test(r)&&(i=/#STOPS:([\s\S]*?)\s*;/i.exec(r)[1]).length&&(i=i.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),r=n[0],a=n[1];return{beat:parseFloat(r),value:parseFloat(a)}}))),("ssc"===t?e.slice(e.indexOf("#NOTEDATA:")).split(/#NOTEDATA:\s*;/).slice(1):e.slice(e.indexOf("#NOTES:")).split(/#NOTES:\s+/).slice(1)).forEach((function(e){var r=R.exec(e)[1],o=F.exec(e)[1],s=M[o];n["".concat(r,"_").concat(s)]={difficulty:s,mode:r,bpms:a,stops:i};var c,l=n["".concat(r,"_").concat(s)];if("ssc"===t)c=/#METER:([0-9]+);/.exec(e)[1];else{var u=new RegExp("".concat(o,":\\s+([0-9]+):"));c=parseInt(u.exec(e)[1])}l.level=c,"ssc"===t&&(/#BPMS:/i.test(e)&&(a=/#BPMS:([\s\S]*?)\s*;/i.exec(e)[1]).length&&(a=a.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),r=n[0],a=n[1];return{beat:parseFloat(r),value:parseFloat(a)}})),l.bpms=a),/#STOPS:/i.test(e)&&(i=/#STOPS:([\s\S]*?)\s*;/i.exec(e)[1]).length&&(i=i.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),r=n[0],a=n[1];return{beat:parseFloat(r),value:parseFloat(a)}})),l.stops=i));var d=e.slice(e.lastIndexOf(":")+1,e.lastIndexOf(";")).trim().split(",").map((function(e,t){var n=e.trim().split("\r\n").filter((function(e){return!e.startsWith("//")})),r=n.length,a=[];return n.forEach((function(e,n){if(e.split("").filter((function(e){return"0"!==e})).length){var i={};i.note=e,i.measureIdx=t,i.measureN=n,i.measureD=r,a.push(i)}})),a}));l.chart=d})),n};function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=n(108),q=n(46),G=n(204);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Z={chartAudio:{status:"stopped",progress:0},previewAudio:{status:"stopped"}},Q=function(e){return function(t){t({type:"CHANGE_ACTIVE_BPM_DISPLAY",payload:e})}};function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var K={activeBpm:null,bpmChangeQueue:[],combo:0},$={difficulty:["Beginner","Basic","Difficult","Expert","Challenge"],mode:["single","double"],mods:{speed:[.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.5,5,5.5,6,6.5,7,7.5,8],turn:["off","mirror","left","right","shuffle"],shuffle:[1,2,3,4,5,6,7,8],noteskin:["rainbow","note","vivid","flat"]}},ee={difficulty:"Expert",mode:"single",mods:{speed:3,turn:"off",shuffle:1,noteskin:"note",guidelines:!0,colorFreezes:!1}};if(O.difficulty){var te={b:"Beginner",B:"Basic",D:"Difficult",E:"Expert",C:"Challenge"};Object.keys(te).includes(O.difficulty[0])&&(ee.difficulty=te[O.difficulty[0]]),"S"===O.difficulty[1]?ee.mode="single":"D"===O.difficulty[1]&&(ee.mode="double")}if(O.speed){var ne=parseFloat("".concat(O.speed[0],".").concat(O.speed.slice(1)));$.mods.speed.includes(ne)&&(ee.mods.speed=ne)}if(O.turn){var re=O.turn.toLowerCase();$.mods.turn.includes(re)&&(ee.mods.turn=re)}function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var oe=ee.mods;function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le={innerWidth:window.innerWidth,innerHeight:window.innerHeight},ue=function(e){return function(t){t({type:"SELECT_SONG",payload:e})}};function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he={difficulty:ee.difficulty,mode:ee.mode},pe=Object(q.c)({audio:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAY_CHART_AUDIO":var n=X({},e.chartAudio,{status:"playing"});return X({},e,{chartAudio:n});case"PAUSE_CHART_AUDIO":var r=X({},e.chartAudio,{status:"paused"});return X({},e,{chartAudio:r});case"STOP_CHART_AUDIO":var a=X({},e.chartAudio,{status:"stopped"});return X({},e,{chartAudio:a});case"PLAY_PREVIEW_AUDIO":var i=X({},e.previewAudio,{status:"playing"});return X({},e,{previewAudio:i});case"STOP_PREVIEW_AUDIO":var o=X({},e.previewAudio,{status:"stopped"});return X({},e,{previewAudio:o});case"SET_CHART_PROGRESS":var s=X({},e.chartAudio,{progress:t.payload});return X({},e,{chartAudio:s});default:return e}},chart:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_BPM_CHANGE_QUEUE":return J({},e,{bpmChangeQueue:Object(k.a)(t.payload)});case"CHANGE_ACTIVE_BPM_DISPLAY":var n=t.payload;return J({},e,{activeBpm:n});case"SET_COMBO":return J({},e,{combo:t.payload});default:return e}},mods:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_MODS":var n=t.payload;return ie({},e,{},n);default:return e}},screen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RESIZE_SCREEN":var n=t.payload.target,r=n.innerWidth,a=n.innerHeight,i={innerWidth:r,innerHeight:a};return ce({},e,{},i);default:return e}},songSelect:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SELECT_SONG":var n=t.payload;return de({},e,{song:n});case"SELECT_DIFFICULTY":var r=t.payload;return de({},e,{difficulty:r});case"SELECT_MODE":var a=t.payload;return de({},e,{mode:a});default:return e}}}),me=Object(q.e)(pe,Object(q.d)(Object(q.a)(G.a),window.devToolsExtension?window.__REDUX_DEVTOOLS_EXTENSION__():function(e){return e})),ve=new(function(){function e(){Object(j.a)(this,e),this.mouseDown=!1,this.currentProgress=0,this.presetStart=0,O.progress&&(this.presetStart=O.progress/1e5,this.currentProgress=this.presetStart)}return Object(_.a)(e,[{key:"initCanvas",value:function(){var e=this;this.canvas=document.querySelector("#progress"),this.presetMarker=document.querySelector("#progress + .preset-marker-wrapper"),this.drawBackground(),this.canvas.addEventListener("touchstart",(function(t){t.preventDefault(),e.jumpToProgress(t.touches[0])})),this.canvas.addEventListener("touchmove",(function(t){t.preventDefault(),e.jumpToProgress(t.touches[0])})),this.canvas.addEventListener("mousedown",(function(t){t.preventDefault(),e.jumpToProgress(t),e.mouseDown=!0})),this.canvas.addEventListener("mousemove",(function(t){t.preventDefault(),e.mouseDown&&e.jumpToProgress(t)})),this.canvas.addEventListener("mouseup",(function(t){t.preventDefault(),e.mouseDown=!1})),this.setPresetMarker(),window.addEventListener("resize",(function(t){e.setPresetMarker()}))}},{key:"setPresetMarker",value:function(){if(this.presetStart&&this.presetMarker){var e=this.canvas.offsetWidth;this.presetPosition=e*this.presetStart,this.presetMarker.style.left="".concat(this.presetPosition,"px")}}},{key:"setProgress",value:function(e){this.currentProgress=e}},{key:"getProgress",value:function(){return this.currentProgress}},{key:"jumpToProgress",value:function(e,t){var n;if(t)n=t;else{var r=this.canvas.getBoundingClientRect(),a=r.width;n=(e.clientX-r.x)/a}n<0||n>1||(this.setProgress(n),ge.seekProgress(n))}},{key:"jumpToPresetStart",value:function(e){this.jumpToProgress(e,this.presetStart),e.stopPropagation()}},{key:"drawBackground",value:function(){var e=this.canvas.getContext("2d");e.fillStyle="#d7e2ed",e.fillRect(0,0,this.canvas.width,this.canvas.height)}},{key:"render",value:function(e){if(!isNaN(e)){this.setProgress(e),this.drawBackground();var t=this.canvas.getContext("2d");t.fillStyle="#627c92",t.fillRect(0,0,this.canvas.width*e,this.canvas.height)}}}]),e}()),ge=new(function(){function e(){Object(j.a)(this,e),this.sources={song:{},preview:{},assistTick:{audio:new H.Howl({src:g("sounds/assist_tick.wav")})}},this.currentSong=null,this.currentPreview=null,this.currentSongId=null,this.currentPreviewId=null,this.activeView=null,this.previewFadeTimeout=null,this.updateTimeline=this.updateTimeline.bind(this),this.updateProgress=this.updateProgress.bind(this),this.audioResyncFrames=0}return Object(_.a)(e,[{key:"getCurrentSong",value:function(){return this.sources.song[this.currentSong]}},{key:"getCurrentPreview",value:function(){return this.sources.preview[this.currentPreview]}},{key:"getCurrentTime",value:function(){return this.getCurrentSong().audio.seek()}},{key:"storeAudioSource",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.sources.song[e.hash]||(this.setLoadingAudio(!0),this.sources.song[e.hash]={title:e.title},this.sources.song[e.hash].audio=new H.Howl({src:"https://dl.dropboxusercontent.com/s/".concat(e.dAudioUrl),format:["mp3"],html5:!0,onload:function(){t.setLoadingAudio(!1),t.seekProgress(n)},onloaderror:function(e,t,n){alert("".concat(e,";;; ").concat(t,";;; ").concat(n))},onplay:function(){t.getCurrentSong().tl.play(),t.resync(),D.a.ticker.add(t.updateProgress),t.startAnimationLoop(),me.dispatch((function(e){e({type:"PLAY_CHART_AUDIO"})}))},onpause:function(){t.getCurrentSong().tl.pause(),D.a.ticker.remove(t.updateTimeline),D.a.ticker.remove(t.updateProgress),t.stopAnimationLoop(),me.dispatch((function(e){e({type:"PAUSE_CHART_AUDIO"})}))},onseek:function(){},onstop:function(){t.getCurrentSong().tl&&t.getCurrentSong().tl.restart().pause(),D.a.ticker.remove(t.updateTimeline),D.a.ticker.remove(t.updateProgress),t.stopAnimationLoop(),me.dispatch((function(e){e({type:"STOP_CHART_AUDIO"})}))},onend:function(e){D.a.ticker.remove(t.updateTimeline),t.stopAnimationLoop(),me.dispatch((function(e){e({type:"STOP_CHART_AUDIO"})}))}}),this.sources.preview[e.hash]={title:e.title},this.sources.preview[e.hash].audio=new H.Howl({src:"https://dl.dropboxusercontent.com/s/".concat(e.dAudioUrl),format:["mp3"],html5:!0,sprite:{sample:[parseFloat(1e3*(e.sampleStart-.12)),parseFloat(1e3*e.sampleLength)]},onplay:function(){me.dispatch((function(e){e({type:"PLAY_PREVIEW_AUDIO"})}))},onstop:function(){clearTimeout(t.previewFadeTimeout),t.currentPreviewId=null,me.dispatch((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))},onend:function(){clearTimeout(t.previewFadeTimeout),t.currentPreviewId=null,me.dispatch((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))}}))}},{key:"selectSong",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.currentSong&&this.getCurrentSong().audio.stop(this.currentSongId),this.storeAudioSource(e,t),this.currentSong=e.hash}},{key:"resync",value:function(){this.audioResyncFrames=10,D.a.ticker.add(this.updateTimeline),this.updateProgressOnce()}},{key:"updateTimeline",value:function(){if(this.getCurrentSong().tl.seek(this.getCurrentTime()+.07),this.audioResyncFrames--,this.audioResyncFrames<=0){var e=function(e){for(var t=e.beatTick,n=e.bpmChangeQueue,r=0,a=0;a<n.length;a++){var i=n[a];if(i.beat>t)return r;r=i.value}return r}(this.getCurrentSong().globalParams);me.dispatch(Q(e));var t=function(e){var t=e.audio,n=e.globalParams.arrows;if(!n.length)return 0;for(var r=0;r<n.length;r++){var a=n[r];if(a.timestamp>t.seek()+.07)return a.combo-1}return n[n.length-1].combo}(this.getCurrentSong()),n=document.querySelector("#combo-temp .combo-num");n&&(n.textContent=t),D.a.ticker.remove(this.updateTimeline)}}},{key:"seekTime",value:function(e){this.getCurrentSong().audio.seek(e),this.resync()}},{key:"goBack",value:function(e){this.seekTime(this.getCurrentTime()-.001*e)}},{key:"goForward",value:function(e){this.seekTime(this.getCurrentTime()+.001*e)}},{key:"seekProgress",value:function(e){this.seekTime(e*this.getCurrentSong().audio.duration())}},{key:"updateProgress",value:function(e,t,n){if(n%15===0){var r=this.getCurrentSong().audio,a=r.seek()/r.duration();ve.render(a)}}},{key:"updateProgressOnce",value:function(){this.updateProgress(null,null,0),this.updateAnimationLoopOnce()}},{key:"setTimeline",value:function(e){this.getCurrentSong().tl=e}},{key:"setGlobalParams",value:function(e){this.getCurrentSong().globalParams=e}},{key:"play",value:function(){this.currentSongId=this.getCurrentSong().audio.play()}},{key:"pause",value:function(){this.getCurrentSong().audio.pause(this.currentSongId)}},{key:"stop",value:function(){this.getCurrentSong().audio.stop(this.currentSongId),this.seekTime(0),this.currentSongId=null}},{key:"isPlaying",value:function(){return this.getCurrentSong()&&this.getCurrentSong().audio.playing(this.currentSongId)}},{key:"isPaused",value:function(){return this.getCurrentSong()&&!this.getCurrentSong().audio.playing(this.currentSongId)}},{key:"playAssistTick",value:function(){this.sources.assistTick.audio.play()}},{key:"playSongPreview",value:function(e){var t=this;this.currentPreview&&this.getCurrentPreview().audio.stop(this.currentPreviewId),this.storeAudioSource(e),this.currentPreview=e.hash;var n=this.getCurrentPreview().audio;this.currentPreviewId=n.play("sample"),n.on("play",(function(){var n=t.getCurrentPreview().audio;n.fade(0,1,200),t.previewFadeTimeout=setTimeout((function(){n.fade(1,0,2e3)}),1e3*e.sampleLength-2e3)}))}},{key:"stopSongPreview",value:function(){this.currentPreview&&this.getCurrentPreview().audio.stop(this.currentPreviewId)}},{key:"isPreviewPlaying",value:function(){return this.getCurrentPreview()&&this.getCurrentPreview().audio.playing(this.currentPreviewId)}}]),e}());function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Oe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sm";Object(j.a)(this,e);this.canvas=t,this.c=t.getContext("2d"),this.tl=D.a.timeline(),this.sm=n,this.simfiles={},this.eventList=[],this.arrows=[],this.shockArrows=[],this.allArrows=[],this.mainLoopRequestRef=null,this.drawBackground(),this.globalParams={beatTick:0,frame:0,combo:0,bpmChangeQueue:[],arrows:this.allArrows},this.sm&&(this.simfiles=V(this.sm,r)),ge.startAnimationLoop=this.startLoop.bind(this),ge.stopAnimationLoop=this.stopLoop.bind(this),ge.updateAnimationLoopOnce=this.updateLoopOnce.bind(this)}return Object(_.a)(e,[{key:"startLoop",value:function(){this.mainLoopRequestRef=window.requestAnimationFrame(this.mainLoop.bind(this))}},{key:"stopLoop",value:function(){window.cancelAnimationFrame(this.mainLoopRequestRef)}},{key:"updateLoopOnce",value:function(){window.requestAnimationFrame(this.mainLoop.bind(this,!1))}},{key:"generateEventList",value:function(e){for(var t=e.bpms,n=e.stops,r=[],a=0,i=0,o=t[0].value;a<t.length&&i<n.length;){var s=t[a],c=n[i];c.beat<=s.beat?(r.push(ye({},c,{bpm:o,type:"stop"})),i++):(r.push(ye({},s,{type:"bpm"})),o=s.value,a++)}for(;a<t.length;)r.push(ye({},t[a],{type:"bpm"})),a++;for(;i<n.length;)r.push(ye({},n[i],{bpm:o,type:"stop"})),i++;r[0].timestamp=0,this.globalParams.bpmChangeQueue=[r[0]];for(var l=1;l<r.length;l++){var u=r[l-1],f=r[l],d=r[l-1].timestamp,h=(f.beat-u.beat)/("bpm"===u.type?u.value:u.bpm)*60;"stop"===u.type&&(h+=u.value);var p=d+h;f.timestamp=p,"bpm"===f.type&&this.globalParams.bpmChangeQueue.push(f)}return this.eventList=r,r}},{key:"generateArrows",value:function(e,t){var n=this,r=e.chart,a=me.getState().songSelect.mode;if(Array.isArray(r[0])){var i=[];r.forEach((function(e){i.push.apply(i,Object(k.a)(e))})),r=i}(r=function(e,t,n){var r=t.turn,a=t.shuffle,i={off:"LDUR",mirror:"RUDL",left:"ULRD",right:"DRLU",shuffle1:"LRDU",shuffle2:"UDRL",shuffle3:"LRUD",shuffle4:"DURL",shuffle5:"DLUR",shuffle6:"DULR",shuffle7:"RLUD",shuffle8:"RULD"},o=r;return"shuffle"===r&&(o+=a),"single"===n?e.map((function(e){var t=e.note;return z({},e,{note:i[o].split("").map((function(e){return t[i.off.indexOf(e)]}))})})):"double"===n?e.map((function(e){var t=e.note.split("");return"mirror"===r&&(t=t.reverse()),z({},e,{note:t})})):void 0}(r,t,a)).forEach((function(e,t){var n=e.measureIdx,a=e.measureN,i=e.measureD;e.currentBeatPosition=4*(n+a/i),e.originalBeatPosition=e.currentBeatPosition;for(var o=0;o<e.note.length;o++)if("3"===e.note[o])for(var s=t-1;s>=0;s--)if("2"===r[s].note[o]){r[s].holdBeats||(r[s].holdBeats=[]),e.holdBeats||(e.holdBeats=[]),r[s].holdBeats[o]=e.currentBeatPosition-r[s].currentBeatPosition,e.holdBeats[o]=e.currentBeatPosition-r[s].currentBeatPosition;break}})),r.forEach((function(e,r){if("M"===e.note[0]||"M"===e.note[4]){var a=new N(ye({key:r},e,{mods:t}));n.shockArrows.push(a),n.allArrows.push(a)}if(e.note.includes("1")||e.note.includes("2")||e.note.includes("3")){var i=new C(ye({key:r},e,{mods:t}));n.arrows.push(i),n.allArrows.push(i)}})),this.stepZone=new B}},{key:"initTimeline",value:function(e){var t,n=this;this.resetArrows(),console.log("this.allArrows.length: ".concat(this.allArrows.length));var r=0,a=this.arrows[this.arrows.length-1],i=this.eventList[this.eventList.length-1],o=0;a&&i?o=Math.max(a.originalBeatPosition,i.beat):a?o=a.originalBeatPosition:i&&(o=i.beat),o+=8;for(var s=function(e){var a=n.eventList[e],i=n.eventList[e+1],s="stop"===a.type?a.value:0;if("bpm"===a.type?t=a.value:"stop"===a.type&&(t=a.bpm),i){var c=i.beat-a.beat,l=c/t*60;n.tl=n.tl.to(n.globalParams,{beatTick:r+c,duration:l,ease:"none",onStart:function(){"bpm"===a.type&&me.dispatch(Q(a.value))}},"+=".concat(s)),r+=c}else n.tl=n.tl.to(n.globalParams,{beatTick:o,duration:(o-r)/t*60,ease:"none",onStart:function(){"bpm"===a.type&&me.dispatch(Q(a.value))}},"+=".concat(s))},c=0;c<this.eventList.length;c++)s(c);console.log("eventList",this.eventList);var l=this.globalParams.bpmChangeQueue;this.comboArrows=[];var u=-1,f=0,d=-1,h=null,p=null,m=0,v=0;this.allArrows.forEach((function(e,t){if(!(e instanceof C)||e.note.includes("1")||e.note.includes("2")){for(;u<l.length-1&&l[u+1].beat<e.originalBeatPosition;){u++;var r=l[u];h=r.value,m=0;for(var a=f;a<n.eventList.length;a++){var i=n.eventList[a];if(i.beat===r.beat&&"bpm"===i.type){f=a;var o=n.eventList[a+1];o&&"stop"===o.type&&(d=a+1,p=n.eventList[d]);break}}}for(;p&&p.beat<e.originalBeatPosition;){m+=p.value;var s=n.eventList[d+1];s&&"stop"===s.type?d++:d=-1,p=n.eventList[d]}var c=l[u].beat,g=l[u].timestamp+(e.originalBeatPosition-c)*(60/h)+m;v++,e.combo=v,e.timestamp=g,n.comboArrows.push(e);var b=document.querySelector("#combo-temp .combo-num");n.tl.set(n.globalParams,{combo:e.combo,onStart:function(){b.textContent=e.combo}},g)}})),window.arrow=function(e){return n.comboArrows[e-1]},this.guidelines=new I({mods:e,finalBeat:o}),ge.setTimeline(this.tl),ge.setGlobalParams(this.globalParams),this.updateLoopOnce()}},{key:"resetArrows",value:function(){this.arrows.forEach((function(e){return e.reset()}))}},{key:"mainLoop",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.drawBackground();var n=me.getState().songSelect.mode;this.stepZone&&this.stepZone.render(this.canvas,this.globalParams.beatTick,n),this.guidelines&&this.guidelines.render(this.canvas,this.globalParams.beatTick);for(var r=this.shockArrows.length-1;r>=0;r--){var a=this.shockArrows[r];a.render(this.canvas,this.globalParams.frame,this.globalParams.beatTick)}for(var i="double"===n?[2,6]:[2],o="double"===n?[0,1,3,4,5,7]:[0,1,3],s=function(t){var n=e.arrows[t];o.forEach((function(t){n.renderFreezeBody(e.canvas,e.globalParams.beatTick,t)}))},c=this.arrows.length-1;c>=0;c--)s(c);for(var l=function(t){var n=e.arrows[t];i.forEach((function(t){n.renderFreezeBody(e.canvas,e.globalParams.beatTick,t)}))},u=0;u<this.arrows.length;u++)l(u);for(var f=function(t){var n=e.arrows[t];o.forEach((function(t){n.renderArrow(e.canvas,e.globalParams.beatTick,t)}))},d=this.arrows.length-1;d>=0;d--)f(d);for(var h=function(t){var n=e.arrows[t];i.forEach((function(t){n.renderArrow(e.canvas,e.globalParams.beatTick,t)}))},p=0;p<this.arrows.length;p++)h(p);this.globalParams.frame++,t&&(this.mainLoopRequestRef=window.requestAnimationFrame(this.mainLoop.bind(this)))}},{key:"drawBackground",value:function(){this.c.fillStyle="black",this.c.fillRect(0,0,this.canvas.width,this.canvas.height)}},{key:"toggleTl",value:function(){this.tl.paused()?(console.log("tl.play()"),this.tl.play()):(console.log("tl.pause()"),this.tl.pause())}},{key:"restartTl",value:function(){this.tl.restart().pause(),this.resetArrows()}},{key:"pauseTl",value:function(){this.tl.pause()}}]),e}(),we=function(e){var t=Object(r.useRef)(),n=Object(r.useRef)();Object(r.useEffect)((function(){var e=t.current.ref.current;e.addEventListener("mousedown",i,!1),e.addEventListener("mouseup",o,!1),e.addEventListener("mouseleave",o,!1),e.addEventListener("touchstart",i,!1),e.addEventListener("touchend",o,!1)}),[]);var i=function(t){t.preventDefault(),e.onClick&&e.onClick(),n.current=requestAnimationFrame(s)},o=function(e){cancelAnimationFrame(n.current)},s=function t(){e.onClick&&e.onClick(),n.current=requestAnimationFrame(t)};return a.a.createElement(p.a,Object.assign({},e,{ref:t}),e.children)},Ee=n(423),Pe=n(421),ke=n(208),Se=n.n(ke),je={Beginner:"b",Basic:"B",Difficult:"D",Expert:"E",Challenge:"C"},_e={single:"S",double:"D"},De=function(e){var t=e.modalOpen,n=e.setModalOpen,i=e.data,o=i.song,s=i.difficulty,c=i.mode,l=i.mods,u=(i.progress,Object(r.useRef)()),d=Object(r.useState)(""),h=Object(f.a)(d,2),v=h[0],g=h[1];if(Object(r.useEffect)((function(){!1===t&&g("")}),[t]),!o)return null;u.current=function(){var e=ve.getProgress(),t={song:o.hash,difficulty:je[s]+_e[c]+"P",turn:"off"!==l.turn?l.turn:"",speed:l.speed.toString().replace(".",""),progress:parseInt(1e5*e)},n=Object.keys(t).map((function(e){return null===t[e]||"undefined"===typeof t[e]?null:"".concat(e,"=").concat(t[e])})).filter((function(e){return null!==e})).join("&");return m()+"?"+n}();return a.a.createElement(Ee.a,{className:"shareModal",size:"fullscreen",open:t,onClose:function(){return n(!1)}},a.a.createElement(Ee.a.Header,null,"Share link to chart"),a.a.createElement(Ee.a.Content,null,a.a.createElement(Pe.a,{type:"text",className:"share-url-input",value:u.current,action:!0},a.a.createElement("input",null),a.a.createElement(p.a,{onClick:function(){Se()(u.current),g("Copied link to clipboard")}},"Copy")),a.a.createElement("p",null,v)))},Ae=Object(s.b)((function(e){var t=e.audio,n=e.chart,r=e.mods,a=e.songSelect,i=e.screen;return{audio:t.chartAudio,chart:n,mods:r,selectedSong:a.song,selectedDifficulty:a.difficulty,selectedMode:a.mode,screen:i}}),(function(e){return{}}))((function(e){var t=e.selectedDifficulty,n=e.selectedMode,i=e.selectedSong,o=e.sm,s=e.chart,c=e.mods,l=e.screen,u=e.loadingAudio,d=e.gameEngine,m=e.setGameEngine,v=Object(r.useState)(null),g=Object(f.a)(v,2),y=g[0],w=g[1],k=Object(r.useState)(!1),S=Object(f.a)(k,2),j=S[0],_=S[1],D=Object(r.useRef)(),A=Object(r.useRef)(),C=Object(r.useRef)();Object(r.useEffect)((function(){u||(D.current=document.querySelector("#chartArea"),w(D.current),ve.initCanvas())}),[u]),Object(r.useEffect)((function(){y&&A.current&&L()}),[y,n,l]);var L=function(){if("single"===n)D.current.width=256,D.current.style.transform="none",D.current.style.position="relative",D.current.style.left=0,D.current.style.top=0;else if("double"===n){D.current.width=512;var e=A.current.getBoundingClientRect();if(e.width<512){var t=e.width/D.current.width,r=(D.current.width-e.width)/2,a=r*(7/8);D.current.style.transform="scale(".concat(t,")"),D.current.style.position="absolute",D.current.style.left="-".concat(r,"px"),D.current.style.top="-".concat(a,"px")}else D.current.style.transform="none",D.current.style.position="relative",D.current.style.left=0,D.current.style.top=0}d&&d.updateLoopOnce()};Object(r.useEffect)((function(){if(y){var e=i.useSsc?"ssc":"sm",r=new Oe(y,o,e);if(t){var a=r.simfiles["".concat(n,"_").concat(t)];a&&(r.generateEventList(a),r.generateArrows(a,c),r.initTimeline(c),r.restartTl(),ge.resync()),m(r)}}}),[y,o,t,n,c]);var N={song:i,difficulty:t,mode:n,mods:c,progress:e.audio.progress};return a.a.createElement("div",{className:"canvas-container"},u&&a.a.createElement("div",{className:"canvas-wrapper",ref:C},a.a.createElement("div",{className:"chart-loading-screen ".concat(n)},a.a.createElement("img",{className:"chart-loading-jacket",src:b("".concat(i.hash,".png"))}),a.a.createElement("div",{className:"chart-loading-message"},"Loading chart..."))),!u&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"canvas-wrapper ".concat(n),ref:A},a.a.createElement("canvas",{id:"chartArea",width:"256",height:"448"}),a.a.createElement("div",{id:"combo-temp"},a.a.createElement("div",null,"Combo"),a.a.createElement("div",{className:"combo-num"},s.combo))),a.a.createElement("div",{className:"progress-container"},a.a.createElement("div",{className:"progress-wrapper"},a.a.createElement("canvas",{id:"progress"}),O.progress?a.a.createElement("div",{className:"preset-marker-wrapper",onClick:ve.jumpToPresetStart.bind(ve),onTouchStart:ve.jumpToPresetStart.bind(ve)},a.a.createElement("div",{className:"preset-marker"})):null))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"play-controls"},a.a.createElement(we,{onClick:function(){return ge.goBack(20)},className:"play-control"},a.a.createElement(h.a,{name:"backward"})),a.a.createElement(p.a,{onClick:function(){d&&("playing"===e.audio.status?ge.pause():ge.play())},disabled:!(d&&!u),className:"play-control"},a.a.createElement(h.a,{name:"playing"===e.audio.status?"pause":"play"})),a.a.createElement(p.a,{onClick:function(){d&&ge.stop()},className:"play-control"},a.a.createElement(h.a,{name:"stop"})),a.a.createElement(we,{onClick:function(){return ge.goForward(20)},className:"play-control"},a.a.createElement(h.a,{name:"forward"})),a.a.createElement(p.a,{onClick:function(){return _(!0)},className:"play-control share-btn",disabled:"playing"===e.audio.status},a.a.createElement(h.a,{name:"share square"})))),a.a.createElement("div",{className:"row"},a.a.createElement("div",{className:"song-information"},i&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"song-title"},i.title),a.a.createElement("div",{className:"song-artist"},i.artist))),a.a.createElement("div",{className:"bpm-information"},a.a.createElement("div",{className:"bpm-header"},"BPM"),a.a.createElement("div",{className:"bpm-value"},s.activeBpm)),a.a.createElement("div",{className:"level-information"},i&&a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"song-difficulty"},t),a.a.createElement("div",{className:"song-level"},i.levels["double"===n?P.indexOf(t)+5:E.indexOf(t)])))),a.a.createElement(De,{modalOpen:j,setModalOpen:_,data:N}))})),Ce=n(424),Le=function(e,t,n){var r="double"===n?P:E,a="double"===n?e.levels.slice(5,9):e.levels.slice(0,5);if(["Difficult","Expert","Challenge"].includes(t)){for(var i=r.length-1;i>=0;i--)if(a[i])return r[i]}else if(["Beginner","Basic"].includes(t))for(var o=0;o<=r.length-1;o++)if(a[o])return r[o]},Ne=function(e){var t=e.displayedSongs,n=e.onSongSelect,r=e.selectedSongOption,i=e.selectedMode,o=e.selectedDifficultyOption,s=e.selectedFilters,c=t,l=function(e){return a.a.createElement("div",{className:"songTile-wrapper",key:"songtile_".concat(e.hash),onClick:function(){return function(e){n(null,{value:e.hash})}(e)}},a.a.createElement("div",{className:"songTile ".concat(r===e.hash?"selected":"")},a.a.createElement("div",{className:"song-jacket-wrapper"},a.a.createElement("img",{className:"song-jacket",src:b("".concat(e.hash,".png")),title:e.title,alt:e.title})),a.a.createElement("div",{className:"song-level-wrapper"},function(e){var t=[];"single"===i?t=e.levels.slice(0,5):"double"===i&&(t=[null].concat(Object(k.a)(e.levels.slice(5,9))));var n=s.level,r=s.difficulty;if("all"===r&&"all"===n){var c=[null,null,null,null,null],l=E.indexOf(o);if(t[l])c[l]=t[l];else{var u=Le(e,o,i),f=E.indexOf(u);c[f]=t[f]}t=c}else t.forEach((function(e,a){if(e){var i=E[a];"all"===r?e!==n&&(t[a]=null):i!==r&&(t[a]=null)}}));return t.map((function(t,n){if(!t)return null;var r=E[n];return a.a.createElement("div",{key:"".concat(e.hash,"_").concat(r),className:"song-level ".concat(r)},t)}))}(e)),a.a.createElement("div",{className:"song-title-bar"},e.title)))};return a.a.createElement("div",{className:"songGrid"},c.map((function(e){return l(e)})))},Te=function(e){var t=e.option1,n=e.option2,r=e.value,i=function(t){t&&"undefined"!==typeof t.value&&e.onChange(t.value)};return a.a.createElement("div",{className:"toggleSwitch-wrapper"},a.a.createElement("label",{className:"toggleSwitch-option1 ".concat(r===t.value?"selected":""),onClick:function(){return i(t)}},t.text),a.a.createElement("div",{className:function(){var e="toggleSwitch";return r===t.value?e+=" left":r===n.value&&(e+=" right"),e}(),onClick:function(){t&&n&&(r===t.value?e.onChange(n.value):(n.value,e.onChange(t.value)))}}),a.a.createElement("label",{className:"toggleSwitch-option2 ".concat(r===n.value?"selected":""),onClick:function(){return i(n)}},n.text))};function xe(){return(xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function Be(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ie=a.a.createElement("path",{id:"Line_1","data-name":"Line 1",d:"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z"}),Re=a.a.createElement("path",{id:"Line_2","data-name":"Line 2",d:"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z"}),Fe=a.a.createElement("path",{id:"Line_3","data-name":"Line 3",d:"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z"}),Me=a.a.createElement("path",{id:"Line_4","data-name":"Line 4",d:"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z"}),Ve=a.a.createElement("path",{id:"Line_5","data-name":"Line 5",d:"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z"}),Ue=a.a.createElement("path",{id:"Line_6","data-name":"Line 6",d:"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z"}),ze=a.a.createElement("path",{id:"Line_7","data-name":"Line 7",d:"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z"}),He=a.a.createElement("path",{id:"Line_8","data-name":"Line 8",d:"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z"}),qe=a.a.createElement("path",{id:"Line_9","data-name":"Line 9",d:"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z"}),Ge=function(e){var t=e.svgRef,n=e.title,r=Be(e,["svgRef","title"]);return a.a.createElement("svg",xe({id:"audioWave","data-name":"Layer 1",viewBox:"0 0 50 38.05",ref:t},r),n?a.a.createElement("title",null,n):null,Ie,Re,Fe,Me,Ve,Ue,ze,He,qe)},We=a.a.forwardRef((function(e,t){return a.a.createElement(Ge,xe({svgRef:t},e))}));n.p;function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){Object(S.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=[{key:"title_all",value:"all",text:"ALL"}].concat(["\u3042","\u304b","\u3055","\u305f","\u306a","\u306f","\u307e","\u3084","\u3089","\u308f","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","NUM"].map((function(e){return{key:"title_".concat(e),value:e,text:e}}))),Ye=[{key:"version_all",value:"all",text:"ALL"}].concat(["DDR 1st","DDR 2ndMIX","DDR 3rdMIX","DDR 4thMIX","DDR 5thMIX","DDRMAX","DDRMAX2","DDR EXTREME","DDR SuperNOVA","DDR SuperNOVA 2","DDR X","DDR X2","DDR X3 VS 2ndMIX","DDR (2013)","DDR (2014)","DDR A","DDR A20"].map((function(e,t){return{key:"version_".concat(t),value:t,text:e}})).reverse()),Je=[{key:"level_all",value:"all",text:"ALL"}].concat([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19].map((function(e){return{key:"level_".concat(e),value:e,text:e}}))),Ke=[{key:"difficulty_all",value:"all",text:"ALL"}].concat(E.map((function(e){return{key:"difficulty_".concat(e),value:e,text:e}}))),$e=Object(s.b)((function(e){var t=e.audio,n=e.songSelect;return{previewAudio:t.previewAudio,selectedDifficulty:n.difficulty,selectedMode:n.mode}}),(function(e){return{selectSong:function(t){return e(ue(t))}}}))((function(e){var t=e.activeView,n=e.simfileList,i=e.selectedDifficulty,o=e.selectedMode,s=e.previewAudio,c=Object(r.useRef)(),d=n.map((function(e){return{key:e.hash,value:e.hash,text:e.title}})),h=Object(r.useState)(null),p=Object(f.a)(h,2),m=p[0],v=p[1],g=Object(r.useState)(i),y=Object(f.a)(g,2),w=y[0],k=y[1],S=Object(r.useState)({title:"all",version:15,level:"all",difficulty:"all"}),j=Object(f.a)(S,2),_=j[0],D=j[1],A=Object(r.useState)([]),C=Object(f.a)(A,2),L=C[0],N=C[1];Object(r.useEffect)((function(){var e=_.title,t=_.version,r=_.level,a=_.difficulty,i=n.filter((function(n){var a=n.levels.slice(0,5),i=n.levels.slice(5,9);return("all"===e||e===n.abcSort)&&("all"===t||t===parseInt(n.version))&&("all"===r&&"single"===o&&a.some((function(e){return!!e}))||"all"===r&&"double"===o&&i.some((function(e){return!!e}))||"single"===o&&n.levels.slice(0,5).includes(r)||"double"===o&&n.levels.slice(5,9).includes(r))})).filter((function(e){if("all"!==a)if("all"===r){if("single"===o)return null!==e.levels[E.indexOf(a)];if("double"===o)return null!==e.levels[P.indexOf(a)+5]}else{if("single"===o)return e.levels[E.indexOf(a)]===r;if("double"===o)return e.levels[P.indexOf(a)+5]===r}return e}));N(i),c.current.scrollTop=0}),[_,o]);var T=Object(r.useState)(null),x=Object(f.a)(T,2),B=x[0],I=x[1];Object(r.useEffect)((function(){document.body.click(),O.song?R(null,{value:O.song}):R(null,{value:"ld6P1lbb0bPO9doqbbPOoPb8qoDo8id0"})}),[]),Object(r.useEffect)((function(){if(m){var e=n.find((function(e){return e.hash===m}));I(e),ge.storeAudioSource(e)}}),[m]);var R=function(){var t=Object(u.a)(l.a.mark((function t(r,a){var i,s,c,u,f,d,h,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.value,v(i),ge.stopSongPreview(),s=n.find((function(e){return e.hash===i})),c=0,O.song===i&&O.progress?c=O.progress/1e5:O.progress=0,t.next=8,e.onSongSelect(s,c);case 8:if("all"===_.difficulty){t.next=12;break}F(_.difficulty),t.next=29;break;case 12:if("all"===_.level){t.next=27;break}u="double"===o?s.levels.slice(5,9):s.levels.slice(0,5),f=0;case 15:if(!(f<u.length)){t.next=25;break}if((d=u[f])!==_.level){t.next=22;break}return h="double"===o?P:E,console.log("match",h[f],d),F(h[f]),t.abrupt("break",25);case 22:f++,t.next=15;break;case 25:t.next=29;break;case 27:p=E.indexOf(w),s.levels[p]?e.onDifficultySelect(w):e.onDifficultySelect(Le(s,w,o));case 29:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),F=function(t){k(t),e.onDifficultySelect(t)};return a.a.createElement("div",{className:"form-container songView ".concat("song"===t?"open":"closed")},a.a.createElement("form",{className:"songForm"},a.a.createElement("div",{className:"form-inner-wrapper"},a.a.createElement("div",{className:"selectedSong"},a.a.createElement("div",{className:"selectedSong-jacket-wrapper ".concat("playing"===s.status?"playing":"")},a.a.createElement("div",{className:"selectedSong-jacket-overlay"},a.a.createElement(We,null)),a.a.createElement("img",{className:"selectedSong-jacket",src:b("".concat(m,".png")),alt:"Selected song",onClick:function(){ge.currentPreview===B.hash?"playing"===s.status?ge.stopSongPreview():ge.playSongPreview(B):("playing"===s.status&&ge.stopSongPreview(),ge.playSongPreview(B))}})),a.a.createElement("div",{className:"selectedSong-info"},a.a.createElement(Ce.a,{placeholder:"Choose a song",className:"song-title-dropdown",search:!0,selection:!0,value:m,onChange:R,options:d,selectOnBlur:!1,selectOnNavigation:!1}),a.a.createElement("div",{className:"song-artist"},B&&B.artist),a.a.createElement("div",{className:"song-difficulties"},function(){return B?("single"===o?e=B.levels.slice(0,5):"double"===o&&(e=B.levels.slice(5,9)),e.map((function(e,t){if(!e)return null;var n="double"===o?P[t]:E[t];return a.a.createElement("div",{className:"song-difficulty ".concat(n," ").concat(i===n?"selected":""),key:"".concat(o,"-difficulty_").concat(n),onClick:function(){return F(n)}},a.a.createElement("div",{className:"difficulty"},n),a.a.createElement("div",{className:"level"},e))}))):null;var e}()),a.a.createElement("div",{className:"song-mode"},a.a.createElement(Te,{option1:{text:"Single",value:"single"},option2:{text:"Double",value:"double"},onChange:function(t){return e.onModeSelect(t)},value:o})))),a.a.createElement("div",{className:"songForm-filters"},a.a.createElement("div",{className:"songForm-filters-row"},a.a.createElement("div",{className:"form-field"},a.a.createElement("label",null,"By Title"),a.a.createElement(Ce.a,{className:"title-filter-dropdown",selection:!0,value:_.title,onChange:function(e,t){return D(Ze({},_,{title:t.value}))},options:Qe})),a.a.createElement("div",{className:"form-field"},a.a.createElement("label",null,"By Version"),a.a.createElement(Ce.a,{className:"version-filter-dropdown",selection:!0,value:_.version,onChange:function(e,t){return D(Ze({},_,{version:t.value}))},options:Ye})),a.a.createElement("div",{className:"form-field"},a.a.createElement("label",null,"By Level"),a.a.createElement(Ce.a,{className:"level-filter-dropdown",selection:!0,value:_.level,onChange:function(e,t){return D(Ze({},_,{level:t.value}))},options:Je}),a.a.createElement("label",null,"By Difficulty"),a.a.createElement(Ce.a,{className:"difficulty-filter-dropdown",selection:!0,value:_.difficulty,onChange:function(e,t){return D(Ze({},_,{difficulty:t.value}))},options:Ke})))))),a.a.createElement("div",{className:"songGrid-container",ref:c},a.a.createElement(Ne,{displayedSongs:L,onSongSelect:R,selectedSongOption:m,selectedMode:o,selectedDifficultyOption:w,selectedFilters:_})))})),et=n(422),tt=n(412),nt=Object(s.b)((function(e){return{mods:e.mods,mode:e.songSelect.mode}}),(function(e){return{updateMods:function(t){return e(function(e){return function(t){t({type:"UPDATE_MODS",payload:e})}}(t))}}}))((function(e){var t=e.activeView,n=e.mods,i=e.updateMods,o=e.mode;return Object(r.useEffect)((function(){"double"!==o||["off","mirror"].includes(n.turn)||i({turn:"off"})}),[o]),a.a.createElement("div",{className:"form-container ".concat("mods"===t?"open":"closed")},a.a.createElement("form",null,a.a.createElement("div",{className:"form-field"},a.a.createElement("h4",{className:"form-label"},"Speed"),$.mods.speed.map((function(e){return a.a.createElement(et.a,{key:"speed_".concat(e),label:"".concat(e,"x"),name:"speed",value:e,checked:n.speed===e,onChange:function(){return i({speed:e})}})}))),a.a.createElement("div",{className:"form-field"},a.a.createElement("h4",{className:"form-label"},"Arrow color"),$.mods.noteskin.map((function(e){return a.a.createElement(et.a,{key:"noteskin_".concat(e),label:y(e),name:"noteskin",value:e,checked:n.noteskin===e,onChange:function(){return i({noteskin:e})}})}))),a.a.createElement("div",{className:"form-field"},a.a.createElement("h4",{className:"form-label"},"Turn"),$.mods.turn.filter((function(e){return"double"!==o||("off"===e||"mirror"===e)})).map((function(e){return a.a.createElement(et.a,{key:"turn_".concat(e),label:y(e),name:"turn",value:e,checked:n.turn===e,onChange:function(){return i({turn:e})}})}))),"shuffle"===n.turn&&a.a.createElement("div",{className:"form-field"},a.a.createElement("h4",{className:"form-label"},"Shuffle pattern"),$.mods.shuffle.map((function(e){return a.a.createElement(et.a,{key:"shuffle_".concat(e),label:e,name:"shuffle",value:e,checked:n.shuffle===e,onChange:function(){return i({shuffle:e})}})}))),a.a.createElement("h4",null,"Miscellaneous"),a.a.createElement("div",{className:"form-field"},a.a.createElement(tt.a,{toggle:!0,label:"Guidelines",name:"guidelines",checked:n.guidelines,onChange:function(){return i({guidelines:!n.guidelines})}})),a.a.createElement("div",{className:"form-field"},a.a.createElement(tt.a,{toggle:!0,label:"Color freeze heads",name:"colorFreezes",checked:n.colorFreezes,onChange:function(){return i({colorFreezes:!n.colorFreezes})}}))))})),rt=Object(s.b)((function(e){var t=e.audio;return{chartAudio:t.chartAudio,previewAudio:t.previewAudio}}),(function(e){return{stopPreviewAudio:function(){return e((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))}}}))((function(e){var t=e.activeView,n=e.chartAudio,r=(e.previewAudio,function(e){return"chart"!==e&&"playing"===n.status});return a.a.createElement("nav",{className:"mobileNav"},[{view:"song",icon:"music"},{view:"mods",icon:"sidebar"},{view:"2",icon:""},{view:"3",icon:""},{view:"chart",icon:"arrow up"}].map((function(i){var o=i.view,s=i.icon;return o?a.a.createElement("div",{key:"mobileNavItem_".concat(o),className:"mobileNav_item ".concat(t===o?"active":""," ").concat(r(o)?"disabled":""),onClick:function(){return function(t){"playing"!==n.status&&(ge.stopSongPreview(),e.setActiveView(t))}(o)}},a.a.createElement(h.a,{name:s})):a.a.createElement("div",{className:"mobileNav_item"})})))})),at=Object(s.b)((function(e){return{}}),(function(e){return{selectSong:function(t){return e(ue(t))},selectDifficulty:function(t){return e((n=t,function(e){e({type:"SELECT_DIFFICULTY",payload:n})}));var n},selectMode:function(t){return e((n=t,function(e){e({type:"SELECT_MODE",payload:n})}));var n},resizeScreen:function(t){return e(function(e){return function(t){t({type:"RESIZE_SCREEN",payload:e})}}(t))}}}))((function(e){var t=Object(r.useState)(!0),n=Object(f.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)([]),c=Object(f.a)(s,2),h=c[0],p=c[1],g=Object(r.useState)(null),b=Object(f.a)(g,2),y=b[0],O=b[1],w=Object(r.useState)("song"),E=Object(f.a)(w,2),P=E[0],k=E[1],S=Object(r.useState)(null),j=Object(f.a)(S,2),_=j[0],D=j[1],A=Object(r.useState)(!1),C=Object(f.a)(A,2),L=C[0],N=C[1];Object(r.useEffect)((function(){(function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:o(!1);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()(),ge.setLoadingAudio=N,window.addEventListener("resize",e.resizeScreen)}),[]);var T=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(d.a)(m()+"data/simfiles.tsv");case 3:(t=e.sent).forEach((function(e){e.levels=e.levels.split(",").map((function(e){return e?parseInt(e):null}))})),p(t),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),x=function(){var t=Object(u.a)(l.a.mark((function t(n){var r,a,i,o=arguments;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:0,console.log("MainContainer selected song",n),ge.selectSong(n,r),e.selectSong(n),document.title="".concat(n.title," - SMViewer"),a=n.smName,"OddDoQ6dqi0QdQDDOO6qlO08d8bPbli1"===n.hash&&(a=a.replace("1",Math.floor(4*Math.random())+1)),t.prev=7,t.next=10,v("".concat(m(),"simfiles/").concat(encodeURIComponent(a),".").concat(n.useSsc?"ssc":"sm"));case 10:i=t.sent,O(i),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(7),alert(t.t0);case 17:case"end":return t.stop()}}),t,null,[[7,14]])})));return function(e){return t.apply(this,arguments)}}(),B=function(e){k(e),ge.activeView=e};return a.a.createElement("div",{className:"main-container"},!i&&a.a.createElement(a.a.Fragment,null,a.a.createElement(Ae,{loadingAudio:L,sm:y,gameEngine:_,setGameEngine:D}),a.a.createElement($e,{activeView:P,setActiveView:B,simfileList:h,onSongSelect:x,onDifficultySelect:function(t){e.selectDifficulty(t)},onModeSelect:function(t){e.selectMode(t)},loadingAudio:L}),a.a.createElement(nt,{activeView:P}),a.a.createElement(rt,{activeView:P,setActiveView:B})))}));var it=function(){return a.a.createElement("div",{className:"app-container"},a.a.createElement(at,null))};o.a.render(a.a.createElement(s.a,{store:me},a.a.createElement(it,null)),document.getElementById("root"))}},[[236,1,2]]]);
//# sourceMappingURL=main.bc1b9b20.chunk.js.map