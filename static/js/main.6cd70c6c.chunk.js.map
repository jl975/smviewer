{"version":3,"sources":["utils/index.js","constants/index.js","components/chart/canvas/Arrow.js","components/chart/canvas/ShockArrow.js","components/chart/canvas/StepZone.js","components/chart/canvas/Guidelines.js","components/chart/canvas/TargetFlash.js","utils/parseSimfile.js","utils/engineUtils.js","reducers/AudioReducer.js","actions/ChartActions.js","reducers/ChartReducer.js","components/form/options.js","reducers/ModsReducer.js","reducers/ScreenReducer.js","actions/SongSelectActions.js","reducers/SongSelectReducer.js","reducers/index.js","actions/AudioActions.js","actions/ModsActions.js","actions/ScreenActions.js","store.js","components/chart/canvas/Progress.js","core/AudioPlayer.js","core/GameEngine.js","components/ui/HoldButton.js","components/chart/ShareModal.js","components/chart/PlayControls.js","components/chart/SongInfo.js","components/chart/ChartArea.js","hooks/index.js","utils/songUtils.js","components/form/SongGrid.js","utils/loadStore.js","components/ui/ToggleSwitch.js","svg/audiowave.svg","components/form/SongForm.js","components/form/ModsForm.js","svg/arrows.svg","svg/mods.svg","svg/music_search.svg","components/navigation/MobileNav.js","containers/main/MainContainer.js","App.js","index.js"],"names":["getOriginPath","window","location","search","href","slice","indexOf","fetchDocument","path","a","fetch","mode","response","reader","body","getReader","decoder","TextDecoder","read","readResult","decode","value","getAssetPath","getJacketPath","capitalize","str","toUpperCase","presetParams","obj","split","forEach","param","key","error","console","log","parseUrlParams","DIRECTIONS","SP_DIFFICULTIES","DP_DIFFICULTIES","arrowImages","direction","Image","src","imageName","Arrow","attrs","mods","speed","noteskin","colorFreezes","this","note","measureIdx","measureN","measureD","originalBeatPosition","holdBeats","hitFrame","previousBeatPosition","beatTick","canvas","directionIdx","arrowImg","frameY","destX","destY","c","getContext","bottomBoundary","height","currentBeatPosition","arrowBodyImg","totalBodyHeight","ARROW_HEIGHT","repetitions","Math","floor","partialHeight","originalPartialHeight","partialDestY","freezeBeingHeld","drawImage","i","bodyHeight","bodyFrameY","bodyDestY","tailHeight","actualDestY","tailPartialHeight","arrowHeadImg","freeze_head","frameX","includes","beatD","beatN","measureFraction","ShockArrow","frame","length","flashImages","receptorImages","StepZone","isFlash","Guidelines","guidelines","finalBeat","showGuidelines","beat","lineWidth","beginPath","moveTo","lineTo","width","strokeStyle","stroke","image","TargetFlash","arrow","directions","push","save","globalAlpha","pow","restore","modeRegex","difficultyRegex","difficultyMap","Beginner","Easy","Medium","Hard","Challenge","parseSimfile","sm","simfileType","simfiles","chartMetadata","bpms","stops","test","exec","map","point","parseFloat","chartStr","smDifficulty","difficulty","level","simfile","levelRegex","RegExp","parseInt","measures","lastIndexOf","trim","measure","ticks","filter","n","startsWith","numTicks","noteObjects","tick","tickIdx","noteObj","chart","initialState","chartAudio","status","progress","previewAudio","changeActiveBpm","bpm","dispatch","type","payload","activeBpm","bpmChangeQueue","combo","options","turn","shuffle","optionDefaultValues","difficulties","b","B","D","E","C","Object","keys","turnValue","toLowerCase","innerWidth","innerHeight","selectSong","song","combineReducers","audio","state","action","updatedMods","screen","target","values","songSelect","store","createStore","reducers","compose","applyMiddleware","thunk","devToolsExtension","__REDUX_DEVTOOLS_EXTENSION__","f","mouseDown","currentProgress","presetStart","document","querySelector","presetMarker","drawBackground","addEventListener","e","preventDefault","jumpToProgress","touches","setPresetMarker","totalWidth","offsetWidth","presetPosition","style","left","event","presetProgress","progressPercent","domRect","getBoundingClientRect","clientX","x","setProgress","AudioPlayer","seekProgress","stopPropagation","fillStyle","fillRect","isNaN","sources","preview","assistTick","Howl","currentSong","currentPreview","currentSongId","currentPreviewId","activeView","previewFadeTimeout","updateTimeline","bind","updateProgress","audioResyncFrames","getCurrentSong","seek","initialProgress","hash","setLoadingAudio","title","dAudioUrl","format","html5","onload","onloaderror","id","blah","alert","onplay","tl","play","resync","gsap","ticker","add","startAnimationLoop","onpause","pause","remove","stopAnimationLoop","onseek","onstop","restart","onend","spriteId","sprite","sample","sampleStart","sampleLength","clearTimeout","stop","storeAudioSource","updateProgressOnce","getCurrentTime","err","currentBpm","params","lastBpmValue","bpmEvent","getCurrentBpm","globalParams","currentCombo","arrows","timestamp","getCurrentCombo","comboTemp","textContent","ms","seekTime","duration","time","deltaTime","Progress","render","updateAnimationLoopOnce","playing","getCurrentPreview","on","fade","setTimeout","GameEngine","timeline","eventList","shockArrows","allArrows","mainLoopRequestRef","targetFlashes","startLoop","stopLoop","updateLoopOnce","requestAnimationFrame","mainLoop","cancelAnimationFrame","bpmPtr","stopPtr","prevEvent","currentEvent","prevTimestamp","timestampDiff","currentTimestamp","getState","Array","isArray","newChart","turnMap","off","mirror","right","shuffle1","shuffle2","shuffle3","shuffle4","shuffle5","shuffle6","shuffle7","shuffle8","turnMod","row","turnedNote","reverse","applyTurnMods","j","shockArrow","stepZone","resetArrows","accumulatedBeatTick","lastArrow","lastEvent","max","startEvent","endEvent","delay","sectionBeatLength","sectionDuration","to","ease","onStart","actions","comboArrows","currentBpmPtr","currentEventPtr","pendingStopPtr","pendingStop","currentStopOffset","idx","bpmSection","nextEvent","bpmSectionStartBeat","arrowTimestamp","set","setTimeline","setGlobalParams","reset","loop","upArrows","notUpArrows","renderFreezeBody","renderArrow","beatStamp","targetFlash","paused","HoldButton","props","button","useRef","requestRef","useEffect","el","current","ref","pressingDown","notPressingDown","onClick","handleHold","Button","children","Basic","Difficult","Expert","modes","single","double","ShareModal","modalOpen","setModalOpen","data","shareUrl","useState","message","setMessage","getProgress","toString","replace","queryStr","join","generateShareUrl","Modal","className","size","open","onClose","Header","Content","Input","copy","connect","controlsDisabled","setShareModalOpen","goBack","Icon","name","disabled","goForward","selectedSong","selectedDifficulty","selectedMode","artist","levels","loadingAudio","gameEngine","setGameEngine","setCanvas","shareModalOpen","chartArea","canvasWrapper","chartLoadingScreen","prevState","usePrevious","initCanvas","resizeChartArea","transform","position","top","wrapper","scaleFactor","xOffset","yOffset","currentState","thing","useSsc","ge","generateEventList","generateArrows","initTimeline","restartTl","shareParams","jumpToPresetStart","onTouchStart","getClosestDifficulty","SongGrid","displayedSongs","onSongSelect","selectedSongOption","selectedDifficultyOption","selectedFilters","songs","renderSong","alt","levelFilter","difficultyFilter","displayedLevels","difficultyIdx","closestDiff","closestDiffIdx","renderSongLevel","loadStore","lastRequestedSong","lastRequestedSongLoaded","ToggleSwitch","option1","option2","selectOption","option","onChange","text","getSwitchClassName","_extends","assign","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref","svgRef","viewBox","ForwardRef","forwardRef","titleSortOptions","concat","letter","versionSortOptions","versionName","levelSortOptions","difficultySortOptions","simfileList","songGridContainer","simfileOptions","setSelectedSongOption","setSelectedDifficultyOption","version","setSelectedFilters","setDisplayedSongs","singleDiffs","doubleDiffs","abcSort","some","scrollTop","setSelectedSong","click","find","songHash","stopSongPreview","handleDifficultySelect","selectedDiffOptionIndex","difficultyToSelect","onDifficultySelect","playSongPreview","Dropdown","placeholder","selection","selectOnBlur","selectOnNavigation","renderDifficulties","onModeSelect","displayBpm","getDisplayBpm","updateMods","Radio","label","checked","lowBpm","highBpm","round","getEffectiveScrollSpeed","Checkbox","toggle","fill","verticalAlign","overflow","fillRule","stopPreviewAudio","navItems","view","icon","svgIcon","SongIcon","ModsIcon","ChartIcon","isDisabled","navItem","SVGIcon","setActiveView","selectDifficulty","selectMode","resizeScreen","loadingSimfiles","setLoadingSimfiles","setSimfileList","selectedSM","setSelectedSM","fetchSimfiles","fetchData","tsv","parsedTsv","smName","random","encodeURIComponent","changeActiveView","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.6cd70c6c.chunk.js","sourcesContent":["export const getOriginPath = () => {\n  if (window.location.search)\n    return window.location.href.slice(\n      0,\n      window.location.href.indexOf(window.location.search)\n    );\n  return window.location.href;\n};\n\nexport const fetchDocument = async (path) => {\n  const response = await fetch(path, {\n    mode: \"cors\",\n  });\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder(\"utf-8\");\n  const readResult = await reader.read();\n  return decoder.decode(readResult.value);\n};\n\nexport const getAssetPath = (path) => {\n  return getOriginPath() + \"assets/\" + path;\n};\n\nexport const getJacketPath = (path) => {\n  return getOriginPath() + \"jackets/\" + path;\n};\n\nexport const capitalize = (str) => {\n  return str.slice(0, 1).toUpperCase() + str.slice(1);\n};\n\nconst parseUrlParams = () => {\n  if (!window.location.search) return {};\n  const obj = {};\n  try {\n    window.location.search\n      .slice(1)\n      .split(\"&\")\n      .forEach((param) => {\n        const [key, value] = param.split(\"=\");\n        obj[key] = value;\n      });\n    return obj;\n  } catch (error) {\n    console.log(\"error parsing url params\", error);\n    return {};\n  }\n};\nexport const presetParams = parseUrlParams();\n","export const ARROW_WIDTH = 64;\nexport const ARROW_HEIGHT = 64;\n\n/* Height of one repetition of the freeze body pattern */\nexport const FREEZE_BODY_HEIGHT = 128;\n\nexport const DIRECTIONS = [\"left\", \"down\", \"up\", \"right\"];\n\n/* Number of seconds that the visuals are delayed relative to the audio */\n// export const GLOBAL_OFFSET = 0.012;\n\n/* \n  Offset of the visuals (i.e. chart, gsap timeline) relative to the audio.\n  Positive value represents notes being earlier (have to hit earlier than the music)\n  Negative value represents notes being later (have to hit later than the music)\n*/\nexport const GLOBAL_OFFSET = 0.07;\n\nexport const MARVELOUS_FLASH_FRAMES = 12;\n\n/* Number of beats played after the last note or event until the timeline ends */\nexport const END_EXTRA_BEATS = 8;\n\nexport const DDR_VERSIONS = [\n  \"DDR 1st\",\n  \"DDR 2ndMIX\",\n  \"DDR 3rdMIX\",\n  \"DDR 4thMIX\",\n  \"DDR 5thMIX\",\n  \"DDRMAX\",\n  \"DDRMAX2\",\n  \"DDR EXTREME\",\n  \"DDR SuperNOVA\",\n  \"DDR SuperNOVA 2\",\n  \"DDR X\",\n  \"DDR X2\",\n  \"DDR X3 VS 2ndMIX\",\n  \"DDR (2013)\",\n  \"DDR (2014)\",\n  \"DDR A\",\n  \"DDR A20\",\n];\n\nexport const SP_DIFFICULTIES = [\n  \"Beginner\",\n  \"Basic\",\n  \"Difficult\",\n  \"Expert\",\n  \"Challenge\",\n];\nexport const DP_DIFFICULTIES = [\"Basic\", \"Difficult\", \"Expert\", \"Challenge\"];\n\nexport const TITLE_CATEGORIES = [\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \"NUM\",\n];\n\nexport const LEVELS = [\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  16,\n  17,\n  18,\n  19,\n];\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  FREEZE_BODY_HEIGHT,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`rainbow_${direction}`] = new Image();\n  arrowImages[`rainbow_${direction}`].src = getAssetPath(\n    `rainbow_${direction}.png`\n  );\n  arrowImages[`note_${direction}`] = new Image();\n  arrowImages[`note_${direction}`].src = getAssetPath(`note_${direction}.png`);\n  arrowImages[`vivid_${direction}`] = new Image();\n  arrowImages[`vivid_${direction}`].src = getAssetPath(\n    `vivid_${direction}.png`\n  );\n  arrowImages[`flat_${direction}`] = new Image();\n  arrowImages[`flat_${direction}`].src = getAssetPath(`vivid_${direction}.png`);\n\n  arrowImages[`freeze_tail_active_${direction}`] = new Image();\n  arrowImages[`freeze_tail_active_${direction}`].src = getAssetPath(\n    `freeze_tail_active_${direction}.png`\n  );\n  arrowImages[`freeze_tail_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_tail_inactive_${direction}`].src = getAssetPath(\n    `freeze_tail_inactive_${direction}.png`\n  );\n\n  arrowImages[`freeze_body_active_${direction}`] = new Image();\n  arrowImages[`freeze_body_active_${direction}`].src = getAssetPath(\n    `freeze_body_active_${direction}.png`\n  );\n  arrowImages[`freeze_body_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_body_inactive_${direction}`].src = getAssetPath(\n    `freeze_body_inactive_${direction}.png`\n  );\n\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nconst miscImages = [\"freeze_head\", \"tap_explosion\"];\nmiscImages.forEach((imageName) => {\n  arrowImages[imageName] = new Image();\n  arrowImages[imageName].src = getAssetPath(`${imageName}.png`);\n});\n\nclass Arrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin, colorFreezes } = mods;\n\n    this.key = key; // arrow index\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n    this.measureIdx = attrs.measureIdx;\n    this.measureN = attrs.measureN;\n    this.measureD = attrs.measureD;\n    this.colorFreezes = colorFreezes;\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n    this.holdBeats = attrs.holdBeats || null;\n\n    this.hitFrame = 0; // frame for showing the Marvelous flash\n\n    // can be used to detect the moment that the arrow passes a certain position\n    // even without landing precisely on it\n    this.previousBeatPosition = null;\n  }\n\n  reset() {\n    this.hitFrame = 0;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  renderFreezeBody(canvas, beatTick, directionIdx) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // freeze body and tail\n    if (this.note[directionIdx] === \"3\") {\n      arrowImg = arrowImages[`freeze_tail_inactive_${direction}`];\n      frameX = 0;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      // Bottom of freeze body must be the bottom of the body image (yellow part of gradient)\n      // and line up with the top of the freeze tail.\n      // Extend the freeze body upwards using as many repetitions of the 128px height image as needed.\n      // Top of freeze body is cut off at the midpoint of the freeze head.\n      let arrowBodyImg = arrowImages[`freeze_body_inactive_${direction}`];\n      const totalBodyHeight =\n        this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed -\n        ARROW_HEIGHT / 2;\n      const repetitions = Math.floor(totalBodyHeight / FREEZE_BODY_HEIGHT);\n      let partialHeight = totalBodyHeight % FREEZE_BODY_HEIGHT;\n      const originalPartialHeight = partialHeight;\n\n      let partialDestY = destY - (totalBodyHeight + ARROW_HEIGHT / 2);\n      let freezeBeingHeld = false;\n\n      // shrink in size once it reaches the target\n      // this is also where the freeze starts to be held down\n      if (partialDestY <= 0) {\n        partialHeight += partialDestY;\n        partialDestY = 0;\n        arrowImg = arrowImages[`freeze_tail_active_${direction}`];\n        arrowBodyImg = arrowImages[`freeze_body_active_${direction}`];\n\n        if (destY >= 0) {\n          freezeBeingHeld = true;\n        }\n      }\n\n      // draw partial\n      if (partialDestY > -partialHeight && partialDestY < bottomBoundary) {\n        c.drawImage(\n          arrowBodyImg,\n          0,\n          FREEZE_BODY_HEIGHT - partialHeight,\n          ARROW_WIDTH,\n          partialHeight,\n          destX,\n          partialDestY + ARROW_HEIGHT / 2,\n          ARROW_WIDTH,\n          partialHeight\n        );\n      }\n\n      // draw repetitions of freeze body\n      for (let i = 1; i <= repetitions; i++) {\n        let bodyHeight = FREEZE_BODY_HEIGHT;\n        let bodyFrameY = 0;\n        let bodyDestY =\n          destY -\n          (totalBodyHeight +\n            ARROW_HEIGHT / 2 -\n            originalPartialHeight -\n            FREEZE_BODY_HEIGHT * (i - 1));\n        if (bodyDestY < 0 && bodyDestY > -FREEZE_BODY_HEIGHT) {\n          bodyHeight += bodyDestY;\n          bodyFrameY -= bodyDestY;\n          bodyDestY = 0;\n        }\n        if (bodyDestY > -bodyHeight && bodyDestY < bottomBoundary) {\n          c.drawImage(\n            arrowBodyImg,\n            0,\n            bodyFrameY,\n            ARROW_WIDTH,\n            bodyHeight,\n            destX,\n            bodyDestY + ARROW_HEIGHT / 2,\n            ARROW_WIDTH,\n            bodyHeight\n          );\n        }\n      }\n\n      let tailHeight = ARROW_HEIGHT;\n\n      // if the freeze is shorter than the height of the tail sprite,\n      // cut off the top of the sprite such that it starts at the midpoint of the freeze head\n\n      // Because we need to overwrite destY for proper sprite placement in the event that the\n      // top of the sprite needs to be cut off, store the actual Y position of the arrow\n      // in a separate variable\n      let actualDestY = destY;\n\n      if (\n        this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed <\n        ARROW_HEIGHT / 2\n      ) {\n        const tailPartialHeight =\n          this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed; // distance between head note and tail note\n        frameY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        destY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        tailHeight = tailPartialHeight + ARROW_HEIGHT / 2;\n      }\n\n      // shrink in size once it reaches the target\n      if (destY < ARROW_HEIGHT / 2 && destY > topBoundary) {\n        frameY += ARROW_HEIGHT / 2 - destY;\n        destY = ARROW_HEIGHT / 2;\n      }\n\n      if (actualDestY > topBoundary && actualDestY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          tailHeight,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          tailHeight\n        );\n      }\n\n      // render head of held freeze arrow on top of the arrow body\n      if (freezeBeingHeld) {\n        const arrowHeadImg = arrowImages.freeze_head;\n        if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n          c.drawImage(\n            arrowHeadImg,\n            DIRECTIONS.indexOf(direction) * ARROW_WIDTH,\n            ARROW_HEIGHT * 2,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            directionIdx * ARROW_WIDTH,\n            0,\n            ARROW_WIDTH,\n            ARROW_HEIGHT\n          );\n        }\n      }\n\n      // flash at the end of successfully held down freeze\n      // if (actualDestY <= 0) {\n      //   if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n      //     c.save();\n      //     c.globalAlpha =\n      //       1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n      //     c.drawImage(\n      //       arrowImages.tap_explosion,\n      //       0,\n      //       0,\n      //       ARROW_WIDTH,\n      //       ARROW_HEIGHT,\n      //       destX - this.hitFrame,\n      //       0 - this.hitFrame,\n      //       ARROW_WIDTH + this.hitFrame * 2,\n      //       ARROW_HEIGHT + this.hitFrame * 2\n      //     );\n      //     c.restore();\n      //     this.hitFrame++;\n      //   }\n      // } else {\n      //   this.hitFrame = 0;\n      // }\n    }\n\n    this.previousBeatPosition = this.currentBeatPosition(beatTick);\n  }\n\n  renderArrow(canvas, beatTick, directionIdx) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height; // can be adjusted with SUDDEN+\n\n    // nothing\n    if (this.note[directionIdx] === \"0\") return;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // regular note\n    if (\n      this.note[directionIdx] === \"1\" ||\n      (this.note[directionIdx] === \"2\" && this.colorFreezes)\n    ) {\n      // console.log(\"arrow\", directionIdx);\n      arrowImg = arrowImages[`${this.noteskin}_${direction}`];\n\n      // color as freeze head if it is hit simultaneously with a freeze arrow\n      if (this.note.includes(\"2\") && !this.colorFreezes) {\n        arrowImg = arrowImages.freeze_head;\n        frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        frameY = 0;\n      } else {\n        if (this.noteskin === \"rainbow\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (this.noteskin === \"note\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          /* \n              NOTE: In the future, if we want to support color codes for 12ths, 24ths, etc.\n              We need to use more precise math to avoid rounding errors.\n              Planned approach: Reduce the measure fraction by dividing both numerator and denominator\n              by their greatest common factor.\n              If GCF == 1, 2, or 4, use 4th note quantization.\n              Otherwise, the resulting denominator is used for the quantization (3 and 6 may be treated as 12ths)\n            */\n          const measureFraction = this.measureN / this.measureD;\n          if ([0, 1 / 4, 2 / 4, 3 / 4].includes(measureFraction)) {\n            frameY = 0;\n          } else if ([1 / 8, 3 / 8, 5 / 8, 7 / 8].includes(measureFraction)) {\n            frameY = 1;\n          } else if (\n            [\n              1 / 16,\n              3 / 16,\n              5 / 16,\n              7 / 16,\n              9 / 16,\n              11 / 16,\n              13 / 16,\n              15 / 16,\n            ].includes(measureFraction)\n          ) {\n            frameY = 3;\n          } else {\n            frameY = 2;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (this.noteskin === \"vivid\") {\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          const noteOffset = Math.floor(beatTick) % 4;\n\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY = ((frameY + noteOffset) % 4) * ARROW_HEIGHT;\n        } else if (this.noteskin === \"flat\") {\n          arrowImg = arrowImages[`vivid_${direction}`];\n\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n          frameY = (Math.floor(beatTick) % 4) * ARROW_HEIGHT;\n        }\n      }\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n      // // target flash\n      // if (destY <= 0) {\n      //   if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n      //     c.save();\n      //     c.globalAlpha =\n      //       1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n      //     c.drawImage(\n      //       arrowImages.tap_explosion,\n      //       0,\n      //       0,\n      //       ARROW_WIDTH,\n      //       ARROW_HEIGHT,\n      //       destX - 2 - this.hitFrame,\n      //       0 - 2 - this.hitFrame,\n      //       ARROW_WIDTH + 4 + this.hitFrame * 2,\n      //       ARROW_HEIGHT + 4 + this.hitFrame * 2\n      //     );\n      //     c.restore();\n      //     this.hitFrame++;\n      //   }\n      // } else {\n      //   this.hitFrame = 0;\n      // }\n    }\n\n    // freeze note\n    else if (this.note[directionIdx] === \"2\") {\n      arrowImg = arrowImages.freeze_head;\n      frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      // draw freeze head\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n\n      // // target flash\n      // if (destY <= 0) {\n      //   if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n      //     c.save();\n      //     c.globalAlpha =\n      //       1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n      //     c.drawImage(\n      //       arrowImages.tap_explosion,\n      //       0,\n      //       0,\n      //       ARROW_WIDTH,\n      //       ARROW_HEIGHT,\n      //       destX - this.hitFrame,\n      //       0 - this.hitFrame,\n      //       ARROW_WIDTH + this.hitFrame * 2,\n      //       ARROW_HEIGHT + this.hitFrame * 2\n      //     );\n      //     c.restore();\n      //     this.hitFrame++;\n      //   }\n      // } else {\n      //   this.hitFrame = 0;\n      // }\n    }\n\n    this.previousBeatPosition = this.currentBeatPosition(beatTick);\n  }\n}\n\nexport default Arrow;\n","import { DIRECTIONS, ARROW_WIDTH, ARROW_HEIGHT } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nclass ShockArrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin } = mods;\n\n    this.key = key;\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  render(canvas, frame, beatTick) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = -ARROW_HEIGHT; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height;\n    frame = Math.floor(frame / 3) % 8; // each sprite frame lasts 3 canvas animation frames\n\n    for (let i = 0; i < this.note.length; i++) {\n      if (this.note[i] !== \"M\") continue;\n      const direction = DIRECTIONS[i % 4];\n      const arrowImg = arrowImages[`shock_${direction}`];\n      const frameX = (frame % 4) * ARROW_WIDTH;\n      const frameY = Math.floor(frame / 4) * ARROW_HEIGHT;\n      const destX = i * ARROW_WIDTH;\n      const destY =\n        this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    }\n  }\n}\n\nexport default ShockArrow;\n","import { DIRECTIONS, ARROW_HEIGHT, ARROW_WIDTH } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst flashImages = {};\nDIRECTIONS.forEach((direction) => {\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n});\n\nconst receptorImages = {};\nDIRECTIONS.forEach((direction) => {\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n});\n\nclass StepZone {\n  render(canvas, beatTick, mode) {\n    const c = canvas.getContext(\"2d\");\n    // flash starts at the beginning of the quarter beat and lasts for 1/16 beat\n\n    const isFlash = beatTick % 1 > 0 && beatTick % 1 < 0.25;\n\n    DIRECTIONS.forEach((direction, i) => {\n      c.drawImage(\n        isFlash ? flashImages[direction] : receptorImages[direction],\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        i * ARROW_WIDTH,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT\n      );\n\n      if (mode === \"double\") {\n        c.drawImage(\n          isFlash ? flashImages[direction] : receptorImages[direction],\n          0,\n          0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          (i + 4) * ARROW_WIDTH,\n          0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    });\n  }\n}\n\nexport default StepZone;\n","import { ARROW_HEIGHT } from \"../../../constants\";\n\nclass Guidelines {\n  constructor(attrs) {\n    const { mods } = attrs;\n    const { speed, guidelines } = mods;\n\n    this.speed = speed;\n    this.finalBeat = attrs.finalBeat;\n    this.showGuidelines = guidelines;\n  }\n\n  render(canvas, beatTick) {\n    if (!this.showGuidelines) return;\n\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    for (let beat = 0; beat <= this.finalBeat; beat++) {\n      const destY =\n        (beat - beatTick) * ARROW_HEIGHT * this.speed + ARROW_HEIGHT / 2;\n\n      // Render a thick line if the beat falls on the beginning of the measure.\n      // Render a thin line otherwise\n      const lineWidth = beat % 4 === 0 ? 2 : 0.8;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.beginPath();\n        c.moveTo(0, destY);\n        c.lineTo(canvas.width, destY);\n        c.lineWidth = lineWidth;\n        c.strokeStyle = \"#fff\";\n        c.stroke();\n      }\n    }\n  }\n}\n\nexport default Guidelines;\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst image = new Image();\nimage.src = getAssetPath(\"tap_explosion.png\");\n\nclass TargetFlash {\n  constructor(arrow) {\n    this.frame = -1;\n\n    this.directions = [];\n    arrow.note.forEach((note, directionIdx) => {\n      if (note === \"1\" || note === \"2\" || note === \"3\") {\n        this.directions.push(directionIdx);\n      }\n    });\n  }\n\n  render(canvas) {\n    const c = canvas.getContext(\"2d\");\n    this.directions.forEach((directionIdx) => {\n      if (this.frame < 0 || this.frame >= MARVELOUS_FLASH_FRAMES) return;\n      const destX = directionIdx * ARROW_WIDTH;\n\n      c.save();\n      c.globalAlpha = 1 - Math.pow(this.frame / MARVELOUS_FLASH_FRAMES, 3);\n      c.drawImage(\n        image,\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        destX - this.frame,\n        0 - this.frame,\n        ARROW_WIDTH + this.frame * 2,\n        ARROW_HEIGHT + this.frame * 2\n      );\n      c.restore();\n    });\n  }\n}\n\nexport default TargetFlash;\n","const modeRegex = /dance-([a-z]+)/;\nconst difficultyRegex = /(Beginner|Easy|Medium|Hard|Challenge|Edit)/;\n\nconst difficultyMap = {\n  Beginner: \"Beginner\",\n  Easy: \"Basic\",\n  Medium: \"Difficult\",\n  Hard: \"Expert\",\n  Challenge: \"Challenge\",\n};\n\nconst parseSimfile = (sm, simfileType = \"sm\") => {\n  const simfiles = {};\n\n  const chartMetadata = sm.slice(\n    0,\n    sm.indexOf(simfileType === \"ssc\" ? \"#NOTEDATA:\" : \"#NOTES:\")\n  );\n\n  let bpms = [];\n  let stops = [];\n\n  // default bpms\n  if (/#BPMS:/i.test(chartMetadata)) {\n    bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (bpms.length) {\n      bpms = bpms.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n  // default stops\n  if (/#STOPS:/i.test(chartMetadata)) {\n    stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (stops.length) {\n      stops = stops.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n\n  let chartStrs;\n\n  if (simfileType === \"ssc\") {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTEDATA:\"))\n      .split(/#NOTEDATA:\\s*;/)\n      .slice(1);\n  } else {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTES:\"))\n      .split(/#NOTES:\\s+/)\n      .slice(1);\n  }\n\n  chartStrs.forEach((chartStr) => {\n    const mode = modeRegex.exec(chartStr)[1]; // single or double\n\n    let smDifficulty = difficultyRegex.exec(chartStr)[1];\n    const difficulty = difficultyMap[smDifficulty];\n\n    simfiles[`${mode}_${difficulty}`] = { difficulty, mode, bpms, stops };\n    const simfile = simfiles[`${mode}_${difficulty}`];\n\n    let level;\n    if (simfileType === \"ssc\") {\n      level = /#METER:([0-9]+);/.exec(chartStr)[1];\n    } else {\n      const levelRegex = new RegExp(`${smDifficulty}:\\\\s+([0-9]+):`);\n      level = parseInt(levelRegex.exec(chartStr)[1]);\n    }\n    simfile.level = level;\n\n    if (simfileType === \"ssc\") {\n      // check for different bpms\n      if (/#BPMS:/i.test(chartStr)) {\n        bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (bpms.length) {\n          bpms = bpms.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.bpms = bpms;\n        }\n      }\n\n      // check for different stops\n      if (/#STOPS:/i.test(chartStr)) {\n        stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (stops.length) {\n          stops = stops.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.stops = stops;\n        }\n      }\n    }\n\n    const measures = chartStr\n      .slice(chartStr.lastIndexOf(\":\") + 1, chartStr.lastIndexOf(\";\"))\n      .trim()\n      .split(\",\")\n      .map((measure, measureIdx) => {\n        const ticks = measure\n          .trim()\n          .split(\"\\r\\n\")\n          .filter((n) => !n.startsWith(\"//\")); // filter out comment lines\n\n        const numTicks = ticks.length;\n\n        const noteObjects = [];\n        ticks.forEach((tick, tickIdx) => {\n          // skip empty ticks and comment lines\n          if (!tick.split(\"\").filter((n) => n !== \"0\").length) return;\n\n          const noteObj = {};\n          noteObj.note = tick;\n          noteObj.measureIdx = measureIdx; // index of the measure relative to the whole song (starting at 0)\n          noteObj.measureN = tickIdx; // numerator of the fraction describing where note falls in this measure\n          noteObj.measureD = numTicks; // denominator of the fraction describing where note falls in this measure\n\n          noteObjects.push(noteObj);\n        });\n\n        return noteObjects;\n      });\n\n    simfile.chart = measures;\n  });\n\n  return simfiles;\n};\n\nexport default parseSimfile;\n","import { GLOBAL_OFFSET } from \"../constants\";\n\nexport const applyTurnMods = (chart, mods, mode) => {\n  const { turn, shuffle } = mods;\n\n  // shuffle patterns courtesy of https://zenius-i-vanisher.com/v5.2/viewthread.php?threadid=3823\n  const turnMap = {\n    off: \"LDUR\",\n    mirror: \"RUDL\",\n    left: \"ULRD\",\n    right: \"DRLU\",\n    shuffle1: \"LRDU\",\n    shuffle2: \"UDRL\",\n    shuffle3: \"LRUD\",\n    shuffle4: \"DURL\",\n    shuffle5: \"DLUR\",\n    shuffle6: \"DULR\",\n    shuffle7: \"RLUD\",\n    shuffle8: \"RULD\",\n  };\n\n  let turnMod = turn;\n  if (turn === \"shuffle\") turnMod += shuffle;\n\n  if (mode === \"single\") {\n    return chart.map((row) => {\n      const note = row.note;\n      const turnedNote = turnMap[turnMod]\n        .split(\"\")\n        .map((direction) => note[turnMap.off.indexOf(direction)]);\n\n      return { ...row, note: turnedNote };\n    });\n  }\n  if (mode === \"double\") {\n    return chart.map((row) => {\n      let turnedNote = row.note.split(\"\");\n      if (turn === \"mirror\") turnedNote = turnedNote.reverse();\n      return { ...row, note: turnedNote };\n    });\n  }\n};\n\n/*\n  Given the bpmChangeQueue and the current beat tick, find the latest bpm\n  change event that happened before the current beat and set the current bpm\n  to that bpm value. This should be invoked every time the audio is resynced\n  (which will happen whenever progress is skipped)\n*/\nexport const getCurrentBpm = (params) => {\n  const { beatTick, bpmChangeQueue } = params;\n  let lastBpmValue = 0;\n  for (let i = 0; i < bpmChangeQueue.length; i++) {\n    const bpmEvent = bpmChangeQueue[i];\n    if (bpmEvent.beat > beatTick) {\n      return lastBpmValue;\n    }\n    lastBpmValue = bpmEvent.value;\n  }\n  return lastBpmValue;\n};\n\n/*\n  Find the current combo given the song timestamp. This should be invoked\n  every time the audio is resynced.\n*/\nexport const getCurrentCombo = (song) => {\n  const { audio, globalParams } = song;\n  const { arrows } = globalParams;\n  if (!arrows.length) return 0;\n\n  // Go through the chart until the arrow following the current timestamp is reached,\n  // then set the combo to one less than that arrow's combo\n  for (let i = 0; i < arrows.length; i++) {\n    const arrow = arrows[i];\n    if (arrow.timestamp > audio.seek() + GLOBAL_OFFSET) {\n      return arrow.combo - 1;\n    }\n  }\n  return arrows[arrows.length - 1].combo;\n};\n","import * as actions from \"../actions/AudioActions\";\n\nconst initialState = {\n  chartAudio: {\n    status: \"stopped\",\n    progress: 0,\n  },\n  previewAudio: {\n    status: \"stopped\",\n  },\n};\n\nexport const audio = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.PLAY_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"playing\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PAUSE_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"paused\" };\n      return { ...state, chartAudio };\n    }\n    case actions.STOP_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"stopped\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PLAY_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"playing\" };\n      return { ...state, previewAudio };\n    }\n    case actions.STOP_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"stopped\" };\n      return { ...state, previewAudio };\n    }\n    case actions.SET_CHART_PROGRESS: {\n      const chartAudio = { ...state.chartAudio, progress: action.payload };\n      return { ...state, chartAudio };\n    }\n    default:\n      return state;\n  }\n};\n","export const SET_BPM_CHANGE_QUEUE = \"SET_BPM_CHANGE_QUEUE\";\nexport const CHANGE_ACTIVE_BPM_DISPLAY = \"CHANGE_ACTIVE_BPM_DISPLAY\";\nexport const SET_COMBO = \"SET_COMBO\";\n\nexport const setBpmChangeQueue = (payload) => (dispatch) => {\n  dispatch({\n    type: SET_BPM_CHANGE_QUEUE,\n    payload,\n  });\n};\n\nexport const changeActiveBpm = (bpm) => (dispatch) => {\n  dispatch({\n    type: CHANGE_ACTIVE_BPM_DISPLAY,\n    payload: bpm,\n  });\n};\n\nexport const setCombo = (combo) => (dispatch) => {\n  dispatch({\n    type: SET_COMBO,\n    payload: combo,\n  });\n};\n","import * as actions from \"../actions/ChartActions\";\n\nconst initialState = {\n  activeBpm: null,\n  bpmChangeQueue: [],\n  combo: 0,\n};\n\nexport const chart = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SET_BPM_CHANGE_QUEUE: {\n      return { ...state, bpmChangeQueue: [...action.payload] };\n    }\n    case actions.CHANGE_ACTIVE_BPM_DISPLAY: {\n      const activeBpm = action.payload;\n      // const activeBpm = Math.round(action.payload);\n      return { ...state, activeBpm };\n    }\n    case actions.SET_COMBO: {\n      return { ...state, combo: action.payload };\n    }\n    default:\n      return state;\n  }\n};\n","import { presetParams } from \"../../utils\";\n\nexport const options = {\n  difficulty: [\"Beginner\", \"Basic\", \"Difficult\", \"Expert\", \"Challenge\"],\n  mode: [\"single\", \"double\"],\n  mods: {\n    speed: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n      2.25,\n      2.5,\n      2.75,\n      3,\n      3.25,\n      3.5,\n      3.75,\n      4,\n      4.5,\n      5,\n      5.5,\n      6,\n      6.5,\n      7,\n      7.5,\n      8,\n    ],\n    turn: [\"off\", \"mirror\", \"left\", \"right\", \"shuffle\"],\n    shuffle: [1, 2, 3, 4, 5, 6, 7, 8],\n    noteskin: [\"rainbow\", \"note\", \"vivid\", \"flat\"],\n  },\n};\n\nconst optionDefaultValues = {\n  difficulty: \"Challenge\",\n  mode: \"single\",\n  mods: {\n    speed: 3,\n    turn: \"off\",\n    shuffle: 1,\n    noteskin: \"note\",\n    guidelines: true,\n    colorFreezes: false,\n  },\n};\n\nif (presetParams.difficulty) {\n  const difficulties = {\n    b: \"Beginner\",\n    B: \"Basic\",\n    D: \"Difficult\",\n    E: \"Expert\",\n    C: \"Challenge\",\n  };\n  if (Object.keys(difficulties).includes(presetParams.difficulty[0])) {\n    optionDefaultValues.difficulty = difficulties[presetParams.difficulty[0]];\n  }\n  if (presetParams.difficulty[1] === \"S\") {\n    optionDefaultValues.mode = \"single\";\n  } else if (presetParams.difficulty[1] === \"D\") {\n    optionDefaultValues.mode = \"double\";\n  }\n}\nif (presetParams.speed) {\n  const value = parseFloat(\n    `${presetParams.speed[0]}.${presetParams.speed.slice(1)}`\n  );\n  if (options.mods.speed.includes(value)) {\n    optionDefaultValues.mods.speed = value;\n  }\n}\nif (presetParams.turn) {\n  const turnValue = presetParams.turn.toLowerCase();\n  if (options.mods.turn.includes(turnValue)) {\n    optionDefaultValues.mods.turn = turnValue;\n  }\n}\n\nexport { optionDefaultValues };\n","import * as actions from \"../actions/ModsActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\n\nconst initialState = optionDefaultValues.mods;\n\nexport const mods = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.UPDATE_MODS: {\n      const updatedMods = action.payload;\n      return { ...state, ...updatedMods };\n    }\n    default:\n      return state;\n  }\n};\n","import * as actions from \"../actions/ScreenActions\";\n\nconst initialState = {\n  innerWidth: window.innerWidth,\n  innerHeight: window.innerHeight,\n};\n\nexport const screen = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.RESIZE_SCREEN: {\n      const { target } = action.payload;\n      const { innerWidth, innerHeight } = target;\n\n      const values = { innerWidth, innerHeight };\n\n      return { ...state, ...values };\n    }\n    default:\n      return state;\n  }\n};\n","export const SELECT_SONG = \"SELECT_SONG\";\nexport const SELECT_DIFFICULTY = \"SELECT_DIFFICULTY\";\nexport const SELECT_MODE = \"SELECT_MODE\";\n\nexport const selectSong = (song) => (dispatch) => {\n  dispatch({\n    type: SELECT_SONG,\n    payload: song,\n  });\n};\n\nexport const selectDifficulty = (difficulty) => (dispatch) => {\n  dispatch({\n    type: SELECT_DIFFICULTY,\n    payload: difficulty,\n  });\n};\n\nexport const selectMode = (mode) => (dispatch) => {\n  dispatch({\n    type: SELECT_MODE,\n    payload: mode,\n  });\n};\n","import * as actions from \"../actions/SongSelectActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\n\nconst initialState = {\n  difficulty: optionDefaultValues.difficulty,\n  mode: optionDefaultValues.mode,\n};\n\nexport const songSelect = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SELECT_SONG: {\n      const song = action.payload;\n      return { ...state, song };\n    }\n    case actions.SELECT_DIFFICULTY: {\n      const difficulty = action.payload;\n      return { ...state, difficulty };\n    }\n    case actions.SELECT_MODE: {\n      const mode = action.payload;\n      return { ...state, mode };\n    }\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from \"redux\";\n\nimport { audio } from \"./AudioReducer\";\nimport { chart } from \"./ChartReducer\";\nimport { mods } from \"./ModsReducer\";\nimport { screen } from \"./ScreenReducer\";\nimport { songSelect } from \"./SongSelectReducer\";\n\nexport default combineReducers({ audio, chart, mods, screen, songSelect });\n","export const PLAY_CHART_AUDIO = \"PLAY_CHART_AUDIO\";\nexport const PAUSE_CHART_AUDIO = \"PAUSE_CHART_AUDIO\";\nexport const STOP_CHART_AUDIO = \"STOP_CHART_AUDIO\";\n\nexport const PLAY_PREVIEW_AUDIO = \"PLAY_PREVIEW_AUDIO\";\nexport const STOP_PREVIEW_AUDIO = \"STOP_PREVIEW_AUDIO\";\n\nexport const SET_CHART_PROGRESS = \"SET_CHART_PROGRESS\";\n\nexport const playChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_CHART_AUDIO,\n  });\n};\n\nexport const pauseChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PAUSE_CHART_AUDIO,\n  });\n};\n\nexport const stopChartAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_CHART_AUDIO,\n  });\n};\n\nexport const playPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_PREVIEW_AUDIO,\n  });\n};\nexport const stopPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_PREVIEW_AUDIO,\n  });\n};\n\nexport const setChartProgress = (progress) => (dispatch) => {\n  dispatch({\n    type: SET_CHART_PROGRESS,\n    payload: progress,\n  });\n};\n","export const UPDATE_MODS = \"UPDATE_MODS\";\n\nexport const updateMods = (mods) => (dispatch) => {\n  dispatch({\n    type: UPDATE_MODS,\n    payload: mods,\n  });\n};\n","export const RESIZE_SCREEN = \"RESIZE_SCREEN\";\n\nexport const resizeScreen = (e) => (dispatch) => {\n  dispatch({\n    type: RESIZE_SCREEN,\n    payload: e,\n  });\n};\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n\nimport reducers from \"./reducers\";\n\nconst store = createStore(\n  reducers,\n  compose(\n    applyMiddleware(thunk),\n    window.devToolsExtension ? window.__REDUX_DEVTOOLS_EXTENSION__() : (f) => f\n  )\n);\n\nexport default store;\n","import { presetParams } from \"../../../utils\";\nimport AudioPlayer from \"../../../core/AudioPlayer\";\n\nclass Progress {\n  constructor() {\n    this.mouseDown = false;\n    this.currentProgress = 0;\n\n    this.presetStart = 0;\n    if (presetParams.progress) {\n      this.presetStart = presetParams.progress / 100000;\n      this.currentProgress = this.presetStart;\n    }\n  }\n\n  initCanvas() {\n    this.canvas = document.querySelector(\"#progress\");\n    this.presetMarker = document.querySelector(\n      \"#progress + .preset-marker-wrapper\"\n    );\n\n    this.drawBackground();\n\n    // mobile scrub behavior\n    this.canvas.addEventListener(\"touchstart\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e.touches[0]);\n    });\n    this.canvas.addEventListener(\"touchmove\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e.touches[0]);\n    });\n\n    // desktop scrub behavior\n    this.canvas.addEventListener(\"mousedown\", (e) => {\n      e.preventDefault();\n      this.jumpToProgress(e);\n      this.mouseDown = true;\n    });\n    this.canvas.addEventListener(\"mousemove\", (e) => {\n      e.preventDefault();\n      if (this.mouseDown) {\n        this.jumpToProgress(e);\n      }\n    });\n    this.canvas.addEventListener(\"mouseup\", (e) => {\n      e.preventDefault();\n      this.mouseDown = false;\n    });\n\n    this.setPresetMarker();\n    window.addEventListener(\"resize\", (e) => {\n      this.setPresetMarker();\n    });\n  }\n\n  setPresetMarker() {\n    if (!this.presetStart || !this.presetMarker) return;\n    const totalWidth = this.canvas.offsetWidth;\n    this.presetPosition = totalWidth * this.presetStart;\n    this.presetMarker.style.left = `${this.presetPosition}px`;\n  }\n\n  setProgress(progress) {\n    this.currentProgress = progress;\n  }\n  getProgress() {\n    return this.currentProgress;\n  }\n\n  jumpToProgress(event, presetProgress) {\n    let progressPercent;\n\n    if (presetProgress) {\n      progressPercent = presetProgress;\n    } else {\n      const domRect = this.canvas.getBoundingClientRect();\n      const totalWidth = domRect.width;\n      const x = event.clientX - domRect.x;\n      progressPercent = x / totalWidth;\n    }\n\n    if (progressPercent < 0 || progressPercent > 1) return;\n    this.setProgress(progressPercent);\n    AudioPlayer.seekProgress(progressPercent);\n  }\n\n  jumpToPresetStart(e) {\n    this.jumpToProgress(e, this.presetStart);\n    e.stopPropagation();\n  }\n\n  drawBackground() {\n    const c = this.canvas.getContext(\"2d\");\n    c.fillStyle = \"#d7e2ed\";\n    c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  render(progress) {\n    if (isNaN(progress)) return;\n\n    this.setProgress(progress);\n\n    this.drawBackground();\n    const c = this.canvas.getContext(\"2d\");\n    c.fillStyle = \"#627c92\";\n    c.fillRect(0, 0, this.canvas.width * progress, this.canvas.height);\n  }\n}\n\nexport default new Progress();\n","import { Howl } from \"howler\";\nimport { gsap } from \"gsap\";\n\nimport store from \"../store\";\nimport * as actions from \"../actions/AudioActions\";\nimport Progress from \"../components/chart/canvas/Progress\";\nimport { changeActiveBpm, setCombo } from \"../actions/ChartActions\";\nimport { getAssetPath } from \"../utils\";\nimport { getCurrentBpm, getCurrentCombo } from \"../utils/engineUtils\";\nimport { GLOBAL_OFFSET } from \"../constants\";\n\nclass AudioPlayer {\n  constructor() {\n    /*\n      Trying to share the same audio source for both song and preview was causing too many\n      issues. Sticking to keeping separate Howl objects for each even if means loading\n      duplicate copies of the same mp3\n    */\n    this.sources = {\n      song: {},\n      preview: {},\n      assistTick: {\n        audio: new Howl({\n          src: getAssetPath(\"sounds/assist_tick.wav\"),\n          // format: [\"wav\"],\n          // html5: true,\n        }),\n      },\n    }; // map of song hash to associated Howl object\n    this.currentSong = null; // hash of current song\n    this.currentPreview = null; // hash of current preview\n\n    this.currentSongId = null; // Howler soundID of current song\n    this.currentPreviewId = null; // Howler soundId of current preview\n\n    // this.updateTimeline = this.updateTimeline.bind(this);\n\n    this.activeView = null; // gets updated whenever active view changes in React\n\n    this.previewFadeTimeout = null; // reference to preview fade setTimeout so it can be cleared\n\n    this.updateTimeline = this.updateTimeline.bind(this);\n    this.updateProgress = this.updateProgress.bind(this);\n    this.audioResyncFrames = 0;\n  }\n\n  getCurrentSong() {\n    return this.sources.song[this.currentSong];\n  }\n  getCurrentPreview() {\n    return this.sources.preview[this.currentPreview];\n  }\n\n  getCurrentTime() {\n    return this.getCurrentSong().audio.seek();\n  }\n\n  // when loading a song file for the first time, save it as two separate Howls:\n  // one for the full song and one for the preview sample\n  storeAudioSource(song, initialProgress = 0) {\n    if (!this.sources.song[song.hash]) {\n      this.setLoadingAudio(true);\n\n      this.sources.song[song.hash] = { title: song.title };\n      this.sources.song[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        onload: () => {\n          // console.log(`AudioPlayer song loaded: ${song.title}`);\n          this.setLoadingAudio(false);\n\n          this.seekProgress(initialProgress);\n        },\n        onloaderror: (id, error, blah) => {\n          alert(`${id};;; ${error};;; ${blah}`);\n        },\n        onplay: () => {\n          this.getCurrentSong().tl.play();\n          this.resync();\n          gsap.ticker.add(this.updateProgress);\n          this.startAnimationLoop();\n          store.dispatch(actions.playChartAudio());\n        },\n        onpause: () => {\n          this.getCurrentSong().tl.pause();\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.pauseChartAudio());\n        },\n        onseek: () => {},\n        onstop: () => {\n          if (this.getCurrentSong().tl) {\n            this.getCurrentSong().tl.restart().pause();\n          }\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n        onend: (spriteId) => {\n          gsap.ticker.remove(this.updateTimeline);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n      });\n\n      this.sources.preview[song.hash] = { title: song.title };\n      this.sources.preview[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        sprite: {\n          sample: [\n            parseFloat((song.sampleStart - 0.12) * 1000),\n            parseFloat(song.sampleLength * 1000),\n          ],\n        },\n        onplay: () => {\n          store.dispatch(actions.playPreviewAudio());\n        },\n        onstop: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n        onend: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n      });\n\n      // console.log(`Added ${song.title} to AudioPlayer.sources`, this.sources);\n    }\n  }\n\n  selectSong(song, initialProgress = 0) {\n    if (this.currentSong) {\n      this.getCurrentSong().audio.stop(this.currentSongId);\n    }\n\n    this.storeAudioSource(song, initialProgress);\n    this.currentSong = song.hash;\n  }\n\n  resync() {\n    // arbitrary number of frames chosen to tell timeline to resync with the audio\n    // because audio playback takes a while to restabilize\n    this.audioResyncFrames = 10;\n    gsap.ticker.add(this.updateTimeline);\n    this.updateProgressOnce();\n  }\n\n  // when audio is played, resync timeline with audio a few times until audio playback\n  // stabilizes, then remove this method from the ticker\n  updateTimeline() {\n    // // for reducing debugging headaches; don't remove\n    // if (!this.getCurrentSong().tl) return;\n\n    // sometimes this will still error on load, just bypass it\n    try {\n      this.getCurrentSong().tl.seek(this.getCurrentTime() + GLOBAL_OFFSET);\n    } catch (err) {}\n\n    this.audioResyncFrames--;\n    if (this.audioResyncFrames <= 0) {\n      // recalculate current bpm (necessary if skipping progress)\n      const currentBpm = getCurrentBpm(this.getCurrentSong().globalParams);\n      store.dispatch(changeActiveBpm(currentBpm));\n      // document.querySelector(\".bpm-value\").textContent = Math.round(currentBpm);\n\n      const currentCombo = getCurrentCombo(this.getCurrentSong());\n      // store.dispatch(setCombo(currentCombo));\n      const comboTemp = document.querySelector(\"#combo-temp .combo-num\");\n      if (comboTemp) comboTemp.textContent = currentCombo;\n\n      gsap.ticker.remove(this.updateTimeline);\n    }\n  }\n\n  seekTime(timestamp) {\n    this.getCurrentSong().audio.seek(timestamp);\n    this.resync();\n  }\n  goBack(ms) {\n    this.seekTime(this.getCurrentTime() - ms * 0.001);\n  }\n  goForward(ms) {\n    this.seekTime(this.getCurrentTime() + ms * 0.001);\n  }\n\n  seekProgress(value) {\n    this.seekTime(value * this.getCurrentSong().audio.duration());\n  }\n\n  // gsap ticker method for regularly updating progress bar, not called manually\n  updateProgress(time, deltaTime, frame) {\n    // detect significant frame skips and resync when it happens\n    if (deltaTime > 60) {\n      // console.log(deltaTime);\n      this.getCurrentSong().tl.seek(this.getCurrentTime() + GLOBAL_OFFSET);\n    }\n    if (frame % 15 === 0) {\n      const audio = this.getCurrentSong().audio;\n      const progress = audio.seek() / audio.duration();\n      // store.dispatch(actions.setChartProgress(progress));\n      Progress.render(progress);\n    }\n  }\n\n  updateProgressOnce() {\n    this.updateProgress(null, null, 0);\n    this.updateAnimationLoopOnce();\n  }\n\n  setTimeline(tl) {\n    this.getCurrentSong().tl = tl;\n  }\n  setGlobalParams(params) {\n    this.getCurrentSong().globalParams = params;\n  }\n\n  play() {\n    this.currentSongId = this.getCurrentSong().audio.play();\n  }\n\n  pause() {\n    this.getCurrentSong().audio.pause(this.currentSongId);\n  }\n\n  stop() {\n    this.getCurrentSong().audio.stop(this.currentSongId);\n    this.seekTime(0);\n    this.currentSongId = null;\n  }\n\n  isPlaying() {\n    return (\n      this.getCurrentSong() &&\n      this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n  isPaused() {\n    return (\n      this.getCurrentSong() &&\n      !this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n\n  playAssistTick() {\n    this.sources.assistTick.audio.play();\n  }\n\n  playSongPreview(song) {\n    if (this.currentPreview) {\n      this.getCurrentPreview().audio.stop(this.currentPreviewId);\n    }\n\n    this.storeAudioSource(song);\n    this.currentPreview = song.hash;\n\n    const preview = this.getCurrentPreview().audio;\n\n    this.currentPreviewId = preview.play(\"sample\");\n\n    preview.on(\"play\", () => {\n      const preview = this.getCurrentPreview().audio;\n\n      const fadeinTime = 200;\n      const fadeoutTime = 2000;\n      preview.fade(0, 1, fadeinTime);\n\n      this.previewFadeTimeout = setTimeout(() => {\n        preview.fade(1, 0, fadeoutTime);\n      }, song.sampleLength * 1000 - fadeoutTime);\n    });\n  }\n\n  stopSongPreview() {\n    if (!this.currentPreview) return;\n    const preview = this.getCurrentPreview().audio;\n\n    preview.stop(this.currentPreviewId);\n\n    // clearTimeout(this.previewFadeTimeout);\n  }\n\n  isPreviewPlaying() {\n    return (\n      this.getCurrentPreview() &&\n      this.getCurrentPreview().audio.playing(this.currentPreviewId)\n    );\n  }\n}\n\nexport default new AudioPlayer();\n","import { gsap } from \"gsap\";\n\nimport Arrow from \"../components/chart/canvas/Arrow\";\nimport ShockArrow from \"../components/chart/canvas/ShockArrow\";\nimport StepZone from \"../components/chart/canvas/StepZone\";\nimport Guidelines from \"../components/chart/canvas/Guidelines\";\nimport TargetFlash from \"../components/chart/canvas/TargetFlash\";\nimport parseSimfile from \"../utils/parseSimfile\";\nimport { applyTurnMods } from \"../utils/engineUtils\";\nimport {\n  GLOBAL_OFFSET,\n  END_EXTRA_BEATS,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../constants\";\nimport AudioPlayer from \"./AudioPlayer\";\nimport store from \"../store\";\nimport * as actions from \"../actions/ChartActions\";\n\nclass GameEngine {\n  constructor(canvas, sm, simfileType = \"sm\") {\n    const self = this;\n    this.canvas = canvas;\n    this.c = canvas.getContext(\"2d\");\n    this.tl = gsap.timeline();\n    this.sm = sm;\n    this.simfiles = {};\n\n    this.eventList = [];\n    this.arrows = [];\n    this.shockArrows = [];\n    this.allArrows = [];\n\n    this.mainLoopRequestRef = null;\n\n    this.drawBackground();\n\n    this.globalParams = {\n      /*\n        Use this parameter to keep track of which beat the chart is on at any given point.\n        Animate this one property in the timeline, then reference its value to calculate frames\n        for step zone and arrow animations without having to create separate tweens for them.\n      */\n      beatTick: 0,\n\n      /*\n        Use this parameter for animations based on absolute frame and not a function of the beat.\n      */\n      frame: 0,\n\n      combo: 0,\n      bpmChangeQueue: [], // this is the one that is used\n\n      arrows: self.allArrows,\n      targetFlashes: {},\n    };\n\n    window.targetFlashes = this.globalParams.targetFlashes;\n\n    // init logic\n    if (this.sm) {\n      this.simfiles = parseSimfile(this.sm, simfileType);\n    }\n\n    AudioPlayer.startAnimationLoop = this.startLoop.bind(this);\n    AudioPlayer.stopAnimationLoop = this.stopLoop.bind(this);\n    AudioPlayer.updateAnimationLoopOnce = this.updateLoopOnce.bind(this);\n  }\n\n  startLoop() {\n    this.mainLoopRequestRef = window.requestAnimationFrame(\n      this.mainLoop.bind(this)\n    );\n  }\n  stopLoop() {\n    window.cancelAnimationFrame(this.mainLoopRequestRef);\n  }\n  updateLoopOnce() {\n    window.requestAnimationFrame(this.mainLoop.bind(this, false));\n  }\n\n  // bpm changes and stops converted to timestamps\n  generateEventList(simfile) {\n    const { bpms, stops } = simfile;\n    const eventList = [];\n    let bpmPtr = 0,\n      stopPtr = 0;\n    let currentBpm = bpms[0].value;\n\n    // console.log(\"generateEventList bpms\", bpms);\n    // console.log(\"generateEventList stops\", stops);\n\n    while (bpmPtr < bpms.length && stopPtr < stops.length) {\n      const bpm = bpms[bpmPtr];\n      const stop = stops[stopPtr];\n\n      // bpm changes before stops when they fall on the same beat\n      // // add stop event, keeping track of the bpm at this point\n      // if (bpm.beat <= stop.beat) {\n      //   eventList.push({ ...bpm, type: \"bpm\" });\n      //   currentBpm = bpm.value;\n      //   bpmPtr++;\n      // }\n      // // add bpm event, replacing the currently tracked bpm\n      // else {\n      //   eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n      //   stopPtr++;\n      // }\n\n      // stops before bpm changes when they fall on the same beat\n      // add stop event, keeping track of the bpm at this point\n      if (stop.beat <= bpm.beat) {\n        eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n        stopPtr++;\n      }\n      // add bpm event, replacing the currently tracked bpm\n      else {\n        eventList.push({ ...bpm, type: \"bpm\" });\n        currentBpm = bpm.value;\n        bpmPtr++;\n      }\n    }\n    while (bpmPtr < bpms.length) {\n      eventList.push({ ...bpms[bpmPtr], type: \"bpm\" });\n      bpmPtr++;\n    }\n    while (stopPtr < stops.length) {\n      eventList.push({ ...stops[stopPtr], bpm: currentBpm, type: \"stop\" });\n      stopPtr++;\n    }\n\n    eventList[0].timestamp = 0;\n\n    this.globalParams.bpmChangeQueue = [eventList[0]];\n\n    for (let i = 1; i < eventList.length; i++) {\n      const prevEvent = eventList[i - 1];\n      const currentEvent = eventList[i];\n      const prevTimestamp = eventList[i - 1].timestamp;\n\n      // Find the number of beats elapsed between the current and previous event,\n      // then convert this into seconds using the bpm at the previous event.\n      // If the previous event was a stop, add the length of the stop.\n      // The timestamp of the current event is this number of seconds after the\n      // timestamp of the previous event.\n      const beatDiff = currentEvent.beat - prevEvent.beat;\n      const prevBpm =\n        prevEvent.type === \"bpm\" ? prevEvent.value : prevEvent.bpm;\n      let timestampDiff = (beatDiff / prevBpm) * 60;\n      if (prevEvent.type === \"stop\") timestampDiff += prevEvent.value;\n      const currentTimestamp = prevTimestamp + timestampDiff;\n\n      currentEvent.timestamp = currentTimestamp;\n\n      if (currentEvent.type === \"bpm\") {\n        this.globalParams.bpmChangeQueue.push(currentEvent);\n      }\n    }\n\n    this.eventList = eventList;\n    return eventList;\n  }\n\n  generateArrows(simfile, mods) {\n    let { chart } = simfile;\n    const mode = store.getState().songSelect.mode;\n\n    if (Array.isArray(chart[0])) {\n      const newChart = [];\n      chart.forEach((measure) => {\n        newChart.push(...measure);\n      });\n      chart = newChart;\n    }\n\n    chart = applyTurnMods(chart, mods, mode);\n\n    chart.forEach((note, key) => {\n      // calculate starting position currentBeatPosition\n      const { measureIdx, measureN, measureD } = note;\n      note.currentBeatPosition = (measureIdx + measureN / measureD) * 4;\n\n      // save its original position for later reference\n      note.originalBeatPosition = note.currentBeatPosition;\n\n      // If the note is the tail of a freeze arrow, calculate the number of beats\n      // from the head of the freeze arrow\n      for (let i = 0; i < note.note.length; i++) {\n        if (note.note[i] !== \"3\") continue;\n\n        // Find the most recent freeze head on the same direction as the tail\n        // and retroactively fill in the length of the hold in beats\n        for (let j = key - 1; j >= 0; j--) {\n          if (chart[j].note[i] === \"2\") {\n            if (!chart[j].holdBeats) chart[j].holdBeats = [];\n            if (!note.holdBeats) note.holdBeats = [];\n            chart[j].holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            note.holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            break;\n          }\n        }\n      }\n    });\n\n    chart.forEach((note, key) => {\n      if (note.note[0] === \"M\" || note.note[4] === \"M\") {\n        const shockArrow = new ShockArrow({ key, ...note, mods });\n        this.shockArrows.push(shockArrow);\n        this.allArrows.push(shockArrow);\n      }\n      if (\n        note.note.includes(\"1\") ||\n        note.note.includes(\"2\") ||\n        note.note.includes(\"3\")\n      ) {\n        const arrow = new Arrow({ key, ...note, mods });\n        this.arrows.push(arrow);\n        this.allArrows.push(arrow);\n      }\n    });\n\n    this.stepZone = new StepZone();\n\n    // console.log(`chart for ${simfile.difficulty}`, chart);\n  }\n\n  // Calculate the gsap tweens before playing the chart\n  initTimeline(mods) {\n    this.resetArrows();\n\n    // console.log(`this.allArrows.length: ${this.allArrows.length}`);\n\n    /*\n      The space in between each event (i.e. a bpm change or stop) denotes a continous section of constant bpm.\n      Create a tween to animate the global beat tick for each of these sections and chain them together.\n      The position and/or frame animation of each canvas object (e.g. arrows, step zone, guidelines) can be\n      determined as a function of the beat tick value at any given point.\n    */\n    let bpm;\n\n    let accumulatedBeatTick = 0;\n\n    // Designate the \"end\" of the chart as an arbitrary number of beats (8?) after either the last arrow\n    // or the last event in the chart, whichever comes later\n    const lastArrow = this.arrows[this.arrows.length - 1];\n    const lastEvent = this.eventList[this.eventList.length - 1];\n\n    let finalBeat = 0;\n    if (lastArrow && lastEvent) {\n      finalBeat = Math.max(lastArrow.originalBeatPosition, lastEvent.beat);\n    } else if (lastArrow) {\n      finalBeat = lastArrow.originalBeatPosition;\n    } else if (lastEvent) {\n      finalBeat = lastEvent.beat;\n    }\n    finalBeat += END_EXTRA_BEATS;\n\n    // // hack to implement global offset of -12 ms\n    // this.tl = this.tl.to({}, { duration: 0 }, GLOBAL_OFFSET);\n\n    for (let i = 0; i < this.eventList.length; i++) {\n      let startEvent = this.eventList[i],\n        endEvent = this.eventList[i + 1];\n\n      // delay the animations by the length of the stop, if applicable\n      let delay = startEvent.type === \"stop\" ? startEvent.value : 0;\n\n      // the bpm of this section\n      if (startEvent.type === \"bpm\") bpm = startEvent.value;\n      else if (startEvent.type === \"stop\") bpm = startEvent.bpm;\n\n      // if there is a bpm change or stop event somewhere ahead of this one\n      if (endEvent) {\n        // number of beats between startEvent and endEvent, i.e. how long this constant bpm section is\n        const sectionBeatLength = endEvent.beat - startEvent.beat;\n\n        // the duration of this constant bpm section in seconds\n        const sectionDuration = (sectionBeatLength / bpm) * 60;\n\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: accumulatedBeatTick + sectionBeatLength,\n            duration: sectionDuration,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n        accumulatedBeatTick += sectionBeatLength;\n      }\n      // if this is the last bpm change/stop event, animate remaining objects to end\n      else {\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: finalBeat,\n            duration: ((finalBeat - accumulatedBeatTick) / bpm) * 60,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n      }\n    }\n\n    // note events (combo, assist tick, target flash)\n    // console.log(\"eventList\", this.eventList);\n    const bpmChangeQueue = this.globalParams.bpmChangeQueue;\n    // console.log(\"bpmChangeQueue\", bpmChangeQueue);\n\n    // subset of arrows that specifically count for combo (e.g. excluding ends of freeze arrows)\n    this.comboArrows = [];\n\n    let currentBpmPtr = -1,\n      currentEventPtr = 0,\n      pendingStopPtr = -1,\n      currentBpm = null,\n      pendingStop = null,\n      currentStopOffset = 0,\n      currentCombo = 0;\n    this.allArrows.forEach((arrow, idx) => {\n      // Find the latest bpm section that starts before this note\n      while (\n        currentBpmPtr < bpmChangeQueue.length - 1 &&\n        bpmChangeQueue[currentBpmPtr + 1].beat < arrow.originalBeatPosition\n      ) {\n        // if this block was entered, a new bpm section was entered\n        currentBpmPtr++;\n        const bpmSection = bpmChangeQueue[currentBpmPtr];\n        currentBpm = bpmSection.value;\n\n        // reset the accumulated stop time\n        currentStopOffset = 0;\n\n        // find the index of this bpm section in the eventList and use it as a starting point\n        // for keeping track of stops\n        for (let i = currentEventPtr; i < this.eventList.length; i++) {\n          const event = this.eventList[i];\n          if (event.beat === bpmSection.beat && event.type === \"bpm\") {\n            currentEventPtr = i;\n            const nextEvent = this.eventList[i + 1];\n            if (nextEvent && nextEvent.type === \"stop\") {\n              pendingStopPtr = i + 1;\n              pendingStop = this.eventList[pendingStopPtr];\n            } else {\n              pendingStop = null;\n            }\n            break;\n          }\n        }\n      }\n\n      // Accumulate total time of any stops that exist in this bpm section before this note.\n      // Keep track of the next pending stop so it can be added to the total stop time as soon as\n      // the first arrow following it is reached\n      while (pendingStop && pendingStop.beat < arrow.originalBeatPosition) {\n        currentStopOffset += pendingStop.value;\n        const nextEvent = this.eventList[pendingStopPtr + 1];\n        if (nextEvent && nextEvent.type === \"stop\") {\n          pendingStopPtr++;\n        } else {\n          pendingStopPtr = -1;\n        }\n        pendingStop = this.eventList[pendingStopPtr];\n      }\n\n      const bpmSectionStartBeat = bpmChangeQueue[currentBpmPtr].beat;\n      const bpmSectionStartTime = bpmChangeQueue[currentBpmPtr].timestamp;\n\n      const beatDiff = arrow.originalBeatPosition - bpmSectionStartBeat;\n      const timeDiff = beatDiff * (60 / currentBpm);\n      const arrowTimestamp = bpmSectionStartTime + timeDiff + currentStopOffset;\n\n      // combo arrows (includes regular notes and freeze heads)\n      if (\n        arrow.note.includes(\"1\") ||\n        arrow.note.includes(\"2\") ||\n        arrow.note.includes(\"M\")\n      ) {\n        currentCombo++;\n        arrow.combo = currentCombo;\n        arrow.timestamp = arrowTimestamp;\n\n        this.comboArrows.push(arrow);\n\n        const comboTemp = document.querySelector(\"#combo-temp .combo-num\");\n\n        this.tl.set(\n          this.globalParams,\n          {\n            combo: arrow.combo,\n            onStart: () => {\n              // store.dispatch(actions.setCombo(arrow.combo));\n              comboTemp.textContent = arrow.combo;\n\n              if (arrow instanceof Arrow) {\n                // AudioPlayer.playAssistTick();\n                // console.log(arrow);\n                this.globalParams.targetFlashes[\n                  arrow.originalBeatPosition\n                ] = new TargetFlash(arrow);\n              }\n            },\n          },\n          arrowTimestamp - 0.008\n        );\n      }\n      // freeze ends that are not simultaneous with combo arrows\n      else if (arrow.note.includes(\"3\")) {\n        this.tl.set(\n          this.globalParams,\n          {\n            onStart: () => {\n              this.globalParams.targetFlashes[\n                arrow.originalBeatPosition\n              ] = new TargetFlash(arrow);\n            },\n          },\n          arrowTimestamp - 0.008\n        );\n      }\n    });\n\n    this.guidelines = new Guidelines({ mods, finalBeat });\n    AudioPlayer.setTimeline(this.tl);\n    AudioPlayer.setGlobalParams(this.globalParams);\n\n    this.updateLoopOnce();\n  }\n\n  resetArrows() {\n    this.arrows.forEach((arrow) => arrow.reset());\n  }\n\n  mainLoop(loop = true) {\n    // console.log(\"mainLoop running\");\n    this.drawBackground();\n\n    const mode = store.getState().songSelect.mode;\n\n    if (this.stepZone) {\n      this.stepZone.render(this.canvas, this.globalParams.beatTick, mode);\n    }\n    if (this.guidelines) {\n      this.guidelines.render(this.canvas, this.globalParams.beatTick);\n    }\n\n    for (let i = this.shockArrows.length - 1; i >= 0; i--) {\n      const shockArrow = this.shockArrows[i];\n      shockArrow.render(\n        this.canvas,\n        this.globalParams.frame,\n        this.globalParams.beatTick\n      );\n    }\n\n    // render arrows in the opposite order so the earlier arrows are layered over the later ones\n    // Up arrow is the exception: later arrows are layered over the earlier ones\n\n    const upArrows = mode === \"double\" ? [2, 6] : [2];\n    const notUpArrows = mode === \"double\" ? [0, 1, 3, 4, 5, 7] : [0, 1, 3];\n\n    // draw freeze bodies first because they need to be at the bottom layer\n    for (let i = this.arrows.length - 1; i >= 0; i--) {\n      const arrow = this.arrows[i];\n      notUpArrows.forEach((directionIdx) => {\n        arrow.renderFreezeBody(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n    for (let i = 0; i < this.arrows.length; i++) {\n      const arrow = this.arrows[i];\n      upArrows.forEach((directionIdx) => {\n        arrow.renderFreezeBody(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n\n    // then draw the arrow heads over the freeze bodies\n    for (let i = this.arrows.length - 1; i >= 0; i--) {\n      const arrow = this.arrows[i];\n      notUpArrows.forEach((directionIdx) => {\n        arrow.renderArrow(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n    for (let i = 0; i < this.arrows.length; i++) {\n      const arrow = this.arrows[i];\n      upArrows.forEach((directionIdx) => {\n        arrow.renderArrow(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n\n    // target flashes\n    for (let beatStamp in this.globalParams.targetFlashes) {\n      const targetFlash = this.globalParams.targetFlashes[beatStamp];\n      targetFlash.frame++;\n      if (targetFlash.frame > MARVELOUS_FLASH_FRAMES) {\n        delete this.globalParams.targetFlashes[beatStamp];\n      } else {\n        targetFlash.render(this.canvas);\n      }\n    }\n\n    // if (this.globalParams.beatTick) {\n    //   console.log(this.globalParams.beatTick);\n    // }\n    this.globalParams.frame++;\n\n    if (loop) {\n      this.mainLoopRequestRef = window.requestAnimationFrame(\n        this.mainLoop.bind(this)\n      );\n    }\n  }\n\n  drawBackground() {\n    this.c.fillStyle = \"black\";\n    this.c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  toggleTl() {\n    if (this.tl.paused()) {\n      console.log(\"tl.play()\");\n      this.tl.play();\n    } else {\n      console.log(\"tl.pause()\");\n      this.tl.pause();\n    }\n  }\n  restartTl() {\n    // console.log(\"call restart\");\n    this.tl.restart().pause();\n    this.resetArrows();\n  }\n  pauseTl() {\n    this.tl.pause();\n  }\n}\n\nexport default GameEngine;\n","import React, { useEffect, useRef } from \"react\";\nimport { Button } from \"semantic-ui-react\";\n\nconst HoldButton = (props) => {\n  const button = useRef();\n  const requestRef = useRef();\n\n  useEffect(() => {\n    const el = button.current.ref.current;\n    el.addEventListener(\"mousedown\", pressingDown, false);\n    el.addEventListener(\"mouseup\", notPressingDown, false);\n    el.addEventListener(\"mouseleave\", notPressingDown, false);\n\n    el.addEventListener(\"touchstart\", pressingDown, false);\n    el.addEventListener(\"touchend\", notPressingDown, false);\n  }, []);\n\n  const pressingDown = (e) => {\n    e.preventDefault();\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  const notPressingDown = (e) => {\n    cancelAnimationFrame(requestRef.current);\n  };\n\n  const handleHold = () => {\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  return (\n    <Button {...props} ref={button}>\n      {props.children}\n    </Button>\n  );\n};\n\nexport default HoldButton;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Modal, Button, Input } from \"semantic-ui-react\";\nimport copy from \"copy-to-clipboard\";\n\nimport { getOriginPath } from \"../../utils\";\nimport Progress from \"./canvas/Progress\";\n\nconst difficulties = {\n  Beginner: \"b\",\n  Basic: \"B\",\n  Difficult: \"D\",\n  Expert: \"E\",\n  Challenge: \"C\",\n};\n\nconst modes = {\n  single: \"S\",\n  double: \"D\",\n};\n\nconst ShareModal = (props) => {\n  const { modalOpen, setModalOpen, data } = props;\n  const { song, difficulty, mode, mods } = data;\n\n  const shareUrl = useRef();\n  const [message, setMessage] = useState(\"\");\n\n  useEffect(() => {\n    if (modalOpen === false) {\n      setMessage(\"\");\n    }\n  }, [modalOpen]);\n\n  if (!song) return null;\n\n  // console.log(\"ShareModal data\", data);\n\n  const generateShareUrl = () => {\n    const progress = Progress.getProgress();\n\n    const params = {\n      song: song.hash,\n      difficulty: difficulties[difficulty] + modes[mode] + \"P\",\n      turn: mods.turn !== \"off\" ? mods.turn : \"\",\n      speed: mods.speed.toString().replace(\".\", \"\"),\n      progress: parseInt(progress * 100000),\n    };\n\n    const queryStr = Object.keys(params)\n      .map((param) => {\n        if (params[param] === null || typeof params[param] === \"undefined\") {\n          return null;\n        }\n        return `${param}=${params[param]}`;\n      })\n      .filter((param) => param !== null)\n      .join(\"&\");\n\n    return getOriginPath() + \"?\" + queryStr;\n  };\n  shareUrl.current = generateShareUrl();\n\n  const copyShareUrl = () => {\n    copy(shareUrl.current);\n    setMessage(\"Copied link to clipboard\");\n  };\n\n  return (\n    <Modal\n      className=\"shareModal\"\n      size=\"fullscreen\"\n      open={modalOpen}\n      onClose={() => setModalOpen(false)}\n    >\n      <Modal.Header>Share link to chart</Modal.Header>\n      <Modal.Content>\n        <Input\n          type=\"text\"\n          className=\"share-url-input\"\n          value={shareUrl.current}\n          action\n        >\n          <input />\n          <Button onClick={copyShareUrl}>Copy</Button>\n        </Input>\n        <p>{message}</p>\n      </Modal.Content>\n    </Modal>\n  );\n};\n\nexport default ShareModal;\n","import React from \"react\";\nimport { connect } from \"react-redux\";\nimport { Button, Icon } from \"semantic-ui-react\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport HoldButton from \"../ui/HoldButton\";\n\nconst PlayControls = (props) => {\n  const { audio, controlsDisabled, setShareModalOpen } = props;\n\n  const togglePlay = () => {\n    if (controlsDisabled) return;\n    if (props.audio.status === \"playing\") {\n      AudioPlayer.pause();\n    } else {\n      AudioPlayer.play();\n    }\n  };\n\n  const restart = () => {\n    if (controlsDisabled) return;\n    AudioPlayer.stop();\n  };\n\n  return (\n    <div className=\"play-controls\">\n      <HoldButton\n        onClick={() => AudioPlayer.goBack(20)}\n        // disabled={audio.progress === 0}\n        className=\"play-control\"\n      >\n        <Icon name=\"backward\" />\n      </HoldButton>\n      <Button\n        onClick={togglePlay}\n        disabled={controlsDisabled}\n        className=\"play-control\"\n      >\n        <Icon name={audio.status === \"playing\" ? \"pause\" : \"play\"} />\n      </Button>\n      <Button onClick={restart} className=\"play-control\">\n        <Icon name=\"stop\" />\n      </Button>\n      <HoldButton\n        onClick={() => AudioPlayer.goForward(20)}\n        className=\"play-control\"\n      >\n        <Icon name=\"forward\" />\n      </HoldButton>\n\n      <Button\n        onClick={() => setShareModalOpen(true)}\n        className=\"play-control share-btn\"\n        disabled={audio.status === \"playing\"}\n      >\n        <Icon name=\"share square\" />\n      </Button>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  return { audio: audio.chartAudio };\n};\n\nexport default connect(mapStateToProps, null)(PlayControls);\n","import React from \"react\";\nimport { connect } from \"react-redux\";\n\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\n\n// displays song information on the chart view\nconst SongInfo = (props) => {\n  const { chart, selectedSong, selectedDifficulty, selectedMode } = props;\n  return (\n    <>\n      <div className=\"song-information\">\n        {selectedSong && (\n          <>\n            <div className=\"song-title\">{selectedSong.title}</div>\n            <div className=\"song-artist\">{selectedSong.artist}</div>\n          </>\n        )}\n      </div>\n      <div className=\"bpm-information\">\n        <div className=\"bpm-header\">BPM</div>\n        <div className=\"bpm-value\">{chart.activeBpm}</div>\n      </div>\n      <div className=\"level-information\">\n        {selectedSong && (\n          <>\n            <div className=\"song-difficulty\">{selectedDifficulty}</div>\n            <div className=\"song-level\">\n              {\n                selectedSong.levels[\n                  selectedMode === \"double\"\n                    ? DP_DIFFICULTIES.indexOf(selectedDifficulty) + 5\n                    : SP_DIFFICULTIES.indexOf(selectedDifficulty)\n                ]\n              }\n            </div>\n          </>\n        )}\n      </div>\n    </>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { chart, songSelect } = state;\n  return {\n    chart,\n    selectedSong: songSelect.song,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n  };\n};\n\nexport default connect(mapStateToProps, null)(SongInfo);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Icon, Modal } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\nimport \"inobounce\";\n\nimport { presetParams, getJacketPath } from \"../../utils\";\nimport { usePrevious } from \"../../hooks\";\n// import loadStore from '../../utils/loadStore';\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\nimport GameEngine from \"../../core/GameEngine\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport HoldButton from \"../ui/HoldButton\";\nimport ShareModal from \"./ShareModal\";\nimport Progress from \"./canvas/Progress\";\nimport PlayControls from \"./PlayControls\";\nimport SongInfo from \"./SongInfo\";\n\nconst ChartArea = (props) => {\n  const {\n    selectedDifficulty,\n    selectedMode,\n    selectedSong,\n    sm,\n    chart,\n    mods,\n    screen,\n    loadingAudio,\n    gameEngine,\n    setGameEngine,\n  } = props;\n\n  const [canvas, setCanvas] = useState(null);\n  const [shareModalOpen, setShareModalOpen] = useState(false);\n  const chartArea = useRef();\n  const canvasWrapper = useRef();\n  const chartLoadingScreen = useRef();\n\n  const prevState = usePrevious({\n    canvas,\n    sm,\n    selectedDifficulty,\n    selectedMode,\n    mods,\n  });\n\n  // define canvas and resize listener on mount\n  useEffect(() => {\n    if (!loadingAudio) {\n      chartArea.current = document.querySelector(\"#chartArea\");\n      setCanvas(chartArea.current);\n\n      Progress.initCanvas();\n    }\n  }, [loadingAudio]);\n\n  // change chart dimensions depending on single or double\n  // Hardcoded heights for now. Variable heights may be possible in the future\n  useEffect(() => {\n    if (!canvas || !canvasWrapper.current) return;\n    resizeChartArea();\n  }, [canvas, selectedMode, screen]);\n\n  const resizeChartArea = () => {\n    if (selectedMode === \"single\") {\n      chartArea.current.width = 256;\n      chartArea.current.style.transform = \"none\";\n      chartArea.current.style.position = \"relative\";\n      chartArea.current.style.left = 0;\n      chartArea.current.style.top = 0;\n    } else if (selectedMode === \"double\") {\n      chartArea.current.width = 512;\n\n      const wrapper = canvasWrapper.current.getBoundingClientRect();\n\n      if (wrapper.width < 512) {\n        const scaleFactor = wrapper.width / chartArea.current.width;\n        const xOffset = (chartArea.current.width - wrapper.width) / 2;\n        const yOffset = xOffset * (7 / 8);\n        chartArea.current.style.transform = `scale(${scaleFactor})`;\n        chartArea.current.style.position = \"absolute\";\n        chartArea.current.style.left = `-${xOffset}px`;\n        chartArea.current.style.top = `-${yOffset}px`;\n      } else {\n        chartArea.current.style.transform = \"none\";\n        chartArea.current.style.position = \"relative\";\n        chartArea.current.style.left = 0;\n        chartArea.current.style.top = 0;\n      }\n    }\n\n    if (gameEngine) {\n      gameEngine.updateLoopOnce();\n    }\n  };\n\n  // reset chart if song, difficulty, or mods change\n  useEffect(() => {\n    const currentState = { canvas, sm, selectedDifficulty, selectedMode, mods };\n    Object.keys(currentState).forEach((thing) => {\n      if (prevState[thing] !== currentState[thing]) {\n        if (thing === \"sm\") {\n          // console.log(\n          //   `${thing} changed from ${\n          //     prevState[thing]\n          //       ? prevState[thing].slice(0, 100)\n          //       : prevState[thing]\n          //   } \\n\\nto ${currentState[thing].slice(0, 100)}`\n          // );\n        } else {\n          // console.log(`${thing} changed`);\n          // console.log(\n          //   `${thing} changed from ${prevState[thing]} to ${currentState[thing]}`\n          // );\n        }\n\n        // console.log(\n        //   `${thing} changed from ${prevState[thing]} to ${currentState[thing]}`\n        // );\n      }\n    });\n\n    if (!canvas) return;\n\n    const simfileType = selectedSong.useSsc ? \"ssc\" : \"sm\";\n\n    let ge = new GameEngine(canvas, sm, simfileType);\n\n    if (!selectedDifficulty) return;\n\n    const simfile = ge.simfiles[`${selectedMode}_${selectedDifficulty}`];\n\n    if (simfile) {\n      ge.generateEventList(simfile);\n      ge.generateArrows(simfile, mods);\n      ge.initTimeline(mods);\n      ge.restartTl();\n      AudioPlayer.resync();\n    }\n    setGameEngine(ge);\n  }, [canvas, sm, selectedDifficulty, selectedMode, mods]);\n\n  const shareParams = {\n    song: selectedSong,\n    difficulty: selectedDifficulty,\n    mode: selectedMode,\n    mods,\n  };\n\n  return (\n    <div className=\"canvas-container\">\n      {loadingAudio && (\n        <div className={`canvas-wrapper`} ref={chartLoadingScreen}>\n          <div className={`chart-loading-screen ${selectedMode}`}>\n            <img\n              className=\"chart-loading-jacket\"\n              src={getJacketPath(`${selectedSong.hash}.png`)}\n            />\n            <div className=\"chart-loading-message\">Loading chart...</div>\n          </div>\n        </div>\n      )}\n      {!loadingAudio && (\n        <>\n          <div className={`canvas-wrapper ${selectedMode}`} ref={canvasWrapper}>\n            <canvas id=\"chartArea\" width=\"256\" height=\"448\" />\n            <div id=\"combo-temp\">\n              <div>Combo</div>\n              <div className=\"combo-num\"></div>\n            </div>\n          </div>\n          <div className=\"progress-container\">\n            <div className=\"progress-wrapper\">\n              <canvas id=\"progress\" />\n              {presetParams.progress ? (\n                <div\n                  className=\"preset-marker-wrapper\"\n                  onClick={Progress.jumpToPresetStart.bind(Progress)}\n                  onTouchStart={Progress.jumpToPresetStart.bind(Progress)}\n                >\n                  <div className=\"preset-marker\" />\n                </div>\n              ) : null}\n            </div>\n          </div>\n        </>\n      )}\n      {/* <canvas id=\"chartArea\" width=\"256\" height=\"18000\" /> */}\n      <div className=\"row\">\n        <PlayControls\n          controlsDisabled={!gameEngine || loadingAudio}\n          setShareModalOpen={setShareModalOpen}\n        />\n      </div>\n      <div className=\"row\">\n        <SongInfo />\n      </div>\n      <ShareModal\n        modalOpen={shareModalOpen}\n        setModalOpen={setShareModalOpen}\n        data={shareParams}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect, screen } = state;\n  return {\n    mods,\n    selectedSong: songSelect.song,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n    screen,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChartArea);\n","import { useEffect, useRef } from \"react\";\n\nexport const usePrevious = (value) => {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current || value;\n};\n","import { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../constants\";\n\n/*\n  If the song does not have a chart corresponding to the chosen difficulty option,\n  pick whatever is *closest*\n  - If Difficult, Expert, or Challenge is the chosen option, start from Challenge and\n    work your way down until the first available difficulty is reached.\n  - If Beginner or Basic is the chosen option, start from Beginner and work up.\n  The closest available difficulty will be chosen for the song without affecting the\n  difficulty option selected for the form, like the way it works in the real game\n*/\nexport const getClosestDifficulty = (song, difficulty, mode) => {\n  const difficulties = mode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n  const levels =\n    mode === \"double\" ? song.levels.slice(5, 9) : song.levels.slice(0, 5);\n\n  if ([\"Difficult\", \"Expert\", \"Challenge\"].includes(difficulty)) {\n    for (let i = difficulties.length - 1; i >= 0; i--) {\n      if (levels[i]) {\n        return difficulties[i];\n      }\n    }\n  } else if ([\"Beginner\", \"Basic\"].includes(difficulty)) {\n    for (let i = 0; i <= difficulties.length - 1; i++) {\n      if (levels[i]) {\n        return difficulties[i];\n      }\n    }\n  }\n};\n","import React from \"react\";\n\nimport { getJacketPath } from \"../../utils\";\nimport { SP_DIFFICULTIES } from \"../../constants\";\nimport { getClosestDifficulty } from \"../../utils/songUtils\";\n\nconst SongGrid = (props) => {\n  const {\n    displayedSongs,\n    onSongSelect,\n    selectedSongOption,\n    selectedMode,\n    selectedDifficultyOption,\n    selectedFilters,\n  } = props;\n\n  let songs = displayedSongs;\n\n  const selectSong = (song) => {\n    onSongSelect(null, { value: song.hash });\n  };\n\n  const renderSongLevel = (song) => {\n    let levels = [];\n    if (selectedMode === \"single\") levels = song.levels.slice(0, 5);\n    else if (selectedMode === \"double\")\n      levels = [null, ...song.levels.slice(5, 9)];\n\n    const levelFilter = selectedFilters.level;\n    const difficultyFilter = selectedFilters.difficulty;\n\n    // If neither level nor difficulty are being filtered, show the chosen difficulty option or whatever is closest\n    if (difficultyFilter === \"all\" && levelFilter === \"all\") {\n      const displayedLevels = [null, null, null, null, null];\n      const difficultyIdx = SP_DIFFICULTIES.indexOf(selectedDifficultyOption);\n      if (levels[difficultyIdx]) {\n        displayedLevels[difficultyIdx] = levels[difficultyIdx];\n      } else {\n        const closestDiff = getClosestDifficulty(\n          song,\n          selectedDifficultyOption,\n          selectedMode\n        );\n        const closestDiffIdx = SP_DIFFICULTIES.indexOf(closestDiff);\n        displayedLevels[closestDiffIdx] = levels[closestDiffIdx];\n      }\n      levels = displayedLevels;\n    } else {\n      levels.forEach((level, i) => {\n        if (!level) return;\n        const difficulty = SP_DIFFICULTIES[i];\n        // If level is chosen but difficulty is not, show all difficulties that match the level\n        if (difficultyFilter === \"all\") {\n          if (level !== levelFilter) levels[i] = null;\n        }\n        // If level is not chosen but difficulty is, show the filtered difficulty only\n        // If both level and difficulty are chosen, show the filtered difficulty only\n        else {\n          if (difficulty !== difficultyFilter) levels[i] = null;\n        }\n      });\n    }\n\n    return levels.map((level, i) => {\n      if (!level) return null;\n      const difficulty = SP_DIFFICULTIES[i];\n      return (\n        <div\n          key={`${song.hash}_${difficulty}`}\n          className={`song-level ${difficulty}`}\n        >\n          {level}\n        </div>\n      );\n    });\n  };\n\n  const renderSong = (song) => {\n    return (\n      <div\n        className=\"songTile-wrapper\"\n        key={`songtile_${song.hash}`}\n        onClick={() => selectSong(song)}\n      >\n        <div\n          className={`songTile ${\n            selectedSongOption === song.hash ? \"selected\" : \"\"\n          }`}\n        >\n          <div className=\"song-jacket-wrapper\">\n            <img\n              className=\"song-jacket\"\n              src={getJacketPath(`${song.hash}.png`)}\n              title={song.title}\n              alt={song.title}\n            />\n          </div>\n          <div className=\"song-level-wrapper\">{renderSongLevel(song)}</div>\n          <div className=\"song-title-bar\">{song.title}</div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"songGrid\">\n      {songs.map((song) => {\n        return renderSong(song);\n      })}\n    </div>\n  );\n};\n\nexport default SongGrid;\n","const loadStore = {\n  lastRequestedSong: null, // storing song title rn for easier debugging, change to hash\n  lastRequestedSongLoaded: false,\n};\nexport default loadStore;\n","import React from \"react\";\n\nconst ToggleSwitch = (props) => {\n  const { option1, option2, value } = props;\n\n  const toggleChange = () => {\n    if (!option1 || !option2) return;\n\n    if (value === option1.value) {\n      props.onChange(option2.value);\n    } else if (value === option2.value) {\n      props.onChange(option1.value);\n    }\n\n    // default to option 1 if uninitialized\n    else {\n      props.onChange(option1.value);\n    }\n  };\n\n  const selectOption = (option) => {\n    if (!option || typeof option.value === \"undefined\") return;\n    props.onChange(option.value);\n  };\n\n  const getSwitchClassName = () => {\n    let className = \"toggleSwitch\";\n    if (value === option1.value) className += ` left`;\n    else if (value === option2.value) className += ` right`;\n    return className;\n  };\n\n  return (\n    <div className=\"toggleSwitch-wrapper\">\n      <label\n        className={`toggleSwitch-option1 ${\n          value === option1.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option1)}\n      >\n        {option1.text}\n      </label>\n      <div className={getSwitchClassName()} onClick={toggleChange}></div>\n      <label\n        className={`toggleSwitch-option2 ${\n          value === option2.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option2)}\n      >\n        {option2.text}\n      </label>\n    </div>\n  );\n};\n\nexport default ToggleSwitch;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_1\",\n  \"data-name\": \"Line 1\",\n  d: \"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_2\",\n  \"data-name\": \"Line 2\",\n  d: \"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_3\",\n  \"data-name\": \"Line 3\",\n  d: \"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z\"\n});\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_4\",\n  \"data-name\": \"Line 4\",\n  d: \"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z\"\n});\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_5\",\n  \"data-name\": \"Line 5\",\n  d: \"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z\"\n});\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_6\",\n  \"data-name\": \"Line 6\",\n  d: \"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z\"\n});\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_7\",\n  \"data-name\": \"Line 7\",\n  d: \"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z\"\n});\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_8\",\n  \"data-name\": \"Line 8\",\n  d: \"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z\"\n});\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_9\",\n  \"data-name\": \"Line 9\",\n  d: \"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z\"\n});\n\nvar SvgAudiowave = function SvgAudiowave(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"audioWave\",\n    \"data-name\": \"Layer 1\",\n    viewBox: \"0 0 50 38.05\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgAudiowave, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/audiowave.e48c060f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef } from \"react\";\nimport { Dropdown } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport * as actions from \"../../actions/SongSelectActions\";\nimport SongGrid from \"./SongGrid\";\nimport { getJacketPath, presetParams } from \"../../utils\";\nimport { getClosestDifficulty } from \"../../utils/songUtils\";\nimport loadStore from \"../../utils/loadStore\";\nimport ToggleSwitch from \"../ui/ToggleSwitch\";\nimport {\n  SP_DIFFICULTIES,\n  DP_DIFFICULTIES,\n  TITLE_CATEGORIES,\n  LEVELS,\n  DDR_VERSIONS,\n} from \"../../constants\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { ReactComponent as AudioWave } from \"../../svg/audiowave.svg\";\n\nconst titleSortOptions = [\n  { key: \"title_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  TITLE_CATEGORIES.map((letter) => {\n    return { key: `title_${letter}`, value: letter, text: letter };\n  })\n);\n\nconst versionSortOptions = [\n  { key: \"version_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  DDR_VERSIONS.map((versionName, idx) => {\n    return { key: `version_${idx}`, value: idx, text: versionName };\n  }).reverse()\n);\n\nconst levelSortOptions = [\n  { key: \"level_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  LEVELS.map((level) => {\n    return { key: `level_${level}`, value: level, text: level };\n  })\n);\n\nconst difficultySortOptions = [\n  { key: \"difficulty_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  SP_DIFFICULTIES.map((difficulty) => {\n    return {\n      key: `difficulty_${difficulty}`,\n      value: difficulty,\n      text: difficulty,\n    };\n  })\n);\n\nconst SongForm = (props) => {\n  const {\n    activeView,\n    simfileList,\n    selectedDifficulty,\n    selectedMode,\n    previewAudio,\n  } = props;\n  const songGridContainer = useRef();\n\n  const simfileOptions = simfileList.map((song) => {\n    return { key: song.hash, value: song.hash, text: song.title };\n  });\n\n  const [selectedSongOption, setSelectedSongOption] = useState(null);\n  const [selectedDifficultyOption, setSelectedDifficultyOption] = useState(\n    selectedDifficulty\n  );\n\n  const [selectedFilters, setSelectedFilters] = useState({\n    title: \"all\",\n    version: 15,\n    level: \"all\",\n    difficulty: \"all\",\n    // level: 10,\n  });\n\n  const [displayedSongs, setDisplayedSongs] = useState([]);\n\n  // on filter or mode change\n  useEffect(() => {\n    const { title, version, level, difficulty } = selectedFilters;\n\n    const songs = simfileList\n      .filter((song) => {\n        const singleDiffs = song.levels.slice(0, 5);\n        const doubleDiffs = song.levels.slice(5, 9);\n        return (\n          // song matches title filter\n          (title === \"all\" || title === song.abcSort) &&\n          // song matches version filter\n          (version === \"all\" || version === parseInt(song.version)) &&\n          // if a level filter is selected, song matches level filter\n          // if level is not being filtered, song has at least one chart on the chosen mode\n          ((level === \"all\" &&\n            selectedMode === \"single\" &&\n            singleDiffs.some((level) => !!level)) ||\n            (level === \"all\" &&\n              selectedMode === \"double\" &&\n              doubleDiffs.some((level) => !!level)) ||\n            (selectedMode === \"single\" &&\n              song.levels.slice(0, 5).includes(level)) ||\n            (selectedMode === \"double\" &&\n              song.levels.slice(5, 9).includes(level)))\n        );\n      })\n      .filter((song) => {\n        // if a difficulty is specified:\n        if (difficulty !== \"all\") {\n          // if level is not specified, simply check if that difficulty exists\n          if (level === \"all\") {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] !== null;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] !== null\n              );\n            }\n          }\n          // if level is specified, only show if the difficulty is that level\n          else {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] === level;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] === level\n              );\n            }\n          }\n        }\n        return song;\n      });\n\n    setDisplayedSongs(songs);\n    songGridContainer.current.scrollTop = 0;\n  }, [selectedFilters, selectedMode]);\n\n  // object corresponding to the selected song option\n  // NOT the song currently playing in the main view\n  const [selectedSong, setSelectedSong] = useState(null);\n\n  // initialize song for testing\n  useEffect(() => {\n    /*\n      For some reason, the very first interaction with the dom will reset the Howler\n      audio seek time to 0 (a bug?). Force an interaction in the beginning to get this\n      out of the way and prevent overwriting of the preset time\n    */\n    document.body.click();\n\n    if (presetParams.song) {\n      onSongSelect(null, { value: presetParams.song });\n    } else {\n      // onSongSelect(null, { value: \"99OQb9b0IQ98P6IQdPOiqi8q16o16iqP\" }); // ORCA\n      // onSongSelect(null, { value: \"PooiIP8qP0IPd9D1Ibi6l9bDoqdi9P8O\" }); // DEGRS\n      // onSongSelect(null, { value: \"q0QIob1PDI6IP86dlPb6I6il9d6bP606\" }); // einya\n      // onSongSelect(null, { value: \"bIlqP91O9ld1lqlq6qoq9OiPdqIDPP0l\" }); // lachryma\n      // onSongSelect(null, { value: \"06O0ObdQobq86lPDo6P18dQ1QPdilIQO\" }); // ayakashi\n      // onSongSelect(null, { value: \"9bI0dQdb01Dl1bQq1Pq998i0l096D99P\" }); // second heaven\n      // onSongSelect(null, { value: \"8o1iQPiId8P6Db9Iqo1Oo119QDoq8qQ8\" }); // chaos\n      // onSongSelect(null, { value: \"dD6PqbboDil89DPIID86Pldi6obI1b8l\" }); // pluto\n      // onSongSelect(null, { value: \"loP08P1PPi990lPD0O060d888O9o6qb8\" }); // seasons\n      // onSongSelect(null, { value: \"8QbqP80q9PI8bbi0qOoiibOQD08OPdli\" }); // felm\n      // onSongSelect(null, { value: \"6bid6d9qPQ80DOqiidQQ891o6Od8801l\" }); // otp\n      // onSongSelect(null, { value: \"9i0q91lPPiO61b9P891O1i86iOP1I08O\" }); // egoism\n      // onSongSelect(null, { value: \"lldPQPDP0qq8iqQ910l8b8PoQ6O668Q0\" }); // downer & upper\n      // onSongSelect(null, { value: \"PP1q0iii1D6Dq9QOd0qqDOQD0160QoPD\" }); // paranoia eternal\n      // onSongSelect(null, { value: \"QI06q9lPIoo80DlI18Ooi6dbPl89bqi0\" }); // our soul\n      // onSongSelect(null, { value: \"POq8OPlOO9199i11Od0P00801Qo01DQo\" }); // rtswy\n      // onSongSelect(null, { value: \"QQldo10ObPPQPlliODiDIIl0Q1oPoo61\" }); // deltamax\n      // onSongSelect(null, { value: \"06loOQ0DQb0DqbOibl6qO81qlIdoP9DI\" }); // paranoia\n      // onSongSelect(null, { value: \"0dOi10q9Q6oi0Q9960iQQDO6olqlDDqo\" }); // private eye\n      // onSongSelect(null, { value: \"9I00D9Id61iD6QP8i8Dd6698PoQ9bdi9\" }); // okome\n      // onSongSelect(null, { value: \"O9qDQOQO8dDDIiO9dPP0Pb8qQo9l89D9\" }); // triperfect\n      // onSongSelect(null, { value: \"0IldoDlDQql99DqQo0Qq9ioPIiiPoIoi\" }); // pluto relinquish\n      // onSongSelect(null, { value: \"PIO8dod8P9OOP1bi0D1POIi6OdOdQDql\" }); // pluto the first\n      // onSongSelect(null, { value: \"8O6b1D9PDO0ll1IO9d1ODDPPo0QPQbob\" }); // tme\n      onSongSelect(null, { value: \"ld6P1lbb0bPO9doqbbPOoPb8qoDo8id0\" }); // A4A\n      // onSongSelect(null, { value: \"O06Id8PIDbDblO109ddi1dldd0bqDdQ1\" }); // sexy planet from nonstop\n    }\n  }, []);\n\n  useEffect(() => {\n    if (selectedSongOption) {\n      const song = simfileList.find((song) => song.hash === selectedSongOption);\n      setSelectedSong(song);\n      AudioPlayer.storeAudioSource(song);\n    }\n  }, [selectedSongOption]);\n\n  const onSongSelect = async (e, data) => {\n    const songHash = data.value;\n    setSelectedSongOption(songHash);\n\n    // console.log(\"setSelectedSongOption\", songHash);\n    AudioPlayer.stopSongPreview();\n\n    const song = simfileList.find((song) => song.hash === songHash);\n\n    let initialProgress = 0;\n    if (presetParams.song === songHash && presetParams.progress) {\n      initialProgress = presetParams.progress / 100000;\n    } else {\n      // remove preset progress marker if it is no longer relevant to the new song\n      presetParams.progress = 0;\n    }\n\n    // automatically fetch simfile and update chart\n    await props.onSongSelect(song, initialProgress);\n\n    // short-circuit if this is not the last song that was selected\n    if (loadStore.lastRequestedSong !== song.title) {\n      return;\n    }\n\n    // if a specific level filter has been chosen, select the difficulty that\n    // corresponds to that level\n    if (selectedFilters.difficulty !== \"all\") {\n      handleDifficultySelect(selectedFilters.difficulty);\n    } else if (selectedFilters.level !== \"all\") {\n      const levels =\n        selectedMode === \"double\"\n          ? song.levels.slice(5, 9)\n          : song.levels.slice(0, 5);\n      for (let i = 0; i < levels.length; i++) {\n        const level = levels[i];\n        if (level === selectedFilters.level) {\n          const difficulties =\n            selectedMode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n          console.log(\"match\", difficulties[i], level);\n          handleDifficultySelect(difficulties[i]);\n          break;\n        }\n      }\n    } else {\n      const selectedDiffOptionIndex = SP_DIFFICULTIES.indexOf(\n        selectedDifficultyOption\n      );\n      let difficultyToSelect;\n      if (song.levels[selectedDiffOptionIndex]) {\n        difficultyToSelect = selectedDifficultyOption;\n      } else {\n        difficultyToSelect = getClosestDifficulty(\n          song,\n          selectedDifficultyOption,\n          selectedMode\n        );\n      }\n      props.onDifficultySelect(difficultyToSelect);\n    }\n  };\n\n  const handleDifficultySelect = (difficulty) => {\n    setSelectedDifficultyOption(difficulty);\n    props.onDifficultySelect(difficulty);\n  };\n\n  const renderDifficulties = () => {\n    if (!selectedSong) return null;\n\n    let levels;\n    if (selectedMode === \"single\") levels = selectedSong.levels.slice(0, 5);\n    else if (selectedMode === \"double\")\n      levels = selectedSong.levels.slice(5, 9);\n\n    return levels.map((level, idx) => {\n      if (!level) return null;\n      const difficulty =\n        selectedMode === \"double\" ? DP_DIFFICULTIES[idx] : SP_DIFFICULTIES[idx];\n      return (\n        <div\n          className={`song-difficulty ${difficulty} ${\n            selectedDifficulty === difficulty ? \"selected\" : \"\"\n          }`}\n          key={`${selectedMode}-difficulty_${difficulty}`}\n          onClick={() => handleDifficultySelect(difficulty)}\n        >\n          <div className=\"difficulty\">{difficulty}</div>\n          <div className=\"level\">{level}</div>\n        </div>\n      );\n    });\n  };\n\n  const getDisplayBpm = () => {\n    if (!selectedSong) return null;\n    let displayBpm = selectedSong.displayBpm;\n    if (displayBpm.includes(\",\")) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(selectedDifficulty);\n      if (selectedMode === \"double\") difficultyIdx += 4;\n      displayBpm = displayBpm.split(\",\")[difficultyIdx];\n    }\n    return displayBpm;\n  };\n\n  const toggleSongPreview = () => {\n    const oldSongHash = AudioPlayer.currentPreview;\n\n    // toggle start/stop of the same song\n    if (oldSongHash === selectedSong.hash) {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      } else {\n        AudioPlayer.playSongPreview(selectedSong);\n      }\n    }\n\n    // play a new song and stop the current one (if applicable)\n    else {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      }\n      AudioPlayer.playSongPreview(selectedSong);\n    }\n  };\n\n  return (\n    <div\n      className={`form-container songView ${\n        activeView === \"song\" ? \"open\" : \"closed\"\n      }`}\n    >\n      <form className=\"songForm\">\n        <div className=\"form-inner-wrapper\">\n          <div className=\"selectedSong\">\n            <div\n              className={`selectedSong-jacket-wrapper ${\n                previewAudio.status === \"playing\" ? \"playing\" : \"\"\n              }`}\n            >\n              <div className=\"selectedSong-jacket-overlay\">\n                <AudioWave />\n              </div>\n              <img\n                className={`selectedSong-jacket`}\n                src={getJacketPath(`${selectedSongOption}.png`)}\n                alt=\"Selected song\"\n                onClick={toggleSongPreview}\n              />\n            </div>\n            <div className=\"selectedSong-info\">\n              <Dropdown\n                placeholder=\"Choose a song\"\n                className=\"song-title-dropdown\"\n                search\n                selection\n                value={selectedSongOption}\n                onChange={onSongSelect}\n                options={simfileOptions}\n                selectOnBlur={false}\n                selectOnNavigation={false}\n              />\n              <div className=\"song-artist\">\n                {selectedSong && selectedSong.artist}\n              </div>\n\n              <div className=\"song-difficulties\">{renderDifficulties()}</div>\n\n              <div className=\"song-mode\">\n                <ToggleSwitch\n                  option1={{ text: \"Single\", value: \"single\" }}\n                  option2={{ text: \"Double\", value: \"double\" }}\n                  onChange={(value) => props.onModeSelect(value)}\n                  value={selectedMode}\n                />\n              </div>\n\n              <div className=\"bpm-display-container\">\n                <div className=\"bpm-display-label\">BPM</div>\n                <div className=\"bpm-display-value\">{getDisplayBpm()}</div>\n              </div>\n            </div>\n          </div>\n          <div className=\"songForm-filters\">\n            <div className=\"songForm-filters-row\">\n              <div className=\"form-field\">\n                <label>By Title</label>\n                <Dropdown\n                  className=\"title-filter-dropdown\"\n                  selection\n                  value={selectedFilters.title}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      title: data.value,\n                    })\n                  }\n                  options={titleSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Version</label>\n                <Dropdown\n                  className=\"version-filter-dropdown\"\n                  selection\n                  value={selectedFilters.version}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      version: data.value,\n                    })\n                  }\n                  options={versionSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Level</label>\n                <Dropdown\n                  className=\"level-filter-dropdown\"\n                  selection\n                  value={selectedFilters.level}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      level: data.value,\n                    })\n                  }\n                  options={levelSortOptions}\n                />\n                <label>By Difficulty</label>\n                <Dropdown\n                  className=\"difficulty-filter-dropdown\"\n                  selection\n                  value={selectedFilters.difficulty}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      difficulty: data.value,\n                    })\n                  }\n                  options={difficultySortOptions}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n\n      <div className=\"songGrid-container\" ref={songGridContainer}>\n        <SongGrid\n          displayedSongs={displayedSongs}\n          onSongSelect={onSongSelect}\n          selectedSongOption={selectedSongOption}\n          selectedMode={selectedMode}\n          // selectedDifficulty={selectedDifficulty}\n          selectedDifficultyOption={selectedDifficultyOption}\n          selectedFilters={selectedFilters}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, songSelect } = state;\n  const { previewAudio } = audio;\n  return {\n    previewAudio,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(actions.selectSong(song)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SongForm);\n","import React, { useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Radio, Checkbox } from \"semantic-ui-react\";\n\nimport { options } from \"./options\";\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\nimport { capitalize } from \"../../utils\";\nimport { updateMods } from \"../../actions/ModsActions\";\n\nconst ModsForm = (props) => {\n  const { activeView, mods, updateMods, mode, song, difficulty } = props;\n\n  // when switching between single and double, any mod set to a value incompatible\n  // with the new mode will be reset to its default value\n  useEffect(() => {\n    if (mode === \"double\" && ![\"off\", \"mirror\"].includes(mods.turn)) {\n      updateMods({ turn: \"off\" });\n    }\n  }, [mode]);\n\n  const getEffectiveScrollSpeed = () => {\n    if (!song) return null;\n    let displayBpm = song.displayBpm;\n    if (displayBpm.includes(\",\")) {\n      let difficultyIdx = SP_DIFFICULTIES.indexOf(difficulty);\n      if (mode === \"double\") difficultyIdx += 4;\n      displayBpm = displayBpm.split(\",\")[difficultyIdx];\n    }\n\n    const [lowBpm, highBpm] = displayBpm.split(\"-\");\n    if (!highBpm) {\n      return <strong>{Math.round(lowBpm * mods.speed)}</strong>;\n    } else {\n      return (\n        <strong>{`${Math.round(lowBpm * mods.speed)} - ${Math.round(\n          highBpm * mods.speed\n        )}`}</strong>\n      );\n    }\n  };\n\n  return (\n    <div\n      className={`form-container ${activeView === \"mods\" ? \"open\" : \"closed\"}`}\n    >\n      <form>\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Speed</h4>\n          {options.mods.speed.map((speed) => {\n            return (\n              <Radio\n                key={`speed_${speed}`}\n                label={`${speed}x`}\n                name=\"speed\"\n                value={speed}\n                checked={mods.speed === speed}\n                onChange={() => updateMods({ speed })}\n              />\n            );\n          })}\n          <div>Effective scroll speed: {getEffectiveScrollSpeed()}</div>\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Arrow color</h4>\n          {options.mods.noteskin.map((noteskin) => {\n            return (\n              <Radio\n                key={`noteskin_${noteskin}`}\n                label={capitalize(noteskin)}\n                name=\"noteskin\"\n                value={noteskin}\n                checked={mods.noteskin === noteskin}\n                onChange={() => updateMods({ noteskin })}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Turn</h4>\n          {options.mods.turn\n            .filter((turn) => {\n              if (mode === \"double\") return turn === \"off\" || turn === \"mirror\";\n              return true;\n            })\n            .map((turn) => {\n              return (\n                <Radio\n                  key={`turn_${turn}`}\n                  label={capitalize(turn)}\n                  name=\"turn\"\n                  value={turn}\n                  checked={mods.turn === turn}\n                  onChange={() => updateMods({ turn })}\n                />\n              );\n            })}\n        </div>\n        {mods.turn === \"shuffle\" && (\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Shuffle pattern</h4>\n            {options.mods.shuffle.map((shuffle) => {\n              return (\n                <Radio\n                  key={`shuffle_${shuffle}`}\n                  label={shuffle}\n                  name=\"shuffle\"\n                  value={shuffle}\n                  checked={mods.shuffle === shuffle}\n                  onChange={() => updateMods({ shuffle })}\n                />\n              );\n            })}\n          </div>\n        )}\n\n        <h4>Miscellaneous</h4>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Guidelines\"\n            name=\"guidelines\"\n            checked={mods.guidelines}\n            onChange={() => updateMods({ guidelines: !mods.guidelines })}\n          />\n        </div>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Color freeze heads\"\n            name=\"colorFreezes\"\n            checked={mods.colorFreezes}\n            onChange={() => updateMods({ colorFreezes: !mods.colorFreezes })}\n          />\n        </div>\n      </form>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect } = state;\n  return {\n    mods,\n    mode: songSelect.mode,\n    song: songSelect.song,\n    difficulty: songSelect.difficulty,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    updateMods: (mods) => dispatch(updateMods(mods)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ModsForm);\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"style\", null, \"\\n\\t\\ttspan { white-space:pre }\\n\\t\\t.shp0 { fill: #020202 } \\n\\t\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Path 0\",\n  className: \"shp0\",\n  d: \"M16.49 17L1.5 32C30.16 60.67 31.81 62.01 35 61.99C37.45 61.97 39.33 61.14 41.27 59.23C43.27 57.26 44.03 55.53 44.01 53C43.98 50.32 43.09 48.61 40.24 45.73L36.5 41.97L54.5 42.03C60.51 35.97 61.98 33.52 62 32C62.02 30.41 60.66 28.14 58.27 25.76L54.5 22.03L36.5 22.03C43.09 15.39 43.98 13.68 44.01 11C44.03 8.47 43.27 6.74 41.27 4.77C39.32 2.85 37.45 2.03 34.99 2.02C31.78 2 30.15 3.32 16.49 17ZM89.49 5.79L85.58 9.58L86.03 27.5C79.22 20.74 77.75 20.03 74.61 20.01C71.58 20 70.19 20.61 68.37 22.75C66.91 24.47 66.03 26.81 66.01 29C65.99 32.19 67.33 33.84 81 47.5L96 62.5C124.67 33.84 126.01 32.19 125.99 29C125.97 26.55 125.14 24.67 123.23 22.73C121.43 20.9 119.47 19.96 117.49 19.98C115.46 19.99 113.1 21.22 110.23 23.75L105.97 27.5L106.03 9.5C99.91 3.43 97.54 2.02 95.95 2.01C94.34 2.01 91.96 3.4 89.49 5.79ZM144.5 16.76C130.41 30.65 129.54 31.73 129.78 35.01C129.94 37.22 131.03 39.51 132.77 41.27C134.74 43.27 136.47 44.03 139 44.01C141.68 43.98 143.39 43.09 146.27 40.24L150.03 36.5L149.97 54.5C156.03 60.51 158.48 61.98 160 62C161.59 62.02 163.86 60.66 166.24 58.27L169.97 54.5L169.97 36.5C176.61 43.09 178.32 43.98 181 44.01C183.53 44.03 185.26 43.27 187.23 41.27C189.14 39.33 189.97 37.45 189.99 35C190.01 31.81 188.68 30.18 175.25 16.75C167.14 8.64 160.27 2.01 159.99 2C159.71 2 152.74 8.64 144.5 16.76ZM214.48 4.8C212.27 6.96 211.65 8.41 211.81 11.05C211.97 13.52 213.09 15.57 215.76 18.27L219.5 22.03L200.89 22C195.51 27.88 194.02 30.58 194 32C193.98 33.59 195.34 35.86 197.73 38.24L201.5 41.97L219.5 41.97C212.91 48.61 212.02 50.32 211.99 53C211.97 55.53 212.73 57.26 214.73 59.23C216.67 61.14 218.55 61.97 221 61.99C224.19 62.01 225.84 60.67 239.5 47L254.5 32C225.76 3.26 224.2 1.99 220.93 2C218.38 2 216.55 2.8 214.48 4.8Z\"\n});\n\nvar SvgArrows = function SvgArrows(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 256 80\",\n    width: 256,\n    height: 80,\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgArrows, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/arrows.48a2d361.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  d: \"M544.033302 516.000776V96.000564c0-17.672051-14.478655-31.998984-32.150706-31.998984s-32.150706 14.326933-32.150707 31.998984v420.061624c-54.909072 14.251072-95.809105 64.333925-95.809105 123.935554 0 59.691941 40.82056 109.836206 96.090876 124.000579a32.298816 32.298816 0 0 0-0.281771 4.006195v159.99492c0 17.672051 14.478655 31.998984 32.150707 31.998984s32.150706-14.326933 32.150706-31.998984V768.004516a32.280754 32.280754 0 0 0-0.317894-3.941171c55.389526-14.088512 96.397933-64.301413 96.397932-124.058378 0.010837-59.691941-40.809723-109.832593-96.080038-124.004191z m13.221527 169.249989a64.00158 64.00158 0 1 1 18.744945-45.256635 63.578925 63.578925 0 0 1-18.744945 45.260247zM223.678606 196.003711a32.287979 32.287979 0 0 0 0.292607-4.002582V96.000564a31.970084 31.970084 0 1 0-63.940169 0V192.001129a32.371065 32.371065 0 0 0 0.180622 4.060381c-55.270316 14.160761-96.173962 64.301413-96.173961 124.000579s40.910871 109.818143 96.181186 123.996966a32.360228 32.360228 0 0 0-0.184234 3.937558V927.999436a31.970084 31.970084 0 1 0 63.940169 0V448.000226a32.287979 32.287979 0 0 0-0.278158-3.883372c55.385914-14.088512 96.350971-64.301413 96.350971-124.054765S279.071744 210.084998 223.678606 196.003711z m13.575545 169.315013A64.00158 64.00158 0 1 1 255.999097 320.062089a63.578925 63.578925 0 0 1-18.744946 45.256635zM959.99842 320.062089c0-59.775027-41.048144-109.977091-96.45212-124.058378a32.360228 32.360228 0 0 0 0.173397-4.002582V96.000564a31.970084 31.970084 0 1 0-63.940169 0V192.001129a32.291592 32.291592 0 0 0 0.299833 4.060381c-55.270316 14.160761-96.116162 64.301413-96.116163 124.000579s40.82056 109.836206 96.090876 124.000578a32.298816 32.298816 0 0 0-0.281771 3.99897V927.999436a31.970084 31.970084 0 1 0 63.940169 0V448.061637a32.381903 32.381903 0 0 0-0.166172-3.941171c55.407588-14.084899 96.452119-64.286963 96.45212-124.058377z m-82.746526 45.253022a63.997968 63.997968 0 1 1 18.748558-45.253022 63.578925 63.578925 0 0 1-18.748558 45.253022z\",\n  fill: \"\"\n});\n\nvar SvgMods = function SvgMods(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    className: \"icon\",\n    style: {\n      width: \"1em\",\n      height: \"1em\",\n      verticalAlign: \"middle\",\n      fill: \"currentColor\",\n      overflow: \"hidden\"\n    },\n    viewBox: \"0 0 1024 1024\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgMods, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/mods.d3d6577c.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"style\", null, \"\\n\\t\\ttspan { white-space:pre }\\n\\t\\t.shp0 { fill: #323638 } \\n\\t\");\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"g\", {\n  id: \"Layer\"\n}, React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M92.28 85.53L84 93.71C83.8 93.9 83.55 94 83.29 94C83.04 94 82.78 93.9 82.59 93.71L65.27 76.56C64.03 75.31 64.05 73.3 65.29 72.07L70.7 66.74C71.9 65.55 73.99 65.56 75.18 66.77L92.29 84.12C92.68 84.51 92.67 85.14 92.28 85.53ZM90.16 84.81L73.76 68.17C73.53 67.95 73.24 67.82 72.92 67.82C72.61 67.82 72.32 67.94 72.1 68.16L66.7 73.49C66.24 73.95 66.23 74.69 66.69 75.15L83.29 91.59L90.16 84.81Z\"\n}), React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M39.31 77.77C18.42 77.77 1.42 60.77 1.42 39.88C1.42 18.99 18.42 2 39.3 2C60.19 2 77.19 18.99 77.19 39.88C77.19 60.77 60.19 77.77 39.31 77.77ZM75.19 39.88C75.19 20.1 59.09 4 39.3 4C19.52 4 3.42 20.1 3.42 39.88C3.42 59.67 19.52 75.77 39.3 75.77C59.09 75.77 75.19 59.67 75.19 39.88Z\"\n}), React.createElement(\"path\", {\n  id: \"Layer\",\n  fillRule: \"evenodd\",\n  className: \"shp0\",\n  d: \"M57.7 25.39L57.7 54.31C57.7 58.64 54.17 62.17 49.83 62.17C45.5 62.17 41.97 58.64 41.97 54.31C41.97 49.97 45.5 46.44 49.83 46.44C52.17 46.44 54.26 47.47 55.7 49.08L55.7 25.39C55.7 25.01 55.46 24.67 55.09 24.55L34.1 17.21C33.85 17.13 33.57 17.17 33.34 17.34C33.11 17.51 32.98 17.77 32.98 18.05L32.98 48.81C32.98 53.15 29.46 56.68 25.12 56.68C20.78 56.68 17.25 53.15 17.25 48.81C17.25 44.47 20.78 40.95 25.12 40.95C27.45 40.95 29.54 41.97 30.98 43.59L30.98 18.05C30.98 17.12 31.41 16.27 32.17 15.72C32.92 15.18 33.85 15.03 34.74 15.31L55.73 22.66C56.9 23.03 57.7 24.13 57.7 25.39ZM30.98 48.81C30.98 45.58 28.35 42.95 25.12 42.95C21.88 42.95 19.25 45.58 19.25 48.81C19.25 52.05 21.88 54.68 25.12 54.68C28.35 54.68 30.98 52.05 30.98 48.81ZM55.7 54.31C55.7 51.07 53.07 48.44 49.83 48.44C46.6 48.44 43.97 51.07 43.97 54.31C43.97 57.54 46.6 60.17 49.83 60.17C53.07 60.17 55.7 57.54 55.7 54.31Z\"\n}));\n\nvar SvgMusicSearch = function SvgMusicSearch(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 94 96\",\n    width: 94,\n    height: 96,\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgMusicSearch, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/music_search.ab83855e.svg\";\nexport { ForwardRef as ReactComponent };","import React from \"react\";\nimport { Icon } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { stopPreviewAudio } from \"../../actions/AudioActions\";\nimport { ReactComponent as ChartIcon } from \"../../svg/arrows.svg\";\nimport { ReactComponent as ModsIcon } from \"../../svg/mods.svg\";\nimport { ReactComponent as SongIcon } from \"../../svg/music_search.svg\";\n\nconst MobileNav = (props) => {\n  const { activeView, chartAudio, previewAudio } = props;\n\n  const navItems = [\n    { view: \"song\", icon: \"music\", svgIcon: SongIcon, text: \"Song\" },\n    { view: \"mods\", icon: \"sidebar\", svgIcon: ModsIcon, text: \"Mods\" },\n    { view: \"2\", icon: \"\", text: \"\" },\n    { view: \"3\", icon: \"\", text: \"\" },\n    { view: \"chart\", svgIcon: ChartIcon, text: \"Chart\" },\n  ];\n\n  const setActiveView = (view) => {\n    if (chartAudio.status === \"playing\") return;\n    AudioPlayer.stopSongPreview();\n    props.setActiveView(view);\n  };\n\n  const isDisabled = (view) => {\n    if (view !== \"chart\" && chartAudio.status === \"playing\") return true;\n    return false;\n  };\n\n  return (\n    <nav className=\"mobileNav\">\n      {navItems.map((navItem) => {\n        const { view, icon, text } = navItem;\n        const SVGIcon = navItem.svgIcon;\n        if (!view) return <div className=\"mobileNav_item\" />;\n        return (\n          <div\n            key={`mobileNavItem_${view}`}\n            className={`mobileNav_item ${activeView === view ? \"active\" : \"\"} ${\n              isDisabled(view) ? \"disabled\" : \"\"\n            }`}\n            onClick={() => setActiveView(view)}\n          >\n            {SVGIcon ? (\n              <SVGIcon className={`svg-icon ${view}`} />\n            ) : (\n              <Icon name={icon} />\n            )}\n            <span className=\"description\">{text}</span>\n          </div>\n        );\n      })}\n    </nav>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  const { chartAudio, previewAudio } = audio;\n  return {\n    chartAudio,\n    previewAudio,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    stopPreviewAudio: () => dispatch(stopPreviewAudio()),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MobileNav);\n","import React, { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { tsv } from \"d3-fetch\";\n\nimport ChartArea from \"../../components/chart/ChartArea\";\nimport SongForm from \"../../components/form/SongForm\";\nimport ModsForm from \"../../components/form/ModsForm\";\nimport MobileNav from \"../../components/navigation/MobileNav\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { getOriginPath, fetchDocument } from \"../../utils\";\nimport {\n  selectSong,\n  selectDifficulty,\n  selectMode,\n} from \"../../actions/SongSelectActions\";\nimport { resizeScreen } from \"../../actions/ScreenActions\";\nimport loadStore from \"../../utils/loadStore\";\n\nconst MainContainer = (props) => {\n  const [loadingSimfiles, setLoadingSimfiles] = useState(true);\n  const [simfileList, setSimfileList] = useState([]);\n  const [selectedSM, setSelectedSM] = useState(null);\n\n  const [activeView, setActiveView] = useState(\"mods\");\n\n  const [gameEngine, setGameEngine] = useState(null);\n\n  const [loadingAudio, setLoadingAudio] = useState(false);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchSimfiles();\n      setLoadingSimfiles(false);\n    };\n    fetchData();\n\n    AudioPlayer.setLoadingAudio = setLoadingAudio;\n\n    window.addEventListener(\"resize\", props.resizeScreen);\n  }, []);\n\n  const fetchSimfiles = async () => {\n    try {\n      const parsedTsv = await tsv(getOriginPath() + \"data/simfiles.tsv\");\n      parsedTsv.forEach((row) => {\n        row.levels = row.levels\n          .split(\",\")\n          .map((level) => (level ? parseInt(level) : null));\n      });\n\n      // console.log(\"simfiles\", parsedTsv);\n      setSimfileList(parsedTsv);\n    } catch (error) {\n      console.error(error);\n      return null;\n    }\n  };\n\n  const onSongSelect = async (song, initialProgress = 0) => {\n    console.log(\"MainContainer selected song\", song);\n    AudioPlayer.selectSong(song, initialProgress);\n    // setSelectedSong(song);\n\n    props.selectSong(song);\n\n    document.title = `${song.title} - SMViewer`;\n\n    // retrieve audio file and simfile from song.simfilePath\n\n    let smName = song.smName;\n\n    // special case for tohoku evolved: pick one of its types at random\n    if (song.hash === \"OddDoQ6dqi0QdQDDOO6qlO08d8bPbli1\") {\n      smName = smName.replace(\"1\", Math.floor(Math.random() * 4) + 1);\n    }\n\n    try {\n      // Immediately update the value of \"last requested song\"\n      // Any pending requests that finish before the last song is loaded will be ignored\n      loadStore.lastRequestedSong = song.title;\n      const sm = await fetchDocument(\n        `${getOriginPath()}simfiles/${encodeURIComponent(smName)}.${\n          song.useSsc ? \"ssc\" : \"sm\"\n        }`\n      );\n\n      // User might try to select a new song before the simfile is fetched.\n      // Only process simfile if this is the last song that was selected\n      if (loadStore.lastRequestedSong === song.title) {\n        // console.log(\"sm loaded\");\n        setSelectedSM(sm);\n      }\n    } catch (err) {\n      alert(`Song ${song.title} failed to load`, err);\n    }\n  };\n\n  const onDifficultySelect = (difficulty) => {\n    // setSelectedDifficulty(difficulty);\n    props.selectDifficulty(difficulty);\n  };\n  const onModeSelect = (mode) => {\n    props.selectMode(mode);\n  };\n\n  const changeActiveView = (view) => {\n    setActiveView(view);\n    AudioPlayer.activeView = view;\n  };\n\n  return (\n    <div className=\"main-container\">\n      {!loadingSimfiles && (\n        <>\n          <ChartArea\n            loadingAudio={loadingAudio}\n            sm={selectedSM}\n            gameEngine={gameEngine}\n            setGameEngine={setGameEngine}\n          />\n\n          <SongForm\n            activeView={activeView}\n            setActiveView={changeActiveView}\n            simfileList={simfileList}\n            onSongSelect={onSongSelect}\n            onDifficultySelect={onDifficultySelect}\n            onModeSelect={onModeSelect}\n            loadingAudio={loadingAudio}\n          />\n\n          <ModsForm activeView={activeView} />\n\n          <MobileNav activeView={activeView} setActiveView={changeActiveView} />\n        </>\n      )}\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {};\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(selectSong(song)),\n    selectDifficulty: (song) => dispatch(selectDifficulty(song)),\n    selectMode: (song) => dispatch(selectMode(song)),\n    resizeScreen: (e) => dispatch(resizeScreen(e)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MainContainer);\n","import React from \"react\";\n\nimport MainContainer from \"./containers/main/MainContainer\";\n\nfunction App() {\n  return (\n    <div className=\"app-container\">\n      <MainContainer />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport \"semantic-ui-css/semantic.min.css\";\n\nimport \"./styles.scss\";\nimport App from \"./App\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}