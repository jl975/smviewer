(this.webpackJsonpsmplayer=this.webpackJsonpsmplayer||[]).push([[0],{177:function(e,t,n){e.exports=n(317)},188:function(e,t,n){},191:function(e,t,n){},317:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(29),o=n.n(i),s=n(31),c=(n(187),n(188),n(19)),l=n.n(c),u=n(34),f=n(13),h=n(166),d=n(327),p=n(149),m=n.n(p),v=(n(190),n(191),n(168)),g=n(23),b=n(20),y=n(21),O=n(25),w=["left","down","up","right"],E=["DDR 1st","DDR 2ndMIX","DDR 3rdMIX","DDR 4thMIX","DDR 5thMIX","DDRMAX","DDRMAX2","DDR EXTREME","DDR SuperNOVA","DDR SuperNOVA 2","DDR X","DDR X2","DDR X3 VS 2ndMIX","DDR (2013)","DDR (2014)","DDR A","DDR A20"],k=["Beginner","Basic","Difficult","Expert","Challenge"],P=["\u3042","\u304b","\u3055","\u305f","\u306a","\u306f","\u307e","\u3084","\u3089","\u308f","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","NUM"],_=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],S=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,a,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors"});case 2:return n=e.sent,a=n.body.getReader(),r=new TextDecoder("utf-8"),e.next=7,a.read();case 7:return i=e.sent,e.abrupt("return",r.decode(i.value));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(e){return window.location.href+"/assets/"+e},A=function(e){return window.location.href+"/jackets/"+e},D=function(e){return e.slice(0,1).toUpperCase()+e.slice(1)},I={};w.forEach((function(e){I["rainbow_".concat(e)]=new Image,I["rainbow_".concat(e)].src=j("rainbow_".concat(e,".png")),I["note_".concat(e)]=new Image,I["note_".concat(e)].src=j("note_".concat(e,".png")),I["vivid_".concat(e)]=new Image,I["vivid_".concat(e)].src=j("vivid_".concat(e,".png")),I["flat_".concat(e)]=new Image,I["flat_".concat(e)].src=j("vivid_".concat(e,".png")),I["freeze_tail_active_".concat(e)]=new Image,I["freeze_tail_active_".concat(e)].src=j("freeze_tail_active_".concat(e,".png")),I["freeze_tail_inactive_".concat(e)]=new Image,I["freeze_tail_inactive_".concat(e)].src=j("freeze_tail_inactive_".concat(e,".png")),I["freeze_body_active_".concat(e)]=new Image,I["freeze_body_active_".concat(e)].src=j("freeze_body_active_".concat(e,".png")),I["freeze_body_inactive_".concat(e)]=new Image,I["freeze_body_inactive_".concat(e)].src=j("freeze_body_inactive_".concat(e,".png")),I["shock_".concat(e)]=new Image,I["shock_".concat(e)].src=j("shock_".concat(e,".png"))}));["freeze_head","tap_explosion"].forEach((function(e){I[e]=new Image,I[e].src=j("".concat(e,".png"))}));var L=function(){function e(t){Object(b.a)(this,e);var n=t.key,a=t.mods,r=a.speed,i=a.noteskin;this.key=n,this.speed=r,this.note=t.note,this.noteskin=i,this.measureIdx=t.measureIdx,this.measureN=t.measureN,this.measureD=t.measureD,this.originalBeatPosition=t.originalBeatPosition,this.holdBeats=t.holdBeats||null,this.hitFrame=0,this.previousBeatPosition=null}return Object(y.a)(e,[{key:"reset",value:function(){this.hitFrame=0}},{key:"currentBeatPosition",value:function(e){return this.originalBeatPosition-e}},{key:"render",value:function(e,t){for(var n=e.getContext("2d"),a=e.height,r=0;r<this.note.length;r++)if("0"!==this.note[r]){var i=void 0,o=void 0,s=void 0,c=void 0,l=void 0,u=w[r];if("1"===this.note[r]){if(i=I["".concat(this.noteskin,"_").concat(u)],this.note.includes("2"))i=I.freeze_head,o=64*w.indexOf(u),s=0;else if("rainbow"===this.noteskin){o=Math.floor(4*t)%8*64;var f=this.measureD/4,h=this.measureN%f;0===h?s=0:0<h&&h<=f/4?s=1:f/4<h&&h<=f/2?s=2:f/2<h&&h<=3*f/4?s=3:3*f/4<h&&h<f&&(s=0),s*=64}else if("note"===this.noteskin){o=Math.floor(4*t)%8*64;var d=this.measureN/this.measureD;s=[0,.25,.5,.75].includes(d)?0:[1/8,3/8,5/8,7/8].includes(d)?1:[1/16,3/16,5/16,7/16,9/16,.6875,.8125,.9375].includes(d)?3:2,s*=64}else if("vivid"===this.noteskin){o=Math.floor(4*t)%4*64;var p=this.measureD/4,m=this.measureN%p;0===m?s=0:0<m&&m<=p/4?s=1:p/4<m&&m<=p/2?s=2:p/2<m&&m<=3*p/4?s=3:3*p/4<m&&m<p&&(s=0),s=(s+Math.floor(t)%4)%4*64}else"flat"===this.noteskin&&(i=I["vivid_".concat(u)],o=Math.floor(4*t)%4*64,s=Math.floor(t)%4*64);c=64*w.indexOf(u),(l=64*this.currentBeatPosition(t)*this.speed)>0&&l<a&&n.drawImage(i,o,s,64,64,c,l,64,64),l<=0?this.hitFrame<=12&&(n.save(),n.globalAlpha=1-Math.pow(this.hitFrame/12,3),n.drawImage(I.tap_explosion,0,0,64,64,c-2-this.hitFrame,-2-this.hitFrame,68+2*this.hitFrame,68+2*this.hitFrame),n.restore(),this.hitFrame++):this.hitFrame=0}else if("2"===this.note[r])i=I.freeze_head,o=64*w.indexOf(u),s=0,c=64*w.indexOf(u),(l=64*this.currentBeatPosition(t)*this.speed)>0&&l<a&&n.drawImage(i,o,s,64,64,c,l,64,64),l<=0?this.hitFrame<=12&&(n.save(),n.globalAlpha=1-Math.pow(this.hitFrame/12,3),n.drawImage(I.tap_explosion,0,0,64,64,c-this.hitFrame,0-this.hitFrame,64+2*this.hitFrame,64+2*this.hitFrame),n.restore(),this.hitFrame++):this.hitFrame=0;else if("3"===this.note[r]){i=I["freeze_tail_inactive_".concat(u)],o=0,s=0,c=64*w.indexOf(u),l=64*this.currentBeatPosition(t)*this.speed;var v=I["freeze_body_inactive_".concat(u)],g=64*this.holdBeats[r]*this.speed-32,b=Math.floor(g/128),y=g%128,O=y,E=l-(g+32),k=!1;E<0&&(y+=E,E=0,i=I["freeze_tail_active_".concat(u)],v=I["freeze_body_active_".concat(u)],l>0&&(k=!0)),E>-y&&E<a&&n.drawImage(v,0,128-y,64,y,c,E+32,64,y);for(var P=1;P<=b;P++){var _=128,S=0,j=l-(g+32-O-128*(P-1));j<0&&j>-128&&(_+=j,S-=j,j=0),j>-_&&j<a&&n.drawImage(v,0,S,64,_,c,j+32,64,_)}var A=64;if(64*this.holdBeats[r]*this.speed<32){var D=64*this.holdBeats[r]*this.speed;s+=32-D,l+=32-D,A=64-D}if(l<32&&l>0&&(s+=32-l,l=32),l>0&&l<a&&n.drawImage(i,o,s,64,A,c,l,64,A),k){var L=I.freeze_head;this.hitFrame<=12&&n.drawImage(L,64*w.indexOf(u),128,64,64,64*w.indexOf(u),0,64,64)}l<=0?this.hitFrame<=12&&(n.save(),n.globalAlpha=1-Math.pow(this.hitFrame/12,3),n.drawImage(I.tap_explosion,0,0,64,64,c-this.hitFrame,0-this.hitFrame,64+2*this.hitFrame,64+2*this.hitFrame),n.restore(),this.hitFrame++):this.hitFrame=0}this.previousBeatPosition=this.currentBeatPosition(t)}}}]),e}(),T={};w.forEach((function(e){T["shock_".concat(e)]=new Image,T["shock_".concat(e)].src=j("shock_".concat(e,".png"))}));var C=function(){function e(t){Object(b.a)(this,e);var n=t.key,a=t.mods,r=a.speed,i=a.noteskin;this.key=n,this.speed=r,this.note=t.note,this.noteskin=i,this.originalBeatPosition=t.originalBeatPosition}return Object(y.a)(e,[{key:"currentBeatPosition",value:function(e){return this.originalBeatPosition-e}},{key:"render",value:function(e,t,n){var a=e.getContext("2d"),r=e.height;t=Math.floor(t/3)%8;for(var i=0;i<this.note.length;i++){var o=w[i],s=T["shock_".concat(o)],c=t%4*64,l=64*Math.floor(t/4),u=64*w.indexOf(o),f=64*this.currentBeatPosition(n)*this.speed;f>-64&&f<r&&a.drawImage(s,c,l,64,64,u,f,64,64)}}}]),e}(),x={};w.forEach((function(e){x[e]=new Image,x[e].src=j("".concat(e,"_tap_flash.png")),x[e]=new Image,x[e].src=j("".concat(e,"_tap_flash.png"))}));var N={};w.forEach((function(e){N[e]=new Image,N[e].src=j("".concat(e,"_tap_receptor.png")),N[e]=new Image,N[e].src=j("".concat(e,"_tap_receptor.png"))}));var R=function(){function e(){Object(b.a)(this,e)}return Object(y.a)(e,[{key:"render",value:function(e,t){var n=e.getContext("2d"),a=t%1>0&&t%1<.25;w.forEach((function(e,t){n.drawImage(a?x[e]:N[e],0,0,64,64,64*t,0,64,64)}))}}]),e}(),B=function(){function e(t){Object(b.a)(this,e);var n=t.mods.speed;this.speed=n,this.finalBeat=t.finalBeat}return Object(y.a)(e,[{key:"render",value:function(e,t){for(var n=e.getContext("2d"),a=e.height,r=0;r<=this.finalBeat;r++){var i=64*(r-t)*this.speed+32,o=r%4===0?2:.8;i>0&&i<a&&(n.beginPath(),n.moveTo(0,i),n.lineTo(e.width,i),n.lineWidth=o,n.strokeStyle="#fff",n.stroke())}}}]),e}(),F=/dance-([a-z]+)/,M=/(Beginner|Easy|Medium|Hard|Challenge|Edit)/,V={Beginner:"Beginner",Easy:"Basic",Medium:"Difficult",Hard:"Expert",Challenge:"Challenge"},U=function(e){var t={},n="";/#BPMS:/i.test(e)&&(n=(n=/#BPMS:([\s\S]*?)\s*;/i.exec(e)[1]).length?n.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),a=n[0],r=n[1];return{beat:parseFloat(a),value:parseFloat(r)}})):[]);var a="";return/#STOPS:/i.test(e)&&(a=(a=/#STOPS:([\s\S]*?)\s*;/i.exec(e)[1]).length?a.split(",").map((function(e){var t=e.split("="),n=Object(f.a)(t,2),a=n[0],r=n[1];return{beat:parseFloat(a),value:parseFloat(r)}})):[]),e.slice(e.indexOf("#NOTES:")).split(/#NOTES:\s+/).slice(1).forEach((function(e){var r=F.exec(e)[1],i=M.exec(e)[1],o=V[i];t["".concat(r,"_").concat(o)]={difficulty:o,mode:r,bpms:n,stops:a};var s=t["".concat(r,"_").concat(o)],c=new RegExp("".concat(i,":\\s+([0-9]+):")),l=parseInt(c.exec(e)[1]);s.level=l;var u=e.slice(e.lastIndexOf(":")+1,e.lastIndexOf(";")).trim().split(",").map((function(e,t){var n=e.trim().split("\r\n").filter((function(e){return!e.startsWith("//")})),a=n.length,r=[];return n.forEach((function(e,n){if(e.split("").filter((function(e){return"0"!==e})).length){var i={};i.note=e,i.measureIdx=t,i.measureN=n,i.measureD=a,r.push(i)}})),r}));s.chart=u})),t};function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var z=function(e,t){var n=t.turn,a=t.shuffle,r={off:"LDUR",mirror:"RUDL",left:"ULRD",right:"DRLU",shuffle1:"LRDU",shuffle2:"UDRL",shuffle3:"LRUD",shuffle4:"DURL",shuffle5:"DLUR",shuffle6:"DULR",shuffle7:"RLUD",shuffle8:"RULD"},i=n;return"shuffle"===n&&(i+=a),e.map((function(e){var t=e.note;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{note:r[i].split("").map((function(e){return t[r.off.indexOf(e)]}))})}))},X=n(102),Z=n(33),W=n(150),G=function(e){return function(t){t({type:"SET_CHART_PROGRESS",payload:e})}};function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J={chartAudio:{status:"stopped",progress:0},previewAudio:{status:"stopped"}},Q=Object(Z.c)({audio:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PLAY_CHART_AUDIO":var n=q({},e.chartAudio,{status:"playing"});return q({},e,{chartAudio:n});case"PAUSE_CHART_AUDIO":var a=q({},e.chartAudio,{status:"paused"});return q({},e,{chartAudio:a});case"STOP_CHART_AUDIO":var r=q({},e.chartAudio,{status:"stopped"});return q({},e,{chartAudio:r});case"PLAY_PREVIEW_AUDIO":var i=q({},e.previewAudio,{status:"playing"});return q({},e,{previewAudio:i});case"STOP_PREVIEW_AUDIO":var o=q({},e.previewAudio,{status:"stopped"});return q({},e,{previewAudio:o});case"SET_CHART_PROGRESS":var s=q({},e.chartAudio,{progress:t.payload});return q({},e,{chartAudio:s});default:return e}}}),K=Object(Z.e)(Q,Object(Z.d)(Object(Z.a)(W.a),window.devToolsExtension?window.__REDUX_DEVTOOLS_EXTENSION__():function(e){return e})),$=new(function(){function e(){Object(b.a)(this,e),this.sources={song:{},preview:{}},this.currentSong=null,this.currentPreview=null,this.currentSongId=null,this.currentPreviewId=null,this.activeView=null,this.previewFadeTimeout=null,this.updateTimeline=this.updateTimeline.bind(this),this.updateProgress=this.updateProgress.bind(this),this.audioResyncFrames=0}return Object(y.a)(e,[{key:"getCurrentSong",value:function(){return this.sources.song[this.currentSong]}},{key:"getCurrentPreview",value:function(){return this.sources.preview[this.currentPreview]}},{key:"storeAudioSource",value:function(e){var t=this;this.sources.song[e.hash]||(this.setLoadingAudio(!0),this.sources.song[e.hash]={title:e.title},this.sources.song[e.hash].audio=new X.Howl({src:"https://dl.dropboxusercontent.com/s/".concat(e.dAudioUrl),format:["mp3"],html5:!0,onload:function(){t.setLoadingAudio(!1)},onloaderror:function(e,t,n){alert("".concat(e,";;; ").concat(t,";;; ").concat(n))},onplay:function(){t.getCurrentSong().tl.play(),t.resync(),O.a.ticker.add(t.updateProgress),K.dispatch((function(e){e({type:"PLAY_CHART_AUDIO"})}))},onpause:function(){t.getCurrentSong().tl.pause(),O.a.ticker.remove(t.updateTimeline),O.a.ticker.remove(t.updateProgress),K.dispatch((function(e){e({type:"PAUSE_CHART_AUDIO"})}))},onseek:function(){},onstop:function(){console.log("song stopped"),t.getCurrentSong().tl&&t.getCurrentSong().tl.restart().pause(),O.a.ticker.remove(t.updateTimeline),K.dispatch((function(e){e({type:"STOP_CHART_AUDIO"})}))},onend:function(e){console.log("song ended"),O.a.ticker.remove(t.updateTimeline),K.dispatch((function(e){e({type:"STOP_CHART_AUDIO"})}))}}),this.sources.preview[e.hash]={title:e.title},this.sources.preview[e.hash].audio=new X.Howl({src:"https://dl.dropboxusercontent.com/s/".concat(e.dAudioUrl),format:["mp3"],html5:!0,sprite:{sample:[parseFloat(1e3*(e.sampleStart-.12)),parseFloat(1e3*e.sampleLength)]},onplay:function(){K.dispatch((function(e){e({type:"PLAY_PREVIEW_AUDIO"})}))},onstop:function(){clearTimeout(t.previewFadeTimeout),t.currentPreviewId=null,K.dispatch((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))},onend:function(){clearTimeout(t.previewFadeTimeout),t.currentPreviewId=null,K.dispatch((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))}}))}},{key:"selectSong",value:function(e){this.currentSong&&this.getCurrentSong().audio.stop(this.currentSongId),this.storeAudioSource(e),this.currentSong=e.hash}},{key:"setTimeline",value:function(e){this.getCurrentSong().tl=e}},{key:"resync",value:function(){this.audioResyncFrames=10,O.a.ticker.add(this.updateTimeline)}},{key:"updateTimeline",value:function(){this.getCurrentSong().tl.time(this.getCurrentTime()+.07),this.audioResyncFrames--,this.audioResyncFrames<=0&&O.a.ticker.remove(this.updateTimeline)}},{key:"updateProgress",value:function(e,t,n){if(n%15===0){var a=this.getCurrentSong().audio,r=a.seek()/a.duration();K.dispatch(G(r))}}},{key:"play",value:function(){this.currentSongId=this.getCurrentSong().audio.play()}},{key:"pause",value:function(){this.getCurrentSong().audio.pause(this.currentSongId)}},{key:"stop",value:function(){this.getCurrentSong().audio.stop(this.currentSongId),this.currentSongId=null}},{key:"getCurrentTime",value:function(){return this.getCurrentSong().audio.seek()}},{key:"goBack",value:function(e){this.seekTime(this.getCurrentTime()-.001*e),this.getCurrentSong().tl.time(this.getCurrentTime()+.07)}},{key:"goForward",value:function(e){this.seekTime(this.getCurrentTime()+.001*e),this.getCurrentSong().tl.time(this.getCurrentTime()+.07)}},{key:"seekTime",value:function(e){this.getCurrentSong().audio.seek(e),this.resync()}},{key:"seekProgress",value:function(e){this.seekTime(e*this.getCurrentSong().audio.duration()),K.dispatch(G(e))}},{key:"isPlaying",value:function(){return this.getCurrentSong()&&this.getCurrentSong().audio.playing(this.currentSongId)}},{key:"isPaused",value:function(){return this.getCurrentSong()&&!this.getCurrentSong().audio.playing(this.currentSongId)}},{key:"playSongPreview",value:function(e){var t=this;this.currentPreview&&this.getCurrentPreview().audio.stop(this.currentPreviewId),this.storeAudioSource(e),this.currentPreview=e.hash;var n=this.getCurrentPreview().audio;this.currentPreviewId=n.play("sample"),n.on("play",(function(){var n=t.getCurrentPreview().audio;n.fade(0,1,200),t.previewFadeTimeout=setTimeout((function(){n.fade(1,0,2e3)}),1e3*e.sampleLength-2e3)}))}},{key:"stopSongPreview",value:function(){this.currentPreview&&this.getCurrentPreview().audio.stop(this.currentPreviewId)}},{key:"isPreviewPlaying",value:function(){return this.getCurrentPreview()&&this.getCurrentPreview().audio.playing(this.currentPreviewId)}}]),e}());function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=function(){function e(t,n){Object(b.a)(this,e),this.canvas=t,this.c=t.getContext("2d"),this.tl=O.a.timeline(),this.sm=n,this.simfiles={},this.eventList=[],this.arrows=[],this.shockArrows=[],this.drawBackground(),this.globalParams={beatTick:0,frame:0},this.sm&&(this.simfiles=U(this.sm)),this.mainLoop()}return Object(y.a)(e,[{key:"generateEventList",value:function(e){for(var t=e.bpms,n=e.stops,a=[],r=0,i=0,o=t[0].value;r<t.length&&i<n.length;){var s=t[r],c=n[i];c.beat<=s.beat?(a.push(te({},c,{bpm:o,type:"stop"})),i++):(a.push(te({},s,{type:"bpm"})),o=s.value,r++)}for(;r<t.length;)a.push(te({},t[r],{type:"bpm"})),r++;for(;i<n.length;)a.push(te({},n[i],{bpm:o,type:"stop"})),i++;a[0].timestamp=0;for(var l=1;l<a.length;l++){var u=a[l-1],f=a[l],h=a[l-1].timestamp,d=(f.beat-u.beat)/("bpm"===u.type?u.value:u.bpm)*60;"stop"===u.type&&(d+=u.value);var p=h+d;f.timestamp=p}return this.eventList=a,a}},{key:"generateArrows",value:function(e,t){var n=this,a=e.chart;if(Array.isArray(a[0])){var r=[];a.forEach((function(e){r.push.apply(r,Object(v.a)(e))})),a=r}(a=z(a,t)).forEach((function(e,t){var n=e.measureIdx,r=e.measureN,i=e.measureD;e.currentBeatPosition=4*(n+r/i),e.originalBeatPosition=e.currentBeatPosition;for(var o=0;o<e.note.length;o++)if("3"===e.note[o])for(var s=t-1;s>=0;s--)if("2"===a[s].note[o]){a[s].holdBeats||(a[s].holdBeats=[]),e.holdBeats||(e.holdBeats=[]),a[s].holdBeats[o]=e.currentBeatPosition-a[s].currentBeatPosition,e.holdBeats[o]=e.currentBeatPosition-a[s].currentBeatPosition;break}})),a.forEach((function(e,a){if("M"===e.note[0]||"M"===e.note[4]){var r=new C(te({key:a},e,{mods:t}));n.shockArrows.push(r)}else{var i=new L(te({key:a},e,{mods:t}));n.arrows.push(i)}})),this.stepZone=new R}},{key:"initTimeline",value:function(e){var t;this.resetArrows();var n=0,a=this.arrows[this.arrows.length-1],r=this.eventList[this.eventList.length-1],i=0;a&&r?i=Math.max(a.originalBeatPosition,r.beat):a?i=a.originalBeatPosition:r&&(i=r.beat),i+=8,this.tl=this.tl.to({},{duration:0},0);for(var o=0;o<this.eventList.length;o++){var s=this.eventList[o],c=this.eventList[o+1],l="stop"===s.type?s.value:0;if("bpm"===s.type?t=s.value:"stop"===s.type&&(t=s.bpm),c){var u=c.beat-s.beat,f=u/t*60;this.tl=this.tl.to(this.globalParams,{beatTick:n+u,duration:f,ease:"none"},"+=".concat(l)),n+=u}else this.tl=this.tl.to(this.globalParams,{beatTick:i,duration:(i-n)/t*60,ease:"none"},"+=".concat(l))}this.guidelines=new B({mods:e,finalBeat:i}),$.setTimeline(this.tl)}},{key:"resetArrows",value:function(){this.arrows.forEach((function(e){return e.reset()}))}},{key:"mainLoop",value:function(){this.drawBackground(),this.stepZone&&this.stepZone.render(this.canvas,this.globalParams.beatTick),this.guidelines&&this.guidelines.render(this.canvas,this.globalParams.beatTick);for(var e=this.shockArrows.length-1;e>=0;e--){this.shockArrows[e].render(this.canvas,this.globalParams.frame,this.globalParams.beatTick)}for(var t=this.arrows.length-1;t>=0;t--){this.arrows[t].render(this.canvas,this.globalParams.beatTick)}this.globalParams.frame++,window.requestAnimationFrame(this.mainLoop.bind(this))}},{key:"drawBackground",value:function(){this.c.fillStyle="black",this.c.fillRect(0,0,this.canvas.width,this.canvas.height)}},{key:"toggleTl",value:function(){this.tl.paused()?(console.log("tl.play()"),this.tl.play()):(console.log("tl.pause()"),this.tl.pause())}},{key:"restartTl",value:function(){this.tl.restart().pause(),this.resetArrows()}},{key:"pauseTl",value:function(){this.tl.pause()}}]),e}(),ae=function(e){var t=Object(a.useRef)(),n=e.progress;Object(a.useEffect)((function(){t.current.addEventListener("touchstart",(function(e){i(e.touches[0])})),t.current.addEventListener("touchmove",(function(e){i(e.touches[0])})),t.current.addEventListener("touchend",(function(e){}))}),[]);var i=function(e){var n=t.current.offsetWidth,a=(e.clientX-t.current.offsetLeft)/n;a<0||a>1||$.seekProgress(a)};return r.a.createElement("div",{id:"progress-bar",ref:t},r.a.createElement("div",{className:"progress-value",style:{width:"".concat(100*n,"%")}}))},re=Object(s.b)((function(e){return{audio:e.audio.chartAudio}}),(function(e){return{}}))((function(e){var t=e.selectedDifficulty,n=(e.selectedSong,e.sm),i=e.mods,o=(e.selectedAudio,e.loadingAudio),s=e.gameEngine,c=e.setGameEngine,l=Object(a.useState)(null),u=Object(f.a)(l,2),h=u[0],p=u[1],v=Object(a.useState)(!1),g=Object(f.a)(v,2),b=(g[0],g[1]);Object(a.useEffect)((function(){if(!o){var e=document.querySelector("#chartArea");p(e);var t=new m.a(e);t.on("panup",(function(e){$.goForward(20)})),t.on("pandown",(function(e){$.goBack(20)}))}}),[o]),Object(a.useEffect)((function(){if(h){var e=new ne(h,n);if(t){var a=e.simfiles["single_".concat(t)];a&&(e.generateEventList(a),e.generateArrows(a,i),e.initTimeline(i),e.restartTl()),c(e)}}}),[h,n,t,i]);return r.a.createElement("div",{className:"canvas-container"},o&&r.a.createElement("div",null,"Loading audio..."),!o&&r.a.createElement(r.a.Fragment,null,r.a.createElement("canvas",{id:"chartArea",width:"256",height:"512"}),r.a.createElement("div",{className:"progress-container"},r.a.createElement(ae,{progress:e.audio.progress}))),r.a.createElement("div",{className:"play-controls"},r.a.createElement(d.a,{onClick:function(){s&&($.isPlaying()?($.pause(),b(!1)):($.play(),b(!0)))},disabled:!(s&&!o)},"playing"===e.audio.status?"Pause":"Play"),r.a.createElement(d.a,{onClick:function(){s&&($.stop(),b(!1))}},"Restart")))})),ie=n(326),oe=function(e){var t=e.displayedSongs,n=e.onSongSelect,a=e.selectedSongOption,i=t,o=function(e){return r.a.createElement("div",{className:"songTile-wrapper",key:"songtile_".concat(e.hash),onClick:function(){return function(e){n(null,{value:e.hash})}(e)}},r.a.createElement("div",{className:"songTile ".concat(a===e.hash?"selected":"")},r.a.createElement("div",{className:"song-jacket-wrapper"},r.a.createElement("img",{className:"song-jacket",src:A("".concat(e.hash,".png")),title:e.title,alt:e.title})),r.a.createElement("div",{className:"song-title-bar"},e.title)))};return r.a.createElement("div",{className:"songGrid-container"},r.a.createElement("div",{className:"songGrid"},i.map((function(e){return o(e)}))))},se={difficulty:["Beginner","Basic","Difficult","Expert","Challenge"],mods:{speed:[.25,.5,.75,1,1.25,1.5,1.75,2,2.25,2.5,2.75,3,3.25,3.5,3.75,4,4.5,5,5.5,6,6.5,7,7.5,8],turn:["off","mirror","left","right","shuffle"],shuffle:[1,2,3,4,5,6,7,8],noteskin:["rainbow","note","vivid","flat"]}},ce="Expert",le={speed:2.5,turn:"off",shuffle:1,noteskin:"note"};function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function fe(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var he=r.a.createElement("path",{id:"Line_1","data-name":"Line 1",d:"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z"}),de=r.a.createElement("path",{id:"Line_2","data-name":"Line 2",d:"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z"}),pe=r.a.createElement("path",{id:"Line_3","data-name":"Line 3",d:"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z"}),me=r.a.createElement("path",{id:"Line_4","data-name":"Line 4",d:"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z"}),ve=r.a.createElement("path",{id:"Line_5","data-name":"Line 5",d:"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z"}),ge=r.a.createElement("path",{id:"Line_6","data-name":"Line 6",d:"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z"}),be=r.a.createElement("path",{id:"Line_7","data-name":"Line 7",d:"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z"}),ye=r.a.createElement("path",{id:"Line_8","data-name":"Line 8",d:"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z"}),Oe=r.a.createElement("path",{id:"Line_9","data-name":"Line 9",d:"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z"}),we=function(e){var t=e.svgRef,n=e.title,a=fe(e,["svgRef","title"]);return r.a.createElement("svg",ue({id:"audioWave","data-name":"Layer 1",viewBox:"0 0 50 38.05",ref:t},a),n?r.a.createElement("title",null,n):null,he,de,pe,me,ve,ge,be,ye,Oe)},Ee=r.a.forwardRef((function(e,t){return r.a.createElement(we,ue({svgRef:t},e))}));n.p;function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _e=Object(s.b)((function(e){return{previewAudio:e.audio.previewAudio}}),(function(e){return{}}))((function(e){var t=e.activeView,n=(e.setActiveView,e.simfileList),i=e.selectedDifficulty,o=(e.loadingAudio,e.previewAudio),s=n.map((function(e){return{key:e.hash,value:e.hash,text:e.title}})),c=Object(a.useState)(null),h=Object(f.a)(c,2),d=h[0],p=h[1],m=Object(a.useState)(i),v=Object(f.a)(m,2),g=v[0],b=v[1],y=Object(a.useState)({title:"all",version:16,level:"all"}),O=Object(f.a)(y,2),w=O[0],S=O[1],j=Object(a.useState)([]),D=Object(f.a)(j,2),I=D[0],L=D[1];Object(a.useEffect)((function(){var e=w.title,t=w.version,a=w.level,r=n.filter((function(n){return("all"===e||e===n.abcSort)&&("all"===t||t===parseInt(n.version))&&("all"===a||n.levels.slice(0,5).includes(a))}));L(r)}),[w]);var T=Object(a.useState)(null),C=Object(f.a)(T,2),x=C[0],N=C[1],R=[{key:"title_all",value:"all",text:"ALL"}].concat(P.map((function(e){return{key:"title_".concat(e),value:e,text:e}}))),B=[{key:"version_all",value:"all",text:"ALL"}].concat(E.map((function(e,t){return{key:"version_".concat(t),value:t,text:e}})).reverse()),F=[{key:"level_all",value:"all",text:"ALL"}].concat(_.map((function(e){return{key:"level_".concat(e),value:e,text:e}})));Object(a.useEffect)((function(){M(null,{value:"q0QIob1PDI6IP86dlPb6I6il9d6bP606"})}),[]),Object(a.useEffect)((function(){if(d){var e=n.find((function(e){return e.hash===d}));N(e),$.storeAudioSource(e)}}),[d]);var M=function(){var t=Object(u.a)(l.a.mark((function t(a,r){var i,o,s,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.value,p(i),console.log("setSelectedSongOption",i),$.stopSongPreview(),o=n.find((function(e){return e.hash===i})),console.log("selectedFilters.level",w.level),!w.level){t.next=19;break}s=0;case 8:if(!(s<o.levels.length)){t.next=17;break}if((c=o.levels[s])!==w.level){t.next=14;break}return console.log("match",k[s],c),V(k[s]),t.abrupt("break",17);case 14:s++,t.next=8;break;case 17:t.next=20;break;case 19:e.onDifficultySelect(g);case 20:e.onSongSelect(o);case 21:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),V=function(t){b(t),e.onDifficultySelect(t)};return r.a.createElement("div",{className:"form-container songView ".concat("song"===t?"open":"closed")},r.a.createElement("form",{className:"songForm"},r.a.createElement("div",{className:"form-inner-wrapper"},r.a.createElement("div",{className:"selectedSong"},r.a.createElement("div",{className:"selectedSong-jacket-wrapper ".concat("playing"===o.status?"playing":"")},r.a.createElement("div",{className:"selectedSong-jacket-overlay"},r.a.createElement(Ee,null)),r.a.createElement("img",{className:"selectedSong-jacket",src:A("".concat(d,".png")),alt:"Selected song",onClick:function(){$.currentPreview===x.hash?"playing"===o.status?$.stopSongPreview():$.playSongPreview(x):("playing"===o.status&&$.stopSongPreview(),$.playSongPreview(x))}})),r.a.createElement("div",{className:"selectedSong-info"},r.a.createElement(ie.a,{placeholder:"Choose a song",className:"song-title-dropdown",search:!0,selection:!0,value:d,onChange:M,options:s}),r.a.createElement("div",{className:"song-artist"},x&&x.artist),r.a.createElement("div",{className:"song-difficulties"},x?x.levels.slice(0,5).map((function(e,t){if(!e)return null;var n=k[t];return r.a.createElement("div",{className:"song-difficulty ".concat(n," ").concat(g===n?"selected":""),key:"sp-difficulty_".concat(n),onClick:function(){return V(n)}},r.a.createElement("div",{className:"difficulty"},n),r.a.createElement("div",{className:"level"},e))})):null))),r.a.createElement("div",{className:"songForm-filters"},r.a.createElement("div",{className:"form-field"},r.a.createElement("label",null,"By Title"),r.a.createElement(ie.a,{className:"title-filter-dropdown",selection:!0,value:w.title,onChange:function(e,t){return S(Pe({},w,{title:t.value}))},options:R})),r.a.createElement("div",{className:"form-field"},r.a.createElement("label",null,"By Version"),r.a.createElement(ie.a,{className:"version-filter-dropdown",selection:!0,value:w.version,onChange:function(e,t){return S(Pe({},w,{version:t.value}))},options:B})),r.a.createElement("div",{className:"form-field"},r.a.createElement("label",null,"By Level"),r.a.createElement(ie.a,{className:"level-filter-dropdown",selection:!0,value:w.level,onChange:function(e,t){return S(Pe({},w,{level:t.value}))},options:F}))))),r.a.createElement(oe,{displayedSongs:I,onSongSelect:M,selectedSongOption:d}))})),Se=n(328);function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ae=function(e){var t=e.activeView,n=(e.simfileList,e.selectedDifficulty,e.mods),i=e.setMods,o=(e.gameEngine,Object(a.useState)(0)),s=Object(f.a)(o,2),c=(s[0],s[1],function(e){i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Object(g.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{},e))});return r.a.createElement("div",{className:"form-container ".concat("mods"===t?"open":"closed")},r.a.createElement("form",null,r.a.createElement("div",{className:"form-field"},r.a.createElement("h4",{className:"form-label"},"Speed"),se.mods.speed.map((function(e){return r.a.createElement(Se.a,{key:"speed_".concat(e),label:"".concat(e,"x"),name:"speed",value:e,checked:n.speed===e,onChange:function(){return c({speed:e})}})}))),r.a.createElement("div",{className:"form-field"},r.a.createElement("h4",{className:"form-label"},"Arrow color"),se.mods.noteskin.map((function(e){return r.a.createElement(Se.a,{key:"noteskin_".concat(e),label:D(e),name:"noteskin",value:e,checked:n.noteskin===e,onChange:function(){return c({noteskin:e})}})}))),r.a.createElement("div",{className:"form-field"},r.a.createElement("h4",{className:"form-label"},"Turn"),se.mods.turn.map((function(e){return r.a.createElement(Se.a,{key:"turn_".concat(e),label:D(e),name:"turn",value:e,checked:n.turn===e,onChange:function(){return c({turn:e})}})}))),"shuffle"===n.turn&&r.a.createElement("div",{className:"form-field"},r.a.createElement("h4",{className:"form-label"},"Shuffle pattern"),se.mods.shuffle.map((function(e){return r.a.createElement(Se.a,{key:"shuffle_".concat(e),label:e,name:"shuffle",value:e,checked:n.shuffle===e,onChange:function(){return c({shuffle:e})}})})))))},De=n(51),Ie=Object(s.b)((function(e){var t=e.audio;return{chartAudio:t.chartAudio,previewAudio:t.previewAudio}}),(function(e){return{stopPreviewAudio:function(){return e((function(e){e({type:"STOP_PREVIEW_AUDIO"})}))}}}))((function(e){var t=e.activeView,n=e.chartAudio,a=(e.previewAudio,function(e){return"song"===e&&"playing"===n.status});return r.a.createElement("nav",{className:"mobileNav"},[{view:"chart",icon:"arrow up"},{view:"song",icon:"music"},{view:"2",icon:""},{view:"3",icon:""},{view:"mods",icon:"sidebar"}].map((function(i){var o=i.view,s=i.icon;return o?r.a.createElement("div",{key:"mobileNavItem_".concat(o),className:"mobileNav_item ".concat(t===o?"active":""," ").concat(a(o)?"disabled":""),onClick:function(){return function(t){"song"===t&&"playing"===n.status||($.stopSongPreview(),e.setActiveView(t))}(o)}},r.a.createElement(De.a,{name:s})):r.a.createElement("div",{className:"mobileNav_item"})})))})),Le=function(e){var t=Object(a.useState)(!0),n=Object(f.a)(t,2),i=n[0],o=n[1],s=Object(a.useState)([]),c=Object(f.a)(s,2),d=c[0],p=c[1],m=Object(a.useState)(null),v=Object(f.a)(m,2),g=v[0],b=v[1],y=Object(a.useState)(null),O=Object(f.a)(y,2),w=O[0],E=O[1],k=Object(a.useState)(ce),P=Object(f.a)(k,2),_=P[0],j=P[1],A=Object(a.useState)(null),D=Object(f.a)(A,2),I=D[0],L=D[1],T=Object(a.useState)(le),C=Object(f.a)(T,2),x=C[0],N=C[1],R=Object(a.useState)("song"),B=Object(f.a)(R,2),F=B[0],M=B[1],V=Object(a.useState)(null),U=Object(f.a)(V,2),H=U[0],z=U[1],X=Object(a.useState)(!1),Z=Object(f.a)(X,2),W=Z[0],G=Z[1];Object(a.useEffect)((function(){(function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y();case 2:o(!1);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()(),$.setLoadingAudio=G}),[]);var Y=function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(h.a)(window.location.href+"/data/simfiles.tsv");case 3:(t=e.sent).forEach((function(e){e.levels=e.levels.split(",").map((function(e){return e?parseInt(e):null}))})),p(t),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=Object(u.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("MainContainer selected song",t),$.selectSong(t),b(t),e.prev=3,e.next=6,S("".concat(window.location.href,"/simfiles/").concat(t.smName,".sm"));case 6:n=e.sent,E(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),alert(e.t0);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),J=function(e){j(e)},Q=function(e){M(e),$.activeView=e};return r.a.createElement("div",{className:"main-container"},!i&&r.a.createElement(r.a.Fragment,null,r.a.createElement(re,{loadingAudio:W,selectedSong:g,selectedDifficulty:_,sm:w,selectedAudio:I,mods:x,gameEngine:H,setGameEngine:z}),r.a.createElement(_e,{activeView:F,setActiveView:Q,simfileList:d,selectedDifficulty:_,onSongSelect:q,onDifficultySelect:J,loadingAudio:W}),r.a.createElement(Ae,{activeView:F,simfileList:d,selectedSong:g,onSongSelect:q,selectedDifficulty:_,onDifficultySelect:J,selectedAudio:I,setSelectedAudio:L,mods:x,setMods:N,gameEngine:H}),r.a.createElement(Ie,{activeView:F,setActiveView:Q})))};var Te=function(){return r.a.createElement("div",{className:"app-container"},r.a.createElement(Le,null))};o.a.render(r.a.createElement(s.a,{store:K},r.a.createElement(Te,null)),document.getElementById("root"))}},[[177,1,2]]]);
//# sourceMappingURL=main.9f55845c.chunk.js.map