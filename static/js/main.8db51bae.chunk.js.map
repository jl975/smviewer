{"version":3,"sources":["constants/index.js","utils/index.js","components/chart/canvas/Arrow.js","components/chart/canvas/ShockArrow.js","components/chart/canvas/StepZone.js","components/chart/canvas/Guidelines.js","utils/parseSimfile.js","utils/engineUtils.js","reducers/AudioReducer.js","actions/ChartActions.js","reducers/ChartReducer.js","components/form/options.js","reducers/ModsReducer.js","actions/SongSelectActions.js","reducers/SongSelectReducer.js","reducers/index.js","actions/AudioActions.js","actions/ModsActions.js","store.js","core/AudioPlayer.js","core/GameEngine.js","components/chart/Progress.js","components/ui/HoldButton.js","components/chart/ShareModal.js","components/chart/ChartArea.js","components/form/SongGrid.js","components/ui/ToggleSwitch.js","svg/audiowave.svg","components/form/SongForm.js","components/form/ModsForm.js","components/navigation/MobileNav.js","containers/main/MainContainer.js","App.js","index.js"],"names":["DIRECTIONS","SP_DIFFICULTIES","DP_DIFFICULTIES","getOriginPath","window","location","search","href","slice","indexOf","fetchDocument","path","a","fetch","mode","response","reader","body","getReader","decoder","TextDecoder","read","readResult","decode","value","getAssetPath","getJacketPath","capitalize","str","toUpperCase","presetParams","obj","split","forEach","param","key","error","console","log","parseUrlParams","arrowImages","direction","Image","src","imageName","Arrow","attrs","mods","speed","noteskin","colorFreezes","this","note","measureIdx","measureN","measureD","originalBeatPosition","holdBeats","hitFrame","previousBeatPosition","beatTick","canvas","directionIdx","arrowImg","frameY","destX","destY","c","getContext","bottomBoundary","height","currentBeatPosition","arrowBodyImg","totalBodyHeight","ARROW_HEIGHT","repetitions","Math","floor","partialHeight","originalPartialHeight","partialDestY","freezeBeingHeld","drawImage","i","bodyHeight","bodyFrameY","bodyDestY","tailHeight","actualDestY","tailPartialHeight","arrowHeadImg","freeze_head","save","globalAlpha","pow","tap_explosion","restore","frameX","includes","beatD","beatN","measureFraction","ARROW_WIDTH","ShockArrow","frame","length","flashImages","receptorImages","StepZone","isFlash","Guidelines","guidelines","finalBeat","showGuidelines","beat","lineWidth","beginPath","moveTo","lineTo","width","strokeStyle","stroke","modeRegex","difficultyRegex","difficultyMap","Beginner","Easy","Medium","Hard","Challenge","parseSimfile","sm","simfileType","simfiles","chartMetadata","bpms","stops","test","exec","map","point","parseFloat","chartStr","smDifficulty","difficulty","level","simfile","levelRegex","RegExp","parseInt","measures","lastIndexOf","trim","measure","ticks","filter","n","startsWith","numTicks","noteObjects","tick","tickIdx","noteObj","push","chart","initialState","chartAudio","status","progress","previewAudio","changeActiveBpm","bpm","dispatch","type","payload","setCombo","combo","activeBpm","bpmChangeQueue","options","turn","shuffle","optionDefaultValues","difficulties","b","B","D","E","C","Object","keys","turnValue","toLowerCase","selectSong","song","combineReducers","audio","state","action","round","updatedMods","songSelect","store","createStore","reducers","compose","applyMiddleware","thunk","devToolsExtension","__REDUX_DEVTOOLS_EXTENSION__","f","sources","preview","assistTick","Howl","currentSong","currentPreview","currentSongId","currentPreviewId","activeView","previewFadeTimeout","updateTimeline","bind","updateProgress","audioResyncFrames","getCurrentSong","seek","initialProgress","hash","setLoadingAudio","title","dAudioUrl","format","html5","onload","seekProgress","onloaderror","id","blah","alert","onplay","tl","play","resync","gsap","ticker","add","startAnimationLoop","onpause","pause","remove","stopAnimationLoop","onseek","onstop","restart","onend","spriteId","sprite","sample","sampleStart","sampleLength","clearTimeout","stop","storeAudioSource","updateProgressOnce","getCurrentTime","currentBpm","params","lastBpmValue","bpmEvent","getCurrentBpm","globalParams","currentCombo","arrows","arrow","timestamp","getCurrentCombo","ms","seekTime","duration","time","deltaTime","actions","updateAnimationLoopOnce","playing","getCurrentPreview","on","fade","setTimeout","GameEngine","timeline","eventList","shockArrows","allArrows","mainLoopRequestRef","drawBackground","AudioPlayer","startLoop","stopLoop","updateLoopOnce","requestAnimationFrame","mainLoop","cancelAnimationFrame","bpmPtr","stopPtr","prevEvent","currentEvent","prevTimestamp","timestampDiff","currentTimestamp","getState","Array","isArray","newChart","turnMap","off","mirror","left","right","shuffle1","shuffle2","shuffle3","shuffle4","shuffle5","shuffle6","shuffle7","shuffle8","turnMod","row","turnedNote","reverse","applyTurnMods","j","shockArrow","stepZone","resetArrows","accumulatedBeatTick","lastArrow","lastEvent","max","startEvent","endEvent","delay","sectionBeatLength","sectionDuration","to","ease","onStart","currentBpmPtr","currentEventPtr","pendingStopPtr","pendingStop","currentStopOffset","idx","bpmSection","event","nextEvent","bpmSectionStartBeat","arrowTimestamp","set","setTimeline","setGlobalParams","reset","loop","render","upArrows","notUpArrows","renderFreezeBody","renderArrow","fillStyle","fillRect","paused","Progress","props","progressBar","useRef","gameEngine","useEffect","current","addEventListener","e","jumpToProgress","touches","totalWidth","offsetWidth","progressPercent","clientX","offsetLeft","ref","className","style","HoldButton","button","requestRef","el","pressingDown","notPressingDown","preventDefault","onClick","handleHold","Button","children","Basic","Difficult","Expert","modes","single","double","ShareModal","modalOpen","setModalOpen","data","shareUrl","useState","message","setMessage","toString","replace","queryStr","join","generateShareUrl","Modal","size","open","onClose","Header","Content","Input","copy","connect","selectedSong","selectedDifficulty","selectedMode","loadingAudio","selectedAudio","setGameEngine","setCanvas","shareModalOpen","setShareModalOpen","chartArea","document","querySelector","transform","position","top","scaleFactor","innerWidth","xOffset","yOffset","useSsc","ge","generateEventList","generateArrows","initTimeline","restartTl","shareParams","goBack","Icon","name","disabled","goForward","artist","levels","SongGrid","displayedSongs","onSongSelect","selectedSongOption","songs","renderSong","alt","ToggleSwitch","option1","option2","selectOption","option","onChange","text","getSwitchClassName","_extends","assign","target","arguments","source","prototype","hasOwnProperty","call","apply","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","d","_ref4","_ref5","_ref6","_ref7","_ref8","_ref9","_ref10","_ref","svgRef","viewBox","ForwardRef","forwardRef","titleSortOptions","concat","letter","versionSortOptions","versionName","levelSortOptions","difficultySortOptions","simfileList","songGridContainer","simfileOptions","setSelectedSongOption","selectedDifficultyOption","setSelectedDifficultyOption","version","selectedFilters","setSelectedFilters","setDisplayedSongs","abcSort","scrollTop","setSelectedSong","click","find","songHash","stopSongPreview","handleDifficultySelect","selectedDiffOptionIndex","onDifficultySelect","playSongPreview","Dropdown","placeholder","selection","selectOnBlur","selectOnNavigation","renderDifficulties","onModeSelect","updateMods","Radio","label","checked","Checkbox","toggle","stopPreviewAudio","isDisabled","view","icon","navItem","setActiveView","selectDifficulty","selectMode","loadingSimfiles","setLoadingSimfiles","setSimfileList","selectedSM","setSelectedSM","fetchSimfiles","fetchData","tsv","parsedTsv","smName","random","encodeURIComponent","changeActiveView","App","ReactDOM","getElementById"],"mappings":"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","file":"static/js/main.8db51bae.chunk.js","sourcesContent":["export const ARROW_WIDTH = 64;\nexport const ARROW_HEIGHT = 64;\n\n/* Height of one repetition of the freeze body pattern */\nexport const FREEZE_BODY_HEIGHT = 128;\n\nexport const DIRECTIONS = [\"left\", \"down\", \"up\", \"right\"];\n\n/* Number of seconds that the visuals are delayed relative to the audio */\n// export const GLOBAL_OFFSET = 0.012;\n\n/* \n  Offset of the visuals (i.e. chart, gsap timeline) relative to the audio.\n  Positive value represents notes being earlier (have to hit earlier than the music)\n  Negative value represents notes being later (have to hit later than the music)\n*/\nexport const GLOBAL_OFFSET = 0.07;\n\nexport const MARVELOUS_FLASH_FRAMES = 12;\n\n/* Number of beats played after the last note or event until the timeline ends */\nexport const END_EXTRA_BEATS = 8;\n\nexport const DDR_VERSIONS = [\n  \"DDR 1st\",\n  \"DDR 2ndMIX\",\n  \"DDR 3rdMIX\",\n  \"DDR 4thMIX\",\n  \"DDR 5thMIX\",\n  \"DDRMAX\",\n  \"DDRMAX2\",\n  \"DDR EXTREME\",\n  \"DDR SuperNOVA\",\n  \"DDR SuperNOVA 2\",\n  \"DDR X\",\n  \"DDR X2\",\n  \"DDR X3 VS 2ndMIX\",\n  \"DDR (2013)\",\n  \"DDR (2014)\",\n  \"DDR A\",\n  \"DDR A20\",\n];\n\nexport const SP_DIFFICULTIES = [\n  \"Beginner\",\n  \"Basic\",\n  \"Difficult\",\n  \"Expert\",\n  \"Challenge\",\n];\nexport const DP_DIFFICULTIES = [\"Basic\", \"Difficult\", \"Expert\", \"Challenge\"];\n\nexport const TITLE_CATEGORIES = [\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"\",\n  \"A\",\n  \"B\",\n  \"C\",\n  \"D\",\n  \"E\",\n  \"F\",\n  \"G\",\n  \"H\",\n  \"I\",\n  \"J\",\n  \"K\",\n  \"L\",\n  \"M\",\n  \"N\",\n  \"O\",\n  \"P\",\n  \"Q\",\n  \"R\",\n  \"S\",\n  \"T\",\n  \"U\",\n  \"V\",\n  \"W\",\n  \"X\",\n  \"Y\",\n  \"Z\",\n  \"NUM\",\n];\n\nexport const LEVELS = [\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  16,\n  17,\n  18,\n  19,\n];\n","export const getOriginPath = () => {\n  if (window.location.search)\n    return window.location.href.slice(\n      0,\n      window.location.href.indexOf(window.location.search)\n    );\n  return window.location.href;\n};\n\nexport const fetchDocument = async (path) => {\n  const response = await fetch(path, {\n    mode: \"cors\",\n  });\n  const reader = response.body.getReader();\n  const decoder = new TextDecoder(\"utf-8\");\n  const readResult = await reader.read();\n  return decoder.decode(readResult.value);\n};\n\nexport const getAssetPath = (path) => {\n  return getOriginPath() + \"assets/\" + path;\n};\n\nexport const getJacketPath = (path) => {\n  return getOriginPath() + \"jackets/\" + path;\n};\n\nexport const capitalize = (str) => {\n  return str.slice(0, 1).toUpperCase() + str.slice(1);\n};\n\nconst parseUrlParams = () => {\n  if (!window.location.search) return {};\n  const obj = {};\n  try {\n    window.location.search\n      .slice(1)\n      .split(\"&\")\n      .forEach((param) => {\n        const [key, value] = param.split(\"=\");\n        obj[key] = value;\n      });\n    return obj;\n  } catch (error) {\n    console.log(\"error parsing url params\", error);\n    return {};\n  }\n};\nexport const presetParams = parseUrlParams();\n","import {\n  DIRECTIONS,\n  ARROW_WIDTH,\n  ARROW_HEIGHT,\n  FREEZE_BODY_HEIGHT,\n  MARVELOUS_FLASH_FRAMES,\n} from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`rainbow_${direction}`] = new Image();\n  arrowImages[`rainbow_${direction}`].src = getAssetPath(\n    `rainbow_${direction}.png`\n  );\n  arrowImages[`note_${direction}`] = new Image();\n  arrowImages[`note_${direction}`].src = getAssetPath(`note_${direction}.png`);\n  arrowImages[`vivid_${direction}`] = new Image();\n  arrowImages[`vivid_${direction}`].src = getAssetPath(\n    `vivid_${direction}.png`\n  );\n  arrowImages[`flat_${direction}`] = new Image();\n  arrowImages[`flat_${direction}`].src = getAssetPath(`vivid_${direction}.png`);\n\n  arrowImages[`freeze_tail_active_${direction}`] = new Image();\n  arrowImages[`freeze_tail_active_${direction}`].src = getAssetPath(\n    `freeze_tail_active_${direction}.png`\n  );\n  arrowImages[`freeze_tail_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_tail_inactive_${direction}`].src = getAssetPath(\n    `freeze_tail_inactive_${direction}.png`\n  );\n\n  arrowImages[`freeze_body_active_${direction}`] = new Image();\n  arrowImages[`freeze_body_active_${direction}`].src = getAssetPath(\n    `freeze_body_active_${direction}.png`\n  );\n  arrowImages[`freeze_body_inactive_${direction}`] = new Image();\n  arrowImages[`freeze_body_inactive_${direction}`].src = getAssetPath(\n    `freeze_body_inactive_${direction}.png`\n  );\n\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nconst miscImages = [\"freeze_head\", \"tap_explosion\"];\nmiscImages.forEach((imageName) => {\n  arrowImages[imageName] = new Image();\n  arrowImages[imageName].src = getAssetPath(`${imageName}.png`);\n});\n\nclass Arrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin, colorFreezes } = mods;\n\n    this.key = key; // arrow index\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n    this.measureIdx = attrs.measureIdx;\n    this.measureN = attrs.measureN;\n    this.measureD = attrs.measureD;\n    this.colorFreezes = colorFreezes;\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n    this.holdBeats = attrs.holdBeats || null;\n\n    this.hitFrame = 0; // frame for showing the Marvelous flash\n\n    // can be used to detect the moment that the arrow passes a certain position\n    // even without landing precisely on it\n    this.previousBeatPosition = null;\n  }\n\n  reset() {\n    this.hitFrame = 0;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  renderFreezeBody(canvas, beatTick, directionIdx) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // freeze body and tail\n    if (this.note[directionIdx] === \"3\") {\n      arrowImg = arrowImages[`freeze_tail_inactive_${direction}`];\n      frameX = 0;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      // Bottom of freeze body must be the bottom of the body image (yellow part of gradient)\n      // and line up with the top of the freeze tail.\n      // Extend the freeze body upwards using as many repetitions of the 128px height image as needed.\n      // Top of freeze body is cut off at the midpoint of the freeze head.\n      let arrowBodyImg = arrowImages[`freeze_body_inactive_${direction}`];\n      const totalBodyHeight =\n        this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed -\n        ARROW_HEIGHT / 2;\n      const repetitions = Math.floor(totalBodyHeight / FREEZE_BODY_HEIGHT);\n      let partialHeight = totalBodyHeight % FREEZE_BODY_HEIGHT;\n      const originalPartialHeight = partialHeight;\n\n      let partialDestY = destY - (totalBodyHeight + ARROW_HEIGHT / 2);\n      let freezeBeingHeld = false;\n\n      // shrink in size once it reaches the target\n      // this is also where the freeze starts to be held down\n      if (partialDestY <= 0) {\n        partialHeight += partialDestY;\n        partialDestY = 0;\n        arrowImg = arrowImages[`freeze_tail_active_${direction}`];\n        arrowBodyImg = arrowImages[`freeze_body_active_${direction}`];\n\n        if (destY >= 0) {\n          freezeBeingHeld = true;\n        }\n      }\n\n      // draw partial\n      if (partialDestY > -partialHeight && partialDestY < bottomBoundary) {\n        c.drawImage(\n          arrowBodyImg,\n          0,\n          FREEZE_BODY_HEIGHT - partialHeight,\n          ARROW_WIDTH,\n          partialHeight,\n          destX,\n          partialDestY + ARROW_HEIGHT / 2,\n          ARROW_WIDTH,\n          partialHeight\n        );\n      }\n\n      // draw repetitions of freeze body\n      for (let i = 1; i <= repetitions; i++) {\n        let bodyHeight = FREEZE_BODY_HEIGHT;\n        let bodyFrameY = 0;\n        let bodyDestY =\n          destY -\n          (totalBodyHeight +\n            ARROW_HEIGHT / 2 -\n            originalPartialHeight -\n            FREEZE_BODY_HEIGHT * (i - 1));\n        if (bodyDestY < 0 && bodyDestY > -FREEZE_BODY_HEIGHT) {\n          bodyHeight += bodyDestY;\n          bodyFrameY -= bodyDestY;\n          bodyDestY = 0;\n        }\n        if (bodyDestY > -bodyHeight && bodyDestY < bottomBoundary) {\n          c.drawImage(\n            arrowBodyImg,\n            0,\n            bodyFrameY,\n            ARROW_WIDTH,\n            bodyHeight,\n            destX,\n            bodyDestY + ARROW_HEIGHT / 2,\n            ARROW_WIDTH,\n            bodyHeight\n          );\n        }\n      }\n\n      let tailHeight = ARROW_HEIGHT;\n\n      // if the freeze is shorter than the height of the tail sprite,\n      // cut off the top of the sprite such that it starts at the midpoint of the freeze head\n\n      // Because we need to overwrite destY for proper sprite placement in the event that the\n      // top of the sprite needs to be cut off, store the actual Y position of the arrow\n      // in a separate variable\n      let actualDestY = destY;\n\n      if (\n        this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed <\n        ARROW_HEIGHT / 2\n      ) {\n        const tailPartialHeight =\n          this.holdBeats[directionIdx] * ARROW_HEIGHT * this.speed; // distance between head note and tail note\n        frameY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        destY += ARROW_HEIGHT / 2 - tailPartialHeight;\n        tailHeight = tailPartialHeight + ARROW_HEIGHT / 2;\n      }\n\n      // shrink in size once it reaches the target\n      if (destY < ARROW_HEIGHT / 2 && destY > topBoundary) {\n        frameY += ARROW_HEIGHT / 2 - destY;\n        destY = ARROW_HEIGHT / 2;\n      }\n\n      if (actualDestY > topBoundary && actualDestY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          tailHeight,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          tailHeight\n        );\n      }\n\n      // render head of held freeze arrow on top of the arrow body\n      if (freezeBeingHeld) {\n        const arrowHeadImg = arrowImages.freeze_head;\n        if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n          c.drawImage(\n            arrowHeadImg,\n            DIRECTIONS.indexOf(direction) * ARROW_WIDTH,\n            ARROW_HEIGHT * 2,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            directionIdx * ARROW_WIDTH,\n            0,\n            ARROW_WIDTH,\n            ARROW_HEIGHT\n          );\n        }\n      }\n\n      // flash at the end of successfully held down freeze\n      if (actualDestY <= 0) {\n        if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n          c.save();\n          c.globalAlpha =\n            1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n          c.drawImage(\n            arrowImages.tap_explosion,\n            0,\n            0,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            destX - this.hitFrame,\n            0 - this.hitFrame,\n            ARROW_WIDTH + this.hitFrame * 2,\n            ARROW_HEIGHT + this.hitFrame * 2\n          );\n          c.restore();\n          this.hitFrame++;\n        }\n      } else {\n        this.hitFrame = 0;\n      }\n    }\n\n    this.previousBeatPosition = this.currentBeatPosition(beatTick);\n  }\n\n  renderArrow(canvas, beatTick, directionIdx) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height; // can be adjusted with SUDDEN+\n\n    // nothing\n    if (this.note[directionIdx] === \"0\") return;\n\n    let arrowImg;\n    let frameX, frameY, destX, destY;\n    const direction = DIRECTIONS[directionIdx % 4];\n\n    // regular note\n    if (\n      this.note[directionIdx] === \"1\" ||\n      (this.note[directionIdx] === \"2\" && this.colorFreezes)\n    ) {\n      // console.log(\"arrow\", directionIdx);\n      arrowImg = arrowImages[`${this.noteskin}_${direction}`];\n\n      // color as freeze head if it is hit simultaneously with a freeze arrow\n      if (this.note.includes(\"2\") && !this.colorFreezes) {\n        arrowImg = arrowImages.freeze_head;\n        frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n        frameY = 0;\n      } else {\n        if (this.noteskin === \"rainbow\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (this.noteskin === \"note\") {\n          frameX = (Math.floor(beatTick * 4) % 8) * ARROW_WIDTH;\n\n          /* \n              NOTE: In the future, if we want to support color codes for 12ths, 24ths, etc.\n              We need to use more precise math to avoid rounding errors.\n              Planned approach: Reduce the measure fraction by dividing both numerator and denominator\n              by their greatest common factor.\n              If GCF == 1, 2, or 4, use 4th note quantization.\n              Otherwise, the resulting denominator is used for the quantization (3 and 6 may be treated as 12ths)\n            */\n          const measureFraction = this.measureN / this.measureD;\n          if ([0, 1 / 4, 2 / 4, 3 / 4].includes(measureFraction)) {\n            frameY = 0;\n          } else if ([1 / 8, 3 / 8, 5 / 8, 7 / 8].includes(measureFraction)) {\n            frameY = 1;\n          } else if (\n            [\n              1 / 16,\n              3 / 16,\n              5 / 16,\n              7 / 16,\n              9 / 16,\n              11 / 16,\n              13 / 16,\n              15 / 16,\n            ].includes(measureFraction)\n          ) {\n            frameY = 3;\n          } else {\n            frameY = 2;\n          }\n          frameY *= ARROW_HEIGHT;\n        } else if (this.noteskin === \"vivid\") {\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n\n          const beatD = this.measureD / 4;\n          const beatN = this.measureN % beatD;\n          const noteOffset = Math.floor(beatTick) % 4;\n\n          if (beatN === 0) {\n            frameY = 0;\n          } else if (0 < beatN && beatN <= beatD / 4) {\n            frameY = 1;\n          } else if (beatD / 4 < beatN && beatN <= beatD / 2) {\n            frameY = 2;\n          } else if (beatD / 2 < beatN && beatN <= (3 * beatD) / 4) {\n            frameY = 3;\n          } else if ((3 * beatD) / 4 < beatN && beatN < beatD) {\n            frameY = 0;\n          }\n          frameY = ((frameY + noteOffset) % 4) * ARROW_HEIGHT;\n        } else if (this.noteskin === \"flat\") {\n          arrowImg = arrowImages[`vivid_${direction}`];\n\n          frameX = (Math.floor(beatTick * 4) % 4) * ARROW_WIDTH;\n          frameY = (Math.floor(beatTick) % 4) * ARROW_HEIGHT;\n        }\n      }\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n      if (destY <= 0) {\n        if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n          c.save();\n          c.globalAlpha =\n            1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n          c.drawImage(\n            arrowImages.tap_explosion,\n            0,\n            0,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            destX - 2 - this.hitFrame,\n            0 - 2 - this.hitFrame,\n            ARROW_WIDTH + 4 + this.hitFrame * 2,\n            ARROW_HEIGHT + 4 + this.hitFrame * 2\n          );\n          c.restore();\n          this.hitFrame++;\n        }\n      } else {\n        this.hitFrame = 0;\n      }\n    }\n\n    // freeze note\n    else if (this.note[directionIdx] === \"2\") {\n      arrowImg = arrowImages.freeze_head;\n      frameX = DIRECTIONS.indexOf(direction) * ARROW_WIDTH;\n      frameY = 0;\n\n      destX = directionIdx * ARROW_WIDTH;\n      destY = this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      // draw freeze head\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n\n      // target flash\n      if (destY <= 0) {\n        if (this.hitFrame <= MARVELOUS_FLASH_FRAMES) {\n          c.save();\n          c.globalAlpha =\n            1 - Math.pow(this.hitFrame / MARVELOUS_FLASH_FRAMES, 3);\n          c.drawImage(\n            arrowImages.tap_explosion,\n            0,\n            0,\n            ARROW_WIDTH,\n            ARROW_HEIGHT,\n            destX - this.hitFrame,\n            0 - this.hitFrame,\n            ARROW_WIDTH + this.hitFrame * 2,\n            ARROW_HEIGHT + this.hitFrame * 2\n          );\n          c.restore();\n          this.hitFrame++;\n        }\n      } else {\n        this.hitFrame = 0;\n      }\n    }\n\n    this.previousBeatPosition = this.currentBeatPosition(beatTick);\n  }\n}\n\nexport default Arrow;\n","import { DIRECTIONS, ARROW_WIDTH, ARROW_HEIGHT } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst arrowImages = {};\nDIRECTIONS.forEach((direction) => {\n  arrowImages[`shock_${direction}`] = new Image();\n  arrowImages[`shock_${direction}`].src = getAssetPath(\n    `shock_${direction}.png`\n  );\n});\n\nclass ShockArrow {\n  constructor(attrs) {\n    const { key, mods } = attrs;\n    const { speed, noteskin } = mods;\n\n    this.key = key;\n    this.speed = speed;\n    this.note = attrs.note;\n    this.noteskin = noteskin;\n\n    // this.currentBeatPosition = attrs.currentBeatPosition;\n    this.originalBeatPosition = attrs.originalBeatPosition;\n  }\n\n  currentBeatPosition(beatTick) {\n    return this.originalBeatPosition - beatTick;\n  }\n\n  render(canvas, frame, beatTick) {\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = -ARROW_HEIGHT; // used to simulate the arrows being hit and disappearing\n    const bottomBoundary = canvas.height;\n    frame = Math.floor(frame / 3) % 8; // each sprite frame lasts 3 canvas animation frames\n\n    for (let i = 0; i < this.note.length; i++) {\n      if (this.note[i] !== \"M\") continue;\n      const direction = DIRECTIONS[i % 4];\n      const arrowImg = arrowImages[`shock_${direction}`];\n      const frameX = (frame % 4) * ARROW_WIDTH;\n      const frameY = Math.floor(frame / 4) * ARROW_HEIGHT;\n      const destX = i * ARROW_WIDTH;\n      const destY =\n        this.currentBeatPosition(beatTick) * ARROW_HEIGHT * this.speed;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.drawImage(\n          arrowImg,\n          frameX,\n          frameY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          destX,\n          destY,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    }\n  }\n}\n\nexport default ShockArrow;\n","import { DIRECTIONS, ARROW_HEIGHT, ARROW_WIDTH } from \"../../../constants\";\nimport { getAssetPath } from \"../../../utils\";\n\nconst flashImages = {};\nDIRECTIONS.forEach((direction) => {\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n  flashImages[direction] = new Image();\n  flashImages[direction].src = getAssetPath(`${direction}_tap_flash.png`);\n});\n\nconst receptorImages = {};\nDIRECTIONS.forEach((direction) => {\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n  receptorImages[direction] = new Image();\n  receptorImages[direction].src = getAssetPath(`${direction}_tap_receptor.png`);\n});\n\nclass StepZone {\n  render(canvas, beatTick, mode) {\n    const c = canvas.getContext(\"2d\");\n    // flash starts at the beginning of the quarter beat and lasts for 1/16 beat\n\n    const isFlash = beatTick % 1 > 0 && beatTick % 1 < 0.25;\n\n    DIRECTIONS.forEach((direction, i) => {\n      c.drawImage(\n        isFlash ? flashImages[direction] : receptorImages[direction],\n        0,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT,\n        i * ARROW_WIDTH,\n        0,\n        ARROW_WIDTH,\n        ARROW_HEIGHT\n      );\n\n      if (mode === \"double\") {\n        c.drawImage(\n          isFlash ? flashImages[direction] : receptorImages[direction],\n          0,\n          0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT,\n          (i + 4) * ARROW_WIDTH,\n          0,\n          ARROW_WIDTH,\n          ARROW_HEIGHT\n        );\n      }\n    });\n  }\n}\n\nexport default StepZone;\n","import { ARROW_HEIGHT } from \"../../../constants\";\n\nclass Guidelines {\n  constructor(attrs) {\n    const { mods } = attrs;\n    const { speed, guidelines } = mods;\n\n    this.speed = speed;\n    this.finalBeat = attrs.finalBeat;\n    this.showGuidelines = guidelines;\n  }\n\n  render(canvas, beatTick) {\n    if (!this.showGuidelines) return;\n\n    const c = canvas.getContext(\"2d\");\n\n    const topBoundary = 0;\n    const bottomBoundary = canvas.height;\n\n    for (let beat = 0; beat <= this.finalBeat; beat++) {\n      const destY =\n        (beat - beatTick) * ARROW_HEIGHT * this.speed + ARROW_HEIGHT / 2;\n\n      // Render a thick line if the beat falls on the beginning of the measure.\n      // Render a thin line otherwise\n      const lineWidth = beat % 4 === 0 ? 2 : 0.8;\n\n      if (destY > topBoundary && destY < bottomBoundary) {\n        c.beginPath();\n        c.moveTo(0, destY);\n        c.lineTo(canvas.width, destY);\n        c.lineWidth = lineWidth;\n        c.strokeStyle = \"#fff\";\n        c.stroke();\n      }\n    }\n  }\n}\n\nexport default Guidelines;\n","const modeRegex = /dance-([a-z]+)/;\nconst difficultyRegex = /(Beginner|Easy|Medium|Hard|Challenge|Edit)/;\n\nconst difficultyMap = {\n  Beginner: \"Beginner\",\n  Easy: \"Basic\",\n  Medium: \"Difficult\",\n  Hard: \"Expert\",\n  Challenge: \"Challenge\",\n};\n\nconst parseSimfile = (sm, simfileType = \"sm\") => {\n  const simfiles = {};\n\n  const chartMetadata = sm.slice(\n    0,\n    sm.indexOf(simfileType === \"ssc\" ? \"#NOTEDATA:\" : \"#NOTES:\")\n  );\n\n  let bpms = [];\n  let stops = [];\n\n  // default bpms\n  if (/#BPMS:/i.test(chartMetadata)) {\n    bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (bpms.length) {\n      bpms = bpms.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n  // default stops\n  if (/#STOPS:/i.test(chartMetadata)) {\n    stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartMetadata)[1];\n    if (stops.length) {\n      stops = stops.split(\",\").map((point) => {\n        const [beat, value] = point.split(\"=\");\n        return { beat: parseFloat(beat), value: parseFloat(value) };\n      });\n    }\n  }\n\n  let chartStrs;\n\n  if (simfileType === \"ssc\") {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTEDATA:\"))\n      .split(/#NOTEDATA:\\s*;/)\n      .slice(1);\n  } else {\n    chartStrs = sm\n      .slice(sm.indexOf(\"#NOTES:\"))\n      .split(/#NOTES:\\s+/)\n      .slice(1);\n  }\n\n  chartStrs.forEach((chartStr) => {\n    const mode = modeRegex.exec(chartStr)[1]; // single or double\n\n    let smDifficulty = difficultyRegex.exec(chartStr)[1];\n    const difficulty = difficultyMap[smDifficulty];\n\n    simfiles[`${mode}_${difficulty}`] = { difficulty, mode, bpms, stops };\n    const simfile = simfiles[`${mode}_${difficulty}`];\n\n    let level;\n    if (simfileType === \"ssc\") {\n      level = /#METER:([0-9]+);/.exec(chartStr)[1];\n    } else {\n      const levelRegex = new RegExp(`${smDifficulty}:\\\\s+([0-9]+):`);\n      level = parseInt(levelRegex.exec(chartStr)[1]);\n    }\n    simfile.level = level;\n\n    if (simfileType === \"ssc\") {\n      // check for different bpms\n      if (/#BPMS:/i.test(chartStr)) {\n        bpms = /#BPMS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (bpms.length) {\n          bpms = bpms.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.bpms = bpms;\n        }\n      }\n\n      // check for different stops\n      if (/#STOPS:/i.test(chartStr)) {\n        stops = /#STOPS:([\\s\\S]*?)\\s*;/i.exec(chartStr)[1];\n        if (stops.length) {\n          stops = stops.split(\",\").map((point) => {\n            const [beat, value] = point.split(\"=\");\n            return { beat: parseFloat(beat), value: parseFloat(value) };\n          });\n          simfile.stops = stops;\n        }\n      }\n    }\n\n    const measures = chartStr\n      .slice(chartStr.lastIndexOf(\":\") + 1, chartStr.lastIndexOf(\";\"))\n      .trim()\n      .split(\",\")\n      .map((measure, measureIdx) => {\n        const ticks = measure\n          .trim()\n          .split(\"\\r\\n\")\n          .filter((n) => !n.startsWith(\"//\")); // filter out comment lines\n\n        const numTicks = ticks.length;\n\n        const noteObjects = [];\n        ticks.forEach((tick, tickIdx) => {\n          // skip empty ticks and comment lines\n          if (!tick.split(\"\").filter((n) => n !== \"0\").length) return;\n\n          const noteObj = {};\n          noteObj.note = tick;\n          noteObj.measureIdx = measureIdx; // index of the measure relative to the whole song (starting at 0)\n          noteObj.measureN = tickIdx; // numerator of the fraction describing where note falls in this measure\n          noteObj.measureD = numTicks; // denominator of the fraction describing where note falls in this measure\n\n          noteObjects.push(noteObj);\n        });\n\n        return noteObjects;\n      });\n\n    simfile.chart = measures;\n  });\n\n  return simfiles;\n};\n\nexport default parseSimfile;\n","import { GLOBAL_OFFSET } from \"../constants\";\n\nexport const applyTurnMods = (chart, mods, mode) => {\n  const { turn, shuffle } = mods;\n\n  // shuffle patterns courtesy of https://zenius-i-vanisher.com/v5.2/viewthread.php?threadid=3823\n  const turnMap = {\n    off: \"LDUR\",\n    mirror: \"RUDL\",\n    left: \"ULRD\",\n    right: \"DRLU\",\n    shuffle1: \"LRDU\",\n    shuffle2: \"UDRL\",\n    shuffle3: \"LRUD\",\n    shuffle4: \"DURL\",\n    shuffle5: \"DLUR\",\n    shuffle6: \"DULR\",\n    shuffle7: \"RLUD\",\n    shuffle8: \"RULD\",\n  };\n\n  let turnMod = turn;\n  if (turn === \"shuffle\") turnMod += shuffle;\n\n  if (mode === \"single\") {\n    return chart.map((row) => {\n      const note = row.note;\n      const turnedNote = turnMap[turnMod]\n        .split(\"\")\n        .map((direction) => note[turnMap.off.indexOf(direction)]);\n\n      return { ...row, note: turnedNote };\n    });\n  }\n  if (mode === \"double\") {\n    return chart.map((row) => {\n      let turnedNote = row.note.split(\"\");\n      if (turn === \"mirror\") turnedNote = turnedNote.reverse();\n      return { ...row, note: turnedNote };\n    });\n  }\n};\n\n/*\n  Given the bpmChangeQueue and the current beat tick, find the latest bpm\n  change event that happened before the current beat and set the current bpm\n  to that bpm value. This should be invoked every time the audio is resynced\n  (which will happen whenever progress is skipped)\n*/\nexport const getCurrentBpm = (params) => {\n  const { beatTick, bpmChangeQueue } = params;\n  let lastBpmValue = 0;\n  for (let i = 0; i < bpmChangeQueue.length; i++) {\n    const bpmEvent = bpmChangeQueue[i];\n    if (bpmEvent.beat > beatTick) {\n      return lastBpmValue;\n    }\n    lastBpmValue = bpmEvent.value;\n  }\n  return lastBpmValue;\n};\n\n/*\n  Find the current combo given the song timestamp. This should be invoked\n  every time the audio is resynced.\n*/\nexport const getCurrentCombo = (song) => {\n  const { audio, globalParams } = song;\n  const { arrows } = globalParams;\n  if (!arrows.length) return 0;\n\n  // Go through the chart until the arrow following the current timestamp is reached,\n  // then set the combo to one less than that arrow's combo\n  for (let i = 0; i < arrows.length; i++) {\n    const arrow = arrows[i];\n    if (arrow.timestamp > audio.seek() + GLOBAL_OFFSET) {\n      return arrow.combo - 1;\n    }\n  }\n  return arrows[arrows.length - 1].combo;\n};\n","import * as actions from \"../actions/AudioActions\";\n\nconst initialState = {\n  chartAudio: {\n    status: \"stopped\",\n    progress: 0,\n  },\n  previewAudio: {\n    status: \"stopped\",\n  },\n};\n\nexport const audio = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.PLAY_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"playing\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PAUSE_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"paused\" };\n      return { ...state, chartAudio };\n    }\n    case actions.STOP_CHART_AUDIO: {\n      const chartAudio = { ...state.chartAudio, status: \"stopped\" };\n      return { ...state, chartAudio };\n    }\n    case actions.PLAY_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"playing\" };\n      return { ...state, previewAudio };\n    }\n    case actions.STOP_PREVIEW_AUDIO: {\n      const previewAudio = { ...state.previewAudio, status: \"stopped\" };\n      return { ...state, previewAudio };\n    }\n    case actions.SET_CHART_PROGRESS: {\n      const chartAudio = { ...state.chartAudio, progress: action.payload };\n      return { ...state, chartAudio };\n    }\n    default:\n      return state;\n  }\n};\n","export const SET_BPM_CHANGE_QUEUE = \"SET_BPM_CHANGE_QUEUE\";\nexport const CHANGE_ACTIVE_BPM_DISPLAY = \"CHANGE_ACTIVE_BPM_DISPLAY\";\nexport const SET_COMBO = \"SET_COMBO\";\n\nexport const setBpmChangeQueue = (payload) => (dispatch) => {\n  dispatch({\n    type: SET_BPM_CHANGE_QUEUE,\n    payload,\n  });\n};\n\nexport const changeActiveBpm = (bpm) => (dispatch) => {\n  dispatch({\n    type: CHANGE_ACTIVE_BPM_DISPLAY,\n    payload: bpm,\n  });\n};\n\nexport const setCombo = (combo) => (dispatch) => {\n  dispatch({\n    type: SET_COMBO,\n    payload: combo,\n  });\n};\n","import * as actions from \"../actions/ChartActions\";\n\nconst initialState = {\n  activeBpm: null,\n  bpmChangeQueue: [],\n  combo: 0,\n};\n\nexport const chart = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SET_BPM_CHANGE_QUEUE: {\n      return { ...state, bpmChangeQueue: [...action.payload] };\n    }\n    case actions.CHANGE_ACTIVE_BPM_DISPLAY: {\n      // const activeBpm = action.payload;\n      const activeBpm = Math.round(action.payload);\n      return { ...state, activeBpm };\n    }\n    case actions.SET_COMBO: {\n      return { ...state, combo: action.payload };\n    }\n    default:\n      return state;\n  }\n};\n","import { presetParams } from \"../../utils\";\n\nexport const options = {\n  difficulty: [\"Beginner\", \"Basic\", \"Difficult\", \"Expert\", \"Challenge\"],\n  mode: [\"single\", \"double\"],\n  mods: {\n    speed: [\n      0.25,\n      0.5,\n      0.75,\n      1,\n      1.25,\n      1.5,\n      1.75,\n      2,\n      2.25,\n      2.5,\n      2.75,\n      3,\n      3.25,\n      3.5,\n      3.75,\n      4,\n      4.5,\n      5,\n      5.5,\n      6,\n      6.5,\n      7,\n      7.5,\n      8,\n    ],\n    turn: [\"off\", \"mirror\", \"left\", \"right\", \"shuffle\"],\n    shuffle: [1, 2, 3, 4, 5, 6, 7, 8],\n    noteskin: [\"rainbow\", \"note\", \"vivid\", \"flat\"],\n  },\n};\n\nconst optionDefaultValues = {\n  difficulty: \"Expert\",\n  mode: \"single\",\n  mods: {\n    speed: 3,\n    turn: \"off\",\n    shuffle: 1,\n    noteskin: \"note\",\n    guidelines: true,\n    colorFreezes: false,\n  },\n};\n\nif (presetParams.difficulty) {\n  const difficulties = {\n    b: \"Beginner\",\n    B: \"Basic\",\n    D: \"Difficult\",\n    E: \"Expert\",\n    C: \"Challenge\",\n  };\n  if (Object.keys(difficulties).includes(presetParams.difficulty[0])) {\n    optionDefaultValues.difficulty = difficulties[presetParams.difficulty[0]];\n  }\n  if (presetParams.difficulty[1] === \"S\") {\n    optionDefaultValues.mode = \"single\";\n  } else if (presetParams.difficulty[1] === \"D\") {\n    optionDefaultValues.mode = \"double\";\n  }\n}\nif (presetParams.speed) {\n  const value = parseFloat(\n    `${presetParams.speed[0]}.${presetParams.speed.slice(1)}`\n  );\n  if (options.mods.speed.includes(value)) {\n    optionDefaultValues.mods.speed = value;\n  }\n}\nif (presetParams.turn) {\n  const turnValue = presetParams.turn.toLowerCase();\n  if (options.mods.turn.includes(turnValue)) {\n    optionDefaultValues.mods.turn = turnValue;\n  }\n}\n\nexport { optionDefaultValues };\n","import * as actions from \"../actions/ModsActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\n\nconst initialState = optionDefaultValues.mods;\n\nexport const mods = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.UPDATE_MODS: {\n      const updatedMods = action.payload;\n      return { ...state, ...updatedMods };\n    }\n    default:\n      return state;\n  }\n};\n","export const SELECT_SONG = \"SELECT_SONG\";\nexport const SELECT_DIFFICULTY = \"SELECT_DIFFICULTY\";\nexport const SELECT_MODE = \"SELECT_MODE\";\n\nexport const selectSong = (song) => (dispatch) => {\n  dispatch({\n    type: SELECT_SONG,\n    payload: song,\n  });\n};\n\nexport const selectDifficulty = (difficulty) => (dispatch) => {\n  dispatch({\n    type: SELECT_DIFFICULTY,\n    payload: difficulty,\n  });\n};\n\nexport const selectMode = (mode) => (dispatch) => {\n  dispatch({\n    type: SELECT_MODE,\n    payload: mode,\n  });\n};\n","import * as actions from \"../actions/SongSelectActions\";\nimport { optionDefaultValues } from \"../components/form/options\";\n\nconst initialState = {\n  difficulty: optionDefaultValues.difficulty,\n  mode: optionDefaultValues.mode,\n};\n\nexport const songSelect = (state = initialState, action) => {\n  switch (action.type) {\n    case actions.SELECT_SONG: {\n      const song = action.payload;\n      return { ...state, song };\n    }\n    case actions.SELECT_DIFFICULTY: {\n      const difficulty = action.payload;\n      return { ...state, difficulty };\n    }\n    case actions.SELECT_MODE: {\n      const mode = action.payload;\n      return { ...state, mode };\n    }\n    default:\n      return state;\n  }\n};\n","import { combineReducers } from \"redux\";\n\nimport { audio } from \"./AudioReducer\";\nimport { chart } from \"./ChartReducer\";\nimport { mods } from \"./ModsReducer\";\nimport { songSelect } from \"./SongSelectReducer\";\n\nexport default combineReducers({ audio, chart, mods, songSelect });\n","export const PLAY_CHART_AUDIO = \"PLAY_CHART_AUDIO\";\nexport const PAUSE_CHART_AUDIO = \"PAUSE_CHART_AUDIO\";\nexport const STOP_CHART_AUDIO = \"STOP_CHART_AUDIO\";\n\nexport const PLAY_PREVIEW_AUDIO = \"PLAY_PREVIEW_AUDIO\";\nexport const STOP_PREVIEW_AUDIO = \"STOP_PREVIEW_AUDIO\";\n\nexport const SET_CHART_PROGRESS = \"SET_CHART_PROGRESS\";\n\nexport const playChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_CHART_AUDIO,\n  });\n};\n\nexport const pauseChartAudio = () => (dispatch) => {\n  dispatch({\n    type: PAUSE_CHART_AUDIO,\n  });\n};\n\nexport const stopChartAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_CHART_AUDIO,\n  });\n};\n\nexport const playPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: PLAY_PREVIEW_AUDIO,\n  });\n};\nexport const stopPreviewAudio = () => (dispatch) => {\n  dispatch({\n    type: STOP_PREVIEW_AUDIO,\n  });\n};\n\nexport const setChartProgress = (progress) => (dispatch) => {\n  dispatch({\n    type: SET_CHART_PROGRESS,\n    payload: progress,\n  });\n};\n","export const UPDATE_MODS = \"UPDATE_MODS\";\n\nexport const updateMods = (mods) => (dispatch) => {\n  dispatch({\n    type: UPDATE_MODS,\n    payload: mods,\n  });\n};\n","import { createStore, applyMiddleware, compose } from \"redux\";\nimport thunk from \"redux-thunk\";\n\nimport reducers from \"./reducers\";\n\nconst store = createStore(\n  reducers,\n  compose(\n    applyMiddleware(thunk),\n    window.devToolsExtension ? window.__REDUX_DEVTOOLS_EXTENSION__() : (f) => f\n  )\n);\n\nexport default store;\n","import { Howl } from \"howler\";\nimport { gsap } from \"gsap\";\n\nimport store from \"../store\";\nimport * as actions from \"../actions/AudioActions\";\nimport { changeActiveBpm, setCombo } from \"../actions/ChartActions\";\nimport { getAssetPath } from \"../utils\";\nimport { getCurrentBpm, getCurrentCombo } from \"../utils/engineUtils\";\nimport { GLOBAL_OFFSET } from \"../constants\";\n\nclass AudioPlayer {\n  constructor() {\n    /*\n      Trying to share the same audio source for both song and preview was causing too many\n      issues. Sticking to keeping separate Howl objects for each even if means loading\n      duplicate copies of the same mp3\n    */\n    this.sources = {\n      song: {},\n      preview: {},\n      assistTick: {\n        audio: new Howl({\n          src: getAssetPath(\"sounds/assist_tick.wav\"),\n          // format: [\"wav\"],\n          // html5: true,\n        }),\n      },\n    }; // map of song hash to associated Howl object\n    this.currentSong = null; // hash of current song\n    this.currentPreview = null; // hash of current preview\n\n    this.currentSongId = null; // Howler soundID of current song\n    this.currentPreviewId = null; // Howler soundId of current preview\n\n    // this.updateTimeline = this.updateTimeline.bind(this);\n\n    this.activeView = null; // gets updated whenever active view changes in React\n\n    this.previewFadeTimeout = null; // reference to preview fade setTimeout so it can be cleared\n\n    this.updateTimeline = this.updateTimeline.bind(this);\n    this.updateProgress = this.updateProgress.bind(this);\n    this.audioResyncFrames = 0;\n  }\n\n  getCurrentSong() {\n    return this.sources.song[this.currentSong];\n  }\n  getCurrentPreview() {\n    return this.sources.preview[this.currentPreview];\n  }\n\n  getCurrentTime() {\n    return this.getCurrentSong().audio.seek();\n  }\n\n  // when loading a song file for the first time, save it as two separate Howls:\n  // one for the full song and one for the preview sample\n  storeAudioSource(song, initialProgress = 0) {\n    if (!this.sources.song[song.hash]) {\n      this.setLoadingAudio(true);\n\n      this.sources.song[song.hash] = { title: song.title };\n      this.sources.song[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        onload: () => {\n          // console.log(`AudioPlayer song loaded: ${song.title}`);\n          this.setLoadingAudio(false);\n\n          this.seekProgress(initialProgress);\n        },\n        onloaderror: (id, error, blah) => {\n          alert(`${id};;; ${error};;; ${blah}`);\n        },\n        onplay: () => {\n          this.getCurrentSong().tl.play();\n          this.resync();\n          gsap.ticker.add(this.updateProgress);\n          this.startAnimationLoop();\n          store.dispatch(actions.playChartAudio());\n        },\n        onpause: () => {\n          this.getCurrentSong().tl.pause();\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.pauseChartAudio());\n        },\n        onseek: () => {},\n        onstop: () => {\n          if (this.getCurrentSong().tl) {\n            this.getCurrentSong().tl.restart().pause();\n          }\n          gsap.ticker.remove(this.updateTimeline);\n          gsap.ticker.remove(this.updateProgress);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n        onend: (spriteId) => {\n          gsap.ticker.remove(this.updateTimeline);\n          this.stopAnimationLoop();\n          store.dispatch(actions.stopChartAudio());\n        },\n      });\n\n      this.sources.preview[song.hash] = { title: song.title };\n      this.sources.preview[song.hash].audio = new Howl({\n        src: `https://dl.dropboxusercontent.com/s/${song.dAudioUrl}`,\n        format: [\"mp3\"],\n        html5: true,\n        sprite: {\n          sample: [\n            parseFloat((song.sampleStart - 0.12) * 1000),\n            parseFloat(song.sampleLength * 1000),\n          ],\n        },\n        onplay: () => {\n          store.dispatch(actions.playPreviewAudio());\n        },\n        onstop: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n        onend: () => {\n          clearTimeout(this.previewFadeTimeout);\n          this.currentPreviewId = null;\n          store.dispatch(actions.stopPreviewAudio());\n        },\n      });\n\n      // console.log(`Added ${song.title} to AudioPlayer.sources`, this.sources);\n    }\n  }\n\n  selectSong(song, initialProgress = 0) {\n    if (this.currentSong) {\n      this.getCurrentSong().audio.stop(this.currentSongId);\n    }\n\n    this.storeAudioSource(song, initialProgress);\n    this.currentSong = song.hash;\n  }\n\n  resync() {\n    // arbitrary number of frames chosen to tell timeline to resync with the audio\n    // because audio playback takes a while to restabilize\n    this.audioResyncFrames = 10;\n    gsap.ticker.add(this.updateTimeline);\n    this.updateProgressOnce();\n  }\n\n  // when audio is played, resync timeline with audio a few times until audio playback\n  // stabilizes, then remove this method from the ticker\n  updateTimeline() {\n    this.getCurrentSong().tl.seek(this.getCurrentTime() + GLOBAL_OFFSET);\n\n    this.audioResyncFrames--;\n    if (this.audioResyncFrames <= 0) {\n      // recalculate current bpm (necessary if skipping progress)\n      const currentBpm = getCurrentBpm(this.getCurrentSong().globalParams);\n      store.dispatch(changeActiveBpm(currentBpm));\n\n      const currentCombo = getCurrentCombo(this.getCurrentSong());\n      store.dispatch(setCombo(currentCombo));\n\n      gsap.ticker.remove(this.updateTimeline);\n    }\n  }\n\n  seekTime(timestamp) {\n    this.getCurrentSong().audio.seek(timestamp);\n    this.resync();\n  }\n  goBack(ms) {\n    this.seekTime(this.getCurrentTime() - ms * 0.001);\n  }\n  goForward(ms) {\n    this.seekTime(this.getCurrentTime() + ms * 0.001);\n  }\n\n  seekProgress(value) {\n    this.seekTime(value * this.getCurrentSong().audio.duration());\n  }\n\n  // gsap ticker method for regularly updating progress bar, not called manually\n  updateProgress(time, deltaTime, frame) {\n    if (frame % 15 === 0) {\n      const audio = this.getCurrentSong().audio;\n      const progress = audio.seek() / audio.duration();\n      store.dispatch(actions.setChartProgress(progress));\n    }\n  }\n\n  updateProgressOnce() {\n    this.updateProgress(null, null, 0);\n    this.updateAnimationLoopOnce();\n  }\n\n  setTimeline(tl) {\n    this.getCurrentSong().tl = tl;\n  }\n  setGlobalParams(params) {\n    this.getCurrentSong().globalParams = params;\n  }\n\n  play() {\n    this.currentSongId = this.getCurrentSong().audio.play();\n  }\n\n  pause() {\n    this.getCurrentSong().audio.pause(this.currentSongId);\n  }\n\n  stop() {\n    this.getCurrentSong().audio.stop(this.currentSongId);\n    this.seekTime(0);\n    this.currentSongId = null;\n  }\n\n  isPlaying() {\n    return (\n      this.getCurrentSong() &&\n      this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n  isPaused() {\n    return (\n      this.getCurrentSong() &&\n      !this.getCurrentSong().audio.playing(this.currentSongId)\n    );\n  }\n\n  playAssistTick() {\n    this.sources.assistTick.audio.play();\n  }\n\n  playSongPreview(song) {\n    if (this.currentPreview) {\n      this.getCurrentPreview().audio.stop(this.currentPreviewId);\n    }\n\n    this.storeAudioSource(song);\n    this.currentPreview = song.hash;\n\n    const preview = this.getCurrentPreview().audio;\n\n    this.currentPreviewId = preview.play(\"sample\");\n\n    preview.on(\"play\", () => {\n      const preview = this.getCurrentPreview().audio;\n\n      const fadeinTime = 200;\n      const fadeoutTime = 2000;\n      preview.fade(0, 1, fadeinTime);\n\n      this.previewFadeTimeout = setTimeout(() => {\n        preview.fade(1, 0, fadeoutTime);\n      }, song.sampleLength * 1000 - fadeoutTime);\n    });\n  }\n\n  stopSongPreview() {\n    if (!this.currentPreview) return;\n    const preview = this.getCurrentPreview().audio;\n\n    preview.stop(this.currentPreviewId);\n\n    // clearTimeout(this.previewFadeTimeout);\n  }\n\n  isPreviewPlaying() {\n    return (\n      this.getCurrentPreview() &&\n      this.getCurrentPreview().audio.playing(this.currentPreviewId)\n    );\n  }\n}\n\nexport default new AudioPlayer();\n","import { gsap } from \"gsap\";\n\nimport Arrow from \"../components/chart/canvas/Arrow\";\nimport ShockArrow from \"../components/chart/canvas/ShockArrow\";\nimport StepZone from \"../components/chart/canvas/StepZone\";\nimport Guidelines from \"../components/chart/canvas/Guidelines\";\nimport parseSimfile from \"../utils/parseSimfile\";\nimport { applyTurnMods } from \"../utils/engineUtils\";\nimport { GLOBAL_OFFSET, END_EXTRA_BEATS } from \"../constants\";\nimport AudioPlayer from \"./AudioPlayer\";\nimport store from \"../store\";\nimport * as actions from \"../actions/ChartActions\";\n\nclass GameEngine {\n  constructor(canvas, sm, simfileType = \"sm\") {\n    const self = this;\n    this.canvas = canvas;\n    this.c = canvas.getContext(\"2d\");\n    this.tl = gsap.timeline();\n    this.sm = sm;\n    this.simfiles = {};\n\n    this.eventList = [];\n    this.arrows = [];\n    this.shockArrows = [];\n    this.allArrows = [];\n\n    this.mainLoopRequestRef = null;\n\n    this.drawBackground();\n\n    this.globalParams = {\n      /*\n        Use this parameter to keep track of which beat the chart is on at any given point.\n        Animate this one property in the timeline, then reference its value to calculate frames\n        for step zone and arrow animations without having to create separate tweens for them.\n      */\n      beatTick: 0,\n\n      /*\n        Use this parameter for animations based on absolute frame and not a function of the beat.\n      */\n      frame: 0,\n\n      combo: 0,\n      bpmChangeQueue: [], // this is the one that is used\n\n      arrows: self.allArrows,\n    };\n\n    // init logic\n    if (this.sm) {\n      this.simfiles = parseSimfile(this.sm, simfileType);\n    }\n\n    AudioPlayer.startAnimationLoop = this.startLoop.bind(this);\n    AudioPlayer.stopAnimationLoop = this.stopLoop.bind(this);\n    AudioPlayer.updateAnimationLoopOnce = this.updateLoopOnce.bind(this);\n  }\n\n  startLoop() {\n    this.mainLoopRequestRef = window.requestAnimationFrame(\n      this.mainLoop.bind(this)\n    );\n  }\n  stopLoop() {\n    window.cancelAnimationFrame(this.mainLoopRequestRef);\n  }\n  updateLoopOnce() {\n    window.requestAnimationFrame(this.mainLoop.bind(this, false));\n  }\n\n  // bpm changes and stops converted to timestamps\n  generateEventList(simfile) {\n    const { bpms, stops } = simfile;\n    const eventList = [];\n    let bpmPtr = 0,\n      stopPtr = 0;\n    let currentBpm = bpms[0].value;\n\n    // console.log(\"generateEventList bpms\", bpms);\n    // console.log(\"generateEventList stops\", stops);\n\n    while (bpmPtr < bpms.length && stopPtr < stops.length) {\n      const bpm = bpms[bpmPtr];\n      const stop = stops[stopPtr];\n\n      // bpm changes before stops when they fall on the same beat\n      // // add stop event, keeping track of the bpm at this point\n      // if (bpm.beat <= stop.beat) {\n      //   eventList.push({ ...bpm, type: \"bpm\" });\n      //   currentBpm = bpm.value;\n      //   bpmPtr++;\n      // }\n      // // add bpm event, replacing the currently tracked bpm\n      // else {\n      //   eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n      //   stopPtr++;\n      // }\n\n      // stops before bpm changes when they fall on the same beat\n      // add stop event, keeping track of the bpm at this point\n      if (stop.beat <= bpm.beat) {\n        eventList.push({ ...stop, bpm: currentBpm, type: \"stop\" });\n        stopPtr++;\n      }\n      // add bpm event, replacing the currently tracked bpm\n      else {\n        eventList.push({ ...bpm, type: \"bpm\" });\n        currentBpm = bpm.value;\n        bpmPtr++;\n      }\n    }\n    while (bpmPtr < bpms.length) {\n      eventList.push({ ...bpms[bpmPtr], type: \"bpm\" });\n      bpmPtr++;\n    }\n    while (stopPtr < stops.length) {\n      eventList.push({ ...stops[stopPtr], bpm: currentBpm, type: \"stop\" });\n      stopPtr++;\n    }\n\n    eventList[0].timestamp = 0;\n\n    this.globalParams.bpmChangeQueue = [eventList[0]];\n\n    for (let i = 1; i < eventList.length; i++) {\n      const prevEvent = eventList[i - 1];\n      const currentEvent = eventList[i];\n      const prevTimestamp = eventList[i - 1].timestamp;\n\n      // Find the number of beats elapsed between the current and previous event,\n      // then convert this into seconds using the bpm at the previous event.\n      // If the previous event was a stop, add the length of the stop.\n      // The timestamp of the current event is this number of seconds after the\n      // timestamp of the previous event.\n      const beatDiff = currentEvent.beat - prevEvent.beat;\n      const prevBpm =\n        prevEvent.type === \"bpm\" ? prevEvent.value : prevEvent.bpm;\n      let timestampDiff = (beatDiff / prevBpm) * 60;\n      if (prevEvent.type === \"stop\") timestampDiff += prevEvent.value;\n      const currentTimestamp = prevTimestamp + timestampDiff;\n\n      currentEvent.timestamp = currentTimestamp;\n\n      if (currentEvent.type === \"bpm\") {\n        this.globalParams.bpmChangeQueue.push(currentEvent);\n      }\n    }\n\n    this.eventList = eventList;\n    return eventList;\n  }\n\n  generateArrows(simfile, mods) {\n    let { chart } = simfile;\n    const mode = store.getState().songSelect.mode;\n\n    if (Array.isArray(chart[0])) {\n      const newChart = [];\n      chart.forEach((measure) => {\n        newChart.push(...measure);\n      });\n      chart = newChart;\n    }\n\n    chart = applyTurnMods(chart, mods, mode);\n\n    chart.forEach((note, key) => {\n      // calculate starting position currentBeatPosition\n      const { measureIdx, measureN, measureD } = note;\n      note.currentBeatPosition = (measureIdx + measureN / measureD) * 4;\n\n      // save its original position for later reference\n      note.originalBeatPosition = note.currentBeatPosition;\n\n      // If the note is the tail of a freeze arrow, calculate the number of beats\n      // from the head of the freeze arrow\n      for (let i = 0; i < note.note.length; i++) {\n        if (note.note[i] !== \"3\") continue;\n\n        // Find the most recent freeze head on the same direction as the tail\n        // and retroactively fill in the length of the hold in beats\n        for (let j = key - 1; j >= 0; j--) {\n          if (chart[j].note[i] === \"2\") {\n            if (!chart[j].holdBeats) chart[j].holdBeats = [];\n            if (!note.holdBeats) note.holdBeats = [];\n            chart[j].holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            note.holdBeats[i] =\n              note.currentBeatPosition - chart[j].currentBeatPosition;\n            break;\n          }\n        }\n      }\n    });\n\n    chart.forEach((note, key) => {\n      if (note.note[0] === \"M\" || note.note[4] === \"M\") {\n        const shockArrow = new ShockArrow({ key, ...note, mods });\n        this.shockArrows.push(shockArrow);\n        this.allArrows.push(shockArrow);\n      }\n      if (\n        note.note.includes(\"1\") ||\n        note.note.includes(\"2\") ||\n        note.note.includes(\"3\")\n      ) {\n        const arrow = new Arrow({ key, ...note, mods });\n        this.arrows.push(arrow);\n        this.allArrows.push(arrow);\n      }\n    });\n\n    this.stepZone = new StepZone();\n\n    // console.log(`chart for ${simfile.difficulty}`, chart);\n  }\n\n  // Calculate the gsap tweens before playing the chart\n  initTimeline(mods) {\n    this.resetArrows();\n\n    /*\n      The space in between each event (i.e. a bpm change or stop) denotes a continous section of constant bpm.\n      Create a tween to animate the global beat tick for each of these sections and chain them together.\n      The position and/or frame animation of each canvas object (e.g. arrows, step zone, guidelines) can be\n      determined as a function of the beat tick value at any given point.\n    */\n    let bpm;\n\n    let accumulatedBeatTick = 0;\n\n    // Designate the \"end\" of the chart as an arbitrary number of beats (8?) after either the last arrow\n    // or the last event in the chart, whichever comes later\n    const lastArrow = this.arrows[this.arrows.length - 1];\n    const lastEvent = this.eventList[this.eventList.length - 1];\n\n    let finalBeat = 0;\n    if (lastArrow && lastEvent) {\n      finalBeat = Math.max(lastArrow.originalBeatPosition, lastEvent.beat);\n    } else if (lastArrow) {\n      finalBeat = lastArrow.originalBeatPosition;\n    } else if (lastEvent) {\n      finalBeat = lastEvent.beat;\n    }\n    finalBeat += END_EXTRA_BEATS;\n\n    // // hack to implement global offset of -12 ms\n    // this.tl = this.tl.to({}, { duration: 0 }, GLOBAL_OFFSET);\n\n    for (let i = 0; i < this.eventList.length; i++) {\n      let startEvent = this.eventList[i],\n        endEvent = this.eventList[i + 1];\n\n      // delay the animations by the length of the stop, if applicable\n      let delay = startEvent.type === \"stop\" ? startEvent.value : 0;\n\n      // the bpm of this section\n      if (startEvent.type === \"bpm\") bpm = startEvent.value;\n      else if (startEvent.type === \"stop\") bpm = startEvent.bpm;\n\n      // if there is a bpm change or stop event somewhere ahead of this one\n      if (endEvent) {\n        // number of beats between startEvent and endEvent, i.e. how long this constant bpm section is\n        const sectionBeatLength = endEvent.beat - startEvent.beat;\n\n        // the duration of this constant bpm section in seconds\n        const sectionDuration = (sectionBeatLength / bpm) * 60;\n\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: accumulatedBeatTick + sectionBeatLength,\n            duration: sectionDuration,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n        accumulatedBeatTick += sectionBeatLength;\n      }\n      // if this is the last bpm change/stop event, animate remaining objects to end\n      else {\n        this.tl = this.tl.to(\n          this.globalParams,\n          {\n            beatTick: finalBeat,\n            duration: ((finalBeat - accumulatedBeatTick) / bpm) * 60,\n            ease: \"none\",\n            onStart: () => {\n              if (startEvent.type === \"bpm\") {\n                store.dispatch(actions.changeActiveBpm(startEvent.value));\n              }\n            },\n          },\n          `+=${delay}`\n        );\n      }\n    }\n\n    // combo counter\n    const bpmChangeQueue = this.globalParams.bpmChangeQueue;\n    // console.log(\"bpmChangeQueue\", bpmChangeQueue);\n\n    let currentBpmPtr = -1,\n      currentEventPtr = 0,\n      pendingStopPtr = -1,\n      currentBpm = null,\n      pendingStop = null,\n      currentStopOffset = 0,\n      currentCombo = 0;\n    this.allArrows.forEach((arrow, idx) => {\n      if (\n        arrow instanceof Arrow &&\n        !arrow.note.includes(\"1\") &&\n        !arrow.note.includes(\"2\")\n      )\n        return;\n\n      // Find the latest bpm section that starts before this note\n      while (\n        currentBpmPtr < bpmChangeQueue.length - 1 &&\n        bpmChangeQueue[currentBpmPtr + 1].beat < arrow.originalBeatPosition\n      ) {\n        // if this block was entered, a new bpm section was entered\n        currentBpmPtr++;\n        const bpmSection = bpmChangeQueue[currentBpmPtr];\n        currentBpm = bpmSection.value;\n\n        // reset the accumulated stop time\n        currentStopOffset = 0;\n\n        // find the index of this bpm section in the eventList and use it as a starting point\n        // for keeping track of stops\n        for (let i = currentEventPtr; i < this.eventList.length; i++) {\n          const event = this.eventList[i];\n          if (event.beat === bpmSection.beat && event.type === \"bpm\") {\n            currentEventPtr = i;\n            const nextEvent = this.eventList[i + 1];\n            if (nextEvent && nextEvent.type === \"stop\") {\n              pendingStopPtr = i + 1;\n              pendingStop = this.eventList[pendingStopPtr];\n            }\n            break;\n          }\n        }\n      }\n\n      // Accumulate total time of any stops that exist in this bpm section before this note.\n      // Keep track of the next pending stop so it can be added to the total stop time as soon as\n      // the first arrow following it is reached\n      while (pendingStop && pendingStop.beat < arrow.originalBeatPosition) {\n        currentStopOffset += pendingStop.value;\n        const nextEvent = this.eventList[pendingStopPtr + 1];\n        if (nextEvent && nextEvent.type === \"stop\") {\n          pendingStopPtr++;\n        } else {\n          pendingStopPtr = -1;\n        }\n        pendingStop = this.eventList[pendingStopPtr];\n      }\n\n      const bpmSectionStartBeat = bpmChangeQueue[currentBpmPtr].beat;\n      const bpmSectionStartTime = bpmChangeQueue[currentBpmPtr].timestamp;\n\n      const beatDiff = arrow.originalBeatPosition - bpmSectionStartBeat;\n      const timeDiff = beatDiff * (60 / currentBpm);\n      const arrowTimestamp = bpmSectionStartTime + timeDiff + currentStopOffset;\n\n      currentCombo++;\n      arrow.combo = currentCombo;\n      arrow.timestamp = arrowTimestamp;\n\n      this.tl.set(\n        this.globalParams,\n        {\n          combo: arrow.combo,\n          onStart: () => {\n            store.dispatch(actions.setCombo(arrow.combo));\n            if (arrow instanceof Arrow) {\n              // AudioPlayer.playAssistTick();\n              // console.log(arrow);\n            }\n          },\n        },\n        arrowTimestamp\n      );\n    });\n\n    this.guidelines = new Guidelines({ mods, finalBeat });\n    AudioPlayer.setTimeline(this.tl);\n    AudioPlayer.setGlobalParams(this.globalParams);\n\n    this.updateLoopOnce();\n    // hack\n  }\n\n  resetArrows() {\n    this.arrows.forEach((arrow) => arrow.reset());\n  }\n\n  mainLoop(loop = true) {\n    // console.log(\"mainLoop running\");\n    this.drawBackground();\n\n    const mode = store.getState().songSelect.mode;\n\n    if (this.stepZone) {\n      this.stepZone.render(this.canvas, this.globalParams.beatTick, mode);\n    }\n    if (this.guidelines) {\n      this.guidelines.render(this.canvas, this.globalParams.beatTick);\n    }\n\n    for (let i = this.shockArrows.length - 1; i >= 0; i--) {\n      const shockArrow = this.shockArrows[i];\n      shockArrow.render(\n        this.canvas,\n        this.globalParams.frame,\n        this.globalParams.beatTick\n      );\n    }\n\n    // render arrows in the opposite order so the earlier arrows are layered over the later ones\n    // Up arrow is the exception: later arrows are layered over the earlier ones\n\n    const upArrows = mode === \"double\" ? [2, 6] : [2];\n    const notUpArrows = mode === \"double\" ? [0, 1, 3, 4, 5, 7] : [0, 1, 3];\n\n    // draw freeze bodies first because they need to be at the bottom layer\n    for (let i = this.arrows.length - 1; i >= 0; i--) {\n      const arrow = this.arrows[i];\n      notUpArrows.forEach((directionIdx) => {\n        arrow.renderFreezeBody(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n    for (let i = 0; i < this.arrows.length; i++) {\n      const arrow = this.arrows[i];\n      upArrows.forEach((directionIdx) => {\n        arrow.renderFreezeBody(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n\n    // then draw the arrow heads over the freeze bodies\n    for (let i = this.arrows.length - 1; i >= 0; i--) {\n      const arrow = this.arrows[i];\n      notUpArrows.forEach((directionIdx) => {\n        arrow.renderArrow(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n    for (let i = 0; i < this.arrows.length; i++) {\n      const arrow = this.arrows[i];\n      upArrows.forEach((directionIdx) => {\n        arrow.renderArrow(\n          this.canvas,\n          this.globalParams.beatTick,\n          directionIdx\n        );\n      });\n    }\n\n    // if (this.globalParams.beatTick) {\n    //   console.log(this.globalParams.beatTick);\n    // }\n    this.globalParams.frame++;\n\n    if (loop) {\n      this.mainLoopRequestRef = window.requestAnimationFrame(\n        this.mainLoop.bind(this)\n      );\n    }\n  }\n\n  drawBackground() {\n    this.c.fillStyle = \"black\";\n    this.c.fillRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n\n  toggleTl() {\n    if (this.tl.paused()) {\n      console.log(\"tl.play()\");\n      this.tl.play();\n    } else {\n      console.log(\"tl.pause()\");\n      this.tl.pause();\n    }\n  }\n  restartTl() {\n    // console.log(\"call restart\");\n    this.tl.restart().pause();\n    this.resetArrows();\n  }\n  pauseTl() {\n    this.tl.pause();\n  }\n}\n\nexport default GameEngine;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\n\nconst Progress = (props) => {\n  const progressBar = useRef();\n  // const [progress, setProgress] = useState(0);\n\n  const { progress, gameEngine } = props;\n\n  useEffect(() => {\n    progressBar.current.addEventListener(\"touchstart\", (e) => {\n      jumpToProgress(e.touches[0]);\n    });\n\n    progressBar.current.addEventListener(\"touchmove\", (e) => {\n      jumpToProgress(e.touches[0]);\n    });\n\n    progressBar.current.addEventListener(\"touchend\", (e) => {\n      // jumpToProgress(e.touches[0]);\n    });\n\n    // AudioPlayer.setStateProgress = setProgress;\n  }, []);\n\n  const jumpToProgress = (event) => {\n    const totalWidth = progressBar.current.offsetWidth;\n    const x = event.clientX - progressBar.current.offsetLeft;\n    const progressPercent = x / totalWidth;\n\n    if (progressPercent < 0 || progressPercent > 1) return;\n\n    AudioPlayer.seekProgress(progressPercent);\n  };\n\n  return (\n    <div id=\"progress-bar\" ref={progressBar}>\n      <div\n        className=\"progress-value\"\n        style={{ width: `${progress * 100}%` }}\n      ></div>\n    </div>\n  );\n};\n\nexport default Progress;\n","import React, { useEffect, useRef } from \"react\";\nimport { Button } from \"semantic-ui-react\";\n\nconst HoldButton = (props) => {\n  const button = useRef();\n  const requestRef = useRef();\n\n  useEffect(() => {\n    const el = button.current.ref.current;\n    el.addEventListener(\"mousedown\", pressingDown, false);\n    el.addEventListener(\"mouseup\", notPressingDown, false);\n    el.addEventListener(\"mouseleave\", notPressingDown, false);\n\n    el.addEventListener(\"touchstart\", pressingDown, false);\n    el.addEventListener(\"touchend\", notPressingDown, false);\n  }, []);\n\n  const pressingDown = (e) => {\n    e.preventDefault();\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  const notPressingDown = (e) => {\n    cancelAnimationFrame(requestRef.current);\n  };\n\n  const handleHold = () => {\n    if (props.onClick) {\n      props.onClick();\n    }\n    requestRef.current = requestAnimationFrame(handleHold);\n  };\n\n  return (\n    <Button {...props} ref={button}>\n      {props.children}\n    </Button>\n  );\n};\n\nexport default HoldButton;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Modal, Button, Input } from \"semantic-ui-react\";\nimport copy from \"copy-to-clipboard\";\n\nimport { getOriginPath } from \"../../utils\";\n\nconst difficulties = {\n  Beginner: \"b\",\n  Basic: \"B\",\n  Difficult: \"D\",\n  Expert: \"E\",\n  Challenge: \"C\",\n};\n\nconst modes = {\n  single: \"S\",\n  double: \"D\",\n};\n\nconst ShareModal = (props) => {\n  const { modalOpen, setModalOpen, data } = props;\n  const { song, difficulty, mode, mods, progress } = data;\n\n  const shareUrl = useRef();\n  const [message, setMessage] = useState(\"\");\n\n  useEffect(() => {\n    if (modalOpen === false) {\n      setMessage(\"\");\n    }\n  }, [modalOpen]);\n\n  if (!song) return null;\n\n  // console.log(\"ShareModal data\", data);\n\n  const generateShareUrl = () => {\n    const params = {\n      song: song.hash,\n      difficulty: difficulties[difficulty] + modes[mode] + \"P\",\n      turn: mods.turn !== \"off\" ? mods.turn : \"\",\n      speed: mods.speed.toString().replace(\".\", \"\"),\n      progress: parseInt(progress * 100000),\n    };\n\n    const queryStr = Object.keys(params)\n      .map((param) => {\n        if (params[param] === null || typeof params[param] === \"undefined\") {\n          return null;\n        }\n        return `${param}=${params[param]}`;\n      })\n      .filter((param) => param !== null)\n      .join(\"&\");\n\n    return getOriginPath() + \"?\" + queryStr;\n  };\n  shareUrl.current = generateShareUrl();\n\n  const copyShareUrl = () => {\n    copy(shareUrl.current);\n    setMessage(\"Copied link to clipboard\");\n  };\n\n  return (\n    <Modal\n      className=\"shareModal\"\n      size=\"fullscreen\"\n      open={modalOpen}\n      onClose={() => setModalOpen(false)}\n    >\n      <Modal.Header>Share link to chart</Modal.Header>\n      <Modal.Content>\n        <Input\n          type=\"text\"\n          className=\"share-url-input\"\n          value={shareUrl.current}\n          action\n        >\n          <input />\n          <Button onClick={copyShareUrl}>Copy</Button>\n        </Input>\n        <p>{message}</p>\n      </Modal.Content>\n    </Modal>\n  );\n};\n\nexport default ShareModal;\n","import React, { useState, useEffect, useRef } from \"react\";\nimport { Button, Icon, Modal } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\nimport \"inobounce\";\n\nimport \"./ChartArea.scss\";\n\nimport { SP_DIFFICULTIES, DP_DIFFICULTIES } from \"../../constants\";\nimport GameEngine from \"../../core/GameEngine\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport Progress from \"./Progress\";\nimport HoldButton from \"../ui/HoldButton\";\nimport ShareModal from \"./ShareModal\";\n\nconst ChartArea = (props) => {\n  const {\n    selectedDifficulty,\n    selectedMode,\n    selectedSong,\n    sm,\n    chart,\n    mods,\n    selectedAudio,\n    loadingAudio,\n    gameEngine,\n    setGameEngine,\n  } = props;\n\n  const [canvas, setCanvas] = useState(null);\n  const [shareModalOpen, setShareModalOpen] = useState(false);\n  const chartArea = useRef();\n\n  // define canvas on mount\n  useEffect(() => {\n    if (!loadingAudio) {\n      chartArea.current = document.querySelector(\"#chartArea\");\n      setCanvas(chartArea.current);\n    }\n  }, [loadingAudio]);\n\n  // change chart dimensions depending on single or double\n  // Hardcoded widths for now. Variable widths may be possible in the future\n  useEffect(() => {\n    if (!canvas) return;\n\n    if (selectedMode === \"single\") {\n      chartArea.current.width = 256;\n      chartArea.current.style.transform = \"none\";\n      chartArea.current.style.position = \"relative\";\n      chartArea.current.style.left = 0;\n      chartArea.current.style.top = 0;\n    } else if (selectedMode === \"double\") {\n      chartArea.current.width = 512;\n      const scaleFactor = window.innerWidth / chartArea.current.width;\n      const xOffset = (chartArea.current.width - window.innerWidth) / 2;\n      const yOffset = xOffset * (7 / 8);\n      chartArea.current.style.transform = `scale(${scaleFactor})`;\n      chartArea.current.style.position = \"absolute\";\n      chartArea.current.style.left = `-${xOffset}px`;\n      chartArea.current.style.top = `-${yOffset}px`;\n    }\n  }, [canvas, selectedMode]);\n\n  // reset chart if song, difficulty, or mods change\n  useEffect(() => {\n    if (!canvas) return;\n\n    const simfileType = selectedSong.useSsc ? \"ssc\" : \"sm\";\n\n    let ge = new GameEngine(canvas, sm, simfileType);\n\n    if (!selectedDifficulty) return;\n\n    const simfile = ge.simfiles[`${selectedMode}_${selectedDifficulty}`];\n\n    if (simfile) {\n      ge.generateEventList(simfile);\n      ge.generateArrows(simfile, mods);\n      ge.initTimeline(mods);\n      ge.restartTl();\n      AudioPlayer.resync();\n    }\n    setGameEngine(ge);\n  }, [canvas, sm, selectedDifficulty, selectedMode, mods]);\n\n  const togglePlay = () => {\n    if (!gameEngine) return;\n    if (props.audio.status === \"playing\") {\n      AudioPlayer.pause();\n    } else {\n      AudioPlayer.play();\n    }\n  };\n  const restart = () => {\n    if (!gameEngine) return;\n    AudioPlayer.stop();\n  };\n\n  const isPlayDisabled = () => {\n    if (!gameEngine || loadingAudio) return true;\n    return false;\n  };\n\n  const shareParams = {\n    song: selectedSong,\n    difficulty: selectedDifficulty,\n    mode: selectedMode,\n    mods,\n    progress: props.audio.progress,\n  };\n\n  return (\n    <div className=\"canvas-container\">\n      {loadingAudio && <div>Loading audio...</div>}\n      {!loadingAudio && (\n        <>\n          <div className={`canvas-wrapper ${selectedMode}`}>\n            <canvas id=\"chartArea\" width=\"256\" height=\"448\" />\n            <div className=\"combo-temp\">\n              <div>Combo</div>\n              <div className=\"combo-num\">{chart.combo}</div>\n            </div>\n          </div>\n          <div className=\"progress-container\">\n            <Progress progress={props.audio.progress} gameEngine={gameEngine} />\n          </div>\n        </>\n      )}\n      {/* <canvas id=\"chartArea\" width=\"256\" height=\"18000\" /> */}\n      <div className=\"row\">\n        <div className=\"play-controls\">\n          <HoldButton\n            onClick={() => AudioPlayer.goBack(20)}\n            // disabled={props.audio.progress === 0}\n            className=\"play-control\"\n          >\n            <Icon name=\"backward\" />\n          </HoldButton>\n          <Button\n            onClick={togglePlay}\n            disabled={isPlayDisabled()}\n            className=\"play-control\"\n          >\n            <Icon name={props.audio.status === \"playing\" ? \"pause\" : \"play\"} />\n          </Button>\n          <Button onClick={restart} className=\"play-control\">\n            <Icon name=\"stop\" />\n          </Button>\n          <HoldButton\n            onClick={() => AudioPlayer.goForward(20)}\n            className=\"play-control\"\n          >\n            <Icon name=\"forward\" />\n          </HoldButton>\n\n          <Button\n            onClick={() => setShareModalOpen(true)}\n            className=\"play-control share-btn\"\n            disabled={props.audio.status === \"playing\"}\n          >\n            <Icon name=\"share square\" />\n          </Button>\n        </div>\n      </div>\n      <div className=\"row\">\n        <div className=\"song-information\">\n          {selectedSong && (\n            <>\n              <div className=\"song-title\">{selectedSong.title}</div>\n              <div className=\"song-artist\">{selectedSong.artist}</div>\n            </>\n          )}\n        </div>\n        <div className=\"bpm-information\">\n          <div className=\"bpm-header\">BPM</div>\n          <div className=\"bpm-value\">{chart.activeBpm}</div>\n        </div>\n        <div className=\"level-information\">\n          {selectedSong && (\n            <>\n              <div className=\"song-difficulty\">{selectedDifficulty}</div>\n              <div className=\"song-level\">\n                {\n                  selectedSong.levels[\n                    selectedMode === \"double\"\n                      ? DP_DIFFICULTIES.indexOf(selectedDifficulty) + 5\n                      : SP_DIFFICULTIES.indexOf(selectedDifficulty)\n                  ]\n                }\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n      <ShareModal\n        modalOpen={shareModalOpen}\n        setModalOpen={setShareModalOpen}\n        data={shareParams}\n      />\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, chart, mods, songSelect } = state;\n  return {\n    audio: audio.chartAudio,\n    chart,\n    mods,\n    selectedSong: songSelect.song,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {};\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ChartArea);\n","import React from \"react\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { getJacketPath } from \"../../utils\";\n\nconst SongGrid = (props) => {\n  const { displayedSongs, onSongSelect, selectedSongOption } = props;\n\n  // let songs = displayedSongs.slice(200, 300);\n  let songs = displayedSongs;\n\n  // console.log(\"songs\", songs);\n\n  const selectSong = (song) => {\n    onSongSelect(null, { value: song.hash });\n    // console.log(\"select song\", song);\n  };\n\n  const renderSong = (song) => {\n    return (\n      <div\n        className=\"songTile-wrapper\"\n        key={`songtile_${song.hash}`}\n        onClick={() => selectSong(song)}\n      >\n        <div\n          className={`songTile ${\n            selectedSongOption === song.hash ? \"selected\" : \"\"\n          }`}\n        >\n          <div className=\"song-jacket-wrapper\">\n            <img\n              className=\"song-jacket\"\n              src={getJacketPath(`${song.hash}.png`)}\n              title={song.title}\n              alt={song.title}\n            />\n          </div>\n          <div className=\"song-title-bar\">{song.title}</div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"songGrid\">\n      {songs.map((song) => {\n        return renderSong(song);\n      })}\n    </div>\n  );\n};\n\nexport default SongGrid;\n","import React from \"react\";\n\nconst ToggleSwitch = (props) => {\n  const { option1, option2, value } = props;\n\n  const toggleChange = () => {\n    if (!option1 || !option2) return;\n\n    if (value === option1.value) {\n      props.onChange(option2.value);\n    } else if (value === option2.value) {\n      props.onChange(option1.value);\n    }\n\n    // default to option 1 if uninitialized\n    else {\n      props.onChange(option1.value);\n    }\n  };\n\n  const selectOption = (option) => {\n    if (!option || typeof option.value === \"undefined\") return;\n    props.onChange(option.value);\n  };\n\n  const getSwitchClassName = () => {\n    let className = \"toggleSwitch\";\n    if (value === option1.value) className += ` left`;\n    else if (value === option2.value) className += ` right`;\n    return className;\n  };\n\n  return (\n    <div className=\"toggleSwitch-wrapper\">\n      <label\n        className={`toggleSwitch-option1 ${\n          value === option1.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option1)}\n      >\n        {option1.text}\n      </label>\n      <div className={getSwitchClassName()} onClick={toggleChange}></div>\n      <label\n        className={`toggleSwitch-option2 ${\n          value === option2.value ? \"selected\" : \"\"\n        }`}\n        onClick={() => selectOption(option2)}\n      >\n        {option2.text}\n      </label>\n    </div>\n  );\n};\n\nexport default ToggleSwitch;\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_1\",\n  \"data-name\": \"Line 1\",\n  d: \"M0.91,15L0.78,15A1,1,0,0,0,0,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H0.91Z\"\n});\n\nvar _ref3 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_2\",\n  \"data-name\": \"Line 2\",\n  d: \"M6.91,9L6.78,9A1,1,0,0,0,6,10V28a1,1,0,1,0,2,0s0,0,0,0V10A1,1,0,0,0,7,9H6.91Z\"\n});\n\nvar _ref4 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_3\",\n  \"data-name\": \"Line 3\",\n  d: \"M12.91,0L12.78,0A1,1,0,0,0,12,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H12.91Z\"\n});\n\nvar _ref5 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_4\",\n  \"data-name\": \"Line 4\",\n  d: \"M18.91,10l-0.12,0A1,1,0,0,0,18,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H18.91Z\"\n});\n\nvar _ref6 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_5\",\n  \"data-name\": \"Line 5\",\n  d: \"M24.91,15l-0.12,0A1,1,0,0,0,24,16v6a1,1,0,0,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H24.91Z\"\n});\n\nvar _ref7 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_6\",\n  \"data-name\": \"Line 6\",\n  d: \"M30.91,10l-0.12,0A1,1,0,0,0,30,11V27a1,1,0,1,0,2,0s0,0,0,0V11a1,1,0,0,0-1-1H30.91Z\"\n});\n\nvar _ref8 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_7\",\n  \"data-name\": \"Line 7\",\n  d: \"M36.91,0L36.78,0A1,1,0,0,0,36,1V37a1,1,0,1,0,2,0s0,0,0,0V1a1,1,0,0,0-1-1H36.91Z\"\n});\n\nvar _ref9 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_8\",\n  \"data-name\": \"Line 8\",\n  d: \"M42.91,9L42.78,9A1,1,0,0,0,42,10V28a1,1,0,1,0,2,0s0,0,0,0V10a1,1,0,0,0-1-1H42.91Z\"\n});\n\nvar _ref10 =\n/*#__PURE__*/\nReact.createElement(\"path\", {\n  id: \"Line_9\",\n  \"data-name\": \"Line 9\",\n  d: \"M48.91,15l-0.12,0A1,1,0,0,0,48,16v6a1,1,0,1,0,2,0s0,0,0,0V16a1,1,0,0,0-1-1H48.91Z\"\n});\n\nvar SvgAudiowave = function SvgAudiowave(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return React.createElement(\"svg\", _extends({\n    id: \"audioWave\",\n    \"data-name\": \"Layer 1\",\n    viewBox: \"0 0 50 38.05\",\n    ref: svgRef\n  }, props), title ? React.createElement(\"title\", null, title) : null, _ref2, _ref3, _ref4, _ref5, _ref6, _ref7, _ref8, _ref9, _ref10);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return React.createElement(SvgAudiowave, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/audiowave.e48c060f.svg\";\nexport { ForwardRef as ReactComponent };","import React, { useState, useEffect, useRef } from \"react\";\nimport { Dropdown } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport * as actions from \"../../actions/SongSelectActions\";\nimport SongGrid from \"./SongGrid\";\nimport { getJacketPath, presetParams } from \"../../utils\";\nimport ToggleSwitch from \"../ui/ToggleSwitch\";\nimport {\n  SP_DIFFICULTIES,\n  DP_DIFFICULTIES,\n  TITLE_CATEGORIES,\n  LEVELS,\n  DDR_VERSIONS,\n} from \"../../constants\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { ReactComponent as AudioWave } from \"../../svg/audiowave.svg\";\n\nconst titleSortOptions = [\n  { key: \"title_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  TITLE_CATEGORIES.map((letter) => {\n    return { key: `title_${letter}`, value: letter, text: letter };\n  })\n);\n\nconst versionSortOptions = [\n  { key: \"version_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  DDR_VERSIONS.map((versionName, idx) => {\n    return { key: `version_${idx}`, value: idx, text: versionName };\n  }).reverse()\n);\n\nconst levelSortOptions = [\n  { key: \"level_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  LEVELS.map((level) => {\n    return { key: `level_${level}`, value: level, text: level };\n  })\n);\n\nconst difficultySortOptions = [\n  { key: \"difficulty_all\", value: \"all\", text: \"ALL\" },\n].concat(\n  SP_DIFFICULTIES.map((difficulty) => {\n    return {\n      key: `difficulty_${difficulty}`,\n      value: difficulty,\n      text: difficulty,\n    };\n  })\n);\n\nconst SongForm = (props) => {\n  const {\n    activeView,\n    simfileList,\n    selectedDifficulty,\n    selectedMode,\n    previewAudio,\n  } = props;\n  const songGridContainer = useRef();\n\n  const simfileOptions = simfileList.map((song) => {\n    return { key: song.hash, value: song.hash, text: song.title };\n  });\n\n  const [selectedSongOption, setSelectedSongOption] = useState(null);\n  const [selectedDifficultyOption, setSelectedDifficultyOption] = useState(\n    selectedDifficulty\n  );\n\n  const [selectedFilters, setSelectedFilters] = useState({\n    title: \"all\",\n    version: 16,\n    level: \"all\",\n    difficulty: \"all\",\n    // level: 10,\n  });\n\n  const [displayedSongs, setDisplayedSongs] = useState([]);\n\n  // on filter change\n  useEffect(() => {\n    const { title, version, level, difficulty } = selectedFilters;\n\n    const songs = simfileList\n      .filter((song) => {\n        return (\n          (title === \"all\" || title === song.abcSort) &&\n          (version === \"all\" || version === parseInt(song.version)) &&\n          (level === \"all\" ||\n            (selectedMode === \"single\" &&\n              song.levels.slice(0, 5).includes(level)) ||\n            (selectedMode === \"double\" &&\n              song.levels.slice(5, 9).includes(level)))\n        );\n      })\n      .filter((song) => {\n        // if a difficulty is specified:\n        if (difficulty !== \"all\") {\n          // if level is not specified, simply check if that difficulty exists\n          if (level === \"all\") {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] !== null;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] !== null\n              );\n            }\n          }\n          // if level is specified, only show if the difficulty is that level\n          else {\n            if (selectedMode === \"single\") {\n              return song.levels[SP_DIFFICULTIES.indexOf(difficulty)] === level;\n            } else if (selectedMode === \"double\") {\n              return (\n                song.levels[DP_DIFFICULTIES.indexOf(difficulty) + 5] === level\n              );\n            }\n          }\n        }\n        return song;\n      });\n\n    setDisplayedSongs(songs);\n    songGridContainer.current.scrollTop = 0;\n  }, [selectedFilters]);\n\n  // object corresponding to the selected song option\n  // NOT the song currently playing in the main view\n  const [selectedSong, setSelectedSong] = useState(null);\n\n  // initialize song for testing\n  useEffect(() => {\n    /*\n      For some reason, the very first interaction with the dom will reset the Howler\n      audio seek time to 0 (a bug?). Force an interaction in the beginning to get this\n      out of the way and prevent overwriting of the preset time\n    */\n    document.body.click();\n\n    if (presetParams.song) {\n      let progress = presetParams.progress ? presetParams.progress / 100000 : 0;\n      onSongSelect(null, { value: presetParams.song }, progress);\n    } else {\n      // onSongSelect(null, { value: \"99OQb9b0IQ98P6IQdPOiqi8q16o16iqP\" }); // ORCA\n      // onSongSelect(null, { value: \"PooiIP8qP0IPd9D1Ibi6l9bDoqdi9P8O\" }); // DEGRS\n      // onSongSelect(null, { value: \"q0QIob1PDI6IP86dlPb6I6il9d6bP606\" }); // einya\n      // onSongSelect(null, { value: \"bIlqP91O9ld1lqlq6qoq9OiPdqIDPP0l\" }); // lachryma\n      // onSongSelect(null, { value: \"06O0ObdQobq86lPDo6P18dQ1QPdilIQO\" }); // ayakashi\n      // onSongSelect(null, { value: \"9bI0dQdb01Dl1bQq1Pq998i0l096D99P\" }); // second heaven\n      // onSongSelect(null, { value: \"8o1iQPiId8P6Db9Iqo1Oo119QDoq8qQ8\" }); // chaos\n      // onSongSelect(null, { value: \"dD6PqbboDil89DPIID86Pldi6obI1b8l\" }); // pluto\n      // onSongSelect(null, { value: \"loP08P1PPi990lPD0O060d888O9o6qb8\" }); // seasons\n      // onSongSelect(null, { value: \"8QbqP80q9PI8bbi0qOoiibOQD08OPdli\" }); // felm\n      // onSongSelect(null, { value: \"6bid6d9qPQ80DOqiidQQ891o6Od8801l\" }); // otp\n      // onSongSelect(null, { value: \"9i0q91lPPiO61b9P891O1i86iOP1I08O\" }); // egoism\n      // onSongSelect(null, { value: \"lldPQPDP0qq8iqQ910l8b8PoQ6O668Q0\" }); // downer & upper\n      // onSongSelect(null, { value: \"PP1q0iii1D6Dq9QOd0qqDOQD0160QoPD\" }); // paranoia eternal\n      // onSongSelect(null, { value: \"QI06q9lPIoo80DlI18Ooi6dbPl89bqi0\" }); // our soul\n      // onSongSelect(null, { value: \"POq8OPlOO9199i11Od0P00801Qo01DQo\" }); // rtswy\n      // onSongSelect(null, { value: \"QQldo10ObPPQPlliODiDIIl0Q1oPoo61\" }); // deltamax\n      // onSongSelect(null, { value: \"06loOQ0DQb0DqbOibl6qO81qlIdoP9DI\" }); // paranoia\n      // onSongSelect(null, { value: \"0dOi10q9Q6oi0Q9960iQQDO6olqlDDqo\" }); // private eye\n      // onSongSelect(null, { value: \"9I00D9Id61iD6QP8i8Dd6698PoQ9bdi9\" }); // okome\n      // onSongSelect(null, { value: \"O9qDQOQO8dDDIiO9dPP0Pb8qQo9l89D9\" }); // triperfect\n      // onSongSelect(null, { value: \"0IldoDlDQql99DqQo0Qq9ioPIiiPoIoi\" }); // pluto relinquish\n      // onSongSelect(null, { value: \"PIO8dod8P9OOP1bi0D1POIi6OdOdQDql\" }); // pluto the first\n      // onSongSelect(null, { value: \"8O6b1D9PDO0ll1IO9d1ODDPPo0QPQbob\" }); // tme\n      onSongSelect(null, { value: \"ld6P1lbb0bPO9doqbbPOoPb8qoDo8id0\" }); // A4A\n      // onSongSelect(null, { value: \"O06Id8PIDbDblO109ddi1dldd0bqDdQ1\" }); // sexy planet from nonstop\n    }\n  }, []);\n\n  useEffect(() => {\n    if (selectedSongOption) {\n      const song = simfileList.find((song) => song.hash === selectedSongOption);\n      setSelectedSong(song);\n      AudioPlayer.storeAudioSource(song);\n    }\n  }, [selectedSongOption]);\n\n  const onSongSelect = async (e, data, initialProgress = 0) => {\n    const songHash = data.value;\n    setSelectedSongOption(songHash);\n\n    // console.log(\"setSelectedSongOption\", songHash);\n    AudioPlayer.stopSongPreview();\n\n    const song = simfileList.find((song) => song.hash === songHash);\n\n    // automatically fetch simfile and update chart\n    await props.onSongSelect(song, initialProgress);\n\n    // if a specific level filter has been chosen, select the difficulty that\n    // corresponds to that level\n    if (selectedFilters.difficulty !== \"all\") {\n      handleDifficultySelect(selectedFilters.difficulty);\n    } else if (selectedFilters.level !== \"all\") {\n      const levels =\n        selectedMode === \"double\"\n          ? song.levels.slice(5, 9)\n          : song.levels.slice(0, 5);\n      for (let i = 0; i < levels.length; i++) {\n        const level = levels[i];\n        if (level === selectedFilters.level) {\n          const difficulties =\n            selectedMode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n          console.log(\"match\", difficulties[i], level);\n          handleDifficultySelect(difficulties[i]);\n          break;\n        }\n      }\n    } else {\n      const selectedDiffOptionIndex = SP_DIFFICULTIES.indexOf(\n        selectedDifficultyOption\n      );\n      if (song.levels[selectedDiffOptionIndex]) {\n        props.onDifficultySelect(selectedDifficultyOption);\n      } else {\n        /*\n          If the song does not have a chart corresponding to the chosen difficulty option,\n          pick whatever is *closest*\n          - If Difficult, Expert, or Challenge is the chosen option, start from Challenge and\n            work your way down until the first available difficulty is reached.\n          - If Beginner or Basic is the chosen option, start from Beginner and work up.\n          The closest available difficulty will be chosen for the song without affecting the\n          difficulty option selected for the form, like the way it works in the real game\n        */\n        const difficulties =\n          selectedMode === \"double\" ? DP_DIFFICULTIES : SP_DIFFICULTIES;\n        const levels =\n          selectedMode === \"double\"\n            ? song.levels.slice(5, 9)\n            : song.levels.slice(0, 5);\n        if (\n          [\"Difficult\", \"Expert\", \"Challenge\"].includes(\n            selectedDifficultyOption\n          )\n        ) {\n          for (let i = difficulties.length - 1; i >= 0; i--) {\n            if (levels[i]) {\n              props.onDifficultySelect(difficulties[i]);\n              break;\n            }\n          }\n        } else if ([\"Beginner\", \"Basic\"].includes(selectedDifficultyOption)) {\n          for (let i = 0; i <= difficulties.length - 1; i++) {\n            if (levels[i]) {\n              props.onDifficultySelect(difficulties[i]);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    // // automatically update chart\n    // props.onSongSelect(song, initialProgress);\n  };\n\n  const handleDifficultySelect = (difficulty) => {\n    setSelectedDifficultyOption(difficulty);\n    props.onDifficultySelect(difficulty);\n  };\n\n  const renderDifficulties = () => {\n    if (!selectedSong) return null;\n\n    let levels;\n    if (selectedMode === \"single\") levels = selectedSong.levels.slice(0, 5);\n    else if (selectedMode === \"double\")\n      levels = selectedSong.levels.slice(5, 9);\n\n    return levels.map((level, idx) => {\n      if (!level) return null;\n      const difficulty =\n        selectedMode === \"double\" ? DP_DIFFICULTIES[idx] : SP_DIFFICULTIES[idx];\n      return (\n        <div\n          className={`song-difficulty ${difficulty} ${\n            selectedDifficulty === difficulty ? \"selected\" : \"\"\n          }`}\n          key={`${selectedMode}-difficulty_${difficulty}`}\n          onClick={() => handleDifficultySelect(difficulty)}\n        >\n          <div className=\"difficulty\">{difficulty}</div>\n          <div className=\"level\">{level}</div>\n        </div>\n      );\n    });\n  };\n\n  const toggleSongPreview = () => {\n    const oldSongHash = AudioPlayer.currentPreview;\n\n    // toggle start/stop of the same song\n    if (oldSongHash === selectedSong.hash) {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      } else {\n        AudioPlayer.playSongPreview(selectedSong);\n      }\n    }\n\n    // play a new song and stop the current one (if applicable)\n    else {\n      if (previewAudio.status === \"playing\") {\n        AudioPlayer.stopSongPreview();\n      }\n      AudioPlayer.playSongPreview(selectedSong);\n    }\n  };\n\n  return (\n    <div\n      className={`form-container songView ${\n        activeView === \"song\" ? \"open\" : \"closed\"\n      }`}\n    >\n      <form className=\"songForm\">\n        <div className=\"form-inner-wrapper\">\n          <div className=\"selectedSong\">\n            <div\n              className={`selectedSong-jacket-wrapper ${\n                previewAudio.status === \"playing\" ? \"playing\" : \"\"\n              }`}\n            >\n              <div className=\"selectedSong-jacket-overlay\">\n                <AudioWave />\n              </div>\n              <img\n                className={`selectedSong-jacket`}\n                src={getJacketPath(`${selectedSongOption}.png`)}\n                alt=\"Selected song\"\n                onClick={toggleSongPreview}\n              />\n            </div>\n            <div className=\"selectedSong-info\">\n              <Dropdown\n                placeholder=\"Choose a song\"\n                className=\"song-title-dropdown\"\n                search\n                selection\n                value={selectedSongOption}\n                onChange={onSongSelect}\n                options={simfileOptions}\n                selectOnBlur={false}\n                selectOnNavigation={false}\n              />\n              <div className=\"song-artist\">\n                {selectedSong && selectedSong.artist}\n              </div>\n\n              <div className=\"song-difficulties\">{renderDifficulties()}</div>\n\n              <div className=\"song-mode\">\n                <ToggleSwitch\n                  option1={{ text: \"Single\", value: \"single\" }}\n                  option2={{ text: \"Double\", value: \"double\" }}\n                  onChange={(value) => props.onModeSelect(value)}\n                  value={selectedMode}\n                />\n              </div>\n            </div>\n          </div>\n          <div className=\"songForm-filters\">\n            <div className=\"songForm-filters-row\">\n              <div className=\"form-field\">\n                <label>By Title</label>\n                <Dropdown\n                  className=\"title-filter-dropdown\"\n                  selection\n                  value={selectedFilters.title}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      title: data.value,\n                    })\n                  }\n                  options={titleSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Version</label>\n                <Dropdown\n                  className=\"version-filter-dropdown\"\n                  selection\n                  value={selectedFilters.version}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      version: data.value,\n                    })\n                  }\n                  options={versionSortOptions}\n                />\n              </div>\n              <div className=\"form-field\">\n                <label>By Level</label>\n                <Dropdown\n                  className=\"level-filter-dropdown\"\n                  selection\n                  value={selectedFilters.level}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      level: data.value,\n                    })\n                  }\n                  options={levelSortOptions}\n                />\n                <label>By Difficulty</label>\n                <Dropdown\n                  className=\"difficulty-filter-dropdown\"\n                  selection\n                  value={selectedFilters.difficulty}\n                  onChange={(e, data) =>\n                    setSelectedFilters({\n                      ...selectedFilters,\n                      difficulty: data.value,\n                    })\n                  }\n                  options={difficultySortOptions}\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n      </form>\n\n      <div className=\"songGrid-container\" ref={songGridContainer}>\n        <SongGrid\n          displayedSongs={displayedSongs}\n          onSongSelect={onSongSelect}\n          selectedSongOption={selectedSongOption}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio, songSelect } = state;\n  const { previewAudio } = audio;\n  return {\n    previewAudio,\n    selectedDifficulty: songSelect.difficulty,\n    selectedMode: songSelect.mode,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(actions.selectSong(song)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SongForm);\n","import React, { useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Radio, Checkbox } from \"semantic-ui-react\";\n\nimport { options } from \"./options\";\nimport { capitalize } from \"../../utils\";\nimport { updateMods } from \"../../actions/ModsActions\";\n\nconst ModsForm = (props) => {\n  const { activeView, mods, updateMods, mode } = props;\n\n  // when switching between single and double, any mod set to a value incompatible\n  // with the new mode will be reset to its default value\n  useEffect(() => {\n    if (mode === \"double\" && ![\"off\", \"mirror\"].includes(mods.turn)) {\n      updateMods({ turn: \"off\" });\n    }\n  }, [mode]);\n\n  return (\n    <div\n      className={`form-container ${activeView === \"mods\" ? \"open\" : \"closed\"}`}\n    >\n      <form>\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Speed</h4>\n          {options.mods.speed.map((speed) => {\n            return (\n              <Radio\n                key={`speed_${speed}`}\n                label={`${speed}x`}\n                name=\"speed\"\n                value={speed}\n                checked={mods.speed === speed}\n                onChange={() => updateMods({ speed })}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Arrow color</h4>\n          {options.mods.noteskin.map((noteskin) => {\n            return (\n              <Radio\n                key={`noteskin_${noteskin}`}\n                label={capitalize(noteskin)}\n                name=\"noteskin\"\n                value={noteskin}\n                checked={mods.noteskin === noteskin}\n                onChange={() => updateMods({ noteskin })}\n              />\n            );\n          })}\n        </div>\n\n        <div className=\"form-field\">\n          <h4 className=\"form-label\">Turn</h4>\n          {options.mods.turn\n            .filter((turn) => {\n              if (mode === \"double\") return turn === \"off\" || turn === \"mirror\";\n              return true;\n            })\n            .map((turn) => {\n              return (\n                <Radio\n                  key={`turn_${turn}`}\n                  label={capitalize(turn)}\n                  name=\"turn\"\n                  value={turn}\n                  checked={mods.turn === turn}\n                  onChange={() => updateMods({ turn })}\n                />\n              );\n            })}\n        </div>\n        {mods.turn === \"shuffle\" && (\n          <div className=\"form-field\">\n            <h4 className=\"form-label\">Shuffle pattern</h4>\n            {options.mods.shuffle.map((shuffle) => {\n              return (\n                <Radio\n                  key={`shuffle_${shuffle}`}\n                  label={shuffle}\n                  name=\"shuffle\"\n                  value={shuffle}\n                  checked={mods.shuffle === shuffle}\n                  onChange={() => updateMods({ shuffle })}\n                />\n              );\n            })}\n          </div>\n        )}\n\n        <h4>Miscellaneous</h4>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Guidelines\"\n            name=\"guidelines\"\n            checked={mods.guidelines}\n            onChange={() => updateMods({ guidelines: !mods.guidelines })}\n          />\n        </div>\n        <div className=\"form-field\">\n          <Checkbox\n            toggle\n            label=\"Color freeze heads\"\n            name=\"colorFreezes\"\n            checked={mods.colorFreezes}\n            onChange={() => updateMods({ colorFreezes: !mods.colorFreezes })}\n          />\n        </div>\n      </form>\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { mods, songSelect } = state;\n  return { mods, mode: songSelect.mode };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    updateMods: (mods) => dispatch(updateMods(mods)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ModsForm);\n","import React from \"react\";\nimport { Icon } from \"semantic-ui-react\";\nimport { connect } from \"react-redux\";\n\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { stopPreviewAudio } from \"../../actions/AudioActions\";\n\nconst MobileNav = (props) => {\n  const { activeView, chartAudio, previewAudio } = props;\n\n  const navItems = [\n    { view: \"song\", icon: \"music\" },\n    { view: \"mods\", icon: \"sidebar\" },\n    { view: \"2\", icon: \"\" },\n    { view: \"3\", icon: \"\" },\n    { view: \"chart\", icon: \"arrow up\" },\n  ];\n\n  const setActiveView = (view) => {\n    if (chartAudio.status === \"playing\") return;\n    AudioPlayer.stopSongPreview();\n    props.setActiveView(view);\n  };\n\n  const isDisabled = (view) => {\n    if (view !== \"chart\" && chartAudio.status === \"playing\") return true;\n    return false;\n  };\n\n  return (\n    <nav className=\"mobileNav\">\n      {navItems.map((navItem) => {\n        const { view, icon } = navItem;\n        if (!view) return <div className=\"mobileNav_item\" />;\n        return (\n          <div\n            key={`mobileNavItem_${view}`}\n            className={`mobileNav_item ${activeView === view ? \"active\" : \"\"} ${\n              isDisabled(view) ? \"disabled\" : \"\"\n            }`}\n            onClick={() => setActiveView(view)}\n          >\n            <Icon name={icon} />\n          </div>\n        );\n      })}\n    </nav>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  const { audio } = state;\n  const { chartAudio, previewAudio } = audio;\n  return {\n    chartAudio,\n    previewAudio,\n  };\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    stopPreviewAudio: () => dispatch(stopPreviewAudio()),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MobileNav);\n","import React, { useState, useEffect } from \"react\";\nimport { connect } from \"react-redux\";\nimport { tsv } from \"d3-fetch\";\nimport { Button } from \"semantic-ui-react\";\n\nimport ChartArea from \"../../components/chart/ChartArea\";\nimport SongForm from \"../../components/form/SongForm\";\nimport ModsForm from \"../../components/form/ModsForm\";\nimport MobileNav from \"../../components/navigation/MobileNav\";\nimport AudioPlayer from \"../../core/AudioPlayer\";\nimport { getOriginPath, fetchDocument, presetParams } from \"../../utils\";\nimport {\n  selectSong,\n  selectDifficulty,\n  selectMode,\n} from \"../../actions/SongSelectActions\";\n\nconst MainContainer = (props) => {\n  const [loadingSimfiles, setLoadingSimfiles] = useState(true);\n  const [simfileList, setSimfileList] = useState([]);\n  const [selectedSM, setSelectedSM] = useState(null);\n  const [selectedAudio, setSelectedAudio] = useState(null);\n\n  const [activeView, setActiveView] = useState(\"chart\");\n\n  const [gameEngine, setGameEngine] = useState(null);\n\n  const [loadingAudio, setLoadingAudio] = useState(false);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      await fetchSimfiles();\n      setLoadingSimfiles(false);\n    };\n    fetchData();\n\n    AudioPlayer.setLoadingAudio = setLoadingAudio;\n  }, []);\n\n  const fetchSimfiles = async () => {\n    try {\n      const parsedTsv = await tsv(getOriginPath() + \"data/simfiles.tsv\");\n      parsedTsv.forEach((row) => {\n        row.levels = row.levels\n          .split(\",\")\n          .map((level) => (level ? parseInt(level) : null));\n      });\n\n      // console.log(\"simfiles\", parsedTsv);\n      setSimfileList(parsedTsv);\n    } catch (error) {\n      console.error(error);\n      return null;\n    }\n  };\n\n  const onSongSelect = async (song, initialProgress = 0) => {\n    console.log(\"MainContainer selected song\", song);\n    AudioPlayer.selectSong(song, initialProgress);\n    // setSelectedSong(song);\n\n    props.selectSong(song);\n\n    document.title = `${song.title} - SMViewer`;\n\n    // retrieve audio file and simfile from song.simfilePath\n    // TEMP: SM only; ignore Ace for Aces and Chaos Terror-Tech for now\n\n    let smName = song.smName;\n\n    // special case for tohoku evolved: pick one of its types at random\n    if (song.hash === \"OddDoQ6dqi0QdQDDOO6qlO08d8bPbli1\") {\n      smName = smName.replace(\"1\", Math.floor(Math.random() * 4) + 1);\n    }\n\n    try {\n      const sm = await fetchDocument(\n        `${getOriginPath()}simfiles/${encodeURIComponent(smName)}.${\n          song.useSsc ? \"ssc\" : \"sm\"\n        }`\n      );\n\n      setSelectedSM(sm);\n    } catch (err) {\n      alert(err);\n    }\n  };\n\n  const onDifficultySelect = (difficulty) => {\n    // setSelectedDifficulty(difficulty);\n    props.selectDifficulty(difficulty);\n  };\n  const onModeSelect = (mode) => {\n    props.selectMode(mode);\n  };\n\n  const changeActiveView = (view) => {\n    setActiveView(view);\n    AudioPlayer.activeView = view;\n  };\n\n  return (\n    <div className=\"main-container\">\n      {!loadingSimfiles && (\n        <>\n          <ChartArea\n            loadingAudio={loadingAudio}\n            // selectedSong={selectedSong}\n            // selectedDifficulty={selectedDifficulty}\n            // selectedMode={selectedMode}\n            sm={selectedSM}\n            selectedAudio={selectedAudio}\n            gameEngine={gameEngine}\n            setGameEngine={setGameEngine}\n          />\n\n          <SongForm\n            activeView={activeView}\n            setActiveView={changeActiveView}\n            simfileList={simfileList}\n            // selectedDifficulty={selectedDifficulty}\n            // selectedMode={selectedMode}\n            onSongSelect={onSongSelect}\n            onDifficultySelect={onDifficultySelect}\n            onModeSelect={onModeSelect}\n            loadingAudio={loadingAudio}\n          />\n\n          <ModsForm activeView={activeView} />\n\n          <MobileNav activeView={activeView} setActiveView={changeActiveView} />\n        </>\n      )}\n    </div>\n  );\n};\n\nconst mapStateToProps = (state) => {\n  return {};\n};\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    selectSong: (song) => dispatch(selectSong(song)),\n    selectDifficulty: (song) => dispatch(selectDifficulty(song)),\n    selectMode: (song) => dispatch(selectMode(song)),\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MainContainer);\n","import React from \"react\";\n\nimport MainContainer from \"./containers/main/MainContainer\";\n\nfunction App() {\n  return (\n    <div className=\"app-container\">\n      <MainContainer />\n    </div>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { Provider } from \"react-redux\";\nimport \"semantic-ui-css/semantic.min.css\";\n\nimport \"./styles.scss\";\nimport App from \"./App\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}